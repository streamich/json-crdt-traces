[[1000000,259780],[4,[-1,259779],[[[-1,259777],"\\documentclass["],[[-1,259762],18],[[-1,259744],"10pt"],[[-1,135083],",journal,compsoc"],[[-1,259740],"]{"],[[-1,135060],"IEEEtran"],[[-1,259738],7],[[-1,259731],"}"],[[-1,31613],"\n\\PassOptionsToPackage{hyphens}{url}"],[[-1,31929],1],[[-1,31841],1],[[-1,31928],35],[[-1,259730],"\n\\usepackage"],[[-1,259716],"[utf8]{inputenc}"],[[-1,258158],"\n\\usepackage{amsmath} % align e"],[[-1,258123],"nvironment"],[[-1,223119],"\n\\usepackage{amssymb} % mathbb"],[[-1,258127],2],[[-1,259700],"\n"],[[-1,135005],1],[[-1,259699],51],[[-1,233321],1],[[-1,233320],"\\usepackage{"],[[-1,232517],"bussproofs"],[[-1,232507],1],[[-1,232559],9],[[-1,232548],1],[[-1,232550],1],[[-1,233233],8],[[-1,233304],10],[[-1,233294],"} % "],[[-1,233275],"notation for "],[[-1,233290],"inference rules"],[[-1,175054],"\n\\usepackage{rotating} "],[[-1,175029],"% sidewaysfigure"],[[-1,31657],22],[[-1,31683],"\n"],[[-1,31550],"\\usepackage{hyperref}"],[[-1,31551],"\n"],[[-1,31682],25],[[-1,31803],1],[[-1,31802],"\\usepackage[hyphenbreaks]{breakurl} % Fix URL line breaking when using dvips (e.g. arxiv.org)"],[[-1,31867],12],[[-1,31850],9],[[-1,31855],5],[[-1,155985],18],[[-1,175013],1],[[-1,175031],1],[[-1,233308],2],[[-1,259648],44],[[-1,134951],1],[[-1,259604],21],[[-1,259583],"\n\\usepackage[n"],[[-1,135031],"ocompress"],[[-1,259569],11],[[-1,259558],"]{"],[[-1,135046],"cite"],[[-1,259556],5],[[-1,259549],1],[[-1,259548],"}"],[[-1,155631],"\n"],[[-1,103971],"\n% Theorem environments\n\\usepackage{amsthm}"],[[-1,103853],"\n\\newtheorem{definition}{Definition}"],[[-1,103928],"\n"],[[-1,103926],"\\newtheorem{theorem}{Theorem}\n\\newtheorem{lemma}[theorem]{Lemma}"],[[-1,99570],"\n\\newtheorem*{convergence-thm}{Theorem}"],[[-1,103927],"\n"],[[-1,155630],"\n% Diagrams\n\\usepackage{tikz}\n\\usetikzlibrary{arrows}\n"],[[-1,259547],"\n\\hyphenation{da"],[[-1,259527],"-"],[[-1,259524],"ta-cen-ter da-ta-cen-ters"],[[-1,244437]," "],[[-1,134949],"net-works "],[[-1,244436],"time-stamp"],[[-1,259499],"}\n"],[[-1,259497],14],[[-1,257984],1],[[-1,233124],1],[[-1,233119],37],[[-1,233046],23],[[-1,233082],18],[[-1,233123],2],[[-1,233161],1],[[-1,232668],1],[[-1,233160],20],[[-1,233023],1],[[-1,233140],15],[[-1,232727],1],[[-1,197188],"\n"],[[-1,197186],"\\newif\\if"],[[-1,50454],"includeappendix"],[[-1,197177],10],[[-1,197167],"\n\\"],[[-1,50429],"includeappendix"],[[-1,197165],10],[[-1,97156],"true"],[[-1,103858],5],[[-1,134835],4],[[-1,174998],5],[[-1,175006],4],[[-1,197155],5],[[-1,197187],"\n"],[[-1,232726],"\n\\newcommand{\\evalto}{\\"],[[-1,232674],";"],[[-1,232703],4],[[-1,232699],"\\Longrightarrow\\"],[[-1,232669],";"],[[-1,232683],4],[[-1,232679],"}"],[[-1,233125],"\n"],[[-1,257983],"\n% "],[[-1,257958],"Place"],[[-1,257951],"h"],[[-1,257946],"older character "],[[-1,257929],"l"],[[-1,257950],2],[[-1,257953],1],[[-1,257980],1],[[-1,257979],"ike \\textvisiblespace"],[[-1,257928],", but works in math mode\n\\newcommand"],[[-1,232729],"{"],[[-1,257892],"\\placeholder"],[[-1,232728],"}"],[[-1,257880],"{%\n  \\makebox[0."],[[-1,257685],"7"],[[-1,257691],1],[[-1,257864],1],[[-1,257863],"em]{%\n    \\ker"],[[-1,257843],"n.07em\n    \\vrule height.3ex\n    \\hrulefill\n    \\vrule height.3ex\n    "],[[-1,257771],"\\kern.07em\n  }%\n}"],[[-1,197150],"\n"],[[-1,156044],"\n% Span multiple columns within an alignat math environment"],[[-1,197149],"\n\\newcommand{\\multialign}[2]{%\n  \\multispan{#1}\\mbox{$\\displaystyle{}#2$}%\n}"],[[-1,257773],1],[[-1,257849],3],[[-1,259483],"\n\n\\begin{document}\n\\sloppy\n\\title{"],[[-1,203897],"A "],[[-1,203887],"Conflict-Free Replicated JSON Datatype"],[[-1,203895],4],[[-1,259449],46],[[-1,259393],14],[[-1,259379],"}\n\\author{"],[[-1,78797],"Martin Kleppmann"],[[-1,134924],8],[[-1,134916]," and A"],[[-1,78774],"lastair R. Beresford"],[[-1,134910],7],[[-1,134903],"\n\\"],[[-1,134877],"thanks{"],[[-1,78575],"M. Kleppmann and A."],[[-1,78502],"R."],[[-1,78552]," Beresford are with the"],[[-1,78556],2],[[-1,78725],20],[[-1,78705]," University of Cambridge"],[[-1,78632]," Computer Laboratory"],[[-1,78681],","],[[-1,78612]," Ca"],[[-1,78603],"mbridge,"],[[-1,78609],3],[[-1,78680]," UK.\\"],[[-1,78673],"protect\\\\"],[[-1,78664],1],[[-1,78663],"Email: \\url{mk428@cl.cam.ac.uk}"],[[-1,78528],", \\url{arb33@cl.cam.ac.uk"],[[-1,78675],1],[[-1,134870],29],[[-1,134841],"}"],[[-1,78500],"."],[[-1,134901],12],[[-1,259369],"}"],[[-1,78503],"}"],[[-1,135309],"\n\n\\IEEEtitleabstractindextext{%\n\\begin{abstract}"],[[-1,116116],"\n% "],[[-1,116102],"abstract "],[[-1,116113],"word limit"],[[-1,116092],": 100-200 words"],[[-1,116103],1],[[-1,135261],"\n"],[[-1,117151],"Many applications model their data in a general-purpose storage format such as JSON. "],[[-1,117064],"This data structure is modified by the application as a result of user input. Such modifications are well understood if "],[[-1,116942],"performed sequentially on a single copy of the data, but"],[[-1,116886],15],[[-1,116863],10],[[-1,116853]," if "],[[-1,116843],"the data is replicated"],[[-1,116821],20],[[-1,116801]," "],[[-1,116748],"and modified concurrently on multiple devices"],[[-1,79310],", it is unclear what the semantics should be"],[[-1,116703],"."],[[-1,116682]," In this paper we present an algorithm and formal semantics for a JSON data structure that automatically resolves concurrent modifications such that no updates are lost, and "],[[-1,116503],"such "],[[-1,116508],"that "],[[-1,116498],"all replicas converge towards the same state"],[[-1,45]," (a conflict-free replicated datatype or CRDT)"],[[-1,116454],". It supports arbitrarily nested list and map types"],[[-1,116394],", which can be modified by insertion, deletion and assignment"],[[-1,116399],". "],[[-1,116330],"The algorithm performs all merging client-side and does not depend on ordering guarantees from the network,"],[[-1,33890]," making i"],[[-1,33877],"t suitable for "],[[-1,33773],"deployment on "],[[-1,33779],3],[[-1,33862],"mobile devices "],[[-1,33809],"with poor network connectivity"],[[-1,33732],","],[[-1,33847],19],[[-1,33881],2],[[-1,116223],27],[[-1,116196]," in peer-to-peer networks"],[[-1,81394],","],[[-1,81393],1],[[-1,81313],3],[[-1,81392],10],[[-1,81320],7],[[-1,81382],16],[[-1,81364],37],[[-1,81366],1],[[-1,81400],3],[[-1,116171]," and in "],[[-1,116161],"messaging systems with end-to-end encryption."],[[-1,81143],20],[[-1,81117],5],[[-1,81076],48],[[-1,81020],5],[[-1,81003],2],[[-1,80997],24],[[-1,80971],53],[[-1,80908],17],[[-1,80910],1],[[-1,80918],4],[[-1,80973],1],[[-1,81001],2],[[-1,81015],6],[[-1,81028],4],[[-1,81112],18],[[-1,81123],3],[[-1,81241],1],[[-1,81202],29],[[-1,81224],11],[[-1,81240],8],[[-1,81243],1],[[-1,116163],1],[[-1,116397],3],[[-1,116403],2],[[-1,116800],1],[[-1,116751],1],[[-1,116799],24],[[-1,116849],3],[[-1,116871],4],[[-1,116944],1],[[-1,117066],1],[[-1,135260],3],[[-1,135243],1],[[-1,135242],"\n"],[[-1,135257],"\\end{abstract}"],[[-1,135241],"\n\n\\begin{IEEEkeywords}\nCRDTs, Collaborative Editing, P2P, JSON, Optimistic Replication, "],[[-1,79266],"Operational "],[[-1,135153],"Semantics, Eventual Consistency.\n\\end{IEEEkeywords}}"],[[-1,259368],"\n\\maketitle\n\n"],[[-1,259355],20],[[-1,259329],4],[[-1,135606],"\\IEEEraisesectionheading{"],[[-1,259325],"\\section{Introduction}"],[[-1,135581],"\\label{sec:introduction}}"],[[-1,259303],"\n"],[[-1,135556],"\n\\IEEEPARstart{"],[[-1,134830],"U"],[[-1,135541],1],[[-1,135540],"}{"],[[-1,134825],"sers"],[[-1,135538],4],[[-1,135534],"} "],[[-1,134821],"of"],[[-1,134819],16],[[-1,134803]," mobile devices"],[[-1,116018],","],[[-1,116061]," such as smartphones"],[[-1,116017],","],[[-1,134788]," expect"],[[-1,134781],5],[[-1,80885],13],[[-1,80872]," "],[[-1,80891],3],[[-1,134776],"application"],[[-1,116016],"s"],[[-1,134765],7],[[-1,134758]," to"],[[-1,116030]," continue"],[[-1,134755]," work"],[[-1,116021],"ing"],[[-1,134750]," while the device is offline or has poor network connectivity"],[[-1,134489],", and to synchronize its state with "],[[-1,134305],"the user's "],[[-1,134453],"other devices when the network is available"],[[-1,134689],"."],[[-1,134410]," Examples of such applications include "],[[-1,134354],"calendar"],[[-1,134338],"s"],[[-1,134346],3],[[-1,134343],", "],[[-1,134371],"address books, "],[[-1,134335],"note-taking"],[[-1,116015]," tools, to-do lists"],[[-1,134324],","],[[-1,134294]," and"],[[-1,134323]," password managers"],[[-1,134290],". "],[[-1,33335],"Similarly,"],[[-1,134288],11],[[-1,134246],18],[[-1,134228]," collaborat"],[[-1,33378],"i"],[[-1,33319],"ve work often requires several people to "],[[-1,33188],"simultaneously "],[[-1,33238],"edit"],[[-1,33278],7],[[-1,33271]," the same"],[[-1,33377],13],[[-1,134217],13],[[-1,80855],35],[[-1,80857],1],[[-1,134204],3],[[-1,134201]," "],[[-1,134190],"text "],[[-1,134200],"document"],[[-1,134192],1],[[-1,134182],", spreadsheet"],[[-1,134169],1],[[-1,134168],", presentation"],[[-1,134154],1],[[-1,134153],", graphic"],[[-1,134144],1],[[-1,134143],", and "],[[-1,134112],"other kinds of"],[[-1,134137],7],[[-1,134130]," document"],[[-1,78812],1],[[-1,33247],2],[[-1,33234],36],[[-1,33198],","],[[-1,33130]," with "],[[-1,33108],"each person's"],[[-1,33095],1],[[-1,33124],8],[[-1,33197]," edits "],[[-1,33071],"reflected on the other collaborators' copies of the document with minimal delay"],[[-1,33091],10],[[-1,33190],2],[[-1,33325],4],[[-1,134121],1],[[-1,134120],"."],[[-1,134097],1],[[-1,80780],1],[[-1,80784],4],[[-1,80779],19],[[-1,80758],9],[[-1,80747],55],[[-1,80636],34],[[-1,80594],1],[[-1,80589],39],[[-1,80593],2],[[-1,80602],4],[[-1,80692],18],[[-1,80672],9],[[-1,80674],1],[[-1,80749],1],[[-1,80760],1],[[-1,80785],"\n"],[[-1,134096],"\nWhat these "],[[-1,134082],"applications have in common is that the "],[[-1,134042],5],[[-1,134037],"application state needs to be replicated to several devices, each of which may modify the state locally. "],[[-1,80518],"T"],[[-1,80550],2],[[-1,115870],28],[[-1,115842],"he "],[[-1,115838],"t"],[[-1,133756],1],[[-1,133928],44],[[-1,133884],"raditional "],[[-1,115896],"approach"],[[-1,115888],2],[[-1,115886]," to "],[[-1,133873],"concurrency control"],[[-1,115871],","],[[-1,80517]," serializability,"],[[-1,133854],1],[[-1,133835],34],[[-1,133801]," "],[[-1,133755],"would cause the application to become unusable at times of poor network connectivity"],[[-1,115996],"~\\cite{Davidson:1985hv}"],[[-1,115967],"."],[[-1,133671],1],[[-1,133670]," "],[[-1,115962],"If we require "],[[-1,115811],"that "],[[-1,115948],"applications"],[[-1,115936],3],[[-1,115933]," work regardless of "],[[-1,115913],4],[[-1,115909],"network"],[[-1,80496]," availability"],[[-1,115902],","],[[-1,133669],1],[[-1,115965],1],[[-1,133668],1],[[-1,133667]," we must assume that users can make arbitrary modifications concurrently on different devices, and"],[[-1,115901]," that"],[[-1,133569]," any resulting conflicts must be resolved.\n\nThe simplest way "],[[-1,80481],"to"],[[-1,133508],2],[[-1,133506]," res"],[[-1,133494],"olv"],[[-1,80474],"e"],[[-1,133491],1],[[-1,80477],1],[[-1,133490],2],[[-1,133488]," confl"],[[-1,133474],"icts is to discard some "],[[-1,133450],9],[[-1,133441],"modifications "],[[-1,80460],"when"],[[-1,133427],3],[[-1,133321],1],[[-1,133320]," "],[[-1,80456],"a "],[[-1,133390],"conflict"],[[-1,133382],1],[[-1,133381]," occur"],[[-1,133375],1],[[-1,80452],"s"],[[-1,133374],2],[[-1,133372],", "],[[-1,133291],"for example using a"],[[-1,133370],27],[[-1,133343]," ``last writer wins''"],[[-1,133272]," policy"],[[-1,133322],"."],[[-1,133265]," However, this approach is unde"],[[-1,133232],"sirable as it incurs data loss. An alternative is to let the user manually resolve the conflict, which is tedious"],[[-1,29625]," and error-prone,"],[[-1,80448]," and therefore should be"],[[-1,80450],1],[[-1,133119]," "],[[-1,80424],"avoided whe"],[[-1,80411],"never possible."],[[-1,80396],1],[[-1,80413],1],[[-1,133118],60],[[-1,115803],"\n\nCurrent"],[[-1,115790]," applications solve this problem with a range of ad-hoc and application-specific mechanisms"],[[-1,115675],"."],[[-1,115615]," In this paper we present "],[[-1,115571],"a"],[[-1,115381]," general-purpose"],[[-1,115570]," datatype that provides the full expressiveness of the JSON data model, and "],[[-1,44245],"supports "],[[-1,115494],25],[[-1,115469],"concurrent modifications without loss of information."],[[-1,43976]," As we shall see later, "],[[-1,43870],"our approach"],[[-1,43695]," typically "],[[-1,43682],"supports the "],[[-1,43657],"automatic merging of "],[[-1,43504],"concurrent "],[[-1,43636],"modifications into a JSON data structure. "],[[-1,42878],"We"],[[-1,43594],3],[[-1,43587],9],[[-1,43591],2],[[-1,43669],6],[[-1,43684],1],[[-1,43858]," "],[[-1,43486],"introduce"],[[-1,43477],1],[[-1,43476]," a"],[[-1,42860]," single,"],[[-1,43474]," general mechan"],[[-1,50],"is"],[[-1,43459],2],[[-1,43457],"m (a "],[[-1,43516],4],[[-1,43565],12],[[-1,43767],14],[[-1,43753],"multi-va"],[[-1,43741],"lue re"],[[-1,43731],"gister"],[[-1,43452],")"],[[-1,42875]," into our model"],[[-1,43725]," to record"],[[-1,43715],10],[[-1,43705]," conflict"],[[-1,43542],"ing u"],[[-1,43533],"pdates"],[[-1,43512]," to leaf"],[[-1,43451]," n"],[[-1,43447],"odes"],[[-1,43405]," in the "],[[-1,43395],"J"],[[-1,43392],"SON data structure"],[[-1,43130],"."],[[-1,43394],1],[[-1,43397],1],[[-1,43443],1],[[-1,43442]," "],[[-1,43128],"T"],[[-1,43205],1],[[-1,43204],"his"],[[-1,43441],31],[[-1,43410]," "],[[-1,43370],"me"],[[-1,43366],"chan"],[[-1,38815],"i"],[[-1,43362],"s"],[[-1,43361],1],[[-1,43356],"m"],[[-1,43339]," "],[[-1,43196],"then pro"],[[-1,43186],"vides a "],[[-1,43118],"consistent basis"],[[-1,43178],3],[[-1,43169],6],[[-1,43163]," on which"],[[-1,43175],3],[[-1,43188],1],[[-1,43338],5],[[-1,43333]," applications can"],[[-1,43316],5],[[-1,43311]," resolve"],[[-1,43092]," any remaining"],[[-1,43303],1],[[-1,43148],4],[[-1,43144]," conflicts"],[[-1,43302],6],[[-1,43296]," "],[[-1,43051],"throug"],[[-1,43043],"h "],[[-1,42945],"programmatic means"],[[-1,42852],","],[[-1,42927]," or"],[[-1,43041],9],[[-1,42987],15],[[-1,43032],3],[[-1,43029]," "],[[-1,42894],"via "],[[-1,42912],"further user input"],[[-1,43028],12],[[-1,43045],1],[[-1,43295],3],[[-1,43290],2],[[-1,43286],8],[[-1,43134],1],[[-1,43278],12],[[-1,43133],1],[[-1,43266],29],[[-1,43237],"."],[[-1,43288],1],[[-1,43292],1],[[-1,43355],8],[[-1,43360],2],[[-1,43368],1],[[-1,43409],4],[[-1,43449],1],[[-1,43527]," "],[[-1,43537],2],[[-1,43696],1],[[-1,43735],2],[[-1,43745],2],[[-1,43857],29],[[-1,43826],9],[[-1,43813],4],[[-1,43817],2],[[-1,43828],1],[[-1,43952],14],[[-1,43902],9],[[-1,43938],18],[[-1,43980],2],[[-1,115416]," We expect that "],[[-1,115365],"implementations of "],[[-1,115400],"this datatype will"],[[-1,115346]," "],[[-1,115329],"drastically simplify the development of collaborative and state-synchronizing applications for mobile devices."],[[-1,80334],"\n"],[[-1,80333],19],[[-1,80304],14],[[-1,80288],70],[[-1,80216],25],[[-1,80187],8],[[-1,80173],28],[[-1,80137],62],[[-1,80073],7],[[-1,80064],4],[[-1,80046],19],[[-1,80058],6],[[-1,80060],1],[[-1,80066],1],[[-1,80075],1],[[-1,80145],4],[[-1,80179],3],[[-1,80191],2],[[-1,80218],1],[[-1,80290],1],[[-1,80314],5],[[-1,115345],8],[[-1,115382],1],[[-1,115589],9],[[-1,115674],59],[[-1,115699],12],[[-1,115794],2],[[-1,133234],1],[[-1,133424],17],[[-1,133482],4],[[-1,133502],4],[[-1,133853],9],[[-1,133932],2],[[-1,134084],1],[[-1,134184],1],[[-1,134191],1],[[-1,134277],1],[[-1,134276],"\n"],[[-1,115136],"\\subsection{JSON "],[[-1,7467],"D"],[[-1,115119],1],[[-1,115118],"ata "],[[-1,7465],"M"],[[-1,115114],1],[[-1,115113],"odel}"],[[-1,115060],"\n\nJSON"],[[-1,114871]," is a popular general-purpose data encoding format"],[[-1,114811],", used in many databases and web services"],[[-1,114821],"."],[[-1,115054]," "],[[-1,114957],"It has similarities to XML, and we compare them "],[[-1,114909],8],[[-1,114901],"in "],[[-1,104374],"S"],[[-1,114898],1],[[-1,114897],"ection~\\ref{sec:json-xml}."],[[-1,114812]," "],[[-1,114770],"The structure of a JSON document can optionally be constrained by a schema"],[[-1,114610],";"],[[-1,114570]," however,"],[[-1,114609]," for simplicity,"],[[-1,114696],5],[[-1,114691]," "],[[-1,114690],3],[[-1,114687],"this paper "],[[-1,114579],"discusses"],[[-1,114676],11],[[-1,114665]," "],[[-1,114660],"only untyped JSON without an explicit schema."],[[-1,114561],"\n\nA JSON document is a tree con"],[[-1,113314],"taining two"],[[-1,113324],5],[[-1,114530],24],[[-1,114506]," types of "],[[-1,113974],"branch "],[[-1,114496],"node:\n\n\\begin{description}"],[[-1,114452],"\n\\item[Map:] A"],[[-1,114438],7],[[-1,114431]," node whose children "],[[-1,114380],"have no defined order, and where each child is labelled with a string \\emph{key}. A key uniquely identifies one of the children."],[[-1,113855]," "],[[-1,108300],"We treat "],[[-1,108290],"k"],[[-1,113854],1],[[-1,113853],"eys "],[[-1,108286],"as"],[[-1,113849],3],[[-1,113846]," immutable, but values a"],[[-1,108282],"s"],[[-1,113822],2],[[-1,113820]," mutable, and key-value mappings can be added and removed from the map."],[[-1,114252]," A JSON map is also known as an \\emph{object}."],[[-1,113857],1],[[-1,114206],"\n\\item"],[[-1,114193],"["],[[-1,114200],1],[[-1,114199],"List:"],[[-1,114192],"] A "],[[-1,114188],7],[[-1,114181],"node whose children have an order defined by the application."],[[-1,113749]," The list can be mutated by inserting or deleting list elements."],[[-1,114120]," "],[[-1,114115],"A JSON list is also known as an \\emph{array}."],[[-1,114070],83],[[-1,113984],1],[[-1,113987],3],[[-1,113983],8],[[-1,114119],2],[[-1,114410],15],[[-1,114470],"\n\\end{description}"],[[-1,113859],"\n\n"],[[-1,113649],"A child of a branch node can be either another branch node, or a leaf node. A"],[[-1,113651],1],[[-1,113685],3],[[-1,113682]," lea"],[[-1,113569],"f"],[[-1,113678],3],[[-1,113675]," of the tree contain"],[[-1,113567],"s a primitive value (string, number, boolean, or null). We treat primitive values as immutable, but allow "],[[-1,113457],"the value of a leaf node to be modified by treating it as a \\emph{register} that can be assigned a new value."],[[-1,113303],"\n"],[[-1,113194],"\nThis model is sufficient to express the state of a wide range of applications. For example, a text document can be represented by a"],[[-1,113062],9],[[-1,113053]," list of "],[[-1,113003],"single-"],[[-1,113044],5],[[-1,113030],6],[[-1,113024],"character"],[[-1,112995]," strings; character-by-character edits are then expressed as insertions and deletions of list elements."],[[-1,112891]," "],[[-1,113015],1],[[-1,113302],1],[[-1,113299],"In "],[[-1,104372],"S"],[[-1,113296],1],[[-1,113295],"ection~\\ref{sec:e"],[[-1,113276],"xamples} we "],[[-1,42839],"describe four more complex"],[[-1,113264],5],[[-1,112879],7],[[-1,113259],5],[[-1,113250],6],[[-1,113244]," examples of using JSON to model application data."],[[-1,112872],"\n\n\\subsection{"],[[-1,112819],"Replication "],[[-1,112797],"and "],[[-1,7463],"C"],[[-1,112793],1],[[-1,112792],"onflict "],[[-1,7461],"R"],[[-1,112784],1],[[-1,112783],"esolution"],[[-1,112807],5],[[-1,112858],19],[[-1,112839],"}"],[[-1,104303],"\\label{sec:intro-replication}"],[[-1,104309],3],[[-1,113254],2],[[-1,113278],1],[[-1,113301],1],[[-1,113461],2],[[-1,113655],1],[[-1,114664],2],[[-1,134275],14],[[-1,134255],9],[[-1,134261],3],[[-1,134356],2],[[-1,135532],199],[[-1,259212],"\n"],[[-1,259179],6],[[-1,259211],6],[[-1,259194],15],[[-1,259205],11],[[-1,259302],1],[[-1,225031],"\n"],[[-1,225029],223],[[-1,224565],46],[[-1,224518],6],[[-1,224519],1],[[-1,225030],1],[[-1,111396],1],[[-1,111394],"We consider systems in which a full copy of the JSON document is replicated on several devices. Those devices could be servers in datacenters, but we "],[[-1,111218],"focus on mobile devices such as smartphones"],[[-1,111161]," and laptops"],[[-1,111148],", which have intermittent network connectivity"],[[-1,111149],"."],[[-1,108382]," We do not distinguish between devices owned by the same user and different users."],[[-1,111102]," Our model allows each "],[[-1,111073],"device to "],[[-1,108690],"optimistically "],[[-1,111063],"modify its local "],[[-1,111036],"replica of the document, and to asynchronously propagate those edits to other replicas."],[[-1,108675],1],[[-1,110949],"\n\n"],[[-1,110941],"Our only requirement of the network is "],[[-1,110902],23],[[-1,110879],"that messages"],[[-1,110386]," sent by one replica"],[[-1,110866]," are eventually deli"],[[-1,110840],"vered"],[[-1,110402]," to all"],[[-1,110366]," other"],[[-1,110395]," replicas"],[[-1,110812],", "],[[-1,110710],"by "],[[-1,110766],16],[[-1,110750],"retrying if "],[[-1,110698],"delivery fails"],[[-1,110738],9],[[-1,110729],"."],[[-1,110684]," "],[[-1,105681],"We assume the"],[[-1,110629],3],[[-1,110626]," network "],[[-1,105655],"may"],[[-1,110617],13],[[-1,110604]," arbitrarily "],[[-1,105704],"de"],[[-1,105694],"lay, "],[[-1,105702],4],[[-1,110591],"re"],[[-1,110583],"order "],[[-1,105687],"and"],[[-1,110577],2],[[-1,110575]," duplicate messages."],[[-1,108280],"\n\n"],[[-1,110555],1],[[-1,110548],"Our algorithm "],[[-1,110411],"works"],[[-1,110534],24],[[-1,110510]," client"],[[-1,110406],"-"],[[-1,110503],"s"],[[-1,110405],"ide"],[[-1,110502]," and does not depend on any server to transform or process message"],[[-1,110245],"s. T"],[[-1,110436],1],[[-1,110360],3],[[-1,110357],"his approach allows"],[[-1,108278]," messages to be delivered via"],[[-1,110338]," a peer-to-peer network "],[[-1,42800],"as well as"],[[-1,42808],3],[[-1,42810],2],[[-1,110314],3],[[-1,110311]," a secure messaging protocol"],[[-1,110118]," with end-to-end encryption"],[[-1,110281],"~\\cite{Unger:2015kg}"],[[-1,42778],". T"],[[-1,110261],11],[[-1,110241],12],[[-1,110229],"he details of the network implementation and "],[[-1,110184],4],[[-1,110180],"cryptographic protocols are outside of the scope of this paper"],[[-1,110250],"."],[[-1,110283],1],[[-1,110554],3],[[-1,110589],3],[[-1,110683],27],[[-1,110728],1],[[-1,110810],22],[[-1,110846],3],[[-1,110947],3],[[-1,111046],5],[[-1,111079],3],[[-1,111175],7],[[-1,111220],1],[[-1,111224],2],[[-1,111244],10],[[-1,111395],"\n"],[[-1,154551],"\n"],[[-1,109995],"In "],[[-1,104370],"S"],[[-1,109992],1],[[-1,109991],"ection~\\ref{sec:semantics} we "],[[-1,79248],"define"],[[-1,109955],5],[[-1,108026],1],[[-1,108025]," "],[[-1,109950],"formal semantics"],[[-1,109934],5],[[-1,109929]," describ"],[[-1,79235],"ing"],[[-1,109921],2],[[-1,109919]," how conflicts are resolved"],[[-1,109961],3],[[-1,109996]," "],[[-1,109891],"w"],[[-1,110090],1],[[-1,110089],"hen "],[[-1,109887],"a"],[[-1,110085],3],[[-1,110082]," JSON document is concurrently modified on different devices"],[[-1,109881],"."],[[-1,110022],5],[[-1,110091]," "],[[-1,154549],"Our design is based on"],[[-1,154527],4],[[-1,154523]," "],[[-1,105647],"three"],[[-1,154006],1],[[-1,108232],4],[[-1,154005],2],[[-1,154003]," "],[[-1,154522],"simple principles:"],[[-1,154502],"\n\\begin{enumerate}\n\\item All replicas of the data structure should "],[[-1,153759],"automatically "],[[-1,153813],5],[[-1,154435],"converge towards the same s"],[[-1,154406],"tate"],[[-1,29608]," (a requirement known as \\emph{strong eventual consistency}~\\cite{Shapiro:2011un})"],[[-1,154402],"."],[[-1,154329],7],[[-1,154314],26],[[-1,154282],85],[[-1,154147],11],[[-1,154197],8],[[-1,154288],3],[[-1,154316],1],[[-1,154322],3],[[-1,154401],"\n\\item No user input should be lost due to concurrent modifications."],[[-1,108228],"\n\\item "],[[-1,108187],"If all sequential permutations of"],[[-1,107222]," a set of"],[[-1,108154]," updates lead to the same state, then concurrent execution of those updates also leads to the same state~\\cite{Bieniusa:2012gt}."],[[-1,108213],13],[[-1,108221],4],[[-1,153803],22],[[-1,154408],1],[[-1,154504],1],[[-1,154550],"\n"],[[-1,154189],"\\end{enumerate}\n"],[[-1,154172],"\n"],[[-1,109585],"\\subsection{Our "],[[-1,7459],"C"],[[-1,109569],1],[[-1,109568],"ontributions}"],[[-1,154171],7],[[-1,153996],38],[[-1,153931],21],[[-1,153958],27],[[-1,153910],28],[[-1,153868],7],[[-1,153724],14],[[-1,153861],10],[[-1,153710],21],[[-1,153851],38],[[-1,153745],1],[[-1,153683],97],[[-1,153744],6],[[-1,153882],7],[[-1,154164],5],[[-1,154155],1],[[-1,154159],2],[[-1,154173],"\n"],[[-1,109528],"\nOur main contribution in this work is to define an algorithm and f"],[[-1,109459],"ormal semantics for collaborative, concurrent editing of JSON data structures with automatic conflict resolution. Although similar algorithms have previously been defined for lists, maps and registers individually"],[[-1,109126]," (see "],[[-1,104368],"S"],[[-1,109120],1],[[-1,109119],"ection~\\ref{sec:related})"],[[-1,109246],", to our knowledge this paper is the first to integrate all of these structures into an arbitrarily composable datatype"],[[-1,32557]," that can be deployed on any network topology"],[[-1,109127],"."],[[-1,32992],"\n\n"],[[-1,32937],"A key requirement of conflict resolution is that"],[[-1,32681]," after any sequence of concurrent modifications,"],[[-1,32889]," "],[[-1,32771],"all "],[[-1,32888],"replicas"],[[-1,32767]," eventually"],[[-1,32880]," converge towards the same state"],[[-1,32631],"."],[[-1,32848],77],[[-1,32938]," "],[[-1,32990],"In Section~\\ref{sec:convergence} and the appendix"],[[-1,32630]," we prove"],[[-1,32575]," a theorem to show"],[[-1,32621]," that our algorithm satisfies this requirement"],[[-1,32939],"."],[[-1,32941],1],[[-1,109094],"\n\nComposing maps and lists into arbitrarily nested structures opens up subtle challenges that do not arise in flat structures, due to the possibility of "],[[-1,108937],"concurrent "],[[-1,108941],"edit"],[[-1,108926],"s at different levels of the tree. We illustrate some of those challenges by example in "],[[-1,104366],"S"],[[-1,108838],1],[[-1,108837],"ection~\\ref{sec:examples}. "],[[-1,80001],1],[[-1,80000],"N"],[[-1,80027],3],[[-1,108810],20],[[-1,108790],"ested structures are an important requirement for many applications"],[[-1,79997],"."],[[-1,32511]," "],[[-1,108723],33],[[-1,108673],48],[[-1,79996],1],[[-1,79905],"Consequently"],[[-1,32510],","],[[-1,79893]," the long-term goal of our work is to"],[[-1,108625],10],[[-1,108615]," simplify"],[[-1,108606],4],[[-1,108602]," the development of applications that use optimistic replication"],[[-1,79848]," by providing a"],[[-1,79803]," general algorithm "],[[-1,79782],"for conf"],[[-1,79772],"lict resolution"],[[-1,79638]," "],[[-1,79529],"whose details can largely be "],[[-1,79496],"hidden inside an easy-to-use soft"],[[-1,79461],"ware"],[[-1,79463],1],[[-1,79500],2],[[-1,79637],21],[[-1,79598],20],[[-1,79578]," library"],[[-1,79457],"."],[[-1,79616],9],[[-1,79744],8],[[-1,79734],12],[[-1,79698],20],[[-1,79722],12],[[-1,79736],1],[[-1,79756],6],[[-1,79774],1],[[-1,79784],1],[[-1,79831],10],[[-1,79817],2],[[-1,79821],2],[[-1,79833],1],[[-1,79850],1],[[-1,79852],1],[[-1,108538],1],[[-1,109461],1],[[-1,132953],1],[[-1,130159],355],[[-1,129804],"\n\n\\section{Related"],[[-1,128979]," "],[[-1,7457],"W"],[[-1,128978],1],[[-1,128977],"ork}"],[[-1,109555],"\\"],[[-1,109546],"label{sec:related}"],[[-1,108537],"\n\nIn this section we discuss existing approaches to optimistic replication, collaborative editing and conflict resolution."],[[-1,109554],4],[[-1,128973],"\n\n\\subsect"],[[-1,129786],"ion{Operational "],[[-1,7455],"T"],[[-1,129770],1],[[-1,129769],"ransformation}\\label{sec:relate"],[[-1,128963],"d-ot}\n\nAlgorithms based on \\emph{operational transformation} (OT"],[[-1,129738],") have long been used for collaborative editing "],[[-1,128899],"applications~\\cite{Ellis:1989"],[[-1,128868],"ue,Ressel:1996wx,Sun:1998vf,Nichol"],[[-1,128870],1],[[-1,129690],"s:1995fd}. Most of them treat a document as a si"],[[-1,128834],"ngle ordered list (of characters, for example) "],[[-1,129642],"and do not support"],[[-1,129624],4],[[-1,79456],2],[[-1,129620]," nested tree structures that are required "],[[-1,79445],"by"],[[-1,129578],3],[[-1,129575]," many applications. Some algor"],[[-1,129545],1],[[-1,129544],"ithms generalize OT to editing XML documents~\\cite{Davis:2002iv,Ignat:2003jy,Wang:2015vo}, which provides nesting of ord"],[[-1,129424],1],[[-1,129423],"ered lists, but these algorithms do not support key-value maps as defined in this paper"],[[-1,108415]," (see "],[[-1,104364],"S"],[[-1,108409],1],[[-1,108408],"ection~\\ref{sec:json-xml})"],[[-1,129336],"."],[[-1,107480]," "],[[-1,107350],"T"],[[-1,107479],10],[[-1,107401],1],[[-1,107400],"he "],[[-1,107469],"performanc"],[[-1,107397],"e of OT algorithms degrades rapidly "],[[-1,107349],"as the number of concurrent operations increases~\\cite{Li:2006kd"],[[-1,29526],",Mehdi:2011ke"],[[-1,107285],"}."],[[-1,107459],29],[[-1,128785],"\n\nMost deployed OT collaboration systems, including Google Docs~\\cite{DayRichter:2010tt}, Etherpad~"],[[-1,128684],"\\cite{Etherpad:2011um}, Novell Vibe~\\cite{Spiewak:2010vw} and Apache Wave (formerly Google Wave~\\cite{Wang:2015vo}), rely on a single server to decide on a total ordering of operations~\\cite{Lemonik:2016wh}, a design decision inherited from the Jupiter system~\\cite{Nichols:1995fd}. This approach has the advantage of making the trans"],[[-1,128346],"formation functions simpler and less error-prone~\\cite{Imine:2003ks}, but it does not meet our requirements, since we want to support peer-to-peer collaboration without requiring a single server.\n\nMany secure messaging protocols, which we plan to use for encrypted collaboration, do not guarantee that different recipients will see messages in the same order~\\cite{Unger:2015kg}. Although it is possible to decide on a tot"],[[-1,127918],"al ordering of operations"],[[-1,414]," without using a single server"],[[-1,127893]," by using an atomic broadcast protocol~\\cite{Defago:2004ji}, "],[[-1,127832],41],[[-1,127791],"such protocols are equivalent to consensus~\\cite{Chandra:1996cp}, so they can only safely make progress if a "],[[-1,537],"quorum"],[[-1,127682],8],[[-1,127674]," of participants are"],[[-1,127654],11],[[-1,127643]," reachable. We expect that in peer-to-peer systems of mobile devices"],[[-1,332]," participants"],[[-1,127575],3],[[-1,127572]," will frequently be"],[[-1,127553],15],[[-1,442],4],[[-1,127538],34],[[-1,480],1],[[-1,479]," offline"],[[-1,471],11],[[-1,127504],25],[[-1,127479],", and so any algorithm"],[[-1,127455]," requiring atomic broadcast would "],[[-1,531],"struggle to reach a quorum and "],[[-1,127421],"become unavailable. "],[[-1,438],"Without quorums, "],[[-1,420],"t"],[[-1,127401],1],[[-1,127400],"he strongest guarantee "],[[-1,127377],5],[[-1,127372],"a system can give is causal ordering~"],[[-1,127333],"\\cite{Attiya:2015dm}.\n\nThe Google Realtime API~\\cite{Goog"],[[-1,127274],"le:2015vk} is "],[[-1,127203],"to our knowledge "],[[-1,127260],"the only implementation of OT "],[[-1,127230],22],[[-1,127208],"that "],[[-1,127164],"supports arbitrary nesting of lists and maps. Like Google Docs, it relies on a single server~\\cite{Lemonik:2016wh}. As a proprietary product, details of its algorithms have not been published.\n\n\\subsection{CRDTs}\\label{sec:related-crdts}\n"],[[-1,108024],"\nConflict-free replicated datatypes "],[[-1,107955],"(CRDT"],[[-1,107948],"s"],[[-1,107950],") "],[[-1,107988],"are a family of data structures "],[[-1,107947],"that "],[[-1,79437],"support"],[[-1,107942],6],[[-1,107936]," concurrent"],[[-1,107925],2],[[-1,107923]," modifi"],[[-1,79426],"cation"],[[-1,107916],2],[[-1,107914]," and "],[[-1,107909],5],[[-1,107904],"guarantee convergence of"],[[-1,107880],5],[[-1,107875]," concurrent updates."],[[-1,107725],41],[[-1,107855]," They work by attaching additional metadata to the data structure,"],[[-1,107789],4],[[-1,107785]," making modification operations commutative by construction."],[[-1,107283]," The JSON datatype described in this paper is a "],[[-1,107235],8],[[-1,107227],"CRDT."],[[-1,107643],31],[[-1,107610],42],[[-1,107612],1],[[-1,107956],"\n"],[[-1,126926],"\nCRDTs for registers, counters, maps"],[[-1,77],","],[[-1,126890]," and sets are w"],[[-1,29499],"ell-"],[[-1,126875],6],[[-1,126869],"known~\\cite{Shapiro:2011un,Shapiro:2011wy}, and have been implemented in various deployed systems such as Riak~\\cite{Brown:2014hs,Brown:2013wy}. For ordered lists, various algorithms have been proposed, incl"],[[-1,126660],"uding WOOT~\\cite{Oster:2006wj}, RGA~\\cite{Roh:2011dw}, Treedoc~\\cite{Preguica:2009fz}, Logoot~\\cite{Weiss:2010hx}"],[[-1,78],","],[[-1,126547]," and LSEQ~\\cite{Nedelec:2013ky}."],[[-1,31507]," Attiya et al.~\\cite{Attiya:2016kh} "],[[-1,31471],8],[[-1,31463],"analyze "],[[-1,31447],"the "],[[-1,31330],"metadata overhead of"],[[-1,31443],10],[[-1,31433]," collaborative"],[[-1,31310],"ly"],[[-1,31419]," edit"],[[-1,31305],"ed"],[[-1,31414],3],[[-1,31411]," "],[[-1,31410],11],[[-1,31399],"lists, and provide a correctness proof of the RGA "],[[-1,29487],"algorithm"],[[-1,31349],8],[[-1,31341],"."],[[-1,126515]," However, none of them support nesting: "],[[-1,31296],"all of the"],[[-1,31271]," "],[[-1,31230],"aforementioned"],[[-1,31270],8],[[-1,31286],2],[[-1,31284]," algorithms"],[[-1,31262]," "],[[-1,31261],23],[[-1,126475],5],[[-1,126470],"assume that "],[[-1,31189],"each of "],[[-1,31167],"their"],[[-1,31181],3],[[-1,126458],3],[[-1,126455]," elements "],[[-1,31175],"is a"],[[-1,126445],27],[[-1,126418]," "],[[-1,107489],"primitive"],[[-1,126417],6],[[-1,126411]," value"],[[-1,126405],1],[[-1,126404],", not another CRDT.\n\nThe problem of nesting one CRDT inside another (also known as \\emph{composition} or \\emph{embedding}) has only been studied more recently. Riak allows nesting of counters and registers inside maps, and of maps within other maps~\\cite{Brown:2014hs,Brown:2013wy}. Embedding counters inside maps raises questions of semantics, which have been studied by Baquero, Almeida and Lerche~\\cite{Baquero:2016iv}. Almeida et a"],[[-1,125967],"l.~\\cite{Almeida:2016tk} also define delta mutations for nested maps, and Baquero et al.~\\cite{Baquero:2015tm} define a theoretical framework for composition of state-based CRDTs, based on lattices. None of this work integrates CRDTs for ordered lists, but the treatment of causality in these datatypes forms a basis for the semantics developed in this paper.\n\nBurckhardt et al."],[[-1,125579],"~\\cite{Burckhardt:2012jy} define \\emph{cloud types}, which are similar to CRDTs and can be composed. They define \\emph{cloud arrays}, which behave similarly to our map datatype"],[[-1,125401],", and \\emph{entities}, which are like unordered sets or relations; ordered lists are not defined in this frame"],[[-1,125287],"work."],[[-1,31162],"\n\n"],[[-1,30981],"On the other hand, "],[[-1,31160],"Martin et al.~\\cite{Martin:2010ih} generalize Logoot~\\cite{Weiss:2010hx} to support collaborative editing of XML documents~-- that is, a tree of nested ordered lists"],[[-1,30925],3],[[-1,30922]," without "],[[-1,30893],"nested maps"],[[-1,30913],10],[[-1,30995],". As discussed"],[[-1,30962]," in Section~\\ref{sec:json-xml}, such "],[[-1,30879],"a structure does not capture the expressiv"],[[-1,30822],"eness"],[[-1,30837],3],[[-1,30834]," of JSON."],[[-1,125282],62],[[-1,125220],"\n\nAlthough CRDTs for registers, maps and ordered lists have existed for years in isolation, we are not aware of any prior work that allows them all"],[[-1,125069]," to be composed into an arbitrarily nested CRDT with a JSON-like structure.\n\n\\subsection{Other"],[[-1,7453]," "],[[-1,7451],"A"],[[-1,124975],2],[[-1,124973],"pproaches}\\label{sec:related-other}\n\nMany replicated data systems need to deal with the problem of concurrent, conflicting modifications, but the solutions are often ad-hoc. For example, in Dynamo~\\cite{DeCandia:2007ui}"],[[-1,28676]," and CouchDB"],[[-1,124754],", if several values are concurrently written to the same key, the database preserves all of these values, and leaves conflict resolution to application code"],[[-1,32509]," -- in other words, the only datatype it supports is a multi-value register"],[[-1,124598],". Naively chosen merge functions often exhibit anomalies such as "],[[-1,124525],"deleted items reappearing~\\cite{DeCandia:2007ui}. "],[[-1,106825],"We believe that conflict"],[[-1,124475],54],[[-1,124421]," resolution is not a simple matter tha"],[[-1,124379],"t can reasonably be left to application programmers.\n\nAnother frequently-used approach to conflict resolution is \\emph{last writer wins} (LWW), which arbitrarily chooses one among several concurrent writes as ``winner'' and discards the others. "],[[-1,28684],"LWW"],[[-1,124134],13],[[-1,124121]," is used in Apache Cassandra, "],[[-1,28596],"for example"],[[-1,124091],15],[[-1,124074],53],[[-1,124021],". "],[[-1,28678],"It"],[[-1,124019],3],[[-1,124014]," does not meet our requirements, since we want no user input to be lost due to concurrent modifications."],[[-1,264],"\n\nResolving concurrent updates on tree structures has been studied in the context of file"],[[-1,175],6],[[-1,169]," synchronization~\\cite{Balasubramaniam:1998jh,Ramsey:2001ce"],[[-1,108],"}."],[[-1,110],1],[[-1,36385],29],[[-1,36354],22],[[-1,36330],16],[[-1,36332],1],[[-1,36356],1],[[-1,36387],1],[[-1,123910],"\n\nFinally, systems such as Bayou~\\cite{Terry:1"],[[-1,123862],"995dn} allow offline nodes to execute transactions tentatively, and "],[[-1,123788],"confirm them when they are next online. This approach relies on all servers executing transactions in the same serial order, and deciding whether a transaction wa"],[[-1,123624],"s successful depending on its preconditions."],[[-1,29478]," "],[[-1,28723],"Bayou"],[[-1,29477],13],[[-1,29464]," has the advantage of being able to express global invariants such as uniqueness constraints, which require serialization and cannot be expressed using CRDTs"],[[-1,28718],"~\\cite{Bailis:2014th}"],[[-1,29307],". "],[[-1,28582],"Bayou's"],[[-1,29215],3],[[-1,29212]," downside is that tentative transactions may be rolled back, requiring "],[[-1,29141],19],[[-1,29122],"explicit"],[[-1,29114],2],[[-1,29112]," handl"],[[-1,28553],"ing"],[[-1,29106],1],[[-1,29105]," "],[[-1,28541],"by the application"],[[-1,29104],9],[[-1,29095],", whereas CRDTs are defined such that operations cannot fail after they have been performed on one replica."],[[-1,29305],45],[[-1,123580],17],[[-1,104362],1],[[-1,123563],123],[[-1,106801],112],[[-1,123626],1],[[-1,123794],3],[[-1,123864],1],[[-1,124016],1],[[-1,124076],1],[[-1,124383],2],[[-1,124533],4],[[-1,125073],2],[[-1,125291],2],[[-1,125403],1],[[-1,125581],1],[[-1,125585],2],[[-1,125589],2],[[-1,125969],1],[[-1,126662],1],[[-1,127276],1],[[-1,127335],1],[[-1,127457],1],[[-1,127924],3],[[-1,128350],2],[[-1,128686],1],[[-1,132951],1396],[[-1,132952],"\n"],[[-1,259172],"\n"],[[-1,123440],"\n"],[[-1,259171],"\\section{"],[[-1,156934],"Composing "],[[-1,7449],"D"],[[-1,156924],15],[[-1,156909],"ata "],[[-1,7447],"S"],[[-1,156905],1],[[-1,156904],"tructures"],[[-1,156936],1],[[-1,259162],21],[[-1,259141],"}"],[[-1,115053],"\\label{sec:composing}"],[[-1,224479],"\n\n"],[[-1,156339],"In this section we"],[[-1,106687]," "],[[-1,106660],"informally "],[[-1,106686],"introduce our approach to "],[[-1,106649],"collaborative editing of JSON data structures"],[[-1,20345],", and "],[[-1,20295],"illustrate some peculiarities of concurrent nested "],[[-1,20179],"data "],[[-1,20244],"structures"],[[-1,20234],19],[[-1,20203],24],[[-1,20215],6],[[-1,20339],22],[[-1,106604],". A formal presentation of the algorithm follows in "],[[-1,104360],"S"],[[-1,106552],1],[[-1,106551],"ection~\\ref{sec:semantics}."],[[-1,106689],"\n\n"],[[-1,156321],69],[[-1,156178],1],[[-1,156252],74],[[-1,156177],8],[[-1,156088],9],[[-1,156169],56],[[-1,156109],17],[[-1,156079],35],[[-1,156113],2],[[-1,224477],87],[[-1,224386],75],[[-1,224295],129],[[-1,224150],43],[[-1,224101],156],[[-1,223943],53],[[-1,203928],2],[[-1,203925],25],[[-1,203780],46],[[-1,203730],49],[[-1,203677],17],[[-1,203618],11],[[-1,203660],10],[[-1,203634],6],[[-1,203586],2],[[-1,203580],2],[[-1,203574],1],[[-1,203578],3],[[-1,203573],66],[[-1,203493],84],[[-1,203165],3],[[-1,203200],24],[[-1,203162],86],[[-1,203176],2],[[-1,203409],1],[[-1,203292],46],[[-1,203408],12],[[-1,203394],72],[[-1,203076],64],[[-1,203246],46],[[-1,203322],30],[[-1,203012],44],[[-1,202966],108],[[-1,202817],69],[[-1,202744],9],[[-1,202733],107],[[-1,202735],1],[[-1,202748],2],[[-1,202858],8],[[-1,202837],6],[[-1,202968],1],[[-1,203396],1],[[-1,203507],7],[[-1,203584],2],[[-1,203628],1],[[-1,203650],6],[[-1,203598],11],[[-1,203644],10],[[-1,202626],213],[[-1,202411],102],[[-1,202177],26],[[-1,202309],23],[[-1,196241],1],[[-1,196188],17],[[-1,196153],7],[[-1,196171],16],[[-1,196154],1],[[-1,196240],51],[[-1,196145],66],[[-1,155967],2],[[-1,155965],"\\subsection{Concurrent "],[[-1,7445],"E"],[[-1,155942],1],[[-1,155941],"diting "],[[-1,7443],"E"],[[-1,155934],1],[[-1,155933],"xamples}"],[[-1,115032],"\\label{sec:examples}"],[[-1,155925],"\n\n\\begin{figure"],[[-1,42502],"*"],[[-1,155910],1],[[-1,155909],"}"],[[-1,17450],"[p]"],[[-1,155727],"\n\\centering"],[[-1,19765],2],[[-1,155892],"\n\\begin{tikzpicture}"],[[-1,154979],"[au"],[[-1,154974],"to"],[[-1,41206],",scale=0.8"],[[-1,154972],"]"],[[-1,42487],"\n\\path [draw"],[[-1,42456],",d"],[[-1,42448],"otted"],[[-1,42454],3],[[-1,42473],"] ("],[[-1,39988],"4"],[[-1,42160],1],[[-1,42470],1],[[-1,42469],","],[[-1,39977],"-"],[[-1,42468],"0"],[[-1,39976],".5"],[[-1,41970],2],[[-1,42467],") -- ("],[[-1,39984],"4"],[[-1,42162],1],[[-1,42461],1],[[-1,42460],","],[[-1,42427],"6"],[[-1,41968],".5"],[[-1,42459],1],[[-1,42458],");"],[[-1,42426],"\n\\node ("],[[-1,42412],"leftR)  at (0,6) {R"],[[-1,42391],"eplica "],[[-1,42382],"$p"],[[-1,42380],2],[[-1,42378],"$:}"],[[-1,42232],";"],[[-1,42375],"\n\\node (rightR) at ("],[[-1,41195],"8"],[[-1,42158],1],[[-1,42355],1],[[-1,42354],",6) {Replica $"],[[-1,42225],"q"],[[-1,42340],3],[[-1,42337],"$:}"],[[-1,42231],";"],[[-1,42384],1],[[-1,42393],1],[[-1,42418],3],[[-1,42475],1],[[-1,154976],1],[[-1,155576],"\n\\node"],[[-1,155556]," ("],[[-1,42560],"left0"],[[-1,155554],5],[[-1,42619],1],[[-1,155549],")"],[[-1,155376],1],[[-1,155548]," "],[[-1,42429]," "],[[-1,155547],"at ("],[[-1,42620],"0"],[[-1,155543],1],[[-1,155542],","],[[-1,42430],"5"],[[-1,42500],1],[[-1,151456],1],[[-1,154604],1],[[-1,154797],1],[[-1,155374],1],[[-1,155541],1],[[-1,155540],")"],[[-1,42334]," [rectangle,draw]"],[[-1,155570],7],[[-1,155777],6],[[-1,155748],1],[[-1,155771],3],[[-1,155715],1],[[-1,155768],7],[[-1,155761]," {"],[[-1,155705],"\\"],[[-1,155704],5],[[-1,155699],"{"],[[-1,42769],"``"],[[-1,155698],1],[[-1,155102],"key"],[[-1,42766],"''"],[[-1,155697],6],[[-1,155691],":"],[[-1,42764]," "],[[-1,42760],"``"],[[-1,42762],1],[[-1,155690],2],[[-1,155688],"A"],[[-1,42757],"''\\"],[[-1,155687],1],[[-1,155686],"}"],[[-1,155685],1],[[-1,155707],1],[[-1,155759],5],[[-1,155754],"}"],[[-1,155500],";"],[[-1,42617],"\n\\node ("],[[-1,42549],"right"],[[-1,42542],"0"],[[-1,42544],1],[[-1,42609],6],[[-1,42603],") at ("],[[-1,41193],"8"],[[-1,42156],1],[[-1,42597],1],[[-1,42596],","],[[-1,42432],"5"],[[-1,42434],1],[[-1,42498],1],[[-1,42595],1],[[-1,42594],")"],[[-1,42317]," [rectangle,draw]"],[[-1,42593]," {\\{``key''"],[[-1,42580],": ``A''"],[[-1,42571],"\\}};"],[[-1,42573],1],[[-1,42582],1],[[-1,155684],"\n"],[[-1,155522],"\\node (left"],[[-1,155378],"1"],[[-1,155511],")"],[[-1,155683],"  "],[[-1,155507],"at"],[[-1,155753],3],[[-1,155750]," ("],[[-1,155747],"0,"],[[-1,42436],"3"],[[-1,42494],1],[[-1,154608],1],[[-1,154599],2],[[-1,154603],2],[[-1,155372],1],[[-1,155652],2],[[-1,155713],1],[[-1,155745],2],[[-1,155742],")"],[[-1,42300]," [rectangle,draw]"],[[-1,155741]," "],[[-1,155740],5],[[-1,155735],"{"],[[-1,155676],"\\"],[[-1,155675],5],[[-1,155670],"{"],[[-1,42747],"``"],[[-1,155669],1],[[-1,155094],"key"],[[-1,42744],"''"],[[-1,155668],6],[[-1,155662],":"],[[-1,42742]," "],[[-1,42740],"``"],[[-1,155661],1],[[-1,155658],1],[[-1,155657],"B"],[[-1,42737],"''\\"],[[-1,155656],1],[[-1,155655],"}"],[[-1,155654],1],[[-1,155660],1],[[-1,155734],5],[[-1,155729],"};"],[[-1,155457],"\n\\node (right"],[[-1,155377],"1"],[[-1,155444],") at ("],[[-1,41191],"8"],[[-1,42154],1],[[-1,155438],1],[[-1,155437],","],[[-1,42438],"3"],[[-1,42490],1],[[-1,154606],1],[[-1,154597],2],[[-1,155370],1],[[-1,155436],1],[[-1,155435],")"],[[-1,42283]," [rectangle,draw]"],[[-1,155434]," {\\"],[[-1,155431],5],[[-1,155426],"{"],[[-1,42720],"``"],[[-1,155425],1],[[-1,155086],"key"],[[-1,42723],"''"],[[-1,155424],6],[[-1,155418],":"],[[-1,42727]," ``"],[[-1,155417],2],[[-1,155415],"C"],[[-1,42730],"''"],[[-1,155414],1],[[-1,42732],"\\"],[[-1,155413],"}"],[[-1,155412],1],[[-1,155411],"};"],[[-1,155369],"\n\\node (left2)  at (0,"],[[-1,39996],"0"],[[-1,39995],2],[[-1,42440],1],[[-1,155341],1],[[-1,155340],")"],[[-1,42266]," [rectangle,draw]"],[[-1,155339]," {\\"],[[-1,155336],5],[[-1,155331],"{"],[[-1,42702],"``"],[[-1,155330],1],[[-1,155078],"key"],[[-1,42692],"''"],[[-1,42696],2],[[-1,155329],6],[[-1,155323],":"],[[-1,42682]," "],[[-1,42519],"\\"],[[-1,155316],1],[[-1,155315],"{"],[[-1,42680],"``"],[[-1,155314],1],[[-1,155313],"B"],[[-1,42674],"''"],[[-1,155312],1],[[-1,155311],","],[[-1,42667]," ``"],[[-1,155310],1],[[-1,155309],"C"],[[-1,42657],"''\\"],[[-1,155308],1],[[-1,155307],"}"],[[-1,42654],"\\"],[[-1,155306],"}"],[[-1,155305],1],[[-1,155304],"};\n\\node (right2) at ("],[[-1,41189],"8"],[[-1,42152],1],[[-1,155282],1],[[-1,155281],","],[[-1,39992],"0"],[[-1,39991],2],[[-1,42442],1],[[-1,155280],1],[[-1,155279],")"],[[-1,42249]," [rectangle,draw]"],[[-1,155278]," {\\"],[[-1,155275],5],[[-1,155270],"{"],[[-1,42688],"``"],[[-1,42699],2],[[-1,155269],1],[[-1,155070],"key"],[[-1,42685],"''"],[[-1,155268],6],[[-1,155262],":"],[[-1,42683]," "],[[-1,42518],"\\"],[[-1,155261],1],[[-1,155260],"{"],[[-1,42677],"``"],[[-1,155259],1],[[-1,155258],"B"],[[-1,42671],"''"],[[-1,155257],1],[[-1,155256],","],[[-1,42664]," ``"],[[-1,155255],1],[[-1,155254],"C"],[[-1,42660],"''"],[[-1,42650],"\\"],[[-1,155253],1],[[-1,155252],"}"],[[-1,42651],"\\"],[[-1,155251],"}"],[[-1,155250],1],[[-1,155249],"};"],[[-1,42065],"\n\\node (comms)  at ("],[[-1,41187],"4"],[[-1,42045],1],[[-1,42044],","],[[-1,39973],"1."],[[-1,39795],"6"],[[-1,39971],1],[[-1,42043],2],[[-1,40006],1],[[-1,41993],1],[[-1,42041],1],[[-1,42040],")"],[[-1,41982]," [text=blue]"],[[-1,42039]," {"],[[-1,42011],"\\footnotesize "],[[-1,42037],"network"],[[-1,41995]," "],[[-1,42014],2],[[-1,42030],1],[[-1,42029],"communication};"],[[-1,155322],3],[[-1,155343],1],[[-1,155347],2],[[-1,155499],"\n\\draw ["],[[-1,154587],"thick,"],[[-1,154589],1],[[-1,154595],3],[[-1,155491],"->] ("],[[-1,42535],"left0"],[[-1,155486],5],[[-1,42567],1],[[-1,155481],")"],[[-1,154989]," "],[[-1,154830],"to"],[[-1,154988],4],[[-1,154984]," node"],[[-1,154828]," ["],[[-1,151478],"left"],[[-1,41017],","],[[-1,41016],1],[[-1,41015],"inner sep=8pt"],[[-1,151447],11],[[-1,151404],3],[[-1,151410],3],[[-1,151436],3],[[-1,151455],4],[[-1,154826],5],[[-1,154812],7],[[-1,154821],"]"],[[-1,155480],1],[[-1,155002],4],[[-1,154998]," {"],[[-1,154796],14],[[-1,154937],1],[[-1,154970],1],[[-1,154903],4],[[-1,154932],4],[[-1,154969],7],[[-1,154962],"do"],[[-1,25464],"c"],[[-1,25462],".get("],[[-1,154960],1],[[-1,154928],1],[[-1,154940],1],[[-1,154959],1],[[-1,154926],6],[[-1,154958],"``key''"],[[-1,25456],")"],[[-1,154919],1],[[-1,154939],1],[[-1,154951],1],[[-1,154950]," := "],[[-1,154916],6],[[-1,154946],"``B'';"],[[-1,154910],1],[[-1,154917],1],[[-1,154996],2],[[-1,154938],"}"],[[-1,155038],2],[[-1,155032],14],[[-1,155479],2],[[-1,155477]," ("],[[-1,155475],6],[[-1,155469],"left"],[[-1,155234],"1"],[[-1,155465],")"],[[-1,155047],";"],[[-1,155464],1],[[-1,155409],"\n"],[[-1,155046],"\\draw "],[[-1,155051],"["],[[-1,154581],"thick,"],[[-1,155050],"->]"],[[-1,155408],10],[[-1,155398]," ("],[[-1,42525],"right0"],[[-1,155396],5],[[-1,155391],") "],[[-1,154836],"to"],[[-1,154897],4],[[-1,154893]," node"],[[-1,154820]," ["],[[-1,151462],"right"],[[-1,41001],",inner sep=8pt"],[[-1,151433],11],[[-1,151398],3],[[-1,151416],3],[[-1,151422],3],[[-1,154818],5],[[-1,154805],7],[[-1,154813],"]"],[[-1,154888]," {"],[[-1,154782],14],[[-1,154886],7],[[-1,154879],"doc"],[[-1,25454],".get("],[[-1,154876],8],[[-1,154868],"``key''"],[[-1,25448],")"],[[-1,154861],2],[[-1,154859]," := "],[[-1,154855],6],[[-1,154849],"``C'';"],[[-1,154843],2],[[-1,154841],"}"],[[-1,155034],2],[[-1,155389],2],[[-1,155387]," (right"],[[-1,155233],"1"],[[-1,155380],");"],[[-1,155247],"\n\\draw ["],[[-1,154575],"thick,"],[[-1,155239],"->] ("],[[-1,155232],"left1) "],[[-1,42122],"--"],[[-1,154766],7],[[-1,154759]," "],[[-1,154758],29],[[-1,155225],3],[[-1,155222],"(left2);\n\\draw ["],[[-1,154569],"thick"],[[-1,42517],",dashed"],[[-1,154564],","],[[-1,41992],"blue,"],[[-1,155204],"->] (left1"],[[-1,42087],".south"],[[-1,42081],5],[[-1,155194],") "],[[-1,40068]," to"],[[-1,40059]," [out="],[[-1,40003],"27"],[[-1,40047],2],[[-1,40045],"0"],[[-1,40021],",in=135"],[[-1,40044],"]"],[[-1,40053],3],[[-1,40065],1],[[-1,42118],2],[[-1,154727],2],[[-1,155192],2],[[-1,155190]," "],[[-1,155187],"(right"],[[-1,155177],"2"],[[-1,42151],".north "],[[-1,42099],"west"],[[-1,42144],4],[[-1,155176],");\n\\draw ["],[[-1,154563],"thick,"],[[-1,42510],"dashed,"],[[-1,41987],"blue,"],[[-1,155166],"->] (right1"],[[-1,42076],".south"],[[-1,42070],5],[[-1,155155],") "],[[-1,40061],"to"],[[-1,40033]," [out"],[[-1,40026],"="],[[-1,39999],"27"],[[-1,40025],2],[[-1,40023],"0"],[[-1,40014],",in=45"],[[-1,40022],"]"],[[-1,40008]," "],[[-1,40028],1],[[-1,42114],2],[[-1,154723],38],[[-1,155153],2],[[-1,155151]," (left2"],[[-1,42140],".north "],[[-1,42091],"east"],[[-1,42133],4],[[-1,155144],");\n\\draw ["],[[-1,154557],"thick,"],[[-1,155134],"->] (right"],[[-1,155122],"1) "],[[-1,42105],"--"],[[-1,154683],7],[[-1,154676]," "],[[-1,154675],30],[[-1,155119],3],[[-1,155116],"(right2);"],[[-1,42489],1],[[-1,155124],1],[[-1,155181],2],[[-1,155189],1],[[-1,155206],1],[[-1,155872],"\n\\end{tikzpicture}"],[[-1,155852],"\n\\caption{Concurrent assignment to "],[[-1,36451],"the register at doc"],[[-1,18681],".get("],[[-1,36432],1],[[-1,36431],"``key''"],[[-1,18675],")"],[[-1,36424],1],[[-1,36423]," by re"],[[-1,36405],"plicas $p$ and $q$"],[[-1,36417],6],[[-1,155817],10],[[-1,36503],1],[[-1,36466],3],[[-1,36502],18],[[-1,105036],"."],[[-1,155807],"}\\label"],[[-1,155798],"{fig:register-assign}"],[[-1,155800],1],[[-1,155854],1],[[-1,155908],"\n\\end{figure"],[[-1,42503],"*"],[[-1,155896],1],[[-1,155895],"}"],[[-1,153586],"\n"],[[-1,19986],"\n"],[[-1,19984],"The sequential semantics of editing a JSON data structure are well-known, and the semantics of concurrently editing a flat map or list data structure have been thoroughly explored in the literature (see Section~\\ref{"],[[-1,19761],"sec:related"],[[-1,19768],"})."],[[-1,19750]," However, "],[[-1,19721],"when"],[[-1,19985],1],[[-1,20123],1],[[-1,20078],17],[[-1,20061]," defining a "],[[-1,20039],"CRDT for JSON data"],[[-1,19717],", difficulties arise"],[[-1,20021],3],[[-1,20018]," due to the interaction"],[[-1,19441],"s"],[[-1,19995]," between "],[[-1,19694],"concurrency and nested data structures."],[[-1,19655],1],[[-1,20049],5],[[-1,20122],"\n"],[[-1,153585],"\n"],[[-1,19653],"In th"],[[-1,19638],"e following examples we "],[[-1,19594],"show "],[[-1,19614],10],[[-1,19648],5],[[-1,106146],1],[[-1,153584],99],[[-1,153483],25],[[-1,153458],"some"],[[-1,19575]," situations that "],[[-1,19437],"m"],[[-1,19432],"ight"],[[-1,19436],2],[[-1,19558],3],[[-1,19555]," occur"],[[-1,153454],29],[[-1,106145]," when JSON documents are concurrently modified, "],[[-1,19496],4],[[-1,19492],"demonstrate how they are handled "],[[-1,19457],"by our algorithm"],[[-1,13993],", and explain the rationale for our design decisions"],[[-1,19459],1],[[-1,106097],24],[[-1,153425],"."],[[-1,38467]," In all examples we assume "],[[-1,37837],"two "],[[-1,38440],21],[[-1,38417],5],[[-1,38410],6],[[-1,38404],"replicas"],[[-1,37833],","],[[-1,38396],1],[[-1,38395]," "],[[-1,38384],"labelled"],[[-1,38376],3],[[-1,38373]," $p$ "],[[-1,38362],"(drawn on the left"],[[-1,34359],"-"],[[-1,38344],1],[[-1,38343],"hand si"],[[-1,38330],"de) and $q$ (right"],[[-1,34358],"-"],[[-1,38312],1],[[-1,38311],"hand s"],[[-1,38295],"ide)"],[[-1,37134],". "],[[-1,37129],"Lo"],[[-1,37385],7],[[-1,37352],2],[[-1,37350],"cal state"],[[-1,37337]," "],[[-1,37127],"for a replica is "],[[-1,37336],"drawn in boxe"],[[-1,37321],"s"],[[-1,19428],","],[[-1,37320]," and modifications "],[[-1,37202],"to local stat"],[[-1,37187],"e"],[[-1,19427]," are"],[[-1,37186]," "],[[-1,37189],1],[[-1,37301],"shown with labelled s"],[[-1,37276],"olid arrows"],[[-1,37181],";"],[[-1,37265],4],[[-1,37261]," time run"],[[-1,37176],"s"],[[-1,37252],4],[[-1,37248]," down the "],[[-1,37228],"page."],[[-1,37238],5],[[-1,37280],2],[[-1,37323],1],[[-1,37341],2],[[-1,37378],13],[[-1,38291],1],[[-1,38139],21],[[-1,38116],44],[[-1,38060],19],[[-1,38015],14],[[-1,38041],13],[[-1,38072],6],[[-1,38118],1],[[-1,38290]," "],[[-1,37632],"Since replicas "],[[-1,37210],"only "],[[-1,37617],"mutate"],[[-1,37211]," "],[[-1,37611],1],[[-1,37574],11],[[-1,37563],"local state"],[[-1,37204],","],[[-1,36602]," we make"],[[-1,37175]," communication"],[[-1,36866]," "],[[-1,36594],"of state c"],[[-1,36580],"hanges "],[[-1,36584],2],[[-1,36865],"between replicas"],[[-1,37161],17],[[-1,36895],14],[[-1,36867],1],[[-1,36881],7],[[-1,37144],3],[[-1,37141]," "],[[-1,37110],"ex"],[[-1,37092],"plicit in our model"],[[-1,36540],"."],[[-1,37073]," "],[[-1,36528],"Net"],[[-1,36523],"work communication"],[[-1,36525],1],[[-1,36536],4],[[-1,37072],3],[[-1,37069]," is "],[[-1,37043],"depicted with dashed arrows."],[[-1,37015],2],[[-1,37065],11],[[-1,37102],5],[[-1,37108],3],[[-1,37203],1],[[-1,37552],2],[[-1,37530],9],[[-1,37517],23],[[-1,37486],19],[[-1,37465],1],[[-1,37460],44],[[-1,37402],16],[[-1,37416],7],[[-1,37464],2],[[-1,37467],1],[[-1,37494],1],[[-1,37489],1],[[-1,37493],2],[[-1,37521],2],[[-1,37546],8],[[-1,37550],2],[[-1,37610],1],[[-1,37607],16],[[-1,37609],1],[[-1,38289],9],[[-1,38238],10],[[-1,37729],3],[[-1,37684],15],[[-1,37726],15],[[-1,37709],5],[[-1,37711],1],[[-1,38228],7],[[-1,38215],3],[[-1,37901],8],[[-1,38212],1],[[-1,38203],19],[[-1,38182],35],[[-1,38143],4],[[-1,37893],23],[[-1,38147],2],[[-1,38184],1],[[-1,38211],4],[[-1,38221],3],[[-1,38280],21],[[-1,38299],2],[[-1,38305],3],[[-1,38336],3],[[-1,38368],3],[[-1,38394],5],[[-1,38412],1],[[-1,38419],1],[[-1,38469],1],[[-1,153424],"\n\nOur first example is shown in Figure~\\ref{fig:register-assign}."],[[-1,38813],4],[[-1,38727],2],[[-1,38717],2],[[-1,38713],15],[[-1,38688],6],[[-1,38579],7],[[-1,38682],20],[[-1,38648],4],[[-1,38640],2],[[-1,38630],46],[[-1,38638],4],[[-1,38644],2],[[-1,38662],7],[[-1,38698],5],[[-1,38715],1],[[-1,38725],4],[[-1,38753],13],[[-1,38809],28],[[-1,153359]," "],[[-1,153336],"In a"],[[-1,153358],1],[[-1,153357]," document that maps "],[[-1,153332],"``key'' to"],[[-1,152722]," a register with value"],[[-1,153322]," ``A'',"],[[-1,153315],4],[[-1,153311]," replica"],[[-1,36624]," $p$"],[[-1,153303]," sets the value of the "],[[-1,153168],"register"],[[-1,153280],3],[[-1,153277]," to ``B'', while "],[[-1,36613],"replica $q$"],[[-1,153260],7],[[-1,153253]," concurrently sets it to ``C''. As the replicas subsequently exchange edits"],[[-1,36849]," via network communication"],[[-1,153178],", they "],[[-1,153160],"detect the conflict. Since we "],[[-1,153104],"do not want to simply discard one of the edits, and the strings ``B'' and ``C'' cannot"],[[-1,78811]," be"],[[-1,153018]," meaningfully "],[[-1,153004],3],[[-1,153001],"merged, the system must preserve both concurrent updates. This datatype"],[[-1,152928]," is known as a \\emph{multi-value register}: although a replica can only assign a"],[[-1,152846]," single value to the register, "],[[-1,152791],"reading the register may return a set of "],[[-1,150276],"multiple values that were "],[[-1,152750],"concurrently written"],[[-1,152730],7],[[-1,152723],"."],[[-1,19420],"\n\nA multi"],[[-1,19409],"-value register is hardly an impressive CRDT, since it does not actually perform any conflict resolution. "],[[-1,19295],"We use it only for primitive values for which no "],[[-1,19229],"automa"],[[-1,19221],"tic"],[[-1,19223],1],[[-1,19246],5],[[-1,19241]," merge "],[[-1,19218],"function is defined. Other CRDTs could be substituted in its place: for example, a cou"],[[-1,19130],"nter CRDT for a number that can only be incremented and decremented, or an ordered list of characters for a collaboratively editable string (see also Figure~\\ref{fig:text-edit})."],[[-1,18952],1],[[-1,19132],1],[[-1,19303],4],[[-1,19411],1],[[-1,145717],1],[[-1,19423],2],[[-1,145716],108],[[-1,145594],1],[[-1,145608],14],[[-1,145593],10],[[-1,36823],51],[[-1,36768],3],[[-1,36761],2],[[-1,36673],32],[[-1,36759],5],[[-1,36748],15],[[-1,36629],1],[[-1,36733],7],[[-1,36754],3],[[-1,36765],2],[[-1,36772],2],[[-1,145583],7],[[-1,36722],3],[[-1,145576],5],[[-1,145548],6],[[-1,36719],3],[[-1,36712],3],[[-1,36707],7],[[-1,36709],1],[[-1,36716],2],[[-1,145542],3],[[-1,145571],23],[[-1,152700],"\n\n"],[[-1,152696],"\\begin{figure*}"],[[-1,17453],"[p]"],[[-1,152667],"\n\\centering\n\\begin{tikzpicture}[auto"],[[-1,41216],",scale=0.8"],[[-1,152631],"]"],[[-1,41267],"\n\\path [draw,dotted] ("],[[-1,41185],"4"],[[-1,41245],1],[[-1,41244],",-"],[[-1,41179],"1"],[[-1,41242],3],[[-1,41239],") -- ("],[[-1,41183],"4"],[[-1,41233],1],[[-1,41232],","],[[-1,25085],"8"],[[-1,40071],1],[[-1,41177],3],[[-1,41231],1],[[-1,41230],");"],[[-1,152470],"\n\\node ("],[[-1,41614],"left0"],[[-1,152462],5],[[-1,152457],") "],[[-1,41580]," "],[[-1,152389],1],[[-1,152455],"at ("],[[-1,41608],"0"],[[-1,151999],1],[[-1,152451],1],[[-1,152450],","],[[-1,24707],"7.5"],[[-1,25087],1],[[-1,40073],1],[[-1,41219],1],[[-1,150832],1],[[-1,151077],1],[[-1,152449],1],[[-1,152448],")"],[[-1,41438]," [rectangle,draw]"],[[-1,152447]," {\\"],[[-1,152444],5],[[-1,152439],"{"],[[-1,41670],"``"],[[-1,152438],1],[[-1,152437],"colors"],[[-1,41667],"''"],[[-1,152431],1],[[-1,152430],": "],[[-1,41665],"\\"],[[-1,152428],"{"],[[-1,41673],"``"],[[-1,152427],1],[[-1,152426],"blue"],[[-1,41676],"''"],[[-1,152422],1],[[-1,152421],": "],[[-1,41679],"``"],[[-1,41659],"\\"],[[-1,152419],1],[[-1,152418],"#0000ff"],[[-1,41682],"''"],[[-1,152411],1],[[-1,41684],"\\"],[[-1,152410],"}"],[[-1,41685],"\\"],[[-1,152409],"}"],[[-1,152408],1],[[-1,152407],"};"],[[-1,41607],"\n\\node (right0) at ("],[[-1,41173],"8"],[[-1,41274],1],[[-1,41587],1],[[-1,41586],","],[[-1,24703],"7.5"],[[-1,25089],1],[[-1,40075],1],[[-1,41221],1],[[-1,41585],1],[[-1,41584],")"],[[-1,41421]," [rectangle,draw]"],[[-1,41583]," {"],[[-1,41578],"\\{``colors'': \\{``blue'': ``\\#0000ff''\\}\\}};"],[[-1,41581],1],[[-1,152405],"\n\\node"],[[-1,152295]," [matrix]"],[[-1,152399]," (left1)"],[[-1,152391],1],[[-1,152390]," "],[[-1,152388],"at (0,"],[[-1,40077],"4"],[[-1,41217],1],[[-1,152382],1],[[-1,152381],")"],[[-1,41404]," [rectangle,draw]"],[[-1,152380]," {"],[[-1,152264],"\n    "],[[-1,152279],"\\node {"],[[-1,152185],"\\"],[[-1,152184],5],[[-1,152179],"{"],[[-1,41705],"``"],[[-1,152178],1],[[-1,152177],"colors"],[[-1,41702],"''"],[[-1,152171],1],[[-1,152170],": "],[[-1,41700],"\\"],[[-1,152168],"{"],[[-1,41698],"``"],[[-1,152167],1],[[-1,152160],"blue"],[[-1,41695],"''"],[[-1,152156],1],[[-1,152155],": "],[[-1,41692],"``"],[[-1,41658],"\\"],[[-1,152153],1],[[-1,152152],"#0000ff"],[[-1,41689],"''"],[[-1,152145],1],[[-1,152144],","],[[-1,152143],1],[[-1,152166],3],[[-1,152252],1],[[-1,152307],6],[[-1,152378],35],[[-1,152340],1],[[-1,152343],1],[[-1,152272],"}"],[[-1,152188],";"],[[-1,152339]," \\\\"],[[-1,152259],"\n   "],[[-1,152336]," "],[[-1,152271],"\\node"],[[-1,152255]," "],[[-1,152266],"{"],[[-1,41716],"``"],[[-1,152141],6],[[-1,152133],1],[[-1,152132],"red"],[[-1,41713],"''"],[[-1,152127],1],[[-1,152126],": "],[[-1,41725],"``"],[[-1,41657],"\\"],[[-1,152124],1],[[-1,152123],"#ff0000"],[[-1,41728],"''"],[[-1,152116],1],[[-1,41730],"\\"],[[-1,152115],"}"],[[-1,41731],"\\"],[[-1,152114],"}"],[[-1,152113],1],[[-1,152129],1],[[-1,152135],1],[[-1,152189],1],[[-1,152335],5],[[-1,152312],1],[[-1,152330],17],[[-1,152311],3],[[-1,152265],"}"],[[-1,152187],";"],[[-1,152284]," \\\\"],[[-1,152253],"\n"],[[-1,152281],1],[[-1,152308],1],[[-1,152342],"};"],[[-1,152112],"\n\\node (right1) at ("],[[-1,41171],"8"],[[-1,41272],1],[[-1,151996],1],[[-1,152092],2],[[-1,152090],","],[[-1,24699],"5.5"],[[-1,25091],1],[[-1,40079],1],[[-1,41223],1],[[-1,151079],1],[[-1,151089],3],[[-1,152087],1],[[-1,152086],")"],[[-1,41387]," [rectangle,draw]"],[[-1,152085]," {\\"],[[-1,152082],5],[[-1,152077],"{"],[[-1,41742],"``"],[[-1,150815],1],[[-1,150814],"colors"],[[-1,41739],"''"],[[-1,150808],1],[[-1,150807],": "],[[-1,41744],"\\"],[[-1,150805],"{"],[[-1,41745],"\\"],[[-1,150804],"}"],[[-1,41746],"\\"],[[-1,152076],"}"],[[-1,152075],1],[[-1,152074],"};\n\\node (right2) at ("],[[-1,41169],"8"],[[-1,41270],1],[[-1,151993],1],[[-1,152052],2],[[-1,152050],","],[[-1,40081],"3"],[[-1,41225],1],[[-1,151085],3],[[-1,152049],1],[[-1,152048],")"],[[-1,41370]," [rectangle,draw]"],[[-1,152047]," {\\"],[[-1,152044],5],[[-1,152039],"{"],[[-1,41768],"``"],[[-1,152038],1],[[-1,152037],"colors"],[[-1,41765],"''"],[[-1,152031],1],[[-1,152030],": "],[[-1,41763],"\\"],[[-1,152024],"{"],[[-1,41761],"``"],[[-1,152023],1],[[-1,152022],"green"],[[-1,41758],"''"],[[-1,152017],1],[[-1,152016],": "],[[-1,41755],"``"],[[-1,41656],"\\"],[[-1,41655],1],[[-1,152014],1],[[-1,152013],"#00ff00"],[[-1,41752],"''\\"],[[-1,152006],1],[[-1,152005],"}"],[[-1,41749],"\\"],[[-1,152004],"}"],[[-1,152003],1],[[-1,152002],"};"],[[-1,151992],"\n\\node"],[[-1,151908]," [matrix]"],[[-1,151986]," (left2) at (0,0)"],[[-1,41353]," [rectangle,draw]"],[[-1,151969]," {"],[[-1,151899],"\n    \\node {"],[[-1,151967],"\\"],[[-1,151966],5],[[-1,151961],"{"],[[-1,41781],"``"],[[-1,151960],1],[[-1,151959],"colors"],[[-1,41784],"''"],[[-1,151953],1],[[-1,151952],": "],[[-1,41786],"\\"],[[-1,151950],"{"],[[-1,41788],"``"],[[-1,151949],1],[[-1,151948],"red"],[[-1,41791],"''"],[[-1,151945],1],[[-1,151944],": "],[[-1,41794],"``"],[[-1,41653],"\\"],[[-1,41652],1],[[-1,151942],1],[[-1,151941],"#ff0000"],[[-1,41797],"''"],[[-1,151934],1],[[-1,151933],","],[[-1,151887],1],[[-1,151886],"};"],[[-1,151725]," \\\\"],[[-1,151884],"\n    \\node"],[[-1,151932]," "],[[-1,151874],"{"],[[-1,41813],"``"],[[-1,151873],6],[[-1,151931],1],[[-1,151930],"green"],[[-1,41810],"''"],[[-1,151925],1],[[-1,151924],": "],[[-1,41807],"``"],[[-1,41651],"\\"],[[-1,151922],1],[[-1,151921],"#00ff00"],[[-1,41804],"''\\"],[[-1,151914],1],[[-1,151913],"}"],[[-1,41801],"\\"],[[-1,151912],"}"],[[-1,151911],1],[[-1,151910],"};"],[[-1,151722]," \\\\"],[[-1,151867],"\n};\n"],[[-1,151726],1],[[-1,151863],"\\node [matrix] (right3) at ("],[[-1,41167],"8"],[[-1,41268],1],[[-1,151835],1],[[-1,151834],","],[[-1,151831],"0)"],[[-1,41336]," [rectangle,draw]"],[[-1,151829]," {\n"],[[-1,151727],1],[[-1,151826],"    \\node {\\"],[[-1,151814],5],[[-1,151809],"{"],[[-1,41856],"``"],[[-1,151808],1],[[-1,151807],"colors"],[[-1,41847],"''"],[[-1,151801],1],[[-1,151800],": "],[[-1,41845],"\\"],[[-1,151798],"{"],[[-1,41843],"``"],[[-1,151797],1],[[-1,151796],"red"],[[-1,41840],"''"],[[-1,151793],1],[[-1,151792],": "],[[-1,41837],"``"],[[-1,41649],"\\"],[[-1,151790],1],[[-1,151789],"#ff0000"],[[-1,41834],"''"],[[-1,151782],1],[[-1,151781],","],[[-1,151778],1],[[-1,151777],"};"],[[-1,151708]," \\\\"],[[-1,151775],"\n"],[[-1,151728],1],[[-1,151774],"    \\node {"],[[-1,151763],1],[[-1,41858],1],[[-1,41853],"``"],[[-1,151762],6],[[-1,151756],"green"],[[-1,41850],"''"],[[-1,151751],1],[[-1,151750],": "],[[-1,41831],"``"],[[-1,41648],"\\"],[[-1,151748],1],[[-1,151747],"#00ff00"],[[-1,41828],"''\\"],[[-1,151740],1],[[-1,151739],"}"],[[-1,41825],"\\"],[[-1,151738],"}"],[[-1,151737],1],[[-1,151736],"};"],[[-1,151715]," "],[[-1,151710],"\\\\"],[[-1,151714],2],[[-1,151734],"\n"],[[-1,151729],1],[[-1,151733],"};"],[[-1,39970],"\n\\node (comms) "],[[-1,39955],1],[[-1,39954],"at (4,"],[[-1,39889],"2"],[[-1,39884],".1"],[[-1,39888],2],[[-1,39948],3],[[-1,39945],") [text=blue] {\\footnotesize network communication};"],[[-1,151705],"\n\\draw [thick,->] ("],[[-1,41529],"left0"],[[-1,151686],5],[[-1,151681],") "],[[-1,148596]," "],[[-1,25190],"-- (left1)\n    "],[[-1,151679],3],[[-1,151676],"node ["],[[-1,151580],"left"],[[-1,25172],",text width="],[[-1,25097],"4"],[[-1,25094],".2"],[[-1,25160],1],[[-1,25159],"cm,text centered,midway"],[[-1,151395],1],[[-1,148595],1],[[-1,151394],6],[[-1,149266],1],[[-1,151388],4],[[-1,151380],2],[[-1,151384],3],[[-1,151670],12],[[-1,151658],"]"],[[-1,41046]," "],[[-1,151657]," {"],[[-1,151655],14],[[-1,151617],"doc"],[[-1,25446],".get("],[[-1,151614],1],[[-1,151613],"``colors''"],[[-1,25439],").get("],[[-1,151603],1],[[-1,151576],1],[[-1,151575],"``red''"],[[-1,25432],")"],[[-1,151568],1],[[-1,151567]," := ``\\#ff0000'';"],[[-1,151544],1],[[-1,151513],11],[[-1,151521],4],[[-1,151543],11],[[-1,151548],2],[[-1,151550],1],[[-1,151602],"}"],[[-1,151378],3],[[-1,151601],8],[[-1,151593],";"],[[-1,151372],"\n\\draw [thick,-"],[[-1,151355],">] ("],[[-1,41519],"right0"],[[-1,151351],5],[[-1,151346],")"],[[-1,151345],1],[[-1,148597]," "],[[-1,151344],"to node [right"],[[-1,151330],7],[[-1,149267],1],[[-1,151323],5],[[-1,150830],1],[[-1,151318],3],[[-1,151315],"] {"],[[-1,151312],14],[[-1,151298],"doc"],[[-1,25430],".get("],[[-1,151295],1],[[-1,151294],"``colors''"],[[-1,25424],")"],[[-1,151284],1],[[-1,150822]," "],[[-1,25403],":"],[[-1,150821],"= \\{\\}"],[[-1,151283],7],[[-1,151276],";} (right1);\n\\draw [thick,->] ("],[[-1,151141],"right"],[[-1,151245],4],[[-1,151241],"1) "],[[-1,25198],"--"],[[-1,151238],34],[[-1,25422],1],[[-1,25417],4],[[-1,25421],2],[[-1,151204],11],[[-1,25411],1],[[-1,25407],4],[[-1,25410],1],[[-1,151193],1],[[-1,151190],10],[[-1,25408],1],[[-1,151180],2],[[-1,151174],5],[[-1,151167],12],[[-1,151155]," (right2)"],[[-1,25402],"\n"],[[-1,25194],"    "],[[-1,25401],"node [right,text width="],[[-1,25099],"4"],[[-1,25096],".2"],[[-1,25195],1],[[-1,25376],1],[[-1,25375],"cm,text "],[[-1,25108],"centered"],[[-1,25120],6],[[-1,25208],8],[[-1,25222],1],[[-1,25219],5],[[-1,25221],1],[[-1,25367],8],[[-1,25237],",midway"],[[-1,25359],"] {doc.get(``colors'').get(``green'') := ``\\#00ff00'';}"],[[-1,25378],1],[[-1,151146],";"],[[-1,151076],"\n\\draw [thick,"],[[-1,151062],2],[[-1,41904],12],[[-1,41874],1],[[-1,41873],"->"],[[-1,151060],"] (left1) "],[[-1,148598]," "],[[-1,151050],"to "],[[-1,151047],6],[[-1,151037],6],[[-1,148594],1],[[-1,151031],21],[[-1,151008],2],[[-1,151006],"(left2);\n\\draw [thick,"],[[-1,150984],2],[[-1,41892],12],[[-1,41871],1],[[-1,41870],"->"],[[-1,150982],"] (right"],[[-1,150972],"2) to "],[[-1,150966],34],[[-1,150928],2],[[-1,150926],"(right3);\n\\draw [thick,"],[[-1,41502],"dashed,blue,"],[[-1,41490],1],[[-1,150903],"->] (left1"],[[-1,41319],".south"],[[-1,41313],5],[[-1,150893],") "],[[-1,148599]," "],[[-1,150891],"to"],[[-1,40123]," [out=270,in=135]"],[[-1,150889]," (right3"],[[-1,41297],".north west"],[[-1,150881],");\n\\draw [thick,"],[[-1,41464],"dashed,blue,"],[[-1,150865],"->] (right2"],[[-1,41308],".south"],[[-1,41302],5],[[-1,150854],") to"],[[-1,40106]," [ou"],[[-1,40098],"t=27"],[[-1,40092],"0,in=45] "],[[-1,40094],1],[[-1,40100],1],[[-1,40102],1],[[-1,150850]," ("],[[-1,150840],"left2"],[[-1,41286],".north east"],[[-1,150835],");"],[[-1,150848],4],[[-1,150930],1],[[-1,150932],1],[[-1,150974],1],[[-1,151010],1],[[-1,151041],2],[[-1,151169],1],[[-1,151178],2],[[-1,151192],1],[[-1,151357],1],[[-1,151641],12],[[-1,151780],1],[[-1,151833],1],[[-1,152028],2],[[-1,152089],1],[[-1,152630],"\n"],[[-1,151731],1],[[-1,152629],"\\end{tikzpicture}\n\\caption{"],[[-1,152576],"Modifying the contents of a nested map while concurrently the entire map is "],[[-1,150796],"overwritten"],[[-1,105035],"."],[[-1,152500],7],[[-1,152493],"}\\label{fig:map-remove}"],[[-1,152602],13],[[-1,152681],"\n\\end{figure*}"],[[-1,150785],57],[[-1,18646],69],[[-1,150728],19],[[-1,18539],4],[[-1,150709],40],[[-1,18520],12],[[-1,150669],69],[[-1,150598],26],[[-1,18577],34],[[-1,18508],122],[[-1,18384],32],[[-1,18254],515],[[-1,17733],5],[[-1,17716],81],[[-1,17629],41],[[-1,17497],41],[[-1,17588],1],[[-1,17635],3],[[-1,17728],6],[[-1,17739],3],[[-1,18386],2],[[-1,150572],168],[[-1,150400],67],[[-1,17517],1],[[-1,150333],25],[[-1,150404],2],[[-1,150600],1],[[-1,152698],1],[[-1,152815],12],[[-1,152848],1],[[-1,152930],1],[[-1,153130],13],[[-1,153485],1],[[-1,196189],1],[[-1,202413],1],[[-1,203681],2],[[-1,203734],2],[[-1,203786],3],[[-1,203900],3],[[-1,223890],1],[[-1,18352],1],[[-1,18350],2],[[-1,17515],2],[[-1,18348],11],[[-1,17500],3],[[-1,18337],10],[[-1,18321],67],[[-1,18327],3],[[-1,18351],"\n"],[[-1,150250],"\n"],[[-1,150248],"\\begin{figure*}"],[[-1,17456],"[p]"],[[-1,150233],"\n\\centering\n\\begin{tikzpicture}[auto"],[[-1,41166],",scale=0.8"],[[-1,150197],"]"],[[-1,40239],"\n\\path [draw,dotted] (5,-0.5) -- (5,"],[[-1,24639],"10"],[[-1,24667],1],[[-1,40203],3],[[-1,40200],");"],[[-1,150057],"\n\\node ("],[[-1,41142],"left0"],[[-1,150049],5],[[-1,150044],") "],[[-1,149958]," "],[[-1,150042],"at "],[[-1,40337]," "],[[-1,150039],"("],[[-1,40352],1],[[-1,41102],"0"],[[-1,150038],1],[[-1,150037],","],[[-1,24671],"9."],[[-1,24643],"5"],[[-1,24669],1],[[-1,40356],1],[[-1,148602],3],[[-1,150036],1],[[-1,150035],")"],[[-1,40567]," [rectangle,draw]"],[[-1,150034]," {"],[[-1,41150],"\\"],[[-1,150032],6],[[-1,150026],"{"],[[-1,41149],"\\"],[[-1,150025],"}"],[[-1,150024],1],[[-1,150023],"};"],[[-1,41137],"\n\\node (right0) at ("],[[-1,40354],"10"],[[-1,41117],1],[[-1,41116],","],[[-1,24675],"9."],[[-1,24645],"5"],[[-1,24673],1],[[-1,40360],1],[[-1,41115],3],[[-1,41112],")"],[[-1,40550]," [rectangle,draw]"],[[-1,41111]," {\\{\\}};"],[[-1,150021],"\n\\node (left1) "],[[-1,149959]," "],[[-1,150006],"at "],[[-1,40339]," "],[[-1,150003],"("],[[-1,40351],1],[[-1,150002],"0,"],[[-1,24679],"7."],[[-1,24647],"5"],[[-1,24677],1],[[-1,40364],1],[[-1,148606],3],[[-1,150000],1],[[-1,149999],")"],[[-1,40533]," [rectangle,draw]"],[[-1,149998]," {\\"],[[-1,149995],5],[[-1,149990],"{"],[[-1,40981],"``"],[[-1,32023],"grocery"],[[-1,32425],8],[[-1,34354],2],[[-1,34350],7],[[-1,34352],1],[[-1,149989],1],[[-1,149809],3],[[-1,40978],"''"],[[-1,149988],5],[[-1,149983],":"],[[-1,40976]," "],[[-1,149982],"[]"],[[-1,40975],"\\"],[[-1,149980],"}"],[[-1,149977],1],[[-1,149976],"};\n\\node (right1)"],[[-1,149957]," at ("],[[-1,40345],"10"],[[-1,40349],2],[[-1,149952],1],[[-1,149951],","],[[-1,24683],"7."],[[-1,24649],"5"],[[-1,24681],1],[[-1,40368],1],[[-1,148610],3],[[-1,149950],1],[[-1,149949],")"],[[-1,40516]," [rectangle,draw]"],[[-1,149948]," {\\"],[[-1,149945],5],[[-1,149940],"{"],[[-1,40967],"``"],[[-1,32038],"grocery"],[[-1,32408],8],[[-1,34340],9],[[-1,149939],1],[[-1,149802],3],[[-1,40970],"''"],[[-1,149938],5],[[-1,149933],":"],[[-1,40972]," "],[[-1,149930],"[]"],[[-1,40973],"\\"],[[-1,149928],"}"],[[-1,149927],1],[[-1,149926],"};\n\\node (left2)  at "],[[-1,40341]," "],[[-1,149905],"("],[[-1,40343],1],[[-1,149904],"0,"],[[-1,24653],"5.0"],[[-1,40372],1],[[-1,24686],2],[[-1,148614],3],[[-1,149902],1],[[-1,149901],")"],[[-1,40499]," [rectangle,draw]"],[[-1,149900]," {\\"],[[-1,149897],5],[[-1,149892],"{"],[[-1,40954],"``"],[[-1,32053],"grocery"],[[-1,32391],8],[[-1,34328],9],[[-1,149891],1],[[-1,149795],3],[[-1,40911],"''"],[[-1,149890],5],[[-1,149885],":"],[[-1,40894]," "],[[-1,149884],"["],[[-1,40887],"``"],[[-1,149883],1],[[-1,149882],"eggs"],[[-1,40869],"''"],[[-1,149878],1],[[-1,149877],"]"],[[-1,40783],"\\"],[[-1,149876],"}"],[[-1,149875],1],[[-1,149874],"};\n\\node (left3)  at "],[[-1,40336]," "],[[-1,149853],"(0,"],[[-1,40376],"2"],[[-1,24688],"."],[[-1,24657],"5"],[[-1,24687],1],[[-1,149850],1],[[-1,148617],2],[[-1,149849],")"],[[-1,40482]," [rectangle,draw]"],[[-1,149848]," {\\"],[[-1,149845],5],[[-1,149840],"{"],[[-1,40922],"``"],[[-1,32068],"grocery"],[[-1,32374],8],[[-1,34316],9],[[-1,149839],1],[[-1,149788],3],[[-1,40908],"''"],[[-1,149838],5],[[-1,149833],":"],[[-1,40893]," "],[[-1,149832],"["],[[-1,40884],"``"],[[-1,149831],1],[[-1,149830],"eggs"],[[-1,40866],"''"],[[-1,149826],1],[[-1,149825],","],[[-1,40864]," "],[[-1,40862],"``"],[[-1,149824],1],[[-1,149734],"ham"],[[-1,40859],"''"],[[-1,149823],5],[[-1,149818],"]"],[[-1,40785],"\\"],[[-1,149817],"}"],[[-1,149816],1],[[-1,149815],"};"],[[-1,149785],"\n\\node (right2) at "],[[-1,149762],"("],[[-1,40334],"10"],[[-1,149766],1],[[-1,149765],","],[[-1,24661],"5.0"],[[-1,40380],1],[[-1,24696],2],[[-1,148620],3],[[-1,149764],1],[[-1,149763],")"],[[-1,149761]," "],[[-1,40465],"[rectangle,draw] "],[[-1,149760],"{\\"],[[-1,149758],5],[[-1,149753],"{"],[[-1,40920],"``"],[[-1,32083],"grocery"],[[-1,32357],8],[[-1,34304],9],[[-1,149752],4],[[-1,40905],"''"],[[-1,149748],1],[[-1,149747],":"],[[-1,40892]," "],[[-1,149746],"["],[[-1,40881],"``"],[[-1,149745],1],[[-1,149728],"milk"],[[-1,40856],"''"],[[-1,149744],4],[[-1,149740],"]"],[[-1,40787],"\\"],[[-1,149739],"}"],[[-1,149724],1],[[-1,149723],"};\n\\node (right3) at ("],[[-1,40327],"10"],[[-1,40331],2],[[-1,149701],1],[[-1,149700],","],[[-1,40384],"2"],[[-1,24694],"."],[[-1,24665],"5"],[[-1,24693],1],[[-1,149699],1],[[-1,148627],2],[[-1,149698],")"],[[-1,40448]," [rect"],[[-1,40438],"angle,draw]"],[[-1,40442],2],[[-1,149697]," {\\"],[[-1,149694],5],[[-1,149689],"{"],[[-1,40918],"``"],[[-1,32098],"grocery"],[[-1,32340],8],[[-1,34292],9],[[-1,149688],4],[[-1,40902],"''"],[[-1,149684],1],[[-1,149683],":"],[[-1,40891]," "],[[-1,149682],"["],[[-1,40878],"``"],[[-1,149681],1],[[-1,149680],"milk"],[[-1,40853],"''"],[[-1,149676],1],[[-1,149675],","],[[-1,40851]," "],[[-1,40849],"``"],[[-1,149674],1],[[-1,149673],"flour"],[[-1,40846],"''"],[[-1,149668],1],[[-1,149667],"]"],[[-1,40789],"\\"],[[-1,149666],"}"],[[-1,149665],1],[[-1,149664],"};\n\\node "],[[-1,149655],5],[[-1,149648],4],[[-1,149644],"(left4) "],[[-1,148638]," "],[[-1,149636],"at "],[[-1,40325]," "],[[-1,149633],"(0,0"],[[-1,24692],".0"],[[-1,148625],2],[[-1,149629],") "],[[-1,40425],"[rectangle,draw] "],[[-1,40427],1],[[-1,149592],"{\\"],[[-1,149590],5],[[-1,149585],"{"],[[-1,40916],"``"],[[-1,32113],"grocery"],[[-1,32323],8],[[-1,34274],9],[[-1,34280],3],[[-1,149584],4],[[-1,40899],"''"],[[-1,149580],1],[[-1,149579],":"],[[-1,40890]," "],[[-1,149578],"["],[[-1,40875],"``"],[[-1,149577],1],[[-1,149576],"eggs"],[[-1,40843],"''"],[[-1,149572],1],[[-1,149571],","],[[-1,40841]," "],[[-1,40839],"``"],[[-1,149570],1],[[-1,149569],"ham"],[[-1,40836],"''"],[[-1,149566],1],[[-1,149565],","],[[-1,40834]," "],[[-1,40832],"``"],[[-1,149564],1],[[-1,149563],"milk"],[[-1,40829],"''"],[[-1,149559],1],[[-1,149558],","],[[-1,40827]," "],[[-1,40825],"``"],[[-1,149557],1],[[-1,149556],"flour"],[[-1,40822],"''"],[[-1,149551],1],[[-1,149550],"]"],[[-1,40793],"\\"],[[-1,149549],"}"],[[-1,149548],1],[[-1,149547],"};\n\\node (right4) at ("],[[-1,40323],"10"],[[-1,149525],1],[[-1,149524],",0"],[[-1,24690],".0"],[[-1,148623],2],[[-1,149522],")"],[[-1,40408]," [rectangle,draw]"],[[-1,149521]," {\\"],[[-1,149518],5],[[-1,149513],"{"],[[-1,40914],"``"],[[-1,32128],"grocery"],[[-1,32306],8],[[-1,34262],9],[[-1,149512],4],[[-1,40896],"''"],[[-1,149508],1],[[-1,149507],":"],[[-1,40889]," "],[[-1,149506],"["],[[-1,40872],"``"],[[-1,149505],1],[[-1,149504],"eggs"],[[-1,40819],"''"],[[-1,149500],1],[[-1,149499],","],[[-1,40817]," "],[[-1,40815],"``"],[[-1,149498],1],[[-1,149497],"ham"],[[-1,40812],"''"],[[-1,40810],1],[[-1,149494],1],[[-1,149493],","],[[-1,40808]," "],[[-1,40806],"``"],[[-1,149492],1],[[-1,149491],"milk"],[[-1,40803],"''"],[[-1,149487],1],[[-1,149486],","],[[-1,40801]," "],[[-1,40799],"``"],[[-1,149485],1],[[-1,149484],"flour"],[[-1,40796],"''"],[[-1,149479],1],[[-1,149478],"]"],[[-1,40794],"\\"],[[-1,149477],"}"],[[-1,149476],1],[[-1,149475],"};"],[[-1,39882],"\n\\node (comms) "],[[-1,39861]," "],[[-1,39867],"at "],[[-1,39859]," (5,1."],[[-1,39797],"4"],[[-1,39799],1],[[-1,39853],1],[[-1,39852],") [text=blue] {\\footnotesize network communication};"],[[-1,39862],1],[[-1,39864],1],[[-1,149473],"\n\\draw [thick,->] ("],[[-1,41096],"left0"],[[-1,149454],5],[[-1,149449],") "],[[-1,148637]," "],[[-1,149447],"to node [left"],[[-1,149434],1],[[-1,148628],1],[[-1,149433],6],[[-1,149268],1],[[-1,149427],5],[[-1,149264],1],[[-1,149422],3],[[-1,149419],"] "],[[-1,40748]," "],[[-1,149417],"{"],[[-1,149416],14],[[-1,149402],"doc"],[[-1,25083],".get("],[[-1,149399],1],[[-1,149398],"``"],[[-1,32143],"grocery"],[[-1,32289],8],[[-1,34250],9],[[-1,149396],3],[[-1,149393],"''"],[[-1,25059],")"],[[-1,149391],1],[[-1,149390]," := [];} (left1);\n\\draw [thick,->] ("],[[-1,41086],"right0"],[[-1,149354],5],[[-1,149349],")"],[[-1,149348],1],[[-1,148636]," "],[[-1,149347],"to node [right"],[[-1,149333],1],[[-1,149330],6],[[-1,149269],1],[[-1,149324],5],[[-1,149262],1],[[-1,149319],3],[[-1,149316],"] {"],[[-1,149313],14],[[-1,149299],"doc"],[[-1,25077],".get("],[[-1,149296],1],[[-1,149295],"``"],[[-1,32158],"grocery"],[[-1,32272],8],[[-1,34238],9],[[-1,149293],3],[[-1,149290],"''"],[[-1,25057],")"],[[-1,149288],1],[[-1,149287]," := [];} (right1);"],[[-1,149261],"\n\\draw [thick,->"],[[-1,149243],"] (left1) "],[[-1,148635]," "],[[-1,24966],"-- (left2)\n   "],[[-1,149233],2],[[-1,149231]," node [left"],[[-1,24952],",text wid"],[[-1,24941],"th=4cm,text centered,midway"],[[-1,24943],1],[[-1,149220],"]"],[[-1,24913]," "],[[-1,149219],1],[[-1,148629]," "],[[-1,149218],"{"],[[-1,149217],14],[[-1,149203],"doc"],[[-1,25071],".get("],[[-1,149200],1],[[-1,149199],"``"],[[-1,32173],"grocery"],[[-1,32255],8],[[-1,34226],9],[[-1,149197],3],[[-1,149194],"''"],[[-1,25055],")"],[[-1,149192],1],[[-1,149191],".i"],[[-1,25049],"dx(0)"],[[-1,24912]," "],[[-1,149189],3],[[-1,149186],".insert"],[[-1,10888],"After"],[[-1,149179],"(``eggs'');}"],[[-1,149167],8],[[-1,149159],";\n\\draw [thick,->] (right1) "],[[-1,24903],"-- (right2)\n    "],[[-1,149131],3],[[-1,149128],"node [right"],[[-1,24884],",text width=4cm,text centered,midway"],[[-1,149117],"] {"],[[-1,149114],14],[[-1,149100],"doc"],[[-1,25065],".get("],[[-1,149097],1],[[-1,149096],"``"],[[-1,32188],"grocery"],[[-1,32238],8],[[-1,34214],9],[[-1,149094],3],[[-1,149091],"''"],[[-1,25053],")"],[[-1,149089],1],[[-1,149088],".i"],[[-1,25041],"dx(0)"],[[-1,24785]," "],[[-1,149086],3],[[-1,149083],".insert"],[[-1,10883],"After"],[[-1,149076],"(``milk'');}"],[[-1,149064],9],[[-1,149055],";\n\\draw [thick,->] (left2) "],[[-1,148634]," "],[[-1,24839],"-- (left3)\n"],[[-1,24826],"   "],[[-1,149028],2],[[-1,149026]," node [left"],[[-1,24823],",text width="],[[-1,24809],"4cm,text centered,midway"],[[-1,24811],1],[[-1,149015],"] "],[[-1,148630]," "],[[-1,149013],"{"],[[-1,25032],"doc.get(``grocery'').idx(1)"],[[-1,24784]," "],[[-1,149012],18],[[-1,148994],".insert"],[[-1,10878],"After"],[[-1,148987],"(``ham'');}"],[[-1,148976],8],[[-1,148968],";\n\\draw [thick,->] (right2) "],[[-1,24775],"-- (right3)\n    "],[[-1,148940],3],[[-1,148937],"node [right"],[[-1,24756],",text width=4cm,text centered,midway"],[[-1,148926],"] {"],[[-1,25001],"doc.get("],[[-1,24989],"``groc"],[[-1,24981],"ery'').idx(1)"],[[-1,24720]," "],[[-1,24983],1],[[-1,24993],2],[[-1,148923],18],[[-1,148905],".insert"],[[-1,10873],"After"],[[-1,148898],"(``flour'');}"],[[-1,148885],9],[[-1,148876],";\n\\draw [thick,->] (left3) "],[[-1,148633]," "],[[-1,148849],"to "],[[-1,148846],12],[[-1,148631],1],[[-1,148834],21],[[-1,148811],2],[[-1,148809],"(left"],[[-1,148802],"4);\n"],[[-1,17438],4],[[-1,148798],"\\draw [thick,->] (right3) to "],[[-1,148769],36],[[-1,148733],"(right4);\n\\draw [thick,"],[[-1,40591],"dashed,blue,"],[[-1,148710],"->] (left3"],[[-1,40321],".south"],[[-1,40315],5],[[-1,148700],") "],[[-1,148632]," "],[[-1,148698],"to"],[[-1,40188]," [out="],[[-1,40158],"27"],[[-1,40166],1],[[-1,40182],2],[[-1,40180],"0"],[[-1,40156],",in="],[[-1,40141],"135"],[[-1,40152],2],[[-1,40179],"]"],[[-1,148696]," (right"],[[-1,148687],"4"],[[-1,40310],"."],[[-1,40272],"north"],[[-1,40309],5],[[-1,40304]," west"],[[-1,148686],");\n\\draw [thick,"],[[-1,40579],"dashed,blue,"],[[-1,148670],"->"],[[-1,148666],"] (right3"],[[-1,40299],"."],[[-1,40262],"south"],[[-1,40257],5],[[-1,40298],6],[[-1,40284],4],[[-1,40292],4],[[-1,148655],") to"],[[-1,40178]," [out="],[[-1,40161],"27"],[[-1,40163],1],[[-1,40172],2],[[-1,40170],"0"],[[-1,40150],",in="],[[-1,40135],"45"],[[-1,40146],3],[[-1,40169],"]"],[[-1,148651]," "],[[-1,40083]," "],[[-1,148650],"(left"],[[-1,148641],"4"],[[-1,40280],".no"],[[-1,40247],"rth east"],[[-1,148640],");"],[[-1,148645],2],[[-1,148657],1],[[-1,148668],1],[[-1,148689],1],[[-1,148804],1],[[-1,148813],1],[[-1,149245],1],[[-1,149332],1],[[-1,149594],1],[[-1,149627],12],[[-1,149650],1],[[-1,149932],1],[[-1,149979],1],[[-1,150196],"\n\\end{tikzpicture}\n\\caption{Two replicas concurrently create "],[[-1,150129],"ordered lists under the same map key"],[[-1,105034],"."],[[-1,150093],"}\\label{fig:two-lists}\n\\end{figure*}"],[[-1,147548],"\n\n"],[[-1,147546],89],[[-1,147418],8],[[-1,147433],8],[[-1,147457],24],[[-1,147410],6],[[-1,32205],8],[[-1,32221],8],[[-1,34202],9],[[-1,147404],46],[[-1,34152],26],[[-1,147358],9],[[-1,34183],11],[[-1,147349],39],[[-1,147308],32],[[-1,147262],57],[[-1,147203],38],[[-1,147163],48],[[-1,147099],28],[[-1,147055],69],[[-1,146980],33],[[-1,146943],24],[[-1,146915],77],[[-1,146830],27],[[-1,28463],2],[[-1,28461],"\\begin{figure*}"],[[-1,17447],"[p]"],[[-1,28446],"\n\\centering\n\\begin{tikzpicture}[auto,scale=0.8]"],[[-1,23370],"\n\\"],[[-1,23348],"path [draw,dotted] (4,-0"],[[-1,23322],".5) -- (4,"],[[-1,23122],"8.5"],[[-1,23279],1],[[-1,23312],3],[[-1,23309],");\n\\node (leftR)  at (0,8"],[[-1,23284],2],[[-1,23278],") {Replica $p$:};\n\\node (rightR) at (8,8"],[[-1,23238],2],[[-1,23236],") {Replica $q$:};"],[[-1,23324],1],[[-1,23368],10],[[-1,28280],"\n\\node (left1) "],[[-1,24607]," "],[[-1,28265],"at (0,"],[[-1,23618],"7"],[[-1,24553],1],[[-1,28259],1],[[-1,28258],") [rectangle,draw] {"],[[-1,28238],12],[[-1,28226],"["],[[-1,28221],"``"],[[-1,28199],"a"],[[-1,28219],1],[[-1,28218],"'', ``"],[[-1,28197],"b"],[[-1,28212],1],[[-1,28211],"''"],[[-1,28196],", ``c''"],[[-1,28209],"]"],[[-1,28208],2],[[-1,28202],"};"],[[-1,24623],16],[[-1,24606],5],[[-1,24599],1],[[-1,24551],1],[[-1,24598],44],[[-1,24550],"\n\\node (left2)  at (0,"],[[-1,23620],"5"],[[-1,24528],1],[[-1,24527],") [rectangle,draw] {[``a'', ``c'']};\n\\node ("],[[-1,24337],"left3)  at (0,"],[[-1,23622],"3"],[[-1,24323],1],[[-1,24322],") [rectangle,draw] {[``a'', ``x'', ``c'']};"],[[-1,24114],"\n\\node (left4)  at (0,0) [rectangle,draw] "],[[-1,24070],"{[``y'', ``a'', ``x'', ``z'', ``c'']};"],[[-1,24072],1],[[-1,24483],"\n\\node (right1) at ("],[[-1,24461],"8,"],[[-1,23624],"7"],[[-1,24459],1],[[-1,24458],") [rectangle,draw] {[``a'', "],[[-1,24418],"``b'', ``c'']};"],[[-1,24279],"\n\\node (right2) at (8,"],[[-1,23626],"5"],[[-1,24257],1],[[-1,24256],") [rectangle,draw] {[``y'', "],[[-1,24224],"``a'', ``b'', ``c'']};\n\\node "],[[-1,24191],"(right3) at (8,"],[[-1,23628],"3"],[[-1,24174],1],[[-1,24173],") [rectangle,draw] {[``y'', ``a'', ``z''"],[[-1,24131],", ``b'', ``c'']};"],[[-1,24032],"\n\\node (right"],[[-1,24015],"4) at (8,0) [rectangle,draw] {[``y'', "],[[-1,23975],"``a'', ``x'', ``z'', ``c'']};"],[[-1,23448],"\n\\node (comms)  at ("],[[-1,23130],"4"],[[-1,23428],1],[[-1,23427],", 1."],[[-1,23128],"5"],[[-1,23423],1],[[-1,23422],") [text=blue] {\\footnotesize network communication};"],[[-1,23946],"\n\\draw [thick,->] (left1)  to node [left]  {doc.idx(2).delete;} (left2);\n\\draw [thick,->] (left2"],[[-1,23848],")  to node [left]  {doc.idx(1).insert"],[[-1,10868],"A"],[[-1,10859],"fter"],[[-1,10867],4],[[-1,23811],"(``x'');} (left3);\n\\draw [thick,->] (right1) to node [right] {doc.idx("],[[-1,23739],"0).insert"],[[-1,10855],"After"],[[-1,23730],"(``y'');} (right2);\n\\draw"],[[-1,23703]," [thick,->] (right2) to node [right] {doc.idx(2).insert"],[[-1,10850],"After"],[[-1,23648],"(``z'');} (right3);"],[[-1,23111],"\n\\draw [thick,->"],[[-1,23091],"] (left3) "],[[-1,23078]," "],[[-1,23081],"to "],[[-1,23077],"(left4);\n\\draw [thick,->] (right3) to (right"],[[-1,23031],"4);"],[[-1,23033],1],[[-1,23095],2],[[-1,23617],"\n\\draw [thick,dashed,blue,->] (left3.south)  to [out=270,in=135] (right4.north west);\n\\draw [thick,dashed,blue,->"],[[-1,23492],"]"],[[-1,23504]," (right3.sou"],[[-1,23491],"th) to [out=270,in=45]  (left4.north east);"],[[-1,23119],4],[[-1,23705],1],[[-1,23741],1],[[-1,23850],1],[[-1,23977],1],[[-1,24019],2],[[-1,24133],1],[[-1,24176],1],[[-1,24195],2],[[-1,24228],2],[[-1,24420],1],[[-1,24426],3],[[-1,24430],2],[[-1,24463],1],[[-1,24601],1],[[-1,28204],1],[[-1,28206],1],[[-1,28225],2],[[-1,28399],"\n\\end{tikzpicture}\n\\caption{Concurrent editing of an ordered list of characters (i.e., a text document).}"],[[-1,20174],"\\label{fig:text-edit}"],[[-1,28294],"\n\\end{figure*}"],[[-1,22966],"\n\n\\begin{figure*}"],[[-1,17444],"[p]"],[[-1,22949],"\n\\centering\n\\begin{tikzpicture}[auto,scale=0.8]"],[[-1,22790],"\n\\path [draw,dotted] (4,-"],[[-1,21467],"1"],[[-1,22765],3],[[-1,22762],") -- (4,"],[[-1,21471],"7"],[[-1,22754],1],[[-1,22753],".5);\n\\node (left1)  at (0,7) [rectangle,draw"],[[-1,22707],"] {\\{\\}};"],[[-1,22647],"\n\\node (left2)  at (0,5) [rectangle,draw] {\\{``a'': \\{\\}\\}};\n\\node (left3)  at (0,"],[[-1,22563],"3) [rectangle,dr"],[[-1,22541],"aw] {\\{``a'': \\{``x'': ``y''\\}\\}};"],[[-1,22378],"\n\\node"],[[-1,22271]," [matrix]"],[[-1,22372]," (left"],[[-1,22364],"4) "],[[-1,22361],1],[[-1,22360],"at (0,0) [rectangle,draw] {"],[[-1,22261],"\n    \\node {"],[[-1,22333],"\\"],[[-1,22330],"{"],[[-1,22325],"mapT("],[[-1,22329],"``a'"],[[-1,22320],"'): \\{``x'': ``y''\\},"],[[-1,22249],"}; \\\\\n    \\node {"],[[-1,22299],1],[[-1,22298],"listT(``a'"],[[-1,22286],"'): [``z'']\\}};"],[[-1,22231]," \\\\\n};"],[[-1,22288],1],[[-1,22332],1],[[-1,22366],1],[[-1,22547],3],[[-1,22565],1],[[-1,22698],"\n\\node (right1) at ("],[[-1,22676],"8,7) [rectangle,draw] {\\{\\}};"],[[-1,22507],"\n\\node (right2) at (8,5) [rectangle,draw] "],[[-1,22463],"{\\{``a'': []\\}};\n\\node (right3) at (8,"],[[-1,22423],"3) [rectangle,draw] {\\{``a'': [``z'']\\}"],[[-1,22379],"}"],[[-1,22381],1],[[-1,22384],1],[[-1,22383],";"],[[-1,22225],"\n\\node [matrix] (right4"],[[-1,22200],") at (8,0) [rectangle,draw] {\n    \\node {\\{mapT(``a''): "],[[-1,22140],"\\{``x'': ``y''\\},}; \\\\\n    \\node {listT(``a''): [``z'']\\}}; \\\\\n};"],[[-1,21466],"\n\\node (comms)  at (4,"],[[-1,21386],"2.0"],[[-1,21444],3],[[-1,21441],") [text=blue] {\\footnotesize network communication};"],[[-1,22075],"\n\\draw [thick,->"],[[-1,22057],"] (left1)  to node [left"],[[-1,22031],"]  {doc.get(``a'') := \\{\\};} (left2);\n\\draw [thick,->"],[[-1,21976],"] (left2)  to node [left]  "],[[-1,21857],"{"],[[-1,21949],1],[[-1,21948],"doc.get(``a'').get(``x'') := ``y'';} (left3);\n\\draw [thick,->"],[[-1,21885],"] (right1) to node [right] "],[[-1,21856],"{doc.get(``a'') := [];} (right2);\n\\draw [thick,->"],[[-1,21803],"] (right2) to node [right] {doc.get(``a'')"],[[-1,21759],".idx(0).insert"],[[-1,10845],"After"],[[-1,21745],"(``z'');} (right3);\n\\draw [thick,->] (left3)  to "],[[-1,21694],"(left4);\n\\draw [thick,->] ("],[[-1,21665],"right3) to (right4);\n\\draw [thick,dashed,blue,->] (left3.south)  to [out=270,in=135] (right4.north west);\n\\draw [thick,dashed,blue,->"],[[-1,21528],"] (right3.south) to [out=270,in=45]  (left4.north east);"],[[-1,21532],2],[[-1,21667],1],[[-1,21696],1],[[-1,21761],1],[[-1,21807],2],[[-1,21887],1],[[-1,21978],1],[[-1,22033],1],[[-1,22059],1],[[-1,22144],2],[[-1,22202],1],[[-1,22425],1],[[-1,22465],1],[[-1,22678],1],[[-1,22709],1],[[-1,22902],"\n\\end{tikzpicture}\n\\caption{Concurrently assigning values of different types to the same map key.}"],[[-1,20153],"\\label{fig"],[[-1,20135],":type-clash}"],[[-1,20143],4],[[-1,22804],"\n\\end{figure*}"],[[-1,146838],4],[[-1,146919],2],[[-1,146947],2],[[-1,146986],3],[[-1,147057],1],[[-1,147071],7],[[-1,147115],8],[[-1,147165],1],[[-1,147205],1],[[-1,147276],7],[[-1,147310],1],[[-1,148593],"\n\n\\begin{figure*}"],[[-1,17441],"[p]"],[[-1,148560],"\n\\centering\n\\begin{tikzpicture}[auto"],[[-1,39794],",scale=0.8"],[[-1,148524],"]"],[[-1,38933],"\n\\path [draw,dotted] (4,-0.5) -- (4,"],[[-1,23025],"7.0"],[[-1,23218],3],[[-1,38897],1],[[-1,38896],");"],[[-1,39029],15],[[-1,38970],1],[[-1,39014],3],[[-1,39009],2],[[-1,39005],1],[[-1,38940],3],[[-1,39004],34],[[-1,38969],6],[[-1,38944],3],[[-1,38963],18],[[-1,38937],2],[[-1,39007],1],[[-1,39011],1],[[-1,148388],"\n\\node"],[[-1,39183]," [matrix]"],[[-1,148382]," ("],[[-1,39304],"left0"],[[-1,148380],5],[[-1,148375],")"],[[-1,148374],1],[[-1,148373]," at ("],[[-1,39327],"0"],[[-1,148368],1],[[-1,148367],","],[[-1,39075],"6"],[[-1,39083],1],[[-1,39325],1],[[-1,39781],1],[[-1,148029],3],[[-1,148296],1],[[-1,148366],1],[[-1,148365],")"],[[-1,39413]," [rectangle,draw]"],[[-1,148364]," {"],[[-1,39164],"\n    \\node {"],[[-1,148362],"\\"],[[-1,148361],5],[[-1,148353],"{"],[[-1,39742],"``"],[[-1,148352],1],[[-1,148351],"todo"],[[-1,39727],"''"],[[-1,148347],1],[[-1,148346],":"],[[-1,148298]," "],[[-1,148345],"["],[[-1,39713],"\\"],[[-1,148344],"{"],[[-1,39711],"``"],[[-1,148343],1],[[-1,148342],"t"],[[-1,148335],"itle"],[[-1,39708],"''"],[[-1,148331],1],[[-1,148330],":"],[[-1,148299]," "],[[-1,39705],"``"],[[-1,148329],1],[[-1,148328],"buy milk"],[[-1,39702],"''"],[[-1,148320],1],[[-1,148319],","],[[-1,39152],"}; \\\\\n    \\"],[[-1,39133],"node {"],[[-1,39141],4],[[-1,148318],1],[[-1,39699],"``"],[[-1,148317],1],[[-1,148316],"done"],[[-1,39696],"''"],[[-1,148310],1],[[-1,148309],": false"],[[-1,39694],"\\"],[[-1,148302],"}]"],[[-1,39693],"\\"],[[-1,148300],"}"],[[-1,148312],1],[[-1,148341],3],[[-1,148356],1],[[-1,148355],"};"],[[-1,39126]," \\\\\n};"],[[-1,39324],"\n\\node"],[[-1,39174]," [matrix]"],[[-1,39318]," (right0)"],[[-1,39299]," at (8,"],[[-1,39077],"6"],[[-1,39085],1],[[-1,39292],1],[[-1,39291],") [rectangle,draw] {"],[[-1,39120],"\n    \\node {"],[[-1,39271],"\\{``todo'': [\\{``title'': ``buy milk'',"],[[-1,39108],"}; \\\\\n  "],[[-1,39232]," "],[[-1,39100]," \\node {"],[[-1,39231],"``done'': false\\}]\\}"],[[-1,39209],"}"],[[-1,39206],";"],[[-1,39092]," \\\\\n};"],[[-1,39208],1],[[-1,39211],1],[[-1,148295],"\n\\node (left1)  at (0,"],[[-1,39079],"3"],[[-1,39777],1],[[-1,148033],3],[[-1,148273],1],[[-1,148272],")"],[[-1,39396]," [rectangle,draw]"],[[-1,148271]," {\\"],[[-1,148268],5],[[-1,148263],"{"],[[-1,39739],"``"],[[-1,148262],1],[[-1,148261],"todo"],[[-1,39724],"''"],[[-1,148257],1],[[-1,148256],": []"],[[-1,39690],"\\"],[[-1,148252],"}"],[[-1,148251],1],[[-1,148250],"};\n\\node"],[[-1,39074]," [matrix]"],[[-1,148242]," (right1) at (8,"],[[-1,39081],"3"],[[-1,39773],1],[[-1,148037],3],[[-1,148226],1],[[-1,148225],")"],[[-1,39379]," [rectangle,draw]"],[[-1,148224]," {"],[[-1,39065],"\n    \\node {"],[[-1,148222],"\\"],[[-1,148221],5],[[-1,148216],"{"],[[-1,39736],"``"],[[-1,148215],1],[[-1,148214],"todo"],[[-1,39721],"''"],[[-1,148210],1],[[-1,148209],": ["],[[-1,39689],"\\"],[[-1,148206],"{"],[[-1,39687],"``"],[[-1,148205],1],[[-1,148204],"title"],[[-1,39684],"''"],[[-1,148199],1],[[-1,148198],": "],[[-1,39681],"``"],[[-1,148196],1],[[-1,148195],"buy milk"],[[-1,39678],"''"],[[-1,148187],1],[[-1,148186],","],[[-1,39052],"}; \\\\\n    \\node {"],[[-1,148185],1],[[-1,39675],"``"],[[-1,148184],1],[[-1,148183],"done"],[[-1,39672],"''"],[[-1,148179],1],[[-1,148178],": true"],[[-1,39670],"\\"],[[-1,148172],"}]"],[[-1,39669],"\\"],[[-1,148170],"}"],[[-1,148169],1],[[-1,148168],"};"],[[-1,39035]," \\\\\n};"],[[-1,148166],"\n\\node (left2)  at (0,0"],[[-1,148026],2],[[-1,148143],")"],[[-1,39362]," [rectangle,draw]"],[[-1,148142]," {\\"],[[-1,148139],5],[[-1,148130],"{"],[[-1,39733],"``"],[[-1,148129],1],[[-1,148128],"todo"],[[-1,39718],"''"],[[-1,148124],1],[[-1,148123],": ["],[[-1,39667],"\\"],[[-1,148120],"{"],[[-1,39664],"``"],[[-1,148119],1],[[-1,148118],"done"],[[-1,39658],"''"],[[-1,148114],1],[[-1,148113],": true"],[[-1,39651],"\\"],[[-1,148107],"}]"],[[-1,39649],"\\"],[[-1,148105],"}"],[[-1,148104],1],[[-1,148103],"};\n\\node (right2) at (8,0"],[[-1,148024],2],[[-1,148078],")"],[[-1,39345]," [rectangle,draw]"],[[-1,148077]," {\\"],[[-1,148074],5],[[-1,148069],"{"],[[-1,39730],"``"],[[-1,148068],1],[[-1,148067],"todo"],[[-1,39715],"''"],[[-1,148063],1],[[-1,148062],": ["],[[-1,39666],"\\"],[[-1,148057],"{"],[[-1,39661],"``"],[[-1,148056],1],[[-1,148055],"done"],[[-1,39653],"''"],[[-1,148051],1],[[-1,39656],1],[[-1,148050],": true"],[[-1,39650],"\\"],[[-1,148044],"}]"],[[-1,39648],"\\"],[[-1,148042],"}"],[[-1,148041],1],[[-1,148040],"};"],[[-1,38894],"\n\\node (comms)  at (4,1."],[[-1,38816],"6"],[[-1,38870],1],[[-1,38869],") [text=blue] {\\footnotesize network communication};"],[[-1,148022],"\n\\draw [thick,->] ("],[[-1,39200],"left0"],[[-1,148003],5],[[-1,147998],")  to node [left"],[[-1,147982],17],[[-1,147965],"]"],[[-1,39628]," "],[[-1,147964]," {"],[[-1,147962],14],[[-1,147948],"doc"],[[-1,23021],".get("],[[-1,147945],1],[[-1,147944],"``todo''"],[[-1,23009],").idx(1)"],[[-1,147936],11],[[-1,147925],".delete;} (left1);\n\\draw [thick,->] ("],[[-1,39190],"right0"],[[-1,147888],5],[[-1,147883],")"],[[-1,147882],1],[[-1,147881]," to node [right"],[[-1,147866],16],[[-1,147850],"] {"],[[-1,147847],14],[[-1,147833],"doc"],[[-1,23015],".get("],[[-1,147830],1],[[-1,147829],"``todo''"],[[-1,22985],")"],[[-1,147821],1],[[-1,147818],5],[[-1,147813],"."],[[-1,22984],"idx(1)."],[[-1,22972],"get("],[[-1,147812],5],[[-1,147807],"``done''"],[[-1,22967],")"],[[-1,147799],1],[[-1,147798]," := true;} (right"],[[-1,147779],"1);\n\\draw [thick,->] (left1)  to "],[[-1,147746],36],[[-1,147708],"(left2);\n\\draw [thick,->] (right1) to "],[[-1,147670],36],[[-1,147634],"(right2);\n\\draw [thick,"],[[-1,39511],"dashed,blue,"],[[-1,147611],"->] (left1"],[[-1,39487],".south"],[[-1,147601],")  to"],[[-1,39475]," [out=2"],[[-1,39464],"70"],[[-1,39460],",in=135]"],[[-1,39462],1],[[-1,39468],2],[[-1,147596]," (right2"],[[-1,39435],".north west"],[[-1,147588],");\n\\draw [thick,"],[[-1,39499],"dashed,blue,"],[[-1,147572],"->] (right1"],[[-1,39481],".south"],[[-1,147561],") to"],[[-1,39452]," [out=270,in=45] "],[[-1,147557]," (left2"],[[-1,39424],".north east"],[[-1,147550],");"],[[-1,147710],1],[[-1,147781],1],[[-1,147820],1],[[-1,148059],1],[[-1,148134],2],[[-1,148523],"\n\\end{tikzpicture}\n\\capt"],[[-1,148497],"ion{One replica removes a list element, while another concurrently updates its contents"],[[-1,105033],"."],[[-1,148410],"}\\label{fig:todo-item}"],[[-1,148499],1],[[-1,148576],"\n"],[[-1,16767],1],[[-1,148575],"\\end{figure*"],[[-1,148561],"}"],[[-1,146803],"\n"],[[-1,16765],"\n"],[[-1,16763],"Figure~\\ref{fig:map-remove} gives an example of concurrent edits at different levels of the JSON tree. Here, replica $p$ adds ``red'' to a map of colors, while replica $q$ concurrently blanks out the entire map of colors"],[[-1,16543],1],[[-1,16542]," and then adds "],[[-1,16526],"``green''. Instead"],[[-1,16506]," of assigning an empty map, $q$ could equivalently remove the entire key ``colors'' from the outer map, and then assign a new em"],[[-1,16376],"pty map to that key. The difficulty in this example is that the addition of ``red'' occurs at a lower level of the tree, while concurrently the removal of the map of colors occurs at a higher level of the tree.\n\nOne possible way of handling such a conflict would be to let edits at higher levels of the tree always override concurrent edits within that subtree. In this case, that would mean the addition of ``red'' would be discarded, since it would be overridden by the blanking-out of the entire map of colors. However, that behavior would "],[[-1,15795],"violate"],[[-1,15833],8],[[-1,15825]," our requirement that "],[[-1,15788],"no user input should be lost due to concurrent modifications. Instead, we "],[[-1,15712],"define merge semantics that preserve all changes, as shown in Figure~\\ref{fig:map-remove}: ``blue'' must be absent from the final map, since it was removed by blanking out the map, while ``red'' and ``green'' must be present"],[[-1,15486],", since they were explicitly added. This behavior matches that of CRDT maps in Riak~\\cite{Brown:2014hs,Brown:2013wy}."],[[-1,13941],"\n\nFigure~\\ref{fig:two-lists} illustrates another problem with maps: two replicas can concurrently insert the same map key. Here, $p$ and $q$ each independently create a new shopping list under the same map key ``grocery'', and add items to the list. In the case of Figure~\\ref{fig:register-assign}, concurrent assignments to the same map key were left to be resolved by the application, but in Figure~\\ref{fig:two-lists}, both values are lists and so they can be merged automatically. We preserve the ordering and adjacency of items inserted at each replica, so ``ham'' appears after ``eggs'', and ``flour'' appears after ``milk'' in the merged result. There is no information on which replica's items should appear first in the merged result, so the algorithm can make an arbitrary choice between ``eggs, ham, milk, flour'' and ``milk, flour, eggs, ham'', provided that all replicas end up with the"],[[-1,13030]," items in the"],[[-1,13042]," same order."],[[-1,13017],"\n\nFigure~\\ref{fig:text-edit} shows how a collaborative text editor can be implemented, "],[[-1,12914],"by treating the document as a list of characters."],[[-1,12808]," All changes are preserved in the merged result:"],[[-1,12865]," ``y'' is inserted before ``a''"],[[-1,12809],";"],[[-1,12744]," ``x'' and ``z'' are inserte"],[[-1,12712],"d between "],[[-1,12698],"``a'' and ``c''; and"],[[-1,12702],2],[[-1,12716],2],[[-1,12834],1],[[-1,12833]," ``b'' is deleted"],[[-1,12678],".\n\nFigure~\\ref{fig:type-clash} demonstrates a variant of the situation in Figure~\\ref{fig:two-lists}, where "],[[-1,12568],"two replicas concurrently insert the same map key, but they do so with different datatypes as values: $"],[[-1,12463],"p$ inserts a nested map, whereas $q$ inserts a list. These datatypes cannot"],[[-1,10801]," be"],[[-1,10803],1],[[-1,12388]," meaningfully"],[[-1,12375],3],[[-1,12372]," merged, so we preserve both values separately. We do this by"],[[-1,12273]," tagging each map key with a type annotation (\\textsf{mapT}"],[[-1,12189],","],[[-1,12214],3],[[-1,12211]," \\textsf{"],[[-1,12198],"listT}"],[[-1,12188],", or \\textsf{regT} for a map, list, or register value respectively), so each type inhabits a separate namespace."],[[-1,12076],8],[[-1,12202],2],[[-1,12311],19],[[-1,12465],1],[[-1,12570],1],[[-1,12759],1],[[-1,12816],6],[[-1,12754],2],[[-1,12758],2],[[-1,12930],8],[[-1,15488],1],[[-1,15714],1],[[-1,16378],1],[[-1,16508],1],[[-1,16764],"\n"],[[-1,146802],"\n"],[[-1,31976],"F"],[[-1,146801],5],[[-1,146796],"inal"],[[-1,31975],"ly,"],[[-1,146792]," "],[[-1,146791],11],[[-1,146780],"Figure~\\ref{fig:todo-item} shows a limitation of the principle of preserving all user input. In "],[[-1,146668],"a to-do list application, one replica removes a to-do item from the list, while another replica concurrently marks the same item as done. As the changes are merged, the update of the map key ``done'' effectively causes the list item to be resurrected on"],[[-1,146415],9],[[-1,146406]," replica"],[[-1,32007]," $p$"],[[-1,146394],", lea"],[[-1,31996],"ving"],[[-1,146389],7],[[-1,146382]," a to-do"],[[-1,146372]," item without a title (since the title was deleted as part of deleting the list item). This behavior is consistent with the example in Figure~\\"],[[-1,146227],"ref{fig:map-remove}, but it is perhaps surprising"],[[-1,146178],9],[[-1,146169],". In this "],[[-1,31985],"case"],[[-1,146159],7],[[-1,146152]," it may be more desirable to discard one of the concurrent updates, and thus preserve the implicit schema that a to-do item has both a ``title'' and a ``done'' field."],[[-1,36238]," We leave t"],[[-1,36225],"he"],[[-1,36152]," analysis"],[[-1,36089]," of developer expectation"],[[-1,36025],"s"],[[-1,36143]," "],[[-1,36094],"and"],[[-1,36064],4],[[-1,36091],1],[[-1,36142],13],[[-1,36125],2],[[-1,36119],5],[[-1,36123],2],[[-1,36129],2],[[-1,36223]," "],[[-1,36042],"the "],[[-1,34098],"development of"],[[-1,36038],4],[[-1,36024],15],[[-1,36034],9],[[-1,36222],10],[[-1,36210],4],[[-1,36206]," a "],[[-1,36191],"schema lan"],[[-1,36175],"guage "],[[-1,31959],"for"],[[-1,36167],2],[[-1,36165]," future work."],[[-1,36169],1],[[-1,36181],3],[[-1,36203],6],[[-1,36212],1],[[-1,36227],1],[[-1,145986],2],[[-1,145982],42],[[-1,145938],44],[[-1,145888],171],[[-1,145894],3],[[-1,145940],1],[[-1,145984],1],[[-1,146229],1],[[-1,146374],1],[[-1,146398],2],[[-1,146684],1],[[-1,146675],3],[[-1,146683],4],[[-1,148563],1],[[-1,150135],3],[[-1,150249],"\n"],[[-1,145468],"\n\\subsection{JSON "],[[-1,7441],"V"],[[-1,145450],1],[[-1,145449],"ersus "],[[-1,145261],"XML"],[[-1,145443],12],[[-1,145431],"}"],[[-1,115012],"\\label{sec:json-xml}"],[[-1,145430],"\n\nThe most common alternative to JSON is XML, and collaborative editing of XML documents has been "],[[-1,145272],"previously"],[[-1,145332],11],[[-1,145321]," studied"],[[-1,135809],"~\\cite{Davis:2002iv,Ignat:2003jy,Wang:2015v"],[[-1,135646],"o"],[[-1,135766],1],[[-1,135765],"}"],[[-1,145309],22],[[-1,145284],1],[[-1,145287],2],[[-1,145285],"."],[[-1,145262]," "],[[-1,145219],"Besides the superficial synta"],[[-1,145188],"ctical differences, "],[[-1,145190],1],[[-1,145246],9],[[-1,145237],"the tree structure"],[[-1,145159]," of XML and JSON appears quite similar. However, there is an important difference that we should highlight.\n\nJSON has two collection constructs"],[[-1,144945]," that can be arbitrarily nested"],[[-1,145016],": maps for unordered key-value pairs, and lists for ordered sequences. "],[[-1,144764],"In "],[[-1,144914],"XM"],[[-1,144766],"L,"],[[-1,144912],36],[[-1,144876]," the children of an element "],[[-1,144838],"form an "],[[-1,144814],6],[[-1,144830],"ordered sequence"],[[-1,144761],", while the attributes of an element are unordered key-value pairs. However, "],[[-1,144672],"XML does not allow nested "],[[-1,144642],"elements inside attributes -- the value of an attribute can only be a primitive datatype. Thus, XM"],[[-1,144532],"L"],[[-1,144544],1],[[-1,144543]," supports "],[[-1,144531],"maps within lists, but not lists"],[[-1,144483]," "],[[-1,144482],7],[[-1,144499],1],[[-1,144498],"within"],[[-1,144475]," "],[[-1,144474],5],[[-1,144492],1],[[-1,144491],"maps."],[[-1,144380]," In this regard, XML is "],[[-1,144334],"less expressive than JSON: "],[[-1,144306],"t"],[[-1,144356],11],[[-1,144469],1],[[-1,144391],5],[[-1,144468],1],[[-1,144467],"he "],[[-1,12025],"scenarios"],[[-1,144464],7],[[-1,12060],1],[[-1,144457]," in Figure"],[[-1,12059],"s"],[[-1,144447],"~\\ref{fig:two-lists}"],[[-1,12058]," and~\\ref{fig:type-clash}"],[[-1,144427]," cannot occur in XML"],[[-1,144207],70],[[-1,144305],"."],[[-1,144407],16],[[-1,144486],"\n\nS"],[[-1,144288],"ome applications may attach map-like semantics to the children of an XML document"],[[-1,144123],", for example by "],[[-1,144057],"interpreting"],[[-1,144106],5],[[-1,144101]," the "],[[-1,144068],"child "],[[-1,144096],"element name "],[[-1,144028],"as key. However, th"],[[-1,79215],"is key-value "],[[-1,79200],"structure is"],[[-1,79202],1],[[-1,144009],17],[[-1,143992]," not part of XML itself"],[[-1,79188],","],[[-1,143969]," and would not be enforced"],[[-1,143730]," by existing collaborative editing algorithms for XML."],[[-1,143881],1],[[-1,143758]," "],[[-1,143674],"I"],[[-1,143757],1],[[-1,143756],"f "],[[-1,143671],"multiple children with the same key are concurrently created, existing algorith"],[[-1,143590],"ms "],[[-1,143592],1],[[-1,143732],2],[[-1,143754],11],[[-1,143880],1],[[-1,143871],50],[[-1,143821],"would create duplicate "],[[-1,143535],"c"],[[-1,143798],1],[[-1,143797],"hildren with the same key rather than m"],[[-1,143464],"erging them like in Figure~\\ref{fig:two-lists}."],[[-1,135764],"\n\n"],[[-1,135762],11],[[-1,135725],78],[[-1,135751],13],[[-1,143879],4],[[-1,143943],31],[[-1,144083],15],[[-1,144045],1],[[-1,144646],2],[[-1,144684],6],[[-1,144848],5],[[-1,145313],2],[[-1,145504],2],[[-1,145502],"\\subsection{Document "],[[-1,7439],"E"],[[-1,145481],1],[[-1,145480],"diting API}"],[[-1,114992],"\\label{sec:"],[[-1,114964],"editing"],[[-1,114981],6],[[-1,114975],"-api}"],[[-1,145469],"\n"],[[-1,223889],"\n\\begin{figure}"],[[-1,220966],"\n\\centering"],[[-1,223746],"\n\\begin{tabular}"],[[-1,223651],"{rcll}"],[[-1,223716],"\nCMD & ::= & "],[[-1,223701],"\\"],[[-1,223696],"text"],[[-1,35711],"tt"],[[-1,223692],2],[[-1,223690],"{let} $x$ "],[[-1,35493],"\\texttt{"],[[-1,223680],"="],[[-1,35485],"}"],[[-1,223679]," EXPR & $x \\in \\mathrm{VAR}$"],[[-1,223645]," \\\\\n& "],[[-1,223595],"$"],[[-1,223597],1],[[-1,223599],1],[[-1,223639],"|"],[[-1,223594],"$"],[[-1,223638]," & "],[[-1,222951],"$\\mathrm{"],[[-1,223635],"EXPR"],[[-1,222942],"}"],[[-1,35484],"$"],[[-1,223631]," "],[[-1,35709],"\\texttt{"],[[-1,219882],":"],[[-1,223630],"="],[[-1,35701],"}"],[[-1,223629]," "],[[-1,35483],"$"],[[-1,223628],1],[[-1,223627],"v$ & $v \\in "],[[-1,223612],"\\mathrm{"],[[-1,223615],"VAL"],[[-1,223604],"}$ \\\\"],[[-1,223063],"\n& $|$ & "],[[-1,223019],"$\\mathrm{"],[[-1,223054],"EXPR"],[[-1,223010],"}"],[[-1,35682],"$"],[[-1,223050],1],[[-1,35700],1],[[-1,223049],"\\"],[[-1,35693],"texttt"],[[-1,223005],4],[[-1,223044],6],[[-1,223038],"{"],[[-1,35681],"."],[[-1,223037],"insert"],[[-1,10840],"After"],[[-1,35482],"("],[[-1,223031],5],[[-1,223026],"}"],[[-1,223025],1],[[-1,35687],"$"],[[-1,223001],"v"],[[-1,35686],"$"],[[-1,35480],"\\texttt{"],[[-1,223000],")"],[[-1,35472],"}"],[[-1,222999],1],[[-1,222998]," & $v \\in \\mathrm{VAL}$ \\\\\n& "],[[-1,222967],"$|$ & "],[[-1,222952],"$"],[[-1,222954],1],[[-1,222961],"\\mathrm"],[[-1,222940],"{EXPR}"],[[-1,35679],"$"],[[-1,222934],1],[[-1,222933],"\\"],[[-1,35672],"texttt"],[[-1,222932],6],[[-1,222926],"{"],[[-1,35666],"."],[[-1,222915],"delete}"],[[-1,222905],1],[[-1,222908]," \\\\"],[[-1,222722],65],[[-1,222925],5],[[-1,222969],1],[[-1,223048],2],[[-1,223394],"\n"],[[-1,223389],"& $|$ & \\"],[[-1,223360],"text"],[[-1,35662],"tt"],[[-1,223380],6],[[-1,223374],"{yield} \\\\"],[[-1,223393],2],[[-1,223593],"\n"],[[-1,223590],"& $|$ & CMD"],[[-1,35446],"\\t"],[[-1,35440],"exttt{"],[[-1,35444],2],[[-1,223579],";"],[[-1,35434],"}"],[[-1,223578]," CMD "],[[-1,223573],2],[[-1,223350],"\\vspace{"],[[-1,223070],"0.5"],[[-1,223342],1],[[-1,223334],"em"],[[-1,223341],3],[[-1,223338],"}"],[[-1,223332],"\\\\"],[[-1,223571],"\nEXPR & ::= & \\text"],[[-1,35659],"t"],[[-1,35657],"t"],[[-1,223552],2],[[-1,223550],"{doc} \\\\"],[[-1,222839],"\n& $|$ & $x$ & $x \\in \\mathrm{VAR}"],[[-1,222801],"$ \\\\"],[[-1,222805],2],[[-1,223542],"\n& $|$ "],[[-1,223356],"& "],[[-1,223535],"EXPR"],[[-1,35470],"\\texttt{"],[[-1,28120],".get("],[[-1,166610],1],[[-1,223531],2],[[-1,223513],4],[[-1,223529],12],[[-1,223509],1],[[-1,166588],5],[[-1,157561],1],[[-1,35740],1],[[-1,35719],1],[[-1,35462],"}$"],[[-1,35738],"\\math"],[[-1,34082],"it"],[[-1,35654],2],[[-1,35733],2],[[-1,35731],"{key}"],[[-1,35460],"$"],[[-1,35458],"\\te"],[[-1,35453],"xttt{"],[[-1,28109],")"],[[-1,35455],1],[[-1,35714],1],[[-1,35448],"}"],[[-1,35718],1],[[-1,35739],1],[[-1,166583],1],[[-1,166570],3],[[-1,166582],4],[[-1,157560],1],[[-1,166578],1],[[-1,223508],11],[[-1,166608],1],[[-1,223497],1],[[-1,223496]," & "],[[-1,223489],"$\\math"],[[-1,34078],"it"],[[-1,35650],2],[[-1,166575],2],[[-1,223483],2],[[-1,223481],"{key} \\in \\mathrm"],[[-1,223462],"{"],[[-1,222728],"String"],[[-1,223461],3],[[-1,223458],"}$ \\"],[[-1,222872],"\\"],[[-1,217399],"\n& $|$ & EXPR"],[[-1,217386],1],[[-1,217385],"\\text"],[[-1,35645],"tt"],[[-1,217380],2],[[-1,217378],"{"],[[-1,35643],"."],[[-1,28113],"idx"],[[-1,28185],2],[[-1,28183],"("],[[-1,217377],4],[[-1,217373],"}"],[[-1,28182],"$"],[[-1,27049],"i"],[[-1,28181],1],[[-1,28180],"$\\texttt{)} & $"],[[-1,27047],"i"],[[-1,28165],1],[[-1,28164]," "],[[-1,28157],"\\ge 0$"],[[-1,28163],3],[[-1,217372]," \\\\"],[[-1,223454],1],[[-1,223328],22],[[-1,223268],2],[[-1,223306],10],[[-1,223453],7],[[-1,223354],2],[[-1,223446],10],[[-1,35638],2],[[-1,223436],3],[[-1,35642],1],[[-1,223433],8],[[-1,223296],22],[[-1,223263],10],[[-1,223274],3],[[-1,223425],"\n"],[[-1,166653],"& $|$ & EXPR"],[[-1,166641],1],[[-1,166640],"\\text"],[[-1,35630],"tt"],[[-1,166635],1],[[-1,35635],2],[[-1,166634],1],[[-1,166633],"{"],[[-1,35641],"."],[[-1,166632],"keys} \\\\"],[[-1,166654],"\n"],[[-1,223424],"& $|$ "],[[-1,223352],"& "],[[-1,223418],"EXPR"],[[-1,223414],1],[[-1,223411],"\\text"],[[-1,35626],"tt"],[[-1,223406],2],[[-1,223404],"{"],[[-1,35447],"."],[[-1,223403],"values}"],[[-1,223253]," "],[[-1,222745],"\\vspace{0.5em}"],[[-1,223252],"\\\\\n"],[[-1,223249],43],[[-1,223074],3],[[-1,223206],7],[[-1,223199],"VAR & ::= & $"],[[-1,223186],1],[[-1,223185],"x"],[[-1,223184],15],[[-1,223169],"$"],[[-1,223122]," "],[[-1,35607],"& $"],[[-1,35581],"x \\in \\mathrm{"],[[-1,35560],"Var"],[[-1,35567],"String}"],[[-1,35604],3],[[-1,35601],"$"],[[-1,223089],14],[[-1,223121],"\\\\"],[[-1,223168],"\nVAL & ::= &"],[[-1,222657]," "],[[-1,222608],"$"],[[-1,222656],"n"],[[-1,222607],"$"],[[-1,222655]," &"],[[-1,223156]," "],[[-1,223148],"$"],[[-1,222653],"n \\"],[[-1,222648],"in "],[[-1,222650],1],[[-1,223155],"\\math"],[[-1,196016],"rm"],[[-1,223150],2],[[-1,223147],"{"],[[-1,196013],"Number"],[[-1,223146],1],[[-1,223145],"}"],[[-1,223144],1],[[-1,223067],2],[[-1,223143],4],[[-1,223065],2],[[-1,223139],16],[[-1,223123],"$"],[[-1,222578]," \\\\"],[[-1,222620],"\n& "],[[-1,222615],"$|$ & "],[[-1,35541],"$"],[[-1,222429],"\\"],[[-1,35548],"math"],[[-1,34070],"it"],[[-1,35544],2],[[-1,35542],"{"],[[-1,222428],6],[[-1,222411],"str"],[[-1,222406],1],[[-1,35556],"}"],[[-1,35540],"$"],[[-1,222408],1],[[-1,222422],1],[[-1,222421]," "],[[-1,222606],1],[[-1,222609],1],[[-1,222605],1],[[-1,222420],9],[[-1,222604],1],[[-1,222603],"& $"],[[-1,222392],"\\math"],[[-1,34074],"it"],[[-1,35537],2],[[-1,222387],2],[[-1,222385],"{"],[[-1,222600],"s"],[[-1,222384],"tr}"],[[-1,222599]," \\in \\mathrm{String}$"],[[-1,222575]," \\\\"],[[-1,196007],"\n& $|$ & \\"],[[-1,35530],"texttt{"],[[-1,195997],5],[[-1,195992],"true"],[[-1,35522],"}"],[[-1,195988],1],[[-1,195987]," $|$ \\"],[[-1,35517],"texttt"],[[-1,35510],"{"],[[-1,195981],5],[[-1,195976],"false"],[[-1,35508],"}"],[[-1,195967],1],[[-1,195971]," $|$"],[[-1,195966]," \\"],[[-1,35503],"texttt"],[[-1,35496],"{"],[[-1,195964],5],[[-1,195959],"null"],[[-1,35494],"}"],[[-1,195952],1],[[-1,195955]," \\\\"],[[-1,222572],"\n& $|$ & \\"],[[-1,222471],"verb|{}|"],[[-1,222558],4],[[-1,222489],2],[[-1,222554],13],[[-1,222541]," "],[[-1,222538],"$|$"],[[-1,222535],2],[[-1,222447]," "],[[-1,222438],"\\verb|[]|"],[[-1,222446],4],[[-1,222533],1],[[-1,222506],6],[[-1,222485],2],[[-1,222500],4],[[-1,222493],2],[[-1,222496],3],[[-1,222532],13],[[-1,222540],1],[[-1,222562],2],[[-1,222617],1],[[-1,223396],1],[[-1,223413],1],[[-1,223464],1],[[-1,223493],2],[[-1,223592],1],[[-1,223700],2],[[-1,223703],1],[[-1,223730],"\n\\end{tabular}"],[[-1,223861],"\n\\caption{Syntax of command language for "],[[-1,223804],"querying and modifying a document"],[[-1,105032],"."],[[-1,223771],"}\\label{fig:local-syntax}"],[[-1,223820],8],[[-1,223874],"\n\\end{figure}"],[[-1,221003],"\n\n\\begin{figure}\n\\centering"],[[-1,220865],19],[[-1,220832],26],[[-1,220647],1],[[-1,220806],14],[[-1,220791],4],[[-1,220792],1],[[-1,220787],1],[[-1,220768],15],[[-1,220751],16],[[-1,220648],1],[[-1,220735],3],[[-1,220694],7],[[-1,220685],14],[[-1,220661],8],[[-1,220671],5],[[-1,220687],1],[[-1,220732],22],[[-1,220708],13],[[-1,220652],1],[[-1,220649],1],[[-1,220651],2],[[-1,220646],1],[[-1,220470],13],[[-1,220645],8],[[-1,220453],4],[[-1,220637],5],[[-1,220449],18],[[-1,220427],7],[[-1,220418],13],[[-1,220420],1],[[-1,220431],2],[[-1,220632],23],[[-1,220607],1],[[-1,220598],1],[[-1,220606],4],[[-1,220597],2],[[-1,220594],14],[[-1,220332],4],[[-1,220580],35],[[-1,220541],2],[[-1,220545],2],[[-1,220602],2],[[-1,220609],1],[[-1,220695],1],[[-1,220710],1],[[-1,220753],1],[[-1,220786],1],[[-1,220777],4],[[-1,220785],4],[[-1,220846],14],[[-1,220539],13],[[-1,220526],"\n"],[[-1,220523],"\\begin{verbatim}"],[[-1,220319],"\ndoc "],[[-1,219881],":"],[[-1,220314],"= {};"],[[-1,25630],"\ndoc.get(\"shopping\") := [];"],[[-1,220309],"\n"],[[-1,219923],"let "],[[-1,28104],"head"],[[-1,219919],4],[[-1,219915]," = "],[[-1,220308],"doc"],[[-1,28089],".get("],[[-1,166602],1],[[-1,220305],5],[[-1,220300],"\"shopping\""],[[-1,28083],")"],[[-1,166600],1],[[-1,220288],1],[[-1,218508],"."],[[-1,28096],"idx(0)"],[[-1,217403],4],[[-1,218507],4],[[-1,219879],";"],[[-1,219912],5],[[-1,220287],1],[[-1,219880],1],[[-1,220286],5],[[-1,220281],"\n"],[[-1,28078],"head"],[[-1,220280],4],[[-1,219907],1],[[-1,220276],7],[[-1,219886],4],[[-1,220269],19],[[-1,220250],".insert"],[[-1,10835],"After"],[[-1,220243],"(\"eggs\");\n"],[[-1,196985],"let "],[[-1,10650],"eggs"],[[-1,25599],4],[[-1,196981],4],[[-1,196977]," = "],[[-1,28065],"doc.get(\"shopping\").idx(1)"],[[-1,196974],9],[[-1,196965],";"],[[-1,196986],1],[[-1,25591],4],[[-1,220233],20],[[-1,219632],"\n"],[[-1,28035],"head"],[[-1,219631],4],[[-1,219627],".insert"],[[-1,10830],"After"],[[-1,219620],"(\"cheese\");"],[[-1,220213],"\n"],[[-1,10642],"eggs"],[[-1,25587],4],[[-1,25583],".insert"],[[-1,10825],"After"],[[-1,25576],"(\"milk\");\n"],[[-1,220212],"\n// Final state:"],[[-1,220290],1],[[-1,220492],"\n{\"shopping\": ["],[[-1,219609],"\"cheese\", "],[[-1,220477],"\"eggs\","],[[-1,220328]," \"milk\"]}"],[[-1,206075],78],[[-1,205995],2],[[-1,205997],1],[[-1,220507],"\n\\end{verbatim}"],[[-1,220525],1],[[-1,220976],"\n\\caption{"],[[-1,220955],"Example of programmatically constructing a JSON document"],[[-1,105031],"."],[[-1,220899],"}\\label{fig:make-doc}\n\\end{figure}"],[[-1,222381],"\n\n"],[[-1,222379],12],[[-1,157529],20],[[-1,222367],16],[[-1,163729],13],[[-1,222351],1],[[-1,157509],2],[[-1,157507],"To define the semantics for collaboratively editable data structures, we first define a simple command language that is executed locally at any of the "],[[-1,105637],"replicas"],[[-1,157356],5],[[-1,157351],", and which allows th"],[[-1,157286],"at "],[[-1,105625],"replica"],[[-1,157283],4],[[-1,157279],"'s local copy of the document to be queried and mo"],[[-1,157227],"dified. Performing read-only queries has no side-effects, but modifying the document has the effect of producing \\emph{operations} describing the mutation. Those operations are "],[[-1,31941],"immediately "],[[-1,157050],"applied to the local copy of the document, and also enqueued for"],[[-1,31956]," asynchronous"],[[-1,156986]," broadcasting to other "],[[-1,105613],"replicas"],[[-1,156963],5],[[-1,156958],"."],[[-1,157229],1],[[-1,157330],22],[[-1,222350],"\n"],[[-1,31943],1],[[-1,222349],"\nT"],[[-1,222345],"he syntax of the command language is given in Figure~\\ref{fig:local-syntax}."],[[-1,204674]," It is not a full p"],[[-1,204647],"rogramming language, but rather an API through which the document state is queried and modified."],[[-1,164542],1],[[-1,204551]," We assume that the "],[[-1,204531],5],[[-1,204526],"program"],[[-1,204458]," accepts user input and"],[[-1,204519]," issues "],[[-1,204509],"a (possibly infinite) sequence of commands"],[[-1,204435]," to the API. We model only the semantics of those commands, and "],[[-1,204359],"do not "],[[-1,204371],"assume "],[[-1,204348],"anything about the program in which the command language is embedded."],[[-1,164540]," The "],[[-1,164495],"API differs slightly from the JSON libr"],[[-1,164456],1],[[-1,164455],"aries "],[[-1,164448],"found in many programming languages, in order to allow us to define consistent merge semantics."],[[-1,164535],20],[[-1,204364],5],[[-1,204467],2],[[-1,204511],1],[[-1,204655],1],[[-1,204650],1],[[-1,204654],2],[[-1,222269],79],[[-1,222090],16],[[-1,222190],22],[[-1,222160],41],[[-1,222074],12],[[-1,222056],45],[[-1,222002],3],[[-1,222011],9],[[-1,221999],37],[[-1,221950],89],[[-1,221861],"\n\n"],[[-1,221082],"We first explain the language informally, before giving its formal semantics."],[[-1,221083]," "],[[-1,221859],"The"],[[-1,221856],29],[[-1,221817],21],[[-1,221678]," "],[[-1,221796],4],[[-1,221792],"expression"],[[-1,221615]," construct"],[[-1,221677],1],[[-1,221782]," EXPR"],[[-1,221598]," is used to"],[[-1,221777],12],[[-1,221673],1],[[-1,221765],27],[[-1,164353],8],[[-1,164345]," construct a \\emph{cursor} which identifies a position in the document"],[[-1,221587],". An expression starts with either the special token \\text"],[[-1,35431],"tt"],[[-1,221529],2],[[-1,221527],"{doc}, identifying the root of the JSON document tree, or a variable $x$ that was previously defined in a "],[[-1,221419],"\\text"],[[-1,35427],"tt"],[[-1,221414],2],[[-1,221412],"{let} "],[[-1,221394],"command. "],[[-1,35214],"The expression defines"],[[-1,35168],", lef"],[[-1,35161],"t to righ"],[[-1,35151],"t"],[[-1,35152],","],[[-1,35163],1],[[-1,35192]," the path"],[[-1,164226],32],[[-1,221385],14],[[-1,164194],1],[[-1,164193]," "],[[-1,164191],"the cursor "],[[-1,35181],"takes"],[[-1,35150],20],[[-1,35176]," as it"],[[-1,164180],2],[[-1,164178]," navigate"],[[-1,35169],"s"],[[-1,164169],1],[[-1,164168]," through the tree"],[[-1,35110]," "],[[-1,35097],"t"],[[-1,35094],"owards "],[[-1,35079],"the leaves"],[[-1,35087],4],[[-1,35096],1],[[-1,35109],6],[[-1,221371],35],[[-1,221318],12],[[-1,221306],": "],[[-1,164151],"the "],[[-1,164147],10],[[-1,164137],"operator \\"],[[-1,35420],"texttt{"],[[-1,12005],".get("],[[-1,164127],6],[[-1,35413],"}$"],[[-1,35407],"\\math"],[[-1,34066],"it"],[[-1,35402],2],[[-1,35400],"{"],[[-1,35409],1],[[-1,35411],1],[[-1,164121],1],[[-1,164120],"key"],[[-1,35397],"}"],[[-1,35386],"$"],[[-1,35396],"\\texttt{"],[[-1,11999],")"],[[-1,164117],2],[[-1,35388],"}"],[[-1,164115],1],[[-1,221304],26],[[-1,221276],2],[[-1,221274]," selects a key within a map"],[[-1,221247],16],[[-1,221231],","],[[-1,11998]," and"],[[-1,11994],1],[[-1,221230]," "],[[-1,217369],"\\text"],[[-1,35383],"tt"],[[-1,217364],2],[[-1,217362],"{"],[[-1,11988],".idx("],[[-1,217361],4],[[-1,217357],"}"],[[-1,11983],"$"],[[-1,11962],"n$\\texttt{)} s"],[[-1,11946],"e"],[[-1,11943],"lects the $n$th"],[[-1,11945],1],[[-1,11948],1],[[-1,11982],10],[[-1,217356]," "],[[-1,217355],23],[[-1,202269],1],[[-1,217332],14],[[-1,164085],4],[[-1,217318],2],[[-1,221227],5],[[-1,35379],2],[[-1,221222],27],[[-1,221195],"element of an ordered list"],[[-1,164080],"."],[[-1,11854]," Lists are indexed starting from 1, and \\texttt{.idx(0)} is a special cursor indicating the head of a list"],[[-1,10795]," (a virtual position before the first list element)"],[[-1,11748],"."],[[-1,164079],"\n\nThe expression construct EXPR can also query the state of the document:"],[[-1,221169],1],[[-1,166567]," \\text"],[[-1,35375],"tt"],[[-1,166561],2],[[-1,166559],"{keys} returns the set of keys in "],[[-1,164005],"the"],[[-1,166525],1],[[-1,166524]," map"],[[-1,164002]," at the current cursor"],[[-1,166520],","],[[-1,221168]," and \\text"],[[-1,35371],"tt"],[[-1,221158],2],[[-1,221156],"{values} "],[[-1,221132],"returns the "],[[-1,34057],"contents"],[[-1,221120],5],[[-1,34064],1],[[-1,221115]," "],[[-1,202268],"of the"],[[-1,34049]," multi-value"],[[-1,202262]," register "],[[-1,202252],11],[[-1,221114],"at the current"],[[-1,163980]," cursor"],[[-1,221229],1],[[-1,221278],1],[[-1,221336],9],[[-1,221406],6],[[-1,221421],1],[[-1,221738],11],[[-1,221668],2],[[-1,221727],23],[[-1,221099],3],[[-1,221704],10],[[-1,221084],"."],[[-1,202241]," (\\"],[[-1,202181],"text"],[[-1,35367],"tt"],[[-1,202238],6],[[-1,202232],"{values} is not defined "],[[-1,163941],"if the cursor refers to a"],[[-1,163916],1],[[-1,202208],3],[[-1,202205]," map or list"],[[-1,202193],6],[[-1,202187],".)"],[[-1,221005],"\n\n"],[[-1,219878],"A command CMD either sets the value of a local variable (\\"],[[-1,219818],"text"],[[-1,35363],"tt"],[[-1,219814],2],[[-1,219812],"{let}), performs network communication (\\text"],[[-1,35359],"tt"],[[-1,219767],2],[[-1,219765],"{yield}), or modifies the docume"],[[-1,219707],"nt. A document can be modified by "],[[-1,11477],"writing to"],[[-1,219673],22],[[-1,219651]," "],[[-1,202141],"a register"],[[-1,219650],4],[[-1,219552],1],[[-1,219539],5],[[-1,219551],6],[[-1,219646],6],[[-1,219640]," ("],[[-1,219638],6],[[-1,219599],"the "],[[-1,219595],11],[[-1,219584],"operator "],[[-1,35357],"\\texttt{"],[[-1,219575],":="],[[-1,35349],"}"],[[-1,11555]," "],[[-1,11463],"assigns"],[[-1,11554],4],[[-1,11550]," the value of the register identified by the cursor"],[[-1,219573],"), by inserting"],[[-1,219534]," an element into a list (\\text"],[[-1,35346],"tt"],[[-1,219504],2],[[-1,219502],"{i"],[[-1,219500],1],[[-1,219499],"n"],[[-1,219492],"s"],[[-1,219498],"ert"],[[-1,10820],"After"],[[-1,219495],"}"],[[-1,11747]," places a new element "],[[-1,11456],6],[[-1,11725],"after"],[[-1,11450],1],[[-1,11720]," "],[[-1,10742],"the"],[[-1,11417],2],[[-1,11719],3],[[-1,11716]," "],[[-1,11441],"existing list element"],[[-1,11715],8],[[-1,11707]," identified by the cursor, and \\texttt{.idx(0).insert"],[[-1,10808],"After"],[[-1,11654],"} inserts at the head of a list"],[[-1,219494],")"],[[-1,219491],", "],[[-1,196067],"or "],[[-1,219489],"by deleting an element from a list or a map (\\text"],[[-1,35342],"tt"],[[-1,219437],2],[[-1,219435],"{delete}"],[[-1,11623]," removes the "],[[-1,11604],"element identified by the cursor"],[[-1,11610],3],[[-1,219427],")"],[[-1,219426],46],[[-1,219380],"."],[[-1,219353],4],[[-1,163870],54],[[-1,219267],26],[[-1,218825],1],[[-1,163753],11],[[-1,218824],16],[[-1,163741],5],[[-1,218808],1],[[-1,219241],8],[[-1,163732],3],[[-1,218804],4],[[-1,219233],44],[[-1,219349],41],[[-1,219359],"\n\n"],[[-1,219185],"Figure~\\ref{fig:make-doc} shows an example"],[[-1,219143],5],[[-1,219138]," sequence of commands"],[[-1,196959]," that"],[[-1,219117]," construct"],[[-1,196951],"s"],[[-1,219107],3],[[-1,219104]," a new document representing"],[[-1,219072]," a shopping list. First \\text"],[[-1,35338],"tt"],[[-1,219043],2],[[-1,219041],"{doc} is "],[[-1,219026],"set to \\"],[[-1,35317],"verb|"],[[-1,35331],7],[[-1,219018],5],[[-1,219013],"{}|, the empty map literal"],[[-1,11309],", and then the key "],[[-1,11284],"\\"],[[-1,11256],"verb|"],[[-1,11283],7],[[-1,11276],"\"shopping\""],[[-1,11264],"|"],[[-1,11251]," within that map is set to the empty list \\verb|[]|"],[[-1,11266],1],[[-1,11290],3],[[-1,218987],". "],[[-1,218475],"The "],[[-1,11194],"third"],[[-1,218471],6],[[-1,218465]," line navigates to"],[[-1,218985],16],[[-1,218969]," the key "],[[-1,218956],"\\"],[[-1,11182],"verb|"],[[-1,25644],7],[[-1,35307],7],[[-1,218955],5],[[-1,218950],"\"shopping\""],[[-1,11176],"|"],[[-1,35299],1],[[-1,218940],1],[[-1,218939]," "],[[-1,218447],56],[[-1,35048],8],[[-1,35064],8],[[-1,218391],11],[[-1,35296],2],[[-1,218380],3],[[-1,217312],4],[[-1,218377],13],[[-1,218338],39],[[-1,218299],"and selects the head of the list"],[[-1,11020],", placing the cursor in a variable called \\texttt{head}"],[[-1,218267],1],[[-1,202131],1],[[-1,35038],5],[[-1,202130],77],[[-1,202053],"."],[[-1,10963]," The list element ``eggs'' is inserted at the head of the list. In line 5, "],[[-1,10739],"the variable \\texttt{"],[[-1,10634],"eggs"],[[-1,10718],4],[[-1,10714],"} is set to a cursor pointing at the list element ``eggs''. "],[[-1,10630],"Then two more list elements are inserted: ``cheese'' "],[[-1,10561],"at the head, and ``milk'' after ``eggs''."],[[-1,10278],"\n\n"],[[-1,10520],1],[[-1,10519],"Note that the cursor "],[[-1,10486],"\\texttt{eggs} identifies the list element by identity, not by its index: after the insertion of ``cheese'', the element ``eggs'' "],[[-1,9537],"moves from index 1 to"],[[-1,10357],3],[[-1,10354]," "],[[-1,10353],6],[[-1,10347],"2, but "],[[-1,10332],"``milk'' is nevertheless "],[[-1,10303],"inserted after ``eggs''."],[[-1,10276]," "],[[-1,10265],"As we shall see later, this feature is helpful for achieving desirable semantics in the presence of concurrent modifications."],[[-1,10275],5],[[-1,10307],2],[[-1,10340],4],[[-1,10498],6],[[-1,10577],8],[[-1,10965],"\n"],[[-1,10964],1],[[-1,218222],9],[[-1,218364],13],[[-1,218938],94],[[-1,35292],2],[[-1,218844],19],[[-1,218800],6],[[-1,218790],10],[[-1,218778],48],[[-1,196950],2],[[-1,218730],1],[[-1,196946],72],[[-1,35285],7],[[-1,196874],4],[[-1,196868],5],[[-1,35277],1],[[-1,196863],44],[[-1,196488],6],[[-1,196819],33],[[-1,35269],7],[[-1,196786],9],[[-1,35275],1],[[-1,196777],70],[[-1,196870],1],[[-1,218729],43],[[-1,218684],20],[[-1,218596],88],[[-1,218664],7],[[-1,218655],41],[[-1,218610],14],[[-1,218125],156],[[-1,217967],28],[[-1,217935],39],[[-1,201993],1],[[-1,217896],1],[[-1,202000],3],[[-1,217895],24],[[-1,201992],39],[[-1,195938],3],[[-1,201953],16],[[-1,195935],11],[[-1,201937],11],[[-1,217871],17],[[-1,217852],32],[[-1,35260],2],[[-1,217820],61],[[-1,217475],9],[[-1,217759],7],[[-1,217676],1],[[-1,217752],14],[[-1,217674],76],[[-1,217568],15],[[-1,217549],74],[[-1,217466],16],[[-1,163698],1],[[-1,157578],16],[[-1,163697],5],[[-1,163700],1],[[-1,217450],1],[[-1,206076],1],[[-1,217449],25],[[-1,206110],21],[[-1,217424],17],[[-1,110017],21],[[-1,217553],2],[[-1,217598],15],[[-1,217738],18],[[-1,217718],12],[[-1,217720],1],[[-1,217854],1],[[-1,217939],2],[[-1,217969],1],[[-1,218614],2],[[-1,218657],1],[[-1,218686],1],[[-1,218780],1],[[-1,218794],2],[[-1,218960],2],[[-1,219032],3],[[-1,219076],2],[[-1,219357],4],[[-1,219379],10],[[-1,219439],1],[[-1,219733],4],[[-1,219727],8],[[-1,219729],1],[[-1,219820],1],[[-1,221694],12],[[-1,221819],1],[[-1,221827],4],[[-1,221962],6],[[-1,222062],3],[[-1,222119],13],[[-1,222168],4],[[-1,222347],1],[[-1,223945],1],[[-1,224107],3],[[-1,224166],8],[[-1,224311],8],[[-1,224390],2],[[-1,254908],1],[[-1,205050],67],[[-1,204936],2],[[-1,204983],7],[[-1,214086],15],[[-1,214057],11],[[-1,213408],2],[[-1,213400],16],[[-1,213406],1],[[-1,213905],3],[[-1,213470],18],[[-1,205380],1],[[-1,213452],2],[[-1,213907],1],[[-1,214046],8],[[-1,213895],5],[[-1,214038],12],[[-1,213908],1],[[-1,204894],1],[[-1,204924],1],[[-1,204870],1],[[-1,204792],12],[[-1,204751],1],[[-1,204780],3],[[-1,204867],8],[[-1,204750],2],[[-1,204777],1],[[-1,204859],4],[[-1,204827],2],[[-1,204869],1],[[-1,204923],1],[[-1,204916],12],[[-1,204871],1],[[-1,204904],3],[[-1,205385],2],[[-1,213354],1],[[-1,213875],3],[[-1,213405],2],[[-1,213872],2],[[-1,213212],3],[[-1,213220],1],[[-1,213056],1],[[-1,213219],1],[[-1,204920],1],[[-1,213870],1],[[-1,213417],2],[[-1,213822],1],[[-1,213869],3],[[-1,213225],2],[[-1,213866],11],[[-1,213851],5],[[-1,213216],1],[[-1,213310],2],[[-1,213846],12],[[-1,213208],5],[[-1,213308],5],[[-1,213834],2],[[-1,213059],1],[[-1,204817],15],[[-1,204800],2],[[-1,204802],1],[[-1,213058],1],[[-1,213832],1],[[-1,213246],3],[[-1,213450],1],[[-1,213363],1],[[-1,213449],1],[[-1,213831],7],[[-1,204797],1],[[-1,204825],1],[[-1,204822],2],[[-1,204824],1],[[-1,204854],1],[[-1,213824],1],[[-1,213821],1],[[-1,213823],1],[[-1,213751],2],[[-1,204748],4],[[-1,204890],1],[[-1,204880],5],[[-1,204889],3],[[-1,213294],1],[[-1,205379],1],[[-1,213198],1],[[-1,213801],1],[[-1,213315],2],[[-1,213316],1],[[-1,213800],14],[[-1,213213],1],[[-1,213786],1],[[-1,205377],2],[[-1,213785],1],[[-1,213267],4],[[-1,213287],9],[[-1,213784],4],[[-1,213778],10],[[-1,213276],3],[[-1,213768],14],[[-1,204895],1],[[-1,204875],2],[[-1,204896],1],[[-1,213752],1],[[-1,213754],2],[[-1,213780],1],[[-1,213855],2],[[-1,214026],1],[[-1,205375],2],[[-1,213358],1],[[-1,213362],1],[[-1,213415],1],[[-1,213448],2],[[-1,213720],14],[[-1,213681],15],[[-1,213260],2],[[-1,213666],8],[[-1,213706],11],[[-1,213693],1],[[-1,213647],1],[[-1,213263],1],[[-1,213646],3],[[-1,213196],1],[[-1,205373],2],[[-1,213195],41],[[-1,213067],4],[[-1,213154],22],[[-1,213128],21],[[-1,205904],8],[[-1,213107],1],[[-1,213047],2],[[-1,213106],39],[[-1,212765],1],[[-1,213063],3],[[-1,213132],2],[[-1,213643],1],[[-1,205371],2],[[-1,213357],1],[[-1,213361],1],[[-1,213414],1],[[-1,213446],2],[[-1,213642],26],[[-1,213612],3],[[-1,213258],2],[[-1,213609],21],[[-1,213262],1],[[-1,163634],2],[[-1,163692],28],[[-1,163635],1],[[-1,163664],28],[[-1,213588],3],[[-1,213045],1],[[-1,205369],2],[[-1,213044],41],[[-1,213001],47],[[-1,205832],8],[[-1,212954],41],[[-1,212766],1],[[-1,212913],3],[[-1,213003],1],[[-1,213585],1],[[-1,205367],2],[[-1,213356],1],[[-1,213360],1],[[-1,213413],1],[[-1,213444],2],[[-1,213584],14],[[-1,213568],10],[[-1,213554],1],[[-1,213558],2],[[-1,213553],2],[[-1,213256],2],[[-1,213551],10],[[-1,213537],11],[[-1,213261],1],[[-1,163632],27],[[-1,163603],31],[[-1,163605],1],[[-1,213526],3],[[-1,212910],1],[[-1,205365],2],[[-1,212909],27],[[-1,212880],14],[[-1,212862],36],[[-1,212822],11],[[-1,205778],8],[[-1,212811],36],[[-1,212774],4],[[-1,212767],1],[[-1,212770],3],[[-1,212826],2],[[-1,212866],2],[[-1,212882],1],[[-1,213523],1],[[-1,205363],2],[[-1,213355],1],[[-1,213359],1],[[-1,213412],1],[[-1,213442],2],[[-1,213522],29],[[-1,213254],2],[[-1,213493],21],[[-1,163572],58],[[-1,213243],4],[[-1,204917],1],[[-1,205361],3],[[-1,163409],15],[[-1,213053],3],[[-1,213239],5],[[-1,213232],3],[[-1,163514],1],[[-1,213229],2],[[-1,163394],4],[[-1,163513],15],[[-1,163488],57],[[-1,163429],17],[[-1,163389],2],[[-1,163410],1],[[-1,163412],2],[[-1,163431],1],[[-1,163498],5],[[-1,213227],2],[[-1,205387],1],[[-1,163390],1],[[-1,205696],4],[[-1,205676],2],[[-1,204922],1],[[-1,205674],1],[[-1,205692],14],[[-1,205673],2],[[-1,205125],6],[[-1,205059],5],[[-1,205085],4],[[-1,205119],8],[[-1,205077],6],[[-1,205053],3],[[-1,205071],1],[[-1,205111],1],[[-1,205098],2],[[-1,205092],1],[[-1,205096],2],[[-1,205104],3],[[-1,205110],3],[[-1,205204],1],[[-1,205164],12],[[-1,205203],18],[[-1,205358],6],[[-1,205267],8],[[-1,205352],13],[[-1,205671],8],[[-1,205230],13],[[-1,205663],52],[[-1,205185],1],[[-1,205565],4],[[-1,205611],46],[[-1,205561],16],[[-1,205070],1],[[-1,205091],1],[[-1,205184],1],[[-1,205339],1],[[-1,205545],4],[[-1,204921],1],[[-1,205541],19],[[-1,205322],6],[[-1,205288],8],[[-1,204961],15],[[-1,204940],2],[[-1,204946],2],[[-1,205316],13],[[-1,205522],25],[[-1,205338],8],[[-1,205497],35],[[-1,204944],1],[[-1,205462],65],[[-1,204943],1],[[-1,205303],1],[[-1,205397],4],[[-1,204926],2],[[-1,205383],2],[[-1,205393],2],[[-1,205152],14],[[-1,205678],1],[[-1,213234],1],[[-1,213424],1],[[-1,213440],14],[[-1,213364],1],[[-1,213379],15],[[-1,213426],1],[[-1,213411],3],[[-1,213541],2],[[-1,213556],1],[[-1,213570],1],[[-1,213616],2],[[-1,213692],11],[[-1,213695],1],[[-1,214025],5],[[-1,213883],5],[[-1,214020],8],[[-1,213878],3],[[-1,214012],18],[[-1,205993],5],[[-1,213994],1],[[-1,205725],15],[[-1,105601],2],[[-1,105597],5],[[-1,105599],1],[[-1,205710],14],[[-1,213993],30],[[-1,213818],8],[[-1,205975],10],[[-1,213810],1],[[-1,213805],4],[[-1,205965],33],[[-1,213809],2],[[-1,213963],55],[[-1,214071],13],[[-1,214058],"\n"],[[-1,217308],"\n"],[[-1,217306],"\\begin{figure*}"],[[-1,217277],"\n\\"],[[-1,215389],"begin{center}"],[[-1,217275],9],[[-1,217178],"\n\\AxiomC{$\\"],[[-1,217165],"mathit{cmd}_1 \\mathbin{:} \\mathrm{CMD}$}"],[[-1,216989],"\n\\"],[[-1,216985],"AxiomC{$A_p,\\, \\mathit{cmd}_1 \\evalto A_p'$}"],[[-1,216987],1],[[-1,217015],"\n\\LeftLabel{\\textsc{Exec}}"],[[-1,217125],"\n\\"],[[-1,217025],"BinaryInfC"],[[-1,217123],6],[[-1,217117],"{$A_p,\\, "],[[-1,217092],"\\langle"],[[-1,217065]," "],[[-1,217094],1],[[-1,217108],"\\mathit{cmd}_1"],[[-1,217085]," \\mathbin{;} \\mathit"],[[-1,217064],"{cmd}_2 \\mathbin{;} \\dots \\rangle"],[[-1,216941],"\n    \\evalto A_p',"],[[-1,216921],"\\, \\langle \\mathit{cmd}_2 \\mathbin{;} \\dots \\rangle$}\n\\DisplayProof\\h"],[[-1,216298],"space{"],[[-1,216253],"4"],[[-1,216292],1],[[-1,216291],"em}"],[[-1,216852],4],[[-1,216848],"\n%\n\\AxiomC{}\n\\LeftLabel{\\textsc{Doc}}\n\\UnaryInfC{$A_p,\\, \\mathsf{doc} \\evalto \\mathsf{cursor}(\\langle\\rangle,"],[[-1,216256],"\\,"],[[-1,216739]," \\mathsf{doc})$}\n"],[[-1,216718],"\\DisplayProof\\proofSkipAmount"],[[-1,215376],"\n\\end{center}"],[[-1,216689],"\n"],[[-1,215363],"\n\\begin{center}"],[[-1,216688],"\n"],[[-1,216274],16],[[-1,216687],"\\AxiomC{$"],[[-1,216676],"A_p,\\, \\mathit{expr} \\evalto \\mathit{cur}$}\n\\LeftLabel{\\textsc{Let}}\n\\UnaryInfC{$A_p,\\, \\mathsf{let}"],[[-1,216258],"\\;"],[[-1,216576]," x = \\mathit{expr} \\evalto A_p[\\,x "],[[-1,216533],"\\,"],[[-1,216541],"\\mapsto"],[[-1,216530],"\\, \\mathit{cur}\\,]$}\n\\DisplayProof\\h"],[[-1,216284],"space{"],[[-1,216251],"3"],[[-1,216278],1],[[-1,216277],"em}"],[[-1,216494],4],[[-1,216490],"\n%\n\\AxiomC{$x \\in \\mathrm{dom}(A_p)$}\n\\"],[[-1,216433],"LeftLabel{"],[[-1,216417],"\\textsc{Var}}\n\\UnaryInfC{$A_p,\\, x \\evalto A_p(x)$}\n\\D"],[[-1,216341],"isplayProof\\"],[[-1,216327],"proofSkipA"],[[-1,216307],"mount"],[[-1,215348],"\n\\end{center}"],[[-1,216250],"\n"],[[-1,215519],"\n\\begin{prooftree}"],[[-1,216249],"\n"],[[-1,216164],"\\AxiomC{"],[[-1,216088],"$A_p,\\, \\mathit{expr} \\evalto \\math"],[[-1,216047],"sf{cursor}(\\langle k_1, \\dots, "],[[-1,216014],"k_{n-1} \\rangle,"],[[-1,215996],"\\, k_n)$}"],[[-1,49691],"\n\\AxiomC{$k_n \\not= \\mathsf{head}$}"],[[-1,215987],"\n\\LeftLabel{\\textsc{Get}}"],[[-1,215998],1],[[-1,216016],1],[[-1,216053],3],[[-1,216100],"\n\\"],[[-1,49693],"Bi"],[[-1,216098],1],[[-1,216097],"naryInfC{"],[[-1,216156],"$A_p,\\, \\mathit{expr}.\\"],[[-1,27135],"math"],[[-1,163239],4],[[-1,27599],"sf"],[[-1,216133],4],[[-1,163269],2],[[-1,216129],2],[[-1,216127],"{"],[[-1,27596],"get"],[[-1,163264],1],[[-1,216126],3],[[-1,216123],"}"],[[-1,27593],"("],[[-1,216122],1],[[-1,216121],"\\mathit{key}"],[[-1,27592],")"],[[-1,163261],1],[[-1,163247],4],[[-1,163260],9],[[-1,216109],1],[[-1,216108]," \\evalto"],[[-1,215962],"\n    \\mathsf{cursor}(\\langle k_1, \\dots, k_{n-1}, \\mathsf{mapT}(k_n) \\rangle,"],[[-1,215570],"\\,"],[[-1,215885]," \\mathit{key})$}\n\\"],[[-1,215475],"end{prooftree}\n\n\\begin{"],[[-1,215450],"prooftree}"],[[-1,215452],1],[[-1,215867],20],[[-1,215520],1],[[-1,215847],6],[[-1,215841],"\n\\AxiomC{$A_p,\\, \\mathit{expr} \\evalto \\mathsf{cursor}"],[[-1,215785],"(\\langle k_1, \\dots, "],[[-1,215762],"k_{n-1} \\rangle,\\, k_n)$"],[[-1,215734],"}"],[[-1,27966],"\n\\AxiomC{$A_p,\\, \\mathsf{cursor}(\\langle k_1, \\dots, k_{n-1}, \\mathsf{listT}(k_n) \\rangle,\\,"],[[-1,27813],"\n   "],[[-1,27874]," \\mathsf{head})"],[[-1,27827],".\\mathsf{idx"],[[-1,27602],"}"],[[-1,27815],"("],[[-1,27051],"i"],[[-1,27814],1],[[-1,27805],9],[[-1,27794],")"],[[-1,27793],1],[[-1,27796],1],[[-1,27845],4],[[-1,27841]," "],[[-1,27855],1],[[-1,27854],"\\evalto "],[[-1,27840],"\\mathit{cur}'"],[[-1,27857],"$}"],[[-1,27859],1],[[-1,215733],"\n\\LeftLabel{"],[[-1,28026],"$"],[[-1,215721],"\\textsc{I"],[[-1,28028],"dx"],[[-1,215712],3],[[-1,215709],"}"],[[-1,28025],"_1$"],[[-1,215708],"}\n\\"],[[-1,27968],"Bi"],[[-1,215705],1],[[-1,215704],"naryInfC{$A_p,\\, \\mathit{expr}.\\mathsf{i"],[[-1,27983],"dx"],[[-1,27981],1],[[-1,215664],3],[[-1,215661],"}"],[[-1,27626],"("],[[-1,27053],"i"],[[-1,27980],1],[[-1,27625],")"],[[-1,27613]," "],[[-1,27979],10],[[-1,215660],1],[[-1,215659],"\\evalto"],[[-1,27792]," \\mathit{cur}'$}"],[[-1,215650],80],[[-1,215568],17],[[-1,215551],"\n\\"],[[-1,215412],"end{prooftree}"],[[-1,27046],"\n\n\\begin{prooftree}"],[[-1,27011],"\n\\AxiomC{$k_1 \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\AxiomC{$\\mathit{ctx}(k_1),\\, \\mathsf{cursor}(\\langle k_2, \\dots, k_{n-1} \\rangle,\\, k_n).\\mathsf{idx}(i)\n    \\evalto \\mathsf{cursor}(\\langle k_2, \\dots, k_{n-1} \\rangle,\\, k_n')$}\n\\LeftLabel{$\\textsc{Idx}_2$"],[[-1,26754],"}\n\\BinaryInfC{$\\mathit{ctx},\\, \\"],[[-1,26718],"mathsf{cursor}(\\langle k"],[[-1,26692],"_1, k_2, \\dots, k_"],[[-1,26668],"{n-1} \\rangle,\\, k_n)"],[[-1,26645],".\\mathsf{idx}(i)\n    \\evalto \\mathsf{cursor}"],[[-1,26599],"(\\langle k_1, k_2, \\dots, k_{n-1} \\rangle,\\, k_n')$}"],[[-1,26601],1],[[-1,26647],1],[[-1,26674],3],[[-1,26694],1],[[-1,26722],2],[[-1,26756],1],[[-1,27027],"\n\\end{prooftree}"],[[-1,215335],9],[[-1,166513],9],[[-1,214228],6],[[-1,215326],10],[[-1,215288],10],[[-1,27055],1],[[-1,27425],3],[[-1,215278],124],[[-1,215150],2],[[-1,215146],5],[[-1,28016],3],[[-1,215141],6],[[-1,28021],1],[[-1,215135],4],[[-1,215129],1],[[-1,27140],1],[[-1,215128],5],[[-1,215119],7],[[-1,27657],1],[[-1,27652],11],[[-1,27656],2],[[-1,215112],12],[[-1,27639],2],[[-1,215100],3],[[-1,27633],6],[[-1,215097],5],[[-1,27581],21],[[-1,215092],9],[[-1,27675],3],[[-1,27556],3],[[-1,27672],1],[[-1,215083],1],[[-1,215076],4],[[-1,27538],1],[[-1,27057],1],[[-1,27534],1],[[-1,27537],2],[[-1,27559],1],[[-1,27557],1],[[-1,27671],11],[[-1,215072],8],[[-1,27421],5],[[-1,215064],6],[[-1,27414],2],[[-1,215058],6],[[-1,27412],3],[[-1,215052],1],[[-1,27408],21],[[-1,215051],3],[[-1,214172],2],[[-1,166486],14],[[-1,214170],13],[[-1,214149],1],[[-1,214126],4],[[-1,214148],6],[[-1,214137],1],[[-1,214142],4],[[-1,214157],4],[[-1,215082],3],[[-1,215123],2],[[-1,215131],1],[[-1,215148],1],[[-1,215154],2],[[-1,215316],1],[[-1,214222],1],[[-1,215315],5],[[-1,215298],10],[[-1,215048],"\n"],[[-1,166471],"\n\\begin{prooftree}"],[[-1,27387],10],[[-1,27361],5],[[-1,27377],8],[[-1,214221],1],[[-1,215047],1],[[-1,214220],1],[[-1,215046],17],[[-1,215011],1],[[-1,215004],1],[[-1,215010],6],[[-1,215003],51],[[-1,214952],"\n\\AxiomC{$"],[[-1,27059],"i"],[[-1,27345],1],[[-1,27344],">0 "],[[-1,27339],"\\,"],[[-1,27335],"\\wedge\\, "],[[-1,27337],1],[[-1,27341],1],[[-1,214942],"\\mathit{ctx}(\\mathsf{next}(k)) = k'"],[[-1,166423]," \\,\\wedge\\, k' \\not= \\mathsf{tail}"],[[-1,214907],"$}"],[[-1,166389],"\n\\Ax"],[[-1,166383],"iomC{$\\mathit{ctx}(\\mathsf{pres}(k"],[[-1,165844],"'"],[[-1,166349],")) \\not= \\{\\}$}"],[[-1,27346],"\n"],[[-1,27311],"\\Ax"],[[-1,27303],"iomC{$\\mathit{ctx},\\, \\mathsf{cursor}"],[[-1,27250],"(\\langle\\rangle,\\, k').\\mathsf{idx}("],[[-1,27063],"i"],[[-1,27214],1],[[-1,27213],"-1) \\evalto \\mathit{ctx}'$}"],[[-1,166385],1],[[-1,214905],"\n\\LeftLabel{$\\textsc{"],[[-1,28009],"Idx"],[[-1,214884],4],[[-1,214880],"}_"],[[-1,28005],"3"],[[-1,214878],1],[[-1,214877],"$}\n\\"],[[-1,27305],"Tr"],[[-1,27307],1],[[-1,166255],1],[[-1,166333],2],[[-1,214873],1],[[-1,214872],"inaryInfC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle\\rangle,\\, k).\\mathsf{"],[[-1,27352],"idx"],[[-1,214800],4],[[-1,214796],"}"],[[-1,27349],"("],[[-1,27065],"i"],[[-1,27348],1],[[-1,27347],")"],[[-1,214795]," \\evalto"],[[-1,27266]," \\mathit{ctx}'$}"],[[-1,214785],44],[[-1,214202],30],[[-1,214787],1],[[-1,215029],"\n\\end"],[[-1,215022],"{"],[[-1,166325],"prooftree"],[[-1,214209],6],[[-1,214203],"}"],[[-1,166254],"\n\n\\begin{prooftree"],[[-1,166234],"}"],[[-1,166217],"\n\\AxiomC{$"],[[-1,27061],"i"],[[-1,27131],1],[[-1,27130],">0 \\,\\wedge\\, "],[[-1,166207],"\\mathit{ctx}(\\mathsf{next}(k)) = k' \\,\\wedge\\, k' \\not= \\mathsf{tail}$}\n\\AxiomC{$\\mathit{ctx}(\\mathsf{pres}(k"],[[-1,165845],"'"],[[-1,166098],")) = \\{\\}$}"],[[-1,166054],"\n\\AxiomC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle\\rangle,\\, k').\\mathsf{"],[[-1,27112],"idx"],[[-1,165982],4],[[-1,165978],"}"],[[-1,27109],"("],[[-1,27067],"i"],[[-1,27108],1],[[-1,27105],")"],[[-1,27107],1],[[-1,165977]," \\evalto \\mathit{cur}'$}"],[[-1,166087],"\n\\LeftLabel{$\\textsc{"],[[-1,27998],"Idx"],[[-1,166066],4],[[-1,166062],"}_"],[[-1,28003],"4"],[[-1,166060],1],[[-1,166057],"$}\n"],[[-1,165953],"\\TrinaryInfC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle\\rangle,\\, k).\\mathsf{"],[[-1,27100],"idx"],[[-1,165878],4],[[-1,165874],"}"],[[-1,27097],"("],[[-1,27069],"i"],[[-1,27096],1],[[-1,27095],")"],[[-1,165873]," \\evalto \\mathit{cur}"],[[-1,165850],"'$}"],[[-1,165852],1],[[-1,166059],1],[[-1,166233],"\n\\end{prooftree}"],[[-1,26066],"\n\n\\begin{prooftree}\n\\AxiomC{$i=0$}\n\\LeftLabel{$\\textsc{Idx}_5$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle\\rangle,\\, k).\\mathsf{idx}(i) \\evalto\n    \\mathsf{cursor}(\\langle\\rangle,\\, k)$}\n\\end{prooftree}"],[[-1,166236],1],[[-1,215021],10],[[-1,214741],"\n\n"],[[-1,214739],17],[[-1,214706],85],[[-1,214620],6],[[-1,214621],1],[[-1,214614],53],[[-1,27090],3],[[-1,214561],5],[[-1,27087],1],[[-1,27071],1],[[-1,27086],2],[[-1,214546],5],[[-1,214537],91],[[-1,27991],3],[[-1,214446],6],[[-1,27987],1],[[-1,165846],1],[[-1,214440],16],[[-1,214418],59],[[-1,214357],22],[[-1,214331],9],[[-1,27080],3],[[-1,214322],5],[[-1,27077],1],[[-1,27073],1],[[-1,27076],2],[[-1,214317],80],[[-1,214335],2],[[-1,214359],1],[[-1,214420],1],[[-1,214424],2],[[-1,214541],2],[[-1,214556],5],[[-1,214722],16],[[-1,165843],2],[[-1,165841],"\\[ \\mathrm{keys}(\\mathit{ctx}) = \\{\\;"],[[-1,165722]," "],[[-1,165796],5],[[-1,165791],"k \\mid"],[[-1,165721],"\n   "],[[-1,165785]," \\mathsf"],[[-1,165769],"{mapT}(k) "],[[-1,165306]," "],[[-1,165759],"\\in \\mathrm{dom}("],[[-1,165334],"\\mathit{"],[[-1,165742],"ctx"],[[-1,165326],"}"],[[-1,165739],") \\,\\vee\\,"],[[-1,165717],"\n    \\mathsf{listT}(k) \\in \\mathrm{dom}("],[[-1,165325],"\\mathit{"],[[-1,165677],"ctx"],[[-1,165317],"}"],[[-1,165674],") \\,\\vee\\,\n    \\mathsf{regT}(k) "],[[-1,165307]," "],[[-1,165642],"\\in \\mathrm{dom}("],[[-1,165316],"\\mathit{"],[[-1,165625],"ctx"],[[-1,165308],"}"],[[-1,165622],")"],[[-1,165729],1],[[-1,165771],1],[[-1,165777],3],[[-1,165804],"\n\\;\\} \\]"],[[-1,165621],"\n\n\\"],[[-1,165600],"begin{prooftree"],[[-1,165581],"}\n\\AxiomC{$A_p,\\, \\mathit{expr} \\evalto \\mathit{cur}$}\n\\AxiomC{$A_p,\\, \\mathit{cur}.\\mathsf{keys}"],[[-1,165482]," \\evalto \\mathit{"],[[-1,165459],"keys}"],[[-1,165465],3],[[-1,165484],"$}"],[[-1,165454],"\n\\LeftLabel{$\\textsc{Keys}_1$}\n\\BinaryInfC{$A_p,\\, \\mathit{expr}.\\mathsf{keys} \\evalto \\mathit{keys}$}\n\\end{"],[[-1,165344],"prooftree}"],[[-1,165305],"\n\n\\begin{prooftree}"],[[-1,165270],"\n\\AxiomC{$"],[[-1,165230],"\\math"],[[-1,165213],"it"],[[-1,165225],2],[[-1,165223],"{"],[[-1,165207],"map"],[[-1,165222],4],[[-1,165218],"}"],[[-1,165204]," = "],[[-1,165217],1],[[-1,165260],"\\mathit{ctx}(\\mathsf{mapT}(k))"],[[-1,165199],"$}\n\\AxiomC{$\\mathit{keys} = \\{\\; k \\mid k \\in \\mathrm{keys}(\\mathit{map}) \\,\\wedge\\,\n    \\mathit{map}(\\mathsf{pres}(k)) \\not= \\{\\} \\;\\}$}\n\\LeftLabel{$\\textsc{Keys}_2$}\n\\BinaryInfC{$A_p,\\, \\"],[[-1,165002],"mathsf{cursor}(\\langle\\rangle,\\, k).\\mathsf{keys} \\evalto \\mathit{keys}$}"],[[-1,165010],4],[[-1,165216],1],[[-1,165286],"\n\\end{prooftree}"],[[-1,164929],"\n\n\\begin{prooftree}"],[[-1,164894],"\n\\AxiomC{$k_1 \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\AxiomC{$\\mathit{ctx}(k_1),\\, \\mathsf{cursor"],[[-1,164543],"}"],[[-1,164803],"(\\langle k_2, \\dots, k_{n-1} \\rangle,\\, k_n).\\mathsf{keys}\n    \\evalto \\mathit{keys}$}\n\\LeftLabel{$\\textsc{Keys}_3"],[[-1,164685],"$}\n\\BinaryInfC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle k_1, k_2, \\dots, k_{n-1"],[[-1,164604],"} \\rangle"],[[-1,164593],",\\, k_n).\\mathsf{keys}\n    \\evalto \\mathit{keys}$}"],[[-1,164595],1],[[-1,164606],1],[[-1,164689],2],[[-1,164910],"\n\\end{prooftree}"],[[-1,165346],1],[[-1,165585],2],[[-1,165618],9],[[-1,208007],"\n\n\\begin{prooftree}"],[[-1,207972],"\n\\AxiomC{$A_p,\\, \\mathit{expr} \\evalto \\mathit{"],[[-1,207891],"cur"],[[-1,207925],3],[[-1,207922],"}$}\n\\AxiomC{$A_p,\\, \\mathit{"],[[-1,207888],"cur}.\\mathsf{values} \\evalto \\mathit{"],[[-1,207849],"val}$}\n\\LeftLabel{$\\textsc{Val}_1$}\n\\BinaryInfC{$A_p,\\, \\mathit{expr}.\\mathsf{values} \\evalto \\mathit{val}$}"],[[-1,207851],1],[[-1,207988],"\n\\end{prooftree}"],[[-1,207741],"\n\n\\begin{prooftree}\n\\AxiomC{$\\mathsf{regT}(k) \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\AxiomC{$\\mathit{val} = \\"],[[-1,204694],"mathrm{ran"],[[-1,204676],"ge"],[[-1,204684],"}("],[[-1,207637],50],[[-1,207587],"\\mathit{ctx}(\\mathsf{regT}(k))"],[[-1,204682],")"],[[-1,207557],5],[[-1,207552],"$}\n\\LeftLabel{$\\textsc{Val}_2$}\n"],[[-1,207518],"\\BinaryInfC{$"],[[-1,207491],"\\mathit{ctx},\\, \\mathsf{cursor}(\\langle\\rangle,\\, k).\\mathsf{values} \\evalto \\mathit{val}$}\n\\end{prooftree}\n\n\\begin{prooftree}"],[[-1,207349],"\n\\AxiomC{$k_1 \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\AxiomC{$\\mathit{ctx}(k_1"],[[-1,207275],"),\\, \\mathsf{cursor"],[[-1,207255],"}"],[[-1,207256],"("],[[-1,207254],"\\langle k_2, \\dots, k"],[[-1,207231],"_{n-1} \\rangle,\\, k_n).\\mathsf{values}\n    \\evalto \\mathit{val}$}\n\\LeftLabel{$\\textsc{Val}_3$}\n\\BinaryInfC{$\\mathit{ctx},\\, \\mathsf{cursor}(\\langle k_1, k_2, \\dots, k_{n-1} \\rangle,\\, k_n).\\mathsf{values}\n    \\evalto \\mathit{val}$}"],[[-1,207233],1],[[-1,207277],1],[[-1,207365],"\n\\end{prooftree}"],[[-1,207505],7],[[-1,207520],1],[[-1,215024],1],[[-1,215310],6],[[-1,215549],28],[[-1,215652],1],[[-1,215738],2],[[-1,215764],1],[[-1,215787],1],[[-1,216248],7],[[-1,216239],26],[[-1,216241],1],[[-1,216317],5],[[-1,216329],1],[[-1,216363],11],[[-1,216423],3],[[-1,216451],9],[[-1,216534],1],[[-1,216678],1],[[-1,216722],2],[[-1,216923],1],[[-1,217167],1],[[-1,217266],"\n\\caption{Rules for evaluating "],[[-1,217235],3],[[-1,217232],"expression"],[[-1,105011],"s"],[[-1,105007],"."],[[-1,217222],19],[[-1,217203],"}\\label{fig:"],[[-1,217189],"expr-rules}"],[[-1,217191],1],[[-1,217291],"\n\\end{figure*}"],[[-1,7519],"\n\n\\section{Formal "],[[-1,7469],"S"],[[-1,7501],1],[[-1,7500],"emantics}\\label{sec:semantics}"],[[-1,212764],"\n\n"],[[-1,9184],"We now explain formally how to achieve the concurrent semantics outlined in Section~\\ref{sec:composing}. "],[[-1,9186],1],[[-1,212762],"The state of "],[[-1,105588],"replica"],[[-1,212749],4],[[-1,212745]," $p$ is described "],[[-1,212685],"by"],[[-1,212727],4],[[-1,212723]," $A_p$, a finite partial function."],[[-1,212683]," "],[[-1,212680],"The "],[[-1,79175],"evaluation rules of"],[[-1,212676],3],[[-1,212671],9],[[-1,212662]," the command language "],[[-1,212640],26],[[-1,212614],"inspect and modify this local state $"],[[-1,212571],"A_p$, and "],[[-1,79125],"they"],[[-1,30817]," do not depend on $A_q$ (the state of any other replica $q"],[[-1,30758]," "],[[-1,30759],"\\"],[[-1,30757],"neq "],[[-1,30751],"p$)"],[[-1,30753],1],[[-1,212561],17],[[-1,212542],18],[[-1,212518],3],[[-1,105200],1],[[-1,212515],19],[[-1,105577],7],[[-1,212496],6],[[-1,105205],1],[[-1,212490],3],[[-1,212487],". The only communication "],[[-1,212458],"between "],[[-1,105565],"replicas"],[[-1,212450],5],[[-1,212445]," occurs in the evaluation of the \\textsf{yield} command, which we discuss later. For now"],[[-1,212355],", we concentrate on the execution of commands at a single "],[[-1,105553],"replica"],[[-1,212297],4],[[-1,212293]," $p$."],[[-1,212288],33],[[-1,105542],7],[[-1,212255],138],[[-1,201809],8],[[-1,212117],15],[[-1,212100],25],[[-1,201926],42],[[-1,201800],2],[[-1,201884],21],[[-1,201797],4],[[-1,201789],138],[[-1,201793],2],[[-1,201863],1],[[-1,212075],55],[[-1,212016],1],[[-1,212013],17],[[-1,201609],86],[[-1,211996],35],[[-1,211959],15],[[-1,211940],3],[[-1,211917],10],[[-1,201414],1],[[-1,211907],16],[[-1,211887],12],[[-1,211873],67],[[-1,211798],14],[[-1,201413],4],[[-1,211784],209],[[-1,211573],7],[[-1,211564],94],[[-1,209894],14],[[-1,211470],1],[[-1,211469],"\n"],[[-1,157644],"\n\\subsection{Expression "],[[-1,7437],"E"],[[-1,157620],1],[[-1,157619],"valuation}\n"],[[-1,211468],"\n"],[[-1,211402],"Figure~\\ref{"],[[-1,211388],"fig:expr-rules} gives "],[[-1,211365],"t"],[[-1,211390],1],[[-1,211467],1],[[-1,211466],"he rules for evaluating EXPR expressions in the command language"],[[-1,211364],", which are "],[[-1,211292],"evaluated"],[[-1,211352],7],[[-1,211345]," in the context of the local "],[[-1,105531],"replica"],[[-1,211316],4],[[-1,211312]," state $A_p$."],[[-1,211283]," The \\textsc{Exec} rule "],[[-1,201392],"formalizes the assumption"],[[-1,211259],7],[[-1,211252]," that commands are executed sequentially. The \\textsc{Let} rule allows the program to define a local variable, which is added to the local state"],[[-1,6021]," (the notation $A_p[\\,x \\,\\mapsto\\, \\mathit{cur}\\,]$ denotes a partial function that is the same as $A_p$, except that $A_p(x) = \\mathit{cur}$)"],[[-1,6024],". T"],[[-1,211108],7],[[-1,211101],"he corresponding \\textsc{Var} rule allows the program to retrieve the value of a previously defined variable.\n\nThe"],[[-1,5878]," following"],[[-1,210987],1],[[-1,210976],9],[[-1,210967]," rules in "],[[-1,210955],"Figure"],[[-1,210863],1],[[-1,210949],"~\\ref{fig:expr-rules}"],[[-1,210861]," show how an expression is"],[[-1,210928]," "],[[-1,210907],"evaluate"],[[-1,210835],"d"],[[-1,210899]," to a "],[[-1,210893],6],[[-1,210887],"cursor"],[[-1,163278],", which"],[[-1,210881],6],[[-1,210806],10],[[-1,210796]," "],[[-1,210782],"unambiguously "],[[-1,210795],"identifies a "],[[-1,210768],"particular position in a JSON document by describing a path from the root of the document tree to some branch or leaf node. "],[[-1,210642],"A cursor consists only of immutable keys and identifiers, so it can be sent over the network to another "],[[-1,105520],"replica"],[[-1,210538],4],[[-1,210534],", where it can be used to locate the same position in the document.\n\nFor ex"],[[-1,209913],"am"],[[-1,209905],"ple,"],[[-1,209899],"\n"],[[-1,201407],"\\[ "],[[-1,209898],1],[[-1,209901],1],[[-1,209911],3],[[-1,210459],8],[[-1,210451],"\\mathsf{cursor}(\\langle \\mathsf{mapT}(\\mathsf{doc}), \\mathsf{listT}(\\text{``shopping''}) \\rangle,\\, \\mathit{id}_1)"],[[-1,201402]," \\]"],[[-1,210337],1],[[-1,209897],1],[[-1,209896],"\n"],[[-1,210336],1],[[-1,210335],"is a cursor representing the list element \\verb|\"eggs\"| in Figure~\\ref{fig:make-doc}"],[[-1,5846],", assuming that $\\mathit{id}_1$ is the unique identifier of the operation that inserted this list element (we will discuss "],[[-1,2789],"these identifiers "],[[-1,5723],"in Section~\\ref{sec:lamport-ts}"],[[-1,5692],34],[[-1,5658],")"],[[-1,210251],". "],[[-1,5655],"The cursor"],[[-1,210235],2],[[-1,210233]," can be interpreted as a path"],[[-1,210177]," through the"],[[-1,6614]," local replica state"],[[-1,210165]," structure"],[[-1,6594]," $A_p$"],[[-1,210155],34],[[-1,210204],", read from left to right: "],[[-1,210121],"starting from the \\"],[[-1,210098],"textsf{doc} map at the root, it traverses through the map "],[[-1,210008],"entry"],[[-1,210040],3],[[-1,210037]," ``shopping'' of type "],[[-1,210003],"\\"],[[-1,209924],"text"],[[-1,210002],4],[[-1,209998],"sf{"],[[-1,210015],"list"],[[-1,209995],"T}, and "],[[-1,209876],"finishes"],[[-1,209987],4],[[-1,209983]," with the list element "],[[-1,5641],"that has"],[[-1,209960],4],[[-1,209956]," identifier $\\mathit{id}_1$."],[[-1,209868],"\n\nIn general, "],[[-1,209802],"$\\mathsf{cursor}(\\langle k_1, \\dots, "],[[-1,209761],"k_{n-1} \\rangle,\\, k_n)$ consists of a"],[[-1,209688]," (possibly empty)"],[[-1,209723]," vector of keys $\\langle k_1, \\dots"],[[-1,209671],", k_{n-1} \\rangle$, and a final key $k_n$ "],[[-1,209629],1],[[-1,209628],"which is always present"],[[-1,209605],1],[[-1,209604],". $k_n$ can be thought of as the final element of the vector, with the distinction that i"],[[-1,209513],"t is not tagged with a datatype, whereas the elements of the vector "],[[-1,201339],"are tagged with the datatype of the branch node"],[[-1,5633]," being traversed"],[[-1,201292],", either"],[[-1,209445],16],[[-1,209423],12],[[-1,209411]," "],[[-1,209406],"\\textsf{mapT} or \\textsf{listT}.\n\nThe \\"],[[-1,209361],"textsc{Doc} rule in Figure~\\ref{fig:expr-rules} defines the simplest cursor"],[[-1,209079]," $\\mathsf{cursor}(\\langle\\rangle,\\, \\mathsf{doc})$"],[[-1,209286],", referencing the root of the document using the special atom \\"],[[-1,209219],"textsf{doc}. "],[[-1,209120],"The \\textsc{Get} rule navigates a cursor "],[[-1,209029],"to a particular key within a "],[[-1,208866],"map. For example, the expression "],[[-1,208829],"\\verb|doc"],[[-1,6046],".get("],[[-1,163230],1],[[-1,208820],5],[[-1,208815],"\"shopping\""],[[-1,6040],")"],[[-1,163228],1],[[-1,208805],1],[[-1,208804],"| evaluates to "],[[-1,208765],"$\\mathsf{cursor}(\\langle \\mathsf{mapT}(\\mathsf{doc}) \\rangle,\\, \\text{``shopping''})$ by applying the \\textsc{Doc} and \\textsc{Get} rules."],[[-1,207000]," Note that "],[[-1,206981],"the expression \\verb"],[[-1,206959],"|doc"],[[-1,6038],".get("],[[-1,163223],1],[[-1,163222],"..."],[[-1,6032],")"],[[-1,163219],1],[[-1,206955],4],[[-1,206951],"| implicitly asserts that \\"],[[-1,206890],"text"],[[-1,206924],4],[[-1,206920],"sf{doc} is of type \\"],[[-1,206886],"textsf{mapT}, and this assertion is encoded in the cursor."],[[-1,206900],3],[[-1,206961],1],[[-1,206989],4],[[-1,208627],"\n\nThe"],[[-1,5617]," rules"],[[-1,208622]," "],[[-1,5611],"$"],[[-1,208621],"\\textsc{I"],[[-1,5603],"dx"],[[-1,208612],3],[[-1,5610],2],[[-1,208609],"}"],[[-1,5601],"_{1"],[[-1,5596]," \\dots 5}$ define how to evaluate the expression \\verb|"],[[-1,5541],3],[[-1,5538],".idx(|$n"],[[-1,5528],"$\\verb|)|"],[[-1,5517],", moving the cursor to a particular element of a list. "],[[-1,5462],7],[[-1,5453],"$\\textsc{Idx}_1$ constructs a cursor representing the head of the list, "],[[-1,5374],"and delegates to the subsequent rules to scan over the list. $\\textsc{Idx}_2$ recursively descends the local state according to the vector of keys in the cursor. When the vector of keys is empty, the context $\\mathit{ctx}$ is the subtree of $A_p$ "],[[-1,5101],"that stores the list in question, and the rules $\\textsc{Idx}_{3,4,5}$ iterate over that list until the desired element is f"],[[-1,4973],"ound.\n\n$\\textsc{Idx}_5$ terminates the iteration when the index reaches zero, while $\\textsc{Idx}_3$ moves to the next element and decrements the index, and $\\textsc{Idx}_4$ skips over "],[[-1,4788],8],[[-1,4780],"list elements"],[[-1,4470]," that are marked as deleted"],[[-1,4767],". The "],[[-1,4761],5],[[-1,4756],"structure resemble"],[[-1,4736],"s a linked list"],[[-1,4716],": each list element has a unique identifier $k$, and the partial function representing local state ma"],[[-1,4613],"ps $\\mathsf{next}(k)$ to the ID of the list element that follows $k$."],[[-1,4366],"\n\n"],[[-1,4443],1],[[-1,4442],"Deleted"],[[-1,4435],5],[[-1,4430]," elements are never removed from the"],[[-1,4389]," linked list structure"],[[-1,4336],", but only marked as deleted"],[[-1,658]," ("],[[-1,646],"they become "],[[-1,616],"so"],[[-1,611],1],[[-1,614],"-"],[[-1,609],"called "],[[-1,613],1],[[-1,634],"\\emph{tombstones})"],[[-1,656],5],[[-1,4308],". To this end, the local state "],[[-1,4185],"main"],[[-1,4277],3],[[-1,4274],"tains a \\emph{presence set} $\\mathsf{pres}(k)$ for "],[[-1,4180],"the"],[[-1,4189],1],[[-1,4223],4],[[-1,4219]," list element with ID $k$"],[[-1,3762],", which"],[[-1,4194],1],[[-1,4159],3],[[-1,4156]," is the set of all operations that have asserted the existence of th"],[[-1,3754],"is"],[[-1,4088],1],[[-1,4087]," list element. When a list element is deleted, the pre"],[[-1,4029],"sence set is set to the empty set, "],[[-1,3748],"which "],[[-1,3994],"mark"],[[-1,3749],"s"],[[-1,3990],3],[[-1,3987]," it as deleted; however, a concurrent operation that references the list element can cause the presence set to be come non-empty again (leading to the situations in Figures~\\ref{fig:map-remove} and"],[[-1,3788],"~\\ref{fig:todo-item})."],[[-1,3742]," "],[[-1,3739],"Rule $\\textsc{Idx}_4$ handles list element"],[[-1,3695],"s with "],[[-1,3674],"an "],[[-1,3688],"empty presence"],[[-1,3671]," set by moving to the next list element without decrementing the index"],[[-1,1643]," "],[[-1,1641],"("],[[-1,2734],2],[[-1,2732],"i.e."],[[-1,1640],","],[[-1,2728]," not counting them as list elements"],[[-1,1639],")"],[[-1,3601],"."],[[-1,3697],1],[[-1,3741],1],[[-1,3790],1],[[-1,4033],2],[[-1,4177],1],[[-1,4164],2],[[-1,4176],6],[[-1,4544],1],[[-1,4519],14],[[-1,4497],2],[[-1,4489],11],[[-1,4495],3],[[-1,4505],4],[[-1,4543],12],[[-1,4615],1],[[-1,4738],1],[[-1,4977],2],[[-1,5127],13],[[-1,5455],1],[[-1,5519],"\n\n"],[[-1,5530],1],[[-1,5598],1],[[-1,208608],8],[[-1,208598],27],[[-1,208563],15],[[-1,208540],11],[[-1,208525],52],[[-1,208471],47],[[-1,163213],4],[[-1,208424],27],[[-1,208270],1],[[-1,208397],1],[[-1,208269],1],[[-1,162556],3],[[-1,163206],7],[[-1,208268],4],[[-1,208396],126],[[-1,208225],109],[[-1,208099],1],[[-1,208116],15],[[-1,163198],1],[[-1,208101],1],[[-1,208098],85],[[-1,163197],23],[[-1,163158],265],[[-1,162887],5],[[-1,162880],30],[[-1,162850],"The $\\textsc{Keys}_{1,2,3}$ rules allow the application to inspect the set of keys "],[[-1,162767],17],[[-1,162750],"in a map. This set is determined by examining the local state, and excluding any keys for which the presence set is empty (indicating that the key has been deleted)."],[[-1,162882],1],[[-1,162889],1],[[-1,162893],2],[[-1,163174],8],[[-1,206828],"\n\nFinally, the $\\textsc{Val}_{1,2,3}$ rules "],[[-1,206782],"allow "],[[-1,162576],"the application"],[[-1,206776],9],[[-1,206767]," to read the "],[[-1,206742],"contents of "],[[-1,201269],"a register at"],[[-1,206730],15],[[-1,206715]," a particular cursor position"],[[-1,206265],", using a similar recursive rule structure as the \\textsc{"],[[-1,2689],"Idx"],[[-1,206207],4],[[-1,206203],"} rules"],[[-1,206686],". "],[[-1,201199],"A "],[[-1,206684],49],[[-1,206635],"registe"],[[-1,201252],"r is"],[[-1,206628],3],[[-1,206621],1],[[-1,206625]," exp"],[[-1,206620],1],[[-1,206619],"ress"],[[-1,206614],"ed using the "],[[-1,206597],"\\textsf{regT} type annotation in the local state"],[[-1,201197],55],[[-1,201126],25],[[-1,201142],16],[[-1,206549],". A"],[[-1,206502],"lthough a "],[[-1,105509],"replica"],[[-1,206492],4],[[-1,206486],7],[[-1,206479]," can only a"],[[-1,206461],"ssign a single value to a register, a register can nevertheless contain multiple values if multi"],[[-1,206363],"ple "],[[-1,105498],"replica"],[[-1,206359],4],[[-1,206355],"s concurrently assign values to it"],[[-1,201100],3],[[-1,206321],22],[[-1,206297],1],[[-1,206292],26],[[-1,206266],"."],[[-1,206196],"\n\n"],[[-1,199357],"\\"],[[-1,206194],4],[[-1,206190],"subsection{"],[[-1,199328],"Generating "],[[-1,7435],"O"],[[-1,199317],1],[[-1,199316],"perations"],[[-1,206155],28],[[-1,206127],"}"],[[-1,199307],"\n\n"],[[-1,199082],"When"],[[-1,199206],48],[[-1,199291],18],[[-1,199273]," commands "],[[-1,199155],4],[[-1,199263],4],[[-1,199259],"mutat"],[[-1,199148],"e"],[[-1,199254],3],[[-1,199251]," the state of the document"],[[-1,199145],", "],[[-1,199070],"they generate \\emph{operations} that describe the mutation"],[[-1,199143],8],[[-1,199147],1],[[-1,199225],"."],[[-1,199012]," In our semantics, "],[[-1,198895],"a "],[[-1,198993],"command"],[[-1,198986],1],[[-1,198985]," never directly modif"],[[-1,198891],"ies"],[[-1,198964],1],[[-1,198963]," the "],[[-1,198950],"local "],[[-1,105487],"replica"],[[-1,198944],4],[[-1,198940]," state $A_p$, but only generate"],[[-1,198888],"s"],[[-1,198909]," an operation."],[[-1,198887]," That operation is th"],[[-1,198860],"en "],[[-1,198828],"immediately "],[[-1,198857],"applied to $A_p$ "],[[-1,198804],"so that it takes effect locally, and "],[[-1,198752],"the "],[[-1,2590],"same "],[[-1,198748],"operation is also "],[[-1,198767],"asynchronously "],[[-1,198730],"broadcast to the other "],[[-1,105476],"replica"],[[-1,198707],4],[[-1,198703],"s."],[[-1,198701],2],[[-1,105127],4],[[-1,198699],1],[[-1,105465],7],[[-1,198698],11],[[-1,198683],1],[[-1,105147],3],[[-1,198682],10],[[-1,105123],3],[[-1,198672],11],[[-1,105116],1],[[-1,198661],5],[[-1,105091],5],[[-1,198656],7],[[-1,105454],7],[[-1,105115],2],[[-1,105112],21],[[-1,105447],1],[[-1,197228],5],[[-1,198649],68],[[-1,198581],"\n\n"],[[-1,198687],2],[[-1,198840],12],[[-1,198866],3],[[-1,198958],4],[[-1,199305],7],[[-1,206179],12],[[-1,206296],2],[[-1,206299],1],[[-1,206365],1],[[-1,206488],1],[[-1,206546],4],[[-1,206540],17],[[-1,206542],1],[[-1,206601],2],[[-1,206754],6],[[-1,206784],1],[[-1,208473],1],[[-1,208529],2],[[-1,208548],4],[[-1,208571],4],[[-1,208600],1],[[-1,208789],12],[[-1,208833],2],[[-1,209000],18],[[-1,208978],47],[[-1,208982],2],[[-1,209206],43],[[-1,209223],2],[[-1,209367],3],[[-1,209410],2],[[-1,209429],3],[[-1,209515],1],[[-1,209765],2],[[-1,209854],12],[[-1,209832],9],[[-1,209842],5],[[-1,210102],2],[[-1,210249],7],[[-1,210644],1],[[-1,210828],11],[[-1,210832],2],[[-1,210875],2],[[-1,210927],6],[[-1,210917],2],[[-1,210921],2],[[-1,210957],1],[[-1,210986],5],[[-1,211566],1],[[-1,211575],1],[[-1,211806],4],[[-1,211875],1],[[-1,211891],2],[[-1,211937],10],[[-1,211944],2],[[-1,211961],1],[[-1,212015],1],[[-1,212020],2],[[-1,212102],1],[[-1,212357],1],[[-1,212462],2],[[-1,212524],3],[[-1,212544],1],[[-1,212577],3],[[-1,212673],1],[[-1,212682],1],[[-1,217307],1],[[-1,224512],1],[[-1,224511],"\\"],[[-1,199364],"sub"],[[-1,224510],"subsection{Lamport "],[[-1,7433],"T"],[[-1,224491],1],[[-1,224490],"imestamps}"],[[-1,5868],"\\label{sec:lamport"],[[-1,5849],"-ts"],[[-1,5850],"}"],[[-1,224480],"\n"],[[-1,198576],"\nEvery operation in our model is given a unique identifier, which is used "],[[-1,198450],"in"],[[-1,198502],10],[[-1,198492]," the local state and "],[[-1,198446],"in"],[[-1,198471],2],[[-1,198469]," cursors."],[[-1,198444]," "],[[-1,198443],180],[[-1,198262],4],[[-1,6553],1],[[-1,198258],2],[[-1,198235],1],[[-1,198256],4],[[-1,6552],2],[[-1,6240],"W"],[[-1,6550],1],[[-1,6549],"henever an element is inserted into a list"],[[-1,2446],","],[[-1,6507]," or a value is assigned to a register, the "],[[-1,6444],"new list element or register value is identified by the identifier of the operation that created it"],[[-1,6464],10],[[-1,198252],17],[[-1,198234],49],[[-1,105086],8],[[-1,105077],31],[[-1,198185],".\n\n"],[[-1,198073],"In order to gener"],[[-1,198054],"ate globally unique operation identifiers without "],[[-1,197949],"requiring "],[[-1,198004],"synchro"],[[-1,197966],"nous coordination"],[[-1,197997],8],[[-1,197989]," between "],[[-1,105442],"replica"],[[-1,105435],1],[[-1,197980],4],[[-1,197976],"s"],[[-1,197975],1],[[-1,198056],1],[[-1,198074]," "],[[-1,197937],"w"],[[-1,198176],1],[[-1,198175],"e use Lamport timestamps~\\cite{Lamport:1978jq"],[[-1,197908],"}."],[[-1,197585]," "],[[-1,198130],2],[[-1,198100],26],[[-1,198128],14],[[-1,198182],3],[[-1,198577],1],[[-1,254907],93],[[-1,254790],163],[[-1,254625],2],[[-1,254623],"A Lamport timestamp is a pair "],[[-1,254591],"$("],[[-1,254587],"c, "],[[-1,254384],"p"],[[-1,254584],1],[[-1,254583],")$ where"],[[-1,254534]," $"],[[-1,254382],"p"],[[-1,174958]," \\in \\mathrm{"],[[-1,105429],"Replica"],[[-1,174945],4],[[-1,174941],"ID}"],[[-1,254532],1],[[-1,254531],"$ is the unique identifier of the "],[[-1,105414],"replica"],[[-1,254377],4],[[-1,254497],4],[[-1,254493]," on which the edit is made"],[[-1,197906]," (for example,"],[[-1,197860]," a "],[[-1,197857],13],[[-1,197892],5],[[-1,197887],"hash of its public"],[[-1,105420]," k"],[[-1,197869],2],[[-1,197867],"ey)"],[[-1,197583],", and"],[[-1,254457],1],[[-1,254467],5],[[-1,254575]," $c"],[[-1,174938]," \\in \\math"],[[-1,174921],"bb"],[[-1,174928],2],[[-1,174926],"{N}"],[[-1,254572],"$ is a counter that is stored at "],[[-1,254451],"each "],[[-1,254369],3],[[-1,254366],"r"],[[-1,105404],"eplica"],[[-1,254446],4],[[-1,254442]," and incremented for every operation. "],[[-1,197455],"Since each "],[[-1,105394],"replica"],[[-1,197444],4],[[-1,197440]," generates a strictly monotonically increasing sequence of counter values $c$, the pair $(c, p)$ is unique."],[[-1,254295],67],[[-1,254337],17],[[-1,254160],19],[[-1,254320],4],[[-1,254186],24],[[-1,253947],"\n\n"],[[-1,254162],1],[[-1,254130],"If a "],[[-1,254125],3],[[-1,254122],"r"],[[-1,105384],"eplica"],[[-1,254121]," receives an operation with a counter value $c$ that is great"],[[-1,254058],"er than the locally stored counter value, the local counter is increased to the value of the incoming counter."],[[-1,253945]," This ensures that if operation $o_1$ "],[[-1,105046],"causally "],[[-1,253907],"happened before $o_2$ (that is, the "],[[-1,253871],3],[[-1,253868],"r"],[[-1,105213],"eplica"],[[-1,253867]," that generated $o_2$ "],[[-1,253815],"had received and processed $o_1$ before $o_2$ was generated), then $o_2$ must have a greater counter value than $o_1$. Only concurrent operations can have equal counter values.\n\nWe can thus define a total ordering"],[[-1,252953]," $<$"],[[-1,253602]," "],[[-1,253571],"for Lamport timestamps:\n"],[[-1,197331],"\\[ "],[[-1,253547],2],[[-1,253543],"(c_1, p_1) < (c_2, p_2) \\"],[[-1,252975],";"],[[-1,253518],4],[[-1,253512],"\\text{"],[[-1,252964]," "],[[-1,253506],"iff"],[[-1,252965]," "],[[-1,253503],"}"],[[-1,253502],1],[[-1,252970],1],[[-1,252969],"\\;"],[[-1,253501],4],[[-1,253497]," (c_1 < c_2) \\vee (c_1 = c_2 \\wedge p_1 < p_2)."],[[-1,197326]," \\]"],[[-1,253450],2],[[-1,253448],"\n"],[[-1,253191],"If one operation happened before another, this ordering is consistent with causality (the earlier operation has a lower times"],[[-1,253066],1],[[-1,253065],"tamp). If two operations are concurrent, th"],[[-1,252961],"e"],[[-1,252949],"ir"],[[-1,253022],2],[[-1,253020]," order"],[[-1,252947]," according to"],[[-1,252934],1],[[-1,252957]," $<$"],[[-1,253014],3],[[-1,253011]," is arbitrary but deterministic."],[[-1,197323]," This ordering property is important for our definition of the semantics of ordered lists."],[[-1,253447],106],[[-1,253317],10],[[-1,253341],12],[[-1,253514],1],[[-1,253545],1],[[-1,253601],15],[[-1,253845],15],[[-1,254060],1],[[-1,254140],5],[[-1,254161],1],[[-1,254316],13],[[-1,254404],19],[[-1,254365],19],[[-1,254539],5],[[-1,254589],1],[[-1,254593],1],[[-1,254627],1],[[-1,254814],12],[[-1,259140],"\n"],[[-1,254956],"\n"],[[-1,195460],"\\subsubsection{Operation "],[[-1,7431],"S"],[[-1,195435],1],[[-1,195434],"tructure}\n\nAn operation is a t"],[[-1,195400],"uple of the form"],[[-1,195135],"\n\\begin{alignat*}{"],[[-1,174973],"3"],[[-1,195117],1],[[-1,195116],"}"],[[-1,195384],"\n"],[[-1,195113],"&"],[[-1,195383],2],[[-1,195381]," \\mathsf{op}("],[[-1,195093]," \\\\"],[[-1,195306],"\n"],[[-1,195087],"&&"],[[-1,195305],3],[[-1,195302]," "],[[-1,195368],"\\mathit{id}"],[[-1,195070]," &"],[[-1,195357],": "],[[-1,195339],"\\mathbb{N} \\times \\mathrm{"],[[-1,105374],"Replica"],[[-1,195313],4],[[-1,195309],"ID}"],[[-1,195301],","],[[-1,194986]," \\\\"],[[-1,195300],"\n"],[[-1,195082],"&&"],[[-1,195299],3],[[-1,195296]," \\mathit{deps}"],[[-1,195068]," &"],[[-1,195282],": \\mathcal{P}("],[[-1,195266],"\\mathbb{N} \\times \\mathrm{"],[[-1,105363],"Replica"],[[-1,195240],4],[[-1,195236],"ID}),"],[[-1,194989]," \\\\"],[[-1,195231],"\n"],[[-1,195077],"&&"],[[-1,195230],3],[[-1,195227]," \\mathit{cur}"],[[-1,195066]," &"],[[-1,195214],": \\mathsf{cursor}(\\langle k_1, \\dots, k_{n-1} \\rangle,\\, k_n),"],[[-1,194992]," \\\\"],[[-1,195152],"\n"],[[-1,195072],"&&"],[[-1,195151],3],[[-1,195148]," \\mathit{mut}"],[[-1,195064]," &: \\mathsf{insert}(v) \\mid \\mathsf{delete} \\"],[[-1,195017],"mid \\mathsf{assign}(v)"],[[-1,174993]," && "],[[-1,174970],"\\"],[[-1,174962],"quad"],[[-1,174969],3],[[-1,174966]," "],[[-1,174989],"v: \\mathrm{VA"],[[-1,174971],"L"],[[-1,174976],1],[[-1,174975],"}"],[[-1,194995]," \\\\"],[[-1,195019],1],[[-1,195268],1],[[-1,195355],8],[[-1,195404],2],[[-1,254955],2],[[-1,254951],24],[[-1,254919],11],[[-1,254927],4],[[-1,254953],1],[[-1,259139],5],[[-1,259126],212],[[-1,258417],12],[[-1,258914],97],[[-1,257666],31],[[-1,258817],15],[[-1,258800],13],[[-1,257634],11],[[-1,257574],1],[[-1,257623],4],[[-1,257617],2],[[-1,258787],34],[[-1,252932],22],[[-1,252908],109],[[-1,252797],106],[[-1,252530],128],[[-1,252691],2],[[-1,252799],1],[[-1,252910],1],[[-1,258753],11],[[-1,257568],4],[[-1,258742],5],[[-1,258725],14],[[-1,258737],12],[[-1,258711],4],[[-1,257559],3],[[-1,257086],50],[[-1,257025],2],[[-1,257036],9],[[-1,257556],7],[[-1,258707],36],[[-1,258438],3],[[-1,258671],15],[[-1,258457],1],[[-1,258656],1],[[-1,258640],15],[[-1,258459],1],[[-1,258625],3],[[-1,257533],12],[[-1,258622],5],[[-1,257546],8],[[-1,258617],2],[[-1,257548],1],[[-1,258615],7],[[-1,257516],12],[[-1,258608],6],[[-1,258458],1],[[-1,258602],1],[[-1,252687],2],[[-1,258420],3],[[-1,258655],15],[[-1,258601],9],[[-1,257499],12],[[-1,258592],6],[[-1,257487],20],[[-1,258586],5],[[-1,257464],2],[[-1,258581],11],[[-1,257462],1],[[-1,258570],18],[[-1,257461],9],[[-1,258552],13],[[-1,257452],13],[[-1,258539],52],[[-1,257398],7],[[-1,258487],7],[[-1,258478],19],[[-1,258405],2],[[-1,257023],24],[[-1,255980],2],[[-1,256999],16],[[-1,255978],2],[[-1,256983],68],[[-1,252234],1],[[-1,251955],1],[[-1,251932],131],[[-1,251948],8],[[-1,251954],3],[[-1,252233],1],[[-1,252184],10],[[-1,252052],7],[[-1,252174],31],[[-1,251764],3],[[-1,252143],21],[[-1,251761],25],[[-1,251735],33],[[-1,251736],1],[[-1,251702],59],[[-1,252122],8],[[-1,252112],16],[[-1,252094],17],[[-1,252027],7],[[-1,252077],9],[[-1,252037],2],[[-1,252068],9],[[-1,251957],1],[[-1,252059],1],[[-1,252018],30],[[-1,252058],2],[[-1,252096],1],[[-1,252114],1],[[-1,252232],24],[[-1,258403],3],[[-1,258390],19],[[-1,258369],51],[[-1,258176],5],[[-1,258318],10],[[-1,258292],31],[[-1,258259],1],[[-1,258261],1],[[-1,258258],1],[[-1,258260],1],[[-1,258257],6],[[-1,258249],2],[[-1,257696],1],[[-1,258247],1],[[-1,258106],4],[[-1,258246],17],[[-1,257688],1],[[-1,258229],2],[[-1,258101],4],[[-1,258227],17],[[-1,257711],11],[[-1,258188],4],[[-1,258210],17],[[-1,257694],1],[[-1,258193],5],[[-1,257987],3],[[-1,258097],34],[[-1,258017],1],[[-1,258063],8],[[-1,257695],1],[[-1,258055],16],[[-1,257687],1],[[-1,258039],14],[[-1,257699],2],[[-1,258025],7],[[-1,258016],4],[[-1,257738],11],[[-1,258012],8],[[-1,258002],10],[[-1,257693],1],[[-1,257992],5],[[-1,258004],1],[[-1,258251],1],[[-1,258308],6],[[-1,258163],5],[[-1,258302],10],[[-1,258371],1],[[-1,258392],1],[[-1,258400],4],[[-1,258480],1],[[-1,258802],1],[[-1,259134],4],[[-1,259173],1],[[-1,256913],1],[[-1,256911],57],[[-1,256852],133],[[-1,256715],78],[[-1,256635],80],[[-1,233421],"\n"],[[-1,195112],"& )\n\\end{alignat*}"],[[-1,194981],"\nwhere "],[[-1,194970],"$\\mathit{id}$ is the Lamport timestamp that uniquely identifies the operation, $\\mathit{cur}$ is the cursor describing the position in the document being modified, and $\\mathit{mut}$ is the mutation that "],[[-1,194740],"was requested at the specified position.\n\n$\\mathit{deps}$ is the set of "],[[-1,2445],"\\emph{"],[[-1,194668],"causal dependencies"],[[-1,2439],"}"],[[-1,194649]," of the operation"],[[-1,2438],"."],[[-1,1837]," It is defined as follows:"],[[-1,2303]," "],[[-1,1810],"i"],[[-1,2302],1],[[-1,2301],"f operation $o_2$ was generated by replica $p$, then"],[[-1,2437]," "],[[-1,2248],"a"],[[-1,2436],1],[[-1,2431]," causal dependency "],[[-1,2406],"of"],[[-1,2404],10],[[-1,2394]," $o_2$ is any operation $o_1$ that had"],[[-1,2311]," already"],[[-1,2356]," been applied"],[[-1,2237]," on $p$ at the time when $o_2$ was generated. In this paper, we define"],[[-1,2165]," "],[[-1,2150],"$\\mathit{deps}$ as the set of Lamport timestamps of all causal dependencies."],[[-1,2156],3],[[-1,2164],4],[[-1,2167],1],[[-1,2343]," "],[[-1,2342],31],[[-1,2412],3],[[-1,2435],2],[[-1,194632],44],[[-1,79111],5],[[-1,194588],22],[[-1,193404],1],[[-1,194566],1],[[-1,194553],32],[[-1,194506],4],[[-1,194521],15],[[-1,194502],9],[[-1,79106],8],[[-1,194493],75],[[-1,194418],"In a real implementation, this set would become impracticably large, so a compact representation of causal history "],[[-1,194293],"would be used instead -- for example, version vectors"],[[-1,143375],"~\\cite{ParkerJ"],[[-1,143357],"r:1983jb}"],[[-1,143361],2],[[-1,143414],", state vectors~\\cite{Ellis:1989ue}, or"],[[-1,194240],3],[[-1,194237]," dotted version vectors"],[[-1,143331],"~\\cite{Preguica:2012fx}"],[[-1,194214],7],[[-1,194205],10],[[-1,194195],". "],[[-1,194016],"However, "],[[-1,194006],"t"],[[-1,194059],1],[[-1,194058],"o avoid ambiguity"],[[-1,194193],8],[[-1,194185]," in our "],[[-1,194177],29],[[-1,194148],"semantics we give the dependencies as a"],[[-1,194001]," simple"],[[-1,194109]," set of operation ID"],[[-1,194069],"s."],[[-1,193994],"\n\nThe purpose of the causal dependencies $\\mathit{deps}$ is to impose a partial ordering on operations: an operation can only be applied after all operations that ``happened before'' it have been applied. In particular, this means that the sequence of operations generated at one particular "],[[-1,193703],3],[[-1,193700],"r"],[[-1,105353],"eplica"],[[-1,193699]," will be applied in the same order at every other "],[[-1,105343],"replica"],[[-1,193649],4],[[-1,193645],". Operations that are concurrent"],[[-1,193611],1],[[-1,193610]," "],[[-1,1637],"("],[[-1,193609],"i.e."],[[-1,1636],","],[[-1,193605]," where there is no causal dependency"],[[-1,1633]," in either direction"],[[-1,1634],")"],[[-1,193569],1],[[-1,193568]," can be applied in any order.\n\n\\subsubsection{Semantics of "],[[-1,7429],"G"],[[-1,193509],1],[[-1,193508],"enerating "],[[-1,7427],"O"],[[-1,193498],1],[[-1,193497],"perations}"],[[-1,193613],1],[[-1,194089],6],[[-1,194079],2],[[-1,194083],2],[[-1,194207],1],[[-1,194303],5],[[-1,194565],6],[[-1,194766],13],[[-1,194974],2],[[-1,195094],"\n"],[[-1,233420],"\n"],[[-1,232505],1],[[-1,233419],"\\begin{figure*}"],[[-1,230684],"\n\\centering"],[[-1,230673],1],[[-1,231007],"\n"],[[-1,194983],1],[[-1,231006],"\\"],[[-1,195492],"begin{prooftree}"],[[-1,193401],"\n"],[[-1,193398],"\\AxiomC{"],[[-1,193347],"$"],[[-1,193390],"A_p,\\, \\mathit{expr} \\evalto \\mathit{cur}"],[[-1,193348],"$"],[[-1,193349],"}"],[[-1,193346],"\n\\AxiomC{$\\mathit{val}: \\mathrm{VAL}"],[[-1,193310],1],[[-1,193150],2],[[-1,193309],6],[[-1,193148],2],[[-1,193303],8],[[-1,193236],5],[[-1,193295],7],[[-1,193216],1],[[-1,193154],4],[[-1,193215],1],[[-1,193195],6],[[-1,193160],2],[[-1,193189],15],[[-1,193110],4],[[-1,193214],4],[[-1,193288],1],[[-1,193221],5],[[-1,193252],7],[[-1,193287],7],[[-1,193229],1],[[-1,193210],1],[[-1,193258],1],[[-1,193245],1],[[-1,193146],2],[[-1,193244],6],[[-1,193144],28],[[-1,193106],1],[[-1,193116],2],[[-1,193105],6],[[-1,193114],2],[[-1,193099],6],[[-1,193112],2],[[-1,193238],2],[[-1,193280],1],[[-1,193279],"$}"],[[-1,193093],"\n\\AxiomC{$A_p,\\, \\mathsf{makeOp}(\\mathit{cur}"],[[-1,193046],", \\mathsf{assign}(\\mathit{val})) \\evalto A_p'$}"],[[-1,192906],"\n\\LeftLabel{\\textsc{"],[[-1,166762],"Make-"],[[-1,192886],"Assign}}"],[[-1,193048],1],[[-1,193277],"\n\\"],[[-1,192998],"Tr"],[[-1,193275],1],[[-1,193274],"inaryInfC{"],[[-1,192994],"$A_p,\\, \\mathit{expr} "],[[-1,192864],"\\,"],[[-1,192968],1],[[-1,192955],7],[[-1,192944],1],[[-1,192940],"\\text{"],[[-1,192869]," "],[[-1,192943],":="],[[-1,192868]," "],[[-1,192934],1],[[-1,192941],"}"],[[-1,192866],"\\,"],[[-1,192933]," \\mathit{val} \\evalto A_p'$"],[[-1,192948],2],[[-1,192967],6],[[-1,192972],2],[[-1,193262],2],[[-1,193260],"}"],[[-1,193264],1],[[-1,193400],1],[[-1,195476],"\n"],[[-1,194982],1],[[-1,195475],"\\end{prooftree}"],[[-1,192862],"\n\n\\begin{prooftree}"],[[-1,192827],"\n\\AxiomC{$A_p,\\, \\mathit{expr} \\evalto \\mathit{cur}$}\n\\AxiomC{$\\mathit{val}: \\mathrm{VAL}$}\n\\AxiomC{$A_p,\\, \\mathsf{makeOp}(\\mathit{cur}, \\mathsf{insert}(\\mathit{val})) \\evalto "],[[-1,192650],1],[[-1,192649],"A"],[[-1,192646],"_p'$}"],[[-1,192640],"\n\\LeftLabel{\\textsc{"],[[-1,166767],"Make-"],[[-1,192620],"Insert}}\n\\TrinaryInfC{$A"],[[-1,192594],"_p,\\, \\mathit{expr}.\\mathsf{insert"],[[-1,1809],"After"],[[-1,192560],"}(\\mathit{val}) \\evalto A_p'$}"],[[-1,192596],1],[[-1,192648],1],[[-1,192843],"\n\\end{prooftree}"],[[-1,192530],"\n\n\\begin{prooftree}\n\\AxiomC{$A_p,\\, \\mathit{expr} \\evalto \\mathit{cur}$}\n\\AxiomC{$A_p,\\, \\mathsf{makeOp}(\\mathit{cur}, \\mathsf{delete}) \\evalto A_p'$}\n\\LeftLabel{\\textsc{"],[[-1,166772],"Make-"],[[-1,192360],"Delete}}\n\\BinaryInfC{$A_p,\\, \\mathit{expr}.\\mathsf{delete"],[[-1,192301],"} \\evalto A_p'$}\n\\end{prooftree}\n\n\\begin{prooftree}"],[[-1,192234],"\n\\AxiomC{$\\mathit{ctr} = \\mathrm{max}(\\{0\\} \\,\\cup\\, \\{ c_i \\mid (c_i, p_i) \\in A_p(\\mathsf{ops}) \\}"],[[-1,192130],"$}\n"],[[-1,192127],36],[[-1,192087],4],[[-1,192091],4],[[-1,192083],3],[[-1,192080],"\\AxiomC{$A_p,\\, \\math"],[[-1,192047],"sf{apply}(\\mathsf{op}("],[[-1,191825],"("],[[-1,192025],"\\mathit{"],[[-1,191836],"ctr"],[[-1,192017],2],[[-1,192015],"}"],[[-1,191833]," + 1, p)"],[[-1,192014],", A_p(\\"],[[-1,191840],1],[[-1,192007],"mathsf{ops}),"],[[-1,191824],"\n   "],[[-1,191994]," \\mathit{cur}, \\mathit{mut}"],[[-1,191756],")"],[[-1,191967],") \\evalto A_p'$}\n\\LeftLabel{\\textsc{Make-Op}}\n\\"],[[-1,191771],"B"],[[-1,191920],2],[[-1,191918],"inaryInfC{$A_p,\\, \\mathsf{makeOp}(\\mathit{cur}, \\mathit{mut}) \\evalto "],[[-1,191848],1],[[-1,191847],"A_p'$}"],[[-1,192059],6],[[-1,192134],2],[[-1,192250],"\n\\end{prooftree}"],[[-1,192303],1],[[-1,231005],8],[[-1,230665],1],[[-1,224670],20],[[-1,224769],13],[[-1,230664],2],[[-1,224788],14],[[-1,224773],2],[[-1,224756],6],[[-1,224735],12],[[-1,224750],1],[[-1,224771],2],[[-1,224774],1],[[-1,230662],1],[[-1,230997],1],[[-1,230655],2],[[-1,230996],20],[[-1,230898],11],[[-1,224749],14],[[-1,230887],3],[[-1,230879],1],[[-1,230884],5],[[-1,230878],15],[[-1,230976],30],[[-1,230862],2],[[-1,230946],12],[[-1,230653],2],[[-1,230934],1],[[-1,230807],1],[[-1,224572],1],[[-1,230804],1],[[-1,230806],1],[[-1,230933],6],[[-1,230923],3],[[-1,230738],5],[[-1,230920],16],[[-1,230651],2],[[-1,230904],6],[[-1,230860],26],[[-1,224570],1],[[-1,230834],1],[[-1,230830],1],[[-1,230833],2],[[-1,230759],2],[[-1,230831],1],[[-1,230829],6],[[-1,230821],13],[[-1,230671],6],[[-1,230695],3],[[-1,230733],7],[[-1,230808],1],[[-1,230823],1],[[-1,230927],2],[[-1,231385],18],[[-1,231306],13],[[-1,231157],1],[[-1,231167],10],[[-1,231293],1],[[-1,231156],8],[[-1,230649],12],[[-1,231148],3],[[-1,231350],41],[[-1,231289],10],[[-1,231277],1],[[-1,230637],2],[[-1,231276],1],[[-1,230757],1],[[-1,224574],1],[[-1,230756],1],[[-1,231275],33],[[-1,231203],9],[[-1,231242],2],[[-1,230635],2],[[-1,231240],8],[[-1,231228],4],[[-1,231023],3],[[-1,231224],1],[[-1,231020],1],[[-1,231223],19],[[-1,231194],16],[[-1,231019],3],[[-1,231178],1],[[-1,231016],1],[[-1,231177],10],[[-1,231232],2],[[-1,231279],2],[[-1,231309],3],[[-1,231367],2],[[-1,230771],12],[[-1,226854],16],[[-1,230657],"\n"],[[-1,230290],1],[[-1,230255],1],[[-1,229980],16],[[-1,230254],27],[[-1,230197],9],[[-1,224636],1],[[-1,230188],45],[[-1,224576],1],[[-1,230143],24],[[-1,227245],4],[[-1,230119],21],[[-1,227225],2],[[-1,230098],7],[[-1,227223],2],[[-1,230091],20],[[-1,227239],1],[[-1,227236],1],[[-1,227238],1],[[-1,230071],4],[[-1,227241],1],[[-1,227234],1],[[-1,227240],1],[[-1,230067],13],[[-1,228588],5],[[-1,230054],33],[[-1,229964],16],[[-1,230021],1],[[-1,229947],1],[[-1,228395],17],[[-1,229946],1],[[-1,229344],15],[[-1,229317],1],[[-1,229329],11],[[-1,229945],5],[[-1,229938],11],[[-1,229940],1],[[-1,230020],1],[[-1,230289],17],[[-1,230656],1],[[-1,230557],1],[[-1,230508],9],[[-1,191766],1],[[-1,230499],10],[[-1,191763],2],[[-1,230489],3],[[-1,191760],1],[[-1,230486],4],[[-1,191758],2],[[-1,230482],48],[[-1,224578],1],[[-1,230434],15],[[-1,230417],9],[[-1,227253],4],[[-1,230408],5],[[-1,230401],16],[[-1,227229],2],[[-1,230385],7],[[-1,227227],2],[[-1,230378],20],[[-1,227247],1],[[-1,227230],1],[[-1,227246],1],[[-1,230358],4],[[-1,227249],1],[[-1,227232],1],[[-1,227248],1],[[-1,230354],25],[[-1,228437],15],[[-1,227959],1],[[-1,227958],"\n\\begin{prooftree}\n\\AxiomC{$A_p,\\"],[[-1,224580],","],[[-1,227925],1],[[-1,227924]," \\mathit{"],[[-1,225982],"op"],[[-1,227915],3],[[-1,227912],"} \\evalto A_p'"],[[-1,227898],15],[[-1,227883],"$}"],[[-1,226450],10],[[-1,225762],14],[[-1,225930],5],[[-1,225923],30],[[-1,225889],38],[[-1,225893],2],[[-1,225925],1],[[-1,226440],35],[[-1,227881],"\n\\LeftLabel{\\textsc{Apply-Local}}\n\\"],[[-1,191690],"U"],[[-1,191689],1],[[-1,226452],2],[[-1,227846],1],[[-1,227845],"naryInfC{$A_p,\\"],[[-1,224582],","],[[-1,227830],1],[[-1,227829]," "],[[-1,226001],"\\mathsf{apply}("],[[-1,226003],1],[[-1,227828],"\\mathit{"],[[-1,226005],"op"],[[-1,227820],3],[[-1,227817],"}"],[[-1,225986],")"],[[-1,227816]," \\evalto A_p"],[[-1,226405],1],[[-1,227804],"'"],[[-1,227799],"[\\,\n    \\mathsf{queue} "],[[-1,227221],"\\,"],[[-1,227776],"\\mapsto"],[[-1,227219],"\\,"],[[-1,227769]," "],[[-1,191723],"A_p'("],[[-1,225780],"\\math"],[[-1,191725],"sf"],[[-1,225771],2],[[-1,225769],"{"],[[-1,225775],2],[[-1,225781],"q"],[[-1,225768],"ueue}"],[[-1,191718],") \\,\\cup\\, \\{\\mathit{op}\\}"],[[-1,227768],3],[[-1,226404],1],[[-1,227765],18],[[-1,227650],1],[[-1,227206],1],[[-1,227649],1],[[-1,227747],4],[[-1,227648],1],[[-1,227208],1],[[-1,227647],1],[[-1,227743],7],[[-1,226403],1],[[-1,227736],31],[[-1,227705],",\\"],[[-1,227701],";\n    \\mathsf{ops} "],[[-1,227217],"\\,"],[[-1,227682],"\\mapsto"],[[-1,227215],"\\,"],[[-1,227675]," "],[[-1,227674],1],[[-1,227673],"A_p"],[[-1,226402],1],[[-1,227670],"'(\\mathsf{ops}) "],[[-1,227269],"\\"],[[-1,227210],","],[[-1,227268],1],[[-1,227654],"\\cup"],[[-1,227267],"\\"],[[-1,227212],","],[[-1,227266],1],[[-1,227646]," \\{\\mathit{op"],[[-1,191730],".id"],[[-1,227633],"}"],[[-1,191754],12],[[-1,227632],"\\}\\,]$}\n\\end{prooftree}"],[[-1,227703],1],[[-1,227803],2],[[-1,230019],1],[[-1,229302],12],[[-1,229165],9],[[-1,229149],2],[[-1,229156],4],[[-1,229288],2],[[-1,229256],23],[[-1,229226],1],[[-1,229233],6],[[-1,229225],60],[[-1,229286],30],[[-1,229290],1],[[-1,229899],14],[[-1,229865],"\n\n\\begin{prooftree}"],[[-1,229830],"\n\\AxiomC{$"],[[-1,229820],6],[[-1,229808],10],[[-1,229798],"\\mathit{"],[[-1,229786],"op}"],[[-1,229783],1],[[-1,229782]," \\in A_p(\\mathsf{recv})$}"],[[-1,191572],"\n\\AxiomC{$\\mathit{op.id} \\not"],[[-1,191543],1],[[-1,191542],"in "],[[-1,191538],"A_p"],[[-1,191533],"(\\mathsf{ops})$}"],[[-1,191535],1],[[-1,229757],"\n\\AxiomC{$"],[[-1,229745],"\\mathit{"],[[-1,191575],"op."],[[-1,229737],"deps} \\subseteq A_p(\\mathsf{ops})$}\n\\AxiomC{$A_p,"],[[-1,229505],"\\"],[[-1,224584],","],[[-1,229504],1],[[-1,229688]," \\mathit{op} \\evalto A_p'$}\n\\LeftLabel{\\textsc{Apply"],[[-1,228154],"-Remote"],[[-1,228268],2],[[-1,229636],"}}\n\\"],[[-1,191514],"Quater"],[[-1,229632],1],[[-1,229619],2],[[-1,229617],"naryInfC{$A_p,\\"],[[-1,224586],","],[[-1,229602],1],[[-1,229601]," \\mathsf{yield} \\evalto"],[[-1,227257],"\n   "],[[-1,229578]," A_p'[\\,\\mathsf{ops} "],[[-1,227201],"\\,"],[[-1,229557],"\\mapsto"],[[-1,227199],"\\,"],[[-1,229550]," A_p'(\\mathsf{ops}) "],[[-1,227261],"\\"],[[-1,227204],","],[[-1,227260],1],[[-1,227265],2],[[-1,229530],"\\cup"],[[-1,227259],"\\"],[[-1,227202],","],[[-1,227258],1],[[-1,229526]," \\{"],[[-1,229514],"\\mathit{"],[[-1,229523],"op"],[[-1,191508],".id"],[[-1,229506],"}"],[[-1,229521],"\\}\\,]$}"],[[-1,229631],6],[[-1,229747],1],[[-1,229790],2],[[-1,229814],3],[[-1,229846],"\n\\end{prooftree}"],[[-1,191504],"\n\n\\begin{prooftree}\n\\AxiomC{}\n\\LeftLabel{\\textsc{Send}}\n\\UnaryInfC{$A_p,\\, \\mathsf{yield} \\evalto\n    A_p[\\,\\mathsf{send} \\,\\mapsto\\, A_p(\\mathsf{send}) \\,\\cup\\, "],[[-1,191340],"A_p(\\mathsf{queue})\\,]$}\n\\end{prooftree}\n\n\\begin{prooftree}\n\\AxiomC{$"],[[-1,191265],"q: \\mathrm{"],[[-1,105332],"Replica"],[[-1,191254],4],[[-1,191250],"ID}$}\n\\LeftLabel{\\textsc{Recv}}\n\\UnaryInfC{$A_p,\\, \\mathsf{yield} \\evalto\n    A_p[\\,\\mathsf{recv} \\,\\mapsto\\, A_p(\\mathsf{recv}) \\,\\cup\\, A_q(\\mathsf{send})\\,]$}\n\\"],[[-1,191077],"end{prooftree}"],[[-1,190594],"\n\n\\begin{prooftree}\n\\AxiomC{$A_p,\\, \\mathsf{yield} \\evalto A_p'$}\n\\AxiomC{$A_p"],[[-1,190511],"'"],[[-1,190516],",\\, \\"],[[-1,190510],"mathsf{yield} \\evalto A_p''$}\n\\LeftLabel{\\textsc{Yield}}\n\\BinaryInfC{$A_p,\\, \\mathsf{yield} \\evalto A_p''$}\n\\end{prooftree}"],[[-1,191087],5],[[-1,191271],3],[[-1,191342],1],[[-1,228323],19],[[-1,228227],45],[[-1,228179],1],[[-1,228182],3],[[-1,228178],10],[[-1,228165],11],[[-1,228147],22],[[-1,228288],2],[[-1,228166],1],[[-1,228286],18],[[-1,228264],26],[[-1,228230],3],[[-1,228125],28],[[-1,228095],136],[[-1,228097],1],[[-1,228238],4],[[-1,228304],16],[[-1,229503],"\n\\caption{Rules for "],[[-1,190608],"generating"],[[-1,229471],18],[[-1,229453],", send"],[[-1,229441],"ing"],[[-1,225732],","],[[-1,229438],4],[[-1,229434]," "],[[-1,190598],"and "],[[-1,229433],"receiving"],[[-1,225731],14],[[-1,229424]," operations"],[[-1,105006],"."],[[-1,229413],"}\n\\label{fig:send-recv}\n\\end{figure*}"],[[-1,193487],"\n\nThe "],[[-1,193481],7],[[-1,193474],"evaluation rules for commands are given in Figure~\\ref{fig:send-recv}."],[[-1,190387]," The \\textsc{"],[[-1,166787],"Make-"],[[-1,190374],"Assign}, \\textsc{"],[[-1,166782],"Make-"],[[-1,190357],"Insert} and \\textsc{"],[[-1,166777],"Make-"],[[-1,190337],"Delete} rules "],[[-1,190313],"define how these respective commands mutate the document: all three delegate "],[[-1,190228],"to the \\textsc{Make-Op} rule "],[[-1,190181],"to"],[[-1,190199],3],[[-1,190196]," generat"],[[-1,190175],"e and apply the operation. \\textsc{Make-Op} "],[[-1,190107],"generates a new Lamport timestamp by choosing a counter value that is 1 greater than any existing counter in $A_p(\\mathsf{ops})$"],[[-1,189974],","],[[-1,189979]," the "],[[-1,189973],"set of all operation IDs that have been applied to "],[[-1,104785],"replica $p$"],[[-1,189922],12],[[-1,189910],".\n\n\\textsc{Make-Op} constructs an \\textsf{op"],[[-1,189864],"()"],[[-1,189866],"} "],[[-1,189862],"tuple of the form described above, and delegates to the \\textsc{Apply-Local} rule to process the operation. \\textsc{Apply-Local} does three things: it evaluates the operation to produce a modified local state $A_p'$, it adds the operation to the queue of "],[[-1,189599],"generated operations $A_p(\\mathsf{queue})$, and it adds "],[[-1,1573],"the"],[[-1,1579],3],[[-1,189543],13],[[-1,189530]," ID to the set of processed operations $A_p(\\mathsf{ops})$.\n"],[[-1,107151],"\nThe \\textsf{yield} command, inspired by Burckhardt et al.~\\cite{Burckhardt:2012jy}, performs network communication: sending and receiving operations to and from other "],[[-1,105320],"replic"],[[-1,105312],"as"],[[-1,105314],1],[[-1,106983],5],[[-1,106978],", and applying operations from remote "],[[-1,106940],3],[[-1,106937],"r"],[[-1,105307],"eplica"],[[-1,106936],"s."],[[-1,106933]," "],[[-1,189470],1],[[-1,189469],"The "],[[-1,189465],10],[[-1,189455],"rules "],[[-1,189449],29],[[-1,189418],2],[[-1,189416],"\\textsc{Apply-Remote}, \\textsc{Send}, \\textsc{Recv} and \\textsc{Yield} define the semantics of "],[[-1,189321],4],[[-1,189317],"\\textsf{yield}"],[[-1,189303],8],[[-1,189295],". "],[[-1,189265],"Since any of these rules can be used to evaluate \\textsf{yield}, the"],[[-1,79088],"ir effect"],[[-1,189197],10],[[-1,189187]," is nondeterministic, which models the asynchronicity of "],[[-1,189128],"the network"],[[-1,189117],13],[[-1,105298],6],[[-1,189104],1],[[-1,189103],": a "],[[-1,189092],"m"],[[-1,189099],1],[[-1,189098],"essag"],[[-1,189091],"e sent by one "],[[-1,189077],3],[[-1,189074],"r"],[[-1,105289],"eplica"],[[-1,189073]," arrives at another "],[[-1,189053],3],[[-1,189050],"r"],[[-1,105280],"eplica"],[[-1,189049]," "],[[-1,189028],"at some arbitrarily later point in time"],[[-1,188988],", and there is no "],[[-1,188937],"mes"],[[-1,48],"s"],[[-1,188934],"age "],[[-1,188970],"ordering guarantee in the network"],[[-1,188989],"."],[[-1,188930],"\n\n"],[[-1,188914],"The "],[[-1,188928],"\\textsc{Send} "],[[-1,188910],"rule takes any operations that were placed in"],[[-1,188859]," $A_p(\\mathsf{queue})$ by \\textsc{Apply-Local} and adds them to a send buffer $A_p(\\mathsf{send})$. Correspondingly, the \\textsc{Recv} rule takes operations in the send buffer of "],[[-1,188680],3],[[-1,188677],"r"],[[-1,105271],"eplica"],[[-1,188676]," $q$ and adds them to the receive buffer "],[[-1,188633],"$A_p(\\"],[[-1,188435],"math"],[[-1,188627],4],[[-1,188623],"sf{recv})$ of "],[[-1,188609],3],[[-1,188606],"r"],[[-1,105262],"eplica"],[[-1,188605]," $p$. This is the only rule that involves more than one "],[[-1,188549],3],[[-1,188546],"r"],[[-1,105253],"eplica"],[[-1,188545],", and it models all network communication.\n\nOnce an operation "],[[-1,188481],"appears in the receive buffer $A_p(\\"],[[-1,188427],"math"],[[-1,188423],1],[[-1,188445],4],[[-1,188441],"sf"],[[-1,188421],"{recv})$, the rule \\textsc{Apply-Remote} may apply. Under the precondition"],[[-1,188297],"s"],[[-1,188347]," that the operation has not already been processed"],[[-1,188296]," and that its causal dependencies "],[[-1,188256],"are satis"],[[-1,188247],1],[[-1,188246],"fied, \\textsc{Apply-Remote} "],[[-1,1510],"applies"],[[-1,188218],9],[[-1,188209]," the operation in the same "],[[-1,188180],"way as \\textsc{Apply-Local}, and adds "],[[-1,1557],"its"],[[-1,188142],3],[[-1,188139]," "],[[-1,188138],10],[[-1,188128],"ID to the set of processed operations $A_p(\\mathsf{ops})$.\n\nThe actual document modifications are performed by "],[[-1,1527],"applying"],[[-1,188017],8],[[-1,188003],2],[[-1,188001]," the operations, which we discuss "],[[-1,35012],"next"],[[-1,187967],9],[[-1,187948],1],[[-1,187958],9],[[-1,187949],"."],[[-1,187947],"\n\n\\subsection{Applying "],[[-1,7423],"O"],[[-1,7426],1],[[-1,187924],1],[[-1,187923],"perations}"],[[-1,187907],"\n\n"],[[-1,187905],8],[[-1,187897],"\\begin{"],[[-1,175063],"sideways"],[[-1,187890],"figure"],[[-1,174919],"*"],[[-1,187884],1],[[-1,187883],"}"],[[-1,187754],"\n\\begin{prooftree}"],[[-1,187720],"\n\\AxiomC{$"],[[-1,187708],21],[[-1,187687],"\\mathit{ctx}"],[[-1,177499],",\\, k_1 "],[[-1,177489],"\\evalto \\mathit{child}"],[[-1,177491],1],[[-1,187675],1],[[-1,187674],"$}\n\\AxiomC{$"],[[-1,177456],19],[[-1,187662],"\\mathit{c"],[[-1,177460],"hild"],[[-1,187653],2],[[-1,187651],"}"],[[-1,187650],5],[[-1,187645],",\\, \\mathsf{op}(\\mathit{id}, \\mathit{deps},"],[[-1,177437],3],[[-1,187600],"\n    \\mathsf{cursor}(\\langle k_2, \\dots, k_{n-1} \\rangle,\\, k_n), \\mathit{mut}) "],[[-1,177405],7],[[-1,187520],"\\evalto \\mathit{"],[[-1,177429],"child"],[[-1,187504],5],[[-1,187499],"}"],[[-1,177424],"'"],[[-1,174671],"$}"],[[-1,177423],18],[[-1,187498],2],[[-1,177391],"\n\\AxiomC{$\\mathit{ctx},\\, \\mathsf{addId}(k_1, \\mathit{id}"],[[-1,55866],", \\mathit{mut}"],[[-1,177334],") \\evalto \\mathit{ctx}'$}"],[[-1,187496],"\n\\LeftLabel{\\textsc{Descend}}\n\\"],[[-1,177308],"Tr"],[[-1,187465],1],[[-1,187464],"inaryInfC{$"],[[-1,187451],"\\mathit{ctx},\\, \\mathsf{op}(\\mathit{id}, \\mathit{deps},\n    \\mathsf{cursor}(\\langle k_1, k_2, \\dots, k_{n-1} \\rangle,\\, k_n), \\mathit{mut}) \\evalto\n    \\mathit{ctx}"],[[-1,177306],"'"],[[-1,177294]," "],[[-1,187287],"[\\, k_1 "],[[-1,187252],"\\"],[[-1,187253],","],[[-1,187279],"\\mapsto"],[[-1,187251],"\\,"],[[-1,187272]," \\mathit{"],[[-1,177300],"child"],[[-1,187263],5],[[-1,187258],"}"],[[-1,177295],"'"],[[-1,187257]," \\,]"],[[-1,187453],"$}"],[[-1,187602],1],[[-1,187710],1],[[-1,187736],"\n\\end{prooftree}"],[[-1,104774],"\\vspace{6pt}"],[[-1,187249],"\n\n"],[[-1,177293],"\\begin{center}"],[[-1,177266],"\n\\AxiomC{$k \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\LeftLabel{"],[[-1,177204],1],[[-1,177203],"\\textsc{Child"],[[-1,176536],"-Get"],[[-1,177190],"}"],[[-1,177189],3],[[-1,177186],"}\n\\UnaryInfC{$\\mathit{ctx},\\, "],[[-1,177154],"k \\evalto \\mathit{ctx}(k)$}\n\\DisplayProof\\h"],[[-1,177103],"space{3em}\n%\n\\AxiomC{$\\mathsf{mapT}(k) \\notin \\math"],[[-1,177050],"rm{dom}(\\mathit{ctx})$}\n\\LeftLabel{"],[[-1,177015],1],[[-1,177014],"\\textsc{Child"],[[-1,176529],"-Map"],[[-1,176999],"}"],[[-1,176998],3],[[-1,176995],"}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{mapT}(k) "],[[-1,176946],"\\evalto \\{\\}$}\n\\DisplayProof\\"],[[-1,172702],"hspace{3em}"],[[-1,174567],28],[[-1,174634],11],[[-1,176917],13],[[-1,176898],2],[[-1,176904],3],[[-1,176948],1],[[-1,177001],1],[[-1,177052],1],[[-1,177111],4],[[-1,177156],1],[[-1,177210],3],[[-1,177279],13],[[-1,176896],"\n"],[[-1,172731],"%"],[[-1,174610],1],[[-1,176895],1],[[-1,174593],14],[[-1,174594],"\n"],[[-1,176894],15],[[-1,176879],"\\AxiomC{$"],[[-1,176633],"\\mathsf{listT}("],[[-1,176870],"k"],[[-1,176618],")"],[[-1,176869]," \\notin \\mathrm{dom}(\\mathit{ctx})$}\n\\LeftLabel{"],[[-1,176821],1],[[-1,176820],"\\textsc{Child"],[[-1,176523],"-List"],[[-1,176807],"}"],[[-1,176806],3],[[-1,176803],"}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{listT}(k) \\evalto"],[[-1,176702],"\n   "],[[-1,176748]," \\{\\,\\mathsf{next}(\\mathsf{head}) "],[[-1,176706],"\\,"],[[-1,176714],"\\mapsto"],[[-1,176704],"\\,"],[[-1,176707]," "],[[-1,176698],"\\mathsf{tail} \\,\\}$}\n\\DisplayProof\\"],[[-1,172680],"proofSkipAmount\n\\end{center}"],[[-1,104762],"\\vspace{6pt}"],[[-1,172652],"\n"],[[-1,176663],11],[[-1,176652],"\n"],[[-1,172650],"\\begin{center}"],[[-1,176651],1],[[-1,176617],"\n\\AxiomC{$\\mathsf{regT}(k) \\notin \\mathrm{dom}(\\mathit{ctx})$}\n\\LeftLabel{"],[[-1,176514],"\\textsc{Child-Reg}}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{regT}(k) \\evalto \\{\\}$}\n\\DisplayProof\\"],[[-1,172617],"hspace{3em}\n%\n"],[[-1,172545],"\\"],[[-1,172603],"AxiomC{$\\mathsf{pres}(k) \\in \\mathrm{dom}(\\mathit{ctx})$}\n"],[[-1,172544],"\\LeftLabel{"],[[-1,172517],"$"],[[-1,172533],"\\textsc{Presence"],[[-1,172514],"}_1$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{pres}(k) \\evalto \\mathit{ctx}(\\mathsf{pres}(k))$}\n\\DisplayProof\\hspace{3em}\n%\n\\AxiomC{$\\mathsf{pres}(k) \\notin \\mathrm{dom}(\\mathit{ctx})$}\n\\LeftLabel{$\\textsc{Presence}_2$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{pres}(k) \\evalto "],[[-1,172241],"\\{\\}$}\n\\DisplayProof\\proofSkipAmount"],[[-1,172245],2],[[-1,172516],1],[[-1,176420],15],[[-1,176541],1],[[-1,176543],1],[[-1,176648],"\n\\"],[[-1,176392],"end{center}"],[[-1,104750],"\\vspace{6pt}"],[[-1,176381],"\n\n\\begin{"],[[-1,55843],"center"],[[-1,172199],9],[[-1,174530],6],[[-1,176372],9],[[-1,176363],"}"],[[-1,55772],"\n\\AxiomC{$\\mathit{mut} \\not= \\mathsf{delete}$}"],[[-1,176346],"\n\\AxiomC{$k_\\mathit{tag} \\in \\{\\mathsf{mapT}(k), \\mathsf{listT}(k), \\mathsf"],[[-1,176269],"{regT}(k)\\}$}\n\\AxiomC{$"],[[-1,172175],"\\mathit{ctx},\\, "],[[-1,176246],"\\mathsf{pres}(k) \\"],[[-1,172154],"evalto"],[[-1,176228],5],[[-1,176223]," \\math"],[[-1,172146],"it"],[[-1,176217],2],[[-1,176215],"{"],[[-1,172141],"pres"],[[-1,176214],3],[[-1,176211],"}"],[[-1,176208],14],[[-1,176194],"$}\n\\LeftLabel{"],[[-1,55683],"$"],[[-1,176180],1],[[-1,176179],"\\textsc{Add-ID"],[[-1,176163],"}"],[[-1,55682],"_1$"],[[-1,176162],3],[[-1,176159],"}"],[[-1,176158],152],[[-1,176165],1],[[-1,176210],1],[[-1,176271],1],[[-1,176362],2],[[-1,174510],14],[[-1,174412],4],[[-1,174496],10],[[-1,176360],14],[[-1,176006],1],[[-1,174486],1],[[-1,176005],18],[[-1,175971],31],[[-1,175938],113],[[-1,175823],35],[[-1,175788],"\n\\"],[[-1,55774],"Tr"],[[-1,175786],1],[[-1,175785],"inaryInfC{$\\mathit{ctx"],[[-1,175761],"},\\, \\math"],[[-1,175749],"sf{addId}(k_\\mathit{tag}, \\mathit{id}"],[[-1,55789],", \\mathit{mut}"],[[-1,175712],") \\evalto\n    \\mathit{ctx}[\\, \\mathsf{pres}(k) \\,\\mapsto\\, "],[[-1,175653],13],[[-1,175640],"\\math"],[[-1,171730],"it"],[[-1,175635],2],[[-1,175633],"{pres}"],[[-1,175627],4],[[-1,175623]," "],[[-1,175596],"\\,"],[[-1,175622],"\\cup"],[[-1,175594],"\\,"],[[-1,175618]," \\{\\mathit{id}\\} \\,]$}"],[[-1,55822],"\n\\Displa"],[[-1,55810],"yProof\\hspace{3em}\n%\n"],[[-1,55726],"\\AxiomC{$\\mathit{mut} = \\mathsf{delete}$}\n\\"],[[-1,55679],"LeftLabel{$\\"],[[-1,55659],"textsc{Add-ID}_2$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{addId}(k_\\mathit{tag}, \\mathit{id}, \\mathit{mut}) \\evalto \\mathit{ctx}$}\n\\DisplayProof\\proofSkipAmount"],[[-1,55667],4],[[-1,55814],2],[[-1,174452],30],[[-1,175751],1],[[-1,175763],1],[[-1,175825],1],[[-1,175940],1],[[-1,175987],"\n\\end{"],[[-1,55828],"center"],[[-1,172184],9],[[-1,174458],6],[[-1,175981],9],[[-1,175972],"}"],[[-1,104738],"\\vspace{6pt}"],[[-1,176646],13],[[-1,176650],1],[[-1,187247],17],[[-1,187214],98],[[-1,187110],27],[[-1,186698],1],[[-1,187083],197],[[-1,186884],35],[[-1,186840],2],[[-1,186849],9],[[-1,186838],114],[[-1,186722],23],[[-1,186724],1],[[-1,186886],1],[[-1,187116],3],[[-1,187230],16],[[-1,186697],"\n\n"],[[-1,178061],"\\b"],[[-1,186695],124],[[-1,186095],19],[[-1,186571],2],[[-1,186561],93],[[-1,186076],3],[[-1,186468],102],[[-1,186073],18],[[-1,186366],147],[[-1,186218],82],[[-1,186134],39],[[-1,186136],1],[[-1,186569],4],[[-1,187868],1],[[-1,184516],3],[[-1,184513],"egin{prooftree}"],[[-1,184482],"\n\\AxiomC{$\\mathit{val} \\not= \\texttt{[]} \\,\\wedge\\, \\mathit{val} \\not= \\texttt{\\string"],[[-1,184394],"{\\string}}"],[[-1,184382],"$}\n\\AxiomC{$"],[[-1,184370],34],[[-1,184336],"\\mathit{ctx}"],[[-1,175553],",\\, \\mathsf{clear}(\\mathit{deps}, \\mathsf{regT}(k)) \\evalto \\mathit{ctx}',\\, \\mathit{pres}"],[[-1,175557],2],[[-1,184324],1],[[-1,184323],"$}\n\\"],[[-1,184317],"AxiomC{$"],[[-1,175250],"\\mathit{ctx}',"],[[-1,174016],"\\,"],[[-1,175236]," \\mathsf{addId}(\\mathsf{regT}(k), \\mathit{id}"],[[-1,55502],", \\mathsf{assign}(\\mathit{val})"],[[-1,175191],")"],[[-1,55471],"\n   "],[[-1,175190]," \\evalto \\mathit{ctx}''"],[[-1,184242],19],[[-1,184309],12],[[-1,183758],6],[[-1,184297],4],[[-1,184289],25],[[-1,184250],8],[[-1,183752],4],[[-1,184223],71],[[-1,184145],2],[[-1,184152],6],[[-1,184142],58],[[-1,184084],"$}"],[[-1,175167],"\n\\AxiomC{$\\mathit{ctx}'',"],[[-1,174018],"\\,"],[[-1,175142]," \\mathsf{regT}(k) \\evalto \\mathit{child}$}"],[[-1,184082],"\n\\LeftLabel{"],[[-1,174408],1],[[-1,184070],1],[[-1,184069],"\\"],[[-1,184058],"te"],[[-1,184048],"xt"],[[-1,184056],2],[[-1,184054],"sc{A"],[[-1,184046],"ssign}"],[[-1,174407],3],[[-1,184040],3],[[-1,184037],"}\n\\"],[[-1,175078],"Quater"],[[-1,184034],3],[[-1,184031],"naryInfC{$\\mathit{ctx},\\, \\mathsf{op}(\\mathit{id}, \\mathit"],[[-1,183971],"{"],[[-1,183962],"deps},\n    \\mathsf{cursor}(\\langle"],[[-1,183926],"\\rangle,\\, k), \\mathsf{assign}(\\mathit{val})"],[[-1,183046],")"],[[-1,183882]," \\evalto\n    \\math"],[[-1,180867],"it"],[[-1,183864],2],[[-1,183862],"{ctx}"],[[-1,175096],"''"],[[-1,183857],"[\\, \\mathsf{regT}(k) \\,"],[[-1,183832],"\\mapsto\\,"],[[-1,183748],"\n   "],[[-1,183823]," \\mathit{c"],[[-1,175085],"hild"],[[-1,183813],3],[[-1,183744],6],[[-1,183810],"}[\\, \\mathit{id} \\,\\mapsto\\, \\mathit{val} \\,]\\,]$}"],[[-1,183834],1],[[-1,183928],1],[[-1,183970],4],[[-1,183973],1],[[-1,184068],5],[[-1,184146],1],[[-1,184264],7],[[-1,184293],2],[[-1,184319],1],[[-1,184384],1],[[-1,184396],1],[[-1,184498],"\n\\end{prooftree}"],[[-1,104726],"\\vspace{6pt}"],[[-1,183738],"\n\n\\begin{prooftree}"],[[-1,183703],"\n\\AxiomC{$"],[[-1,183693],42],[[-1,183651],"\\mathit{val} "],[[-1,183638],4],[[-1,183634],"= \\texttt{\\string{\\string}}$}\n\\AxiomC{$"],[[-1,183595],37],[[-1,183558],"\\mathit{ctx}"],[[-1,174134],",\\, \\mathsf{clearElem}(\\mathit{deps},"],[[-1,174087]," k) \\evalto \\mathit{ctx}',\\, \\mathit{pres}"],[[-1,174097],5],[[-1,183546],1],[[-1,183545],"$}"],[[-1,174045],"\n\\AxiomC{$\\mathit{ctx}',\\, "],[[-1,174014],"\\mathsf{addId}(\\mathsf{"],[[-1,173985],"mapT}(k), \\mathit{id}"],[[-1,55467],", \\mathsf{assign}(\\mathit{val})"],[[-1,173964],")"],[[-1,55436],"\n   "],[[-1,173963]," \\evalto \\mathit{ctx}''$}\n\\AxiomC{$\\mathit{ctx}'',\\, \\mathsf{mapT}(k) \\"],[[-1,173888],"evalto \\mathit{child}$}"],[[-1,173892],2],[[-1,173991],3],[[-1,183543],"\n\\LeftLabel{"],[[-1,183531],1],[[-1,183530],"\\textsc{"],[[-1,174354],"Empty-Map"],[[-1,183522],6],[[-1,183516],"}"],[[-1,183515],3],[[-1,183512],"}\n\\"],[[-1,173863],"Quater"],[[-1,183509],2],[[-1,183507],"naryInfC{$\\mathit{ctx},\\, \\mathsf{op}"],[[-1,183468],"(\\mathit{id}, \\mathit{deps},\n    \\mathsf{cursor}(\\langle\\rangle,\\, k), \\mathsf{assign}("],[[-1,174371],"\\"],[[-1,174184],1],[[-1,174183],"mathit{val"],[[-1,174370],7],[[-1,174388],16],[[-1,174372],"}"],[[-1,183381],12],[[-1,183047],")"],[[-1,183369],") \\evalto\n    \\math"],[[-1,180871],"it"],[[-1,183350],2],[[-1,183348],"{ctx}"],[[-1,174255],"''"],[[-1,183343],"[\\, \\mathsf{"],[[-1,174277],"mapT"],[[-1,183331],4],[[-1,183327],"}(k) \\,\\ma"],[[-1,174288],"psto\\, "],[[-1,174273],"\\mathit{child} \\,]"],[[-1,183317],56],[[-1,183261],"$}"],[[-1,183470],1],[[-1,183719],"\n\\end{prooftree}"],[[-1,104714],"\\vspace{6pt}"],[[-1,173857],"\n\n"],[[-1,173783],"\\begin{prooftree}"],[[-1,173750],"\n\\AxiomC{$\\mathit{val} = \\texttt{[]}$}\n\\AxiomC{$\\mathit{ctx},\\, \\mathsf{clearElem}(\\mathit{deps}, k) \\evalto \\mathit{ctx}',\\, \\mathit{pres}$}\n\\"],[[-1,173605],"AxiomC{$\\mathit{ctx}',\\, \\mathsf{addId}(\\mathsf{listT}(k), \\mathit{id}"],[[-1,55432],", \\mathsf{assign}(\\mathit{val})"],[[-1,173535],")"],[[-1,55401],"\n   "],[[-1,173534]," \\evalto \\mathit{ctx}''$}\n\\AxiomC{$\\mathit{ctx}'',\\, \\mathsf{listT}(k) \\evalto \\mathit{child}$}\n\\LeftLabel{\\textsc{Empty-List}}\n\\QuaternaryInfC{$\\mathit{ctx},\\, \\mathsf{op}(\\mathit{id}, \\mathit{deps},\n    \\mathsf{cursor}(\\langle\\rangle,\\, k), \\mathsf{assign}(\\mathit{val})) \\evalto\n    \\mathit{ctx}''[\\, \\mathsf{listT}(k) \\,\\mapsto"],[[-1,173201],"\\, \\mathit{child} \\,]$}"],[[-1,173203],1],[[-1,173607],1],[[-1,173766],"\n\\end{prooftree}"],[[-1,104702],"\\vspace{6pt}"],[[-1,173855],8],[[-1,173812],1],[[-1,173847],13],[[-1,173820],7],[[-1,173834],7],[[-1,187867],26],[[-1,187831],45],[[-1,187780],26],[[-1,187786],3],[[-1,187841],5],[[-1,187882],14],[[-1,187913],3],[[-1,188009],3],[[-1,188182],1],[[-1,188262],3],[[-1,188483],1],[[-1,188635],1],[[-1,188865],3],[[-1,189038],5],[[-1,189048],5],[[-1,189130],1],[[-1,189293],2],[[-1,189283],8],[[-1,189291],4],[[-1,189420],1],[[-1,189607],4],[[-1,190131],12],[[-1,190188],4],[[-1,190236],4],[[-1,190323],5],[[-1,229447],3],[[-1,229483],6],[[-1,230018],12],[[-1,230329],1],[[-1,230212],15],[[-1,230304],14],[[-1,230328],12],[[-1,230403],1],[[-1,230419],1],[[-1,230556],24],[[-1,231365],14],[[-1,231351],"\n"],[[-1,229376],"\n"],[[-1,229375],15],[[-1,225717],18],[[-1,225682],9],[[-1,225622],1],[[-1,225673],5],[[-1,224591],2],[[-1,225668],30],[[-1,224588],1],[[-1,225638],16],[[-1,225621],15],[[-1,224593],1],[[-1,225606],25],[[-1,225574],1],[[-1,225581],6],[[-1,225573],35],[[-1,225534],47],[[-1,224595],1],[[-1,225487],10],[[-1,225475],8],[[-1,225463],15],[[-1,225446],1],[[-1,224597],1],[[-1,225445],15],[[-1,225448],1],[[-1,225467],2],[[-1,225477],1],[[-1,225538],2],[[-1,225699],17],[[-1,229147],18],[[-1,228958],10],[[-1,228946],37],[[-1,228948],1],[[-1,229080],10],[[-1,229068],4],[[-1,229062],1],[[-1,224601],1],[[-1,229061],1],[[-1,229046],1],[[-1,229060],14],[[-1,229045],15],[[-1,224599],1],[[-1,229030],8],[[-1,229016],1],[[-1,229022],5],[[-1,229064],1],[[-1,229070],2],[[-1,226362],16],[[-1,224603],1],[[-1,226346],31],[[-1,225748],2],[[-1,226315],49],[[-1,228890],10],[[-1,228866],11],[[-1,228741],55],[[-1,228684],6],[[-1,228676],31],[[-1,228678],2],[[-1,228686],1],[[-1,228880],7],[[-1,229110],28],[[-1,229015],2],[[-1,226365],3],[[-1,226856],2],[[-1,228642],6],[[-1,229013],18],[[-1,224605],1],[[-1,228995],16],[[-1,226380],3],[[-1,226390],5],[[-1,226396],3],[[-1,228979],20],[[-1,228909],3],[[-1,228959],1],[[-1,228906],8],[[-1,226266],8],[[-1,224607],1],[[-1,226258],15],[[-1,228854],5],[[-1,228898],5],[[-1,227196],53],[[-1,228893],1],[[-1,228849],8],[[-1,228837],3],[[-1,228610],5],[[-1,228834],30],[[-1,228599],5],[[-1,228804],16],[[-1,228770],12],[[-1,228752],10],[[-1,228758],3],[[-1,228772],1],[[-1,228788],11],[[-1,228742],1],[[-1,228777],2],[[-1,228636],20],[[-1,228378],26],[[-1,228346],23],[[-1,228352],3],[[-1,228775],3],[[-1,228841],2],[[-1,228892],2],[[-1,229082],1],[[-1,229129],6],[[-1,229121],10],[[-1,226766],19],[[-1,226731],64],[[-1,224611],1],[[-1,226667],31],[[-1,224609],1],[[-1,226636],15],[[-1,226179],16],[[-1,224613],1],[[-1,226163],31],[[-1,225746],2],[[-1,226132],48],[[-1,226621],13],[[-1,226603],1],[[-1,226608],4],[[-1,226602],13],[[-1,226181],2],[[-1,226589],17],[[-1,224617],1],[[-1,226572],15],[[-1,226371],4],[[-1,226557],32],[[-1,226084],6],[[-1,226009],1],[[-1,226016],1],[[-1,224615],1],[[-1,226015],6],[[-1,226078],2],[[-1,226525],60],[[-1,226747],16],[[-1,225430],19],[[-1,225363],46],[[-1,225315],13],[[-1,225291],5],[[-1,224619],1],[[-1,225286],14],[[-1,225302],11],[[-1,225272],16],[[-1,225317],1],[[-1,225395],32],[[-1,225256],14],[[-1,225240],5],[[-1,224621],1],[[-1,225235],38],[[-1,225193],4],[[-1,225197],4],[[-1,225189],16],[[-1,225166],2],[[-1,225173],7],[[-1,225164],42],[[-1,225242],2],[[-1,225411],16],[[-1,229111],1],[[-1,229123],1],[[-1,230726],7],[[-1,231477],1],[[-1,231464],9],[[-1,231476],6],[[-1,232328],1],[[-1,232327],"\\begin{prooftree}"],[[-1,231438],41],[[-1,231395],7],[[-1,230633],2],[[-1,231388],3],[[-1,231397],1],[[-1,232291],"\n"],[[-1,232290],4],[[-1,232286],"\\AxiomC{$"],[[-1,183207],"\\mathit{ctx}"],[[-1,232277],31],[[-1,230631],2],[[-1,232246],"("],[[-1,183195],"\\mathsf{next}("],[[-1,232245],"\\mathit{prev}"],[[-1,183181],")"],[[-1,232232],") = "],[[-1,231577],15],[[-1,232228],3],[[-1,230628],13],[[-1,232225],3],[[-1,232222],"\\mathit{next}"],[[-1,232209],1],[[-1,232208],"$}\n"],[[-1,232205],4],[[-1,232201],"\\AxiomC{$"],[[-1,225122],26],[[-1,232192],"\\mathit{next} < \\mathit{id}"],[[-1,225070]," "],[[-1,225035],"\\,"],[[-1,225069],"\\vee"],[[-1,225033],"\\,"],[[-1,225065]," \\mathit{next} = \\mathsf{tail}"],[[-1,232165],"$}"],[[-1,231145],"\n"],[[-1,231144],4],[[-1,231140],"\\AxiomC{$"],[[-1,183102],"\\mathit{ctx},\\, \\math"],[[-1,182715],"sf"],[[-1,183081],2],[[-1,183079],"{op}(\\mathit{id}, \\mathit{deps},"],[[-1,183045],"\n    \\mathsf{cursor}(\\langle\\rangle,\\, \\mathit{id}), \\mathsf{assign}(\\mathit{val})) \\evalto \\mathit{ctx}'"],[[-1,231131],1],[[-1,230615],2],[[-1,231130],1],[[-1,230755],1],[[-1,224623],1],[[-1,230754],1],[[-1,231129],35],[[-1,230611],2],[[-1,231094],1],[[-1,231093],"$}"],[[-1,232163],"\n"],[[-1,232162],4],[[-1,232158],"\\LeftLabel{"],[[-1,232146],"$"],[[-1,232147],"\\"],[[-1,231935],"text"],[[-1,232145],4],[[-1,232141],"sc{"],[[-1,231862],6],[[-1,232138],"Ins"],[[-1,182940],"ert"],[[-1,232135],"}_1$}\n"],[[-1,232129],4],[[-1,232125],"\\"],[[-1,182925],"Tri"],[[-1,231088],6],[[-1,231442],3],[[-1,231439],"n"],[[-1,232124],3],[[-1,232121],"aryInfC{$"],[[-1,182919],"\\mathit{ctx}"],[[-1,232112],1],[[-1,230613],2],[[-1,232111],","],[[-1,230753],"\\"],[[-1,224625],","],[[-1,230752],1],[[-1,232110]," \\mathsf{"],[[-1,182900],"o"],[[-1,232101],6],[[-1,225744],1],[[-1,225743],"p"],[[-1,232095],"}(\\mathit{id},"],[[-1,182899]," \\mathit{deps},\n    \\mathsf{cursor}(\\langle\\rangle,\\,"],[[-1,232081]," \\mathit{prev}"],[[-1,182846],")"],[[-1,232067],", "],[[-1,182844],"\\mathsf{insert}(\\mathit{val})"],[[-1,232065],1],[[-1,232064],") \\evalto"],[[-1,232053],"\n"],[[-1,232052],4],[[-1,232048],"    "],[[-1,182812],"\\mathit{ctx}"],[[-1,232029],1],[[-1,230609],2],[[-1,231082],"'"],[[-1,232028],"[\\,"],[[-1,182800],"\\mathsf{next}("],[[-1,232025],"\\mathit{prev}"],[[-1,182786],")"],[[-1,232012]," "],[[-1,226465],"\\,"],[[-1,232011],"\\mapsto"],[[-1,226463],"\\,"],[[-1,232004]," "],[[-1,231562],15],[[-1,232003],3],[[-1,230604],13],[[-1,230606],1],[[-1,232000],3],[[-1,231997],"\\mathit{id}"],[[-1,231986],1],[[-1,231985],",\\;"],[[-1,231546],"\n"],[[-1,231545],4],[[-1,231541],"    "],[[-1,182752],"\\mathsf{next}("],[[-1,231982],1],[[-1,231981],"\\mathit{id}"],[[-1,182738],")"],[[-1,231970]," "],[[-1,226461],"\\,"],[[-1,231969],"\\mapsto"],[[-1,226459],"\\,"],[[-1,231962]," "],[[-1,231537],15],[[-1,231961],4],[[-1,231957],"\\mathit{next}"],[[-1,231944],1],[[-1,231943],"\\,]"],[[-1,231923],"$"],[[-1,231940],"}"],[[-1,232055],1],[[-1,232310],"\n"],[[-1,232307],"\\end{prooftree}"],[[-1,104690],"\\vspace{6pt}"],[[-1,232292],1],[[-1,182712],41],[[-1,182671],"\n"],[[-1,232309],1],[[-1,233262],19],[[-1,233225],"\n"],[[-1,232502],"\\begin{prooftree}"],[[-1,232503],"\n"],[[-1,232461],4],[[-1,232457],"\\AxiomC{$"],[[-1,182667],"\\mathit{ctx}"],[[-1,182655],1],[[-1,233224],6],[[-1,232543],4],[[-1,233218],5],[[-1,233201],7],[[-1,233175],14],[[-1,233022],1],[[-1,233019],17],[[-1,232363],3],[[-1,232765],12],[[-1,233002],1],[[-1,232770],2],[[-1,233001],2],[[-1,230591],2],[[-1,232999],"("],[[-1,182653],"\\mathsf{next}("],[[-1,232998],"\\mathit{prev}"],[[-1,182639],")"],[[-1,232985],") = "],[[-1,182604],"\\"],[[-1,231522],15],[[-1,232981],3],[[-1,230588],13],[[-1,232978],4],[[-1,232972],"mathit{next}"],[[-1,232960],1],[[-1,232376],"$"],[[-1,232445],"}"],[[-1,232959],1],[[-1,232538],2],[[-1,232536],"\n"],[[-1,232535],4],[[-1,232958],2],[[-1,232444],"\\AxiomC{"],[[-1,232421],"$"],[[-1,232956],"\\mathit{id} < \\mathit{next}"],[[-1,232420],"$"],[[-1,232433],"}"],[[-1,232835],1],[[-1,232529],2],[[-1,232834],1],[[-1,232833],"\n"],[[-1,232832],4],[[-1,232432],"\\AxiomC{"],[[-1,232422],"$"],[[-1,182599],"ctx"],[[-1,232828],1],[[-1,230573],2],[[-1,232827],","],[[-1,230751],"\\"],[[-1,224627],","],[[-1,230750],1],[[-1,232826]," \\mathsf{"],[[-1,182589],"o"],[[-1,232817],6],[[-1,225742],1],[[-1,225741],"p"],[[-1,232811],"}(\\mathit{id},"],[[-1,182588]," \\mathit{deps},\n   "],[[-1,232797]," "],[[-1,182569],"\\mathsf{cursor}(\\langle\\rangle,\\, "],[[-1,232796],"\\mathit{next}"],[[-1,182535],")"],[[-1,232783],", "],[[-1,182534],"\\mathsf{"],[[-1,178699],"insert"],[[-1,182526],6],[[-1,182520],"}(\\mathit{"],[[-1,232781],"v"],[[-1,182510],"al})"],[[-1,232780],")"],[[-1,232749]," \\evalto"],[[-1,232779],4],[[-1,232775]," "],[[-1,182503],"\\mathit{ctx}"],[[-1,232774],1],[[-1,230575],2],[[-1,232773],"'"],[[-1,232423],"$"],[[-1,232424],"}"],[[-1,232360],"\n"],[[-1,232359],4],[[-1,232355],"\\LeftLabel{"],[[-1,232044],"$"],[[-1,232344],"\\"],[[-1,231927],"text"],[[-1,232039],4],[[-1,232343],4],[[-1,232339],"sc{"],[[-1,231856],6],[[-1,232336],"Ins"],[[-1,182491],"ert"],[[-1,232333],3],[[-1,232330],"}"],[[-1,232032],"_2$"],[[-1,232329],"}"],[[-1,232929],"\n"],[[-1,232417],4],[[-1,232413],"\\TrinaryInfC{"],[[-1,232395],"$"],[[-1,182479],"\\mathit{ctx}"],[[-1,232928],8],[[-1,230571],2],[[-1,232920],","],[[-1,230749],"\\"],[[-1,224629],","],[[-1,230748],1],[[-1,232919]," "],[[-1,232888],"\\mathsf{"],[[-1,182460],"o"],[[-1,232880],6],[[-1,225740],1],[[-1,225739],"p"],[[-1,232874],"}(\\mathit{id},"],[[-1,182459]," \\mathit{deps},\n   "],[[-1,232860]," "],[[-1,182440],"\\mathsf{cursor}(\\langle\\rangle,\\, "],[[-1,232859],"\\mathit{prev}"],[[-1,182406],")"],[[-1,232846],", "],[[-1,182405],"\\mathsf{insert}(\\mathit{"],[[-1,232844],"v"],[[-1,182381],"al}))"],[[-1,232843],1],[[-1,232737]," \\evalto"],[[-1,232842],4],[[-1,232838]," "],[[-1,182372],"\\mathit{ctx}"],[[-1,232837],1],[[-1,230569],2],[[-1,232836],"'"],[[-1,232394],"$}"],[[-1,232772],"\n"],[[-1,232391],"\\end{prooftree}"],[[-1,174838],"\n\\caption{Rules for "],[[-1,104995],"applying insertion and assignment"],[[-1,174818],10],[[-1,174808]," operations"],[[-1,104932]," to "],[[-1,104906],"update "],[[-1,104928],"the state of a replica"],[[-1,104933],"."],[[-1,174797],29],[[-1,174768],"}\\label{fig:operation-rules}\n\\end{sidewaysfigure*}"],[[-1,162527],"\n\nFigure~\\ref{fig:operation-rules} gives the rules that "],[[-1,1495],"apply"],[[-1,162471],8],[[-1,162463]," an operation $\\mathsf{op}$ "],[[-1,1484],"to"],[[-1,162435],6],[[-1,162429]," a context $\\mathit{ctx}$,"],[[-1,162403],4],[[-1,162399]," produc"],[[-1,1477],"ing"],[[-1,162392],1],[[-1,162391]," a"],[[-1,162379],"n updated context $\\mathit{ctx}'$."],[[-1,104678]," The context is initially the replica state"],[[-1,104633]," $A"],[[-1,104628],"_p$, but may refer to "],[[-1,104537],"subtrees"],[[-1,104606],11],[[-1,104595]," of the state as rules are recursively applied."],[[-1,104630],1],[[-1,104635],1],[[-1,162345]," These rules are used by \\textsc{Apply-Local} and \\textsc{Apply-Remote} to perform the state updates on a document.\n\nWhen the "],[[-1,162212],"operation"],[[-1,162203],2],[[-1,162201]," "],[[-1,162219],"cursor"],[[-1,1472],"'s vector of keys is non-empty,"],[[-1,162213]," "],[[-1,162200],52],[[-1,162146],16],[[-1,162130],"the \\textsc{Descend} rule first applies. It "],[[-1,162084],"recursively descends the document tree "],[[-1,1322],"by following the path described by the"],[[-1,1284],2],[[-1,1282]," keys"],[[-1,162045],51],[[-1,161994],". If the tree node already exists"],[[-1,161940]," in the local "],[[-1,161926],3],[[-1,161923],"r"],[[-1,105244],"eplica"],[[-1,161922]," state"],[[-1,161961],", \\textsc{Child-Get} "],[[-1,161916],"finds it, otherwise \\textsc{Child-Map} and \\textsc{Child-List} "],[[-1,161851],"create an empty map or list respectively."],[[-1,161808],"\n\n"],[[-1,161804],"The \\textsc{Descend} rule also invokes "],[[-1,55383],"$"],[[-1,161765],"\\textsc{Add"],[[-1,161752],"-ID}"],[[-1,55382],"_{1,2}$"],[[-1,161748]," at each tree node along the path described by the cursor, adding the operation ID to the presence set $\\mathsf{pres}(k)$ to indicate that the subtree includes "],[[-1,161582],"a mutation made by this operation.\n\nThe remaining rules in Figure~\\ref{fig:operation-rules} apply when the vector of keys in the cursor is empty, "],[[-1,1609],"which is the case"],[[-1,161436],4],[[-1,161432]," when descended to the context of the tree node to which the mutation applies. "],[[-1,161351],"The \\textsc{Assign}"],[[-1,161229]," rule handles assignment of a"],[[-1,104529]," primitive value to a"],[[-1,161200]," register,"],[[-1,161332],1],[[-1,161331]," \\textsc{Empty-Map}"],[[-1,161190]," handles assignment where the value is the empty map literal \\verb|{}|,"],[[-1,161312]," and \\textsc{Empty-List}"],[[-1,161288],6],[[-1,161282]," handle"],[[-1,161113],"s"],[[-1,161275]," "],[[-1,161274],18],[[-1,161254],2],[[-1,161246],7],[[-1,161239],"assign"],[[-1,161082],"ment of the empty list \\verb|[]|. These "],[[-1,161025],"three "],[[-1,161042],11],[[-1,161031],"rules "],[[-1,161008],"for \\textsf{assign} have a similar structure: first clearing the prior value at the cursor (as discussed in the next section), then adding the operation ID to the presence set, and finally incorporating the new value into the tree of local state."],[[-1,161233],3],[[-1,161252],3],[[-1,161256],1],[[-1,161353],1],[[-1,161588],3],[[-1,161754],1],[[-1,161806],1],[[-1,161810],1],[[-1,161853],1],[[-1,162086],1],[[-1,162148],1],[[-1,162389],5],[[-1,231850],"\n"],[[-1,160762],"\n"],[[-1,160760],"The $\\textsc{Insert}_{1,2}$ rules handle insertion of a new element into an ordered list. In this case, the cursor re"],[[-1,160641],"fers to the list element $\\mathit{prev}$, and the new element is inserted after that position in the list. "],[[-1,160526],"$\\textsc{Insert}_1$ performs the insertion by manipulating the linked list structure"],[[-1,160434],". $\\textsc{Insert}_2$ handles the case of multiple "],[[-1,105233],"replicas"],[[-1,160383],5],[[-1,160378]," concurrently inserting list elements at the same position, and "],[[-1,160234],"uses the ordering relation $<$ on Lamport timestamps to "],[[-1,160146],"consistently "],[[-1,160178],"determine the insertion point"],[[-1,160148],1],[[-1,160149],"."],[[-1,104508]," Our approach for handling insertions is based on the RGA algorithm~\\cite{Roh:2011dw}."],[[-1,160133]," We show later that these rules ensure all "],[[-1,160090],3],[[-1,160087],"r"],[[-1,105222],"eplica"],[[-1,160086],"s converge towards the same state."],[[-1,160314],30],[[-1,160282],9],[[-1,160284],1],[[-1,160442],4],[[-1,160534],4],[[-1,160643],1],[[-1,160761],"\n"],[[-1,160051],"\n\\subsubsection{Clearing "],[[-1,7421],"P"],[[-1,160026],1],[[-1,160025],"rior "],[[-1,7419],"S"],[[-1,160020],1],[[-1,160019],"tate}"],[[-1,160052],"\n"],[[-1,174718],"\n\\begin{figure*}"],[[-1,231849],"\n\\begin{prooftree}"],[[-1,231815],"\n"],[[-1,231814],4],[[-1,231810],"\\AxiomC{$"],[[-1,182287],30],[[-1,182255],5],[[-1,181993],13],[[-1,182257],1],[[-1,231801],1],[[-1,230567],2],[[-1,231800],1],[[-1,231799],"\\mathit{"],[[-1,182301],"ctx"],[[-1,231791],6],[[-1,231785],"}"],[[-1,173014],",\\, \\mathsf{clearElem}(\\mathit{deps}, k) \\evalto \\mathit{ctx}',"],[[-1,172949],"\\, \\mathit{pres}"],[[-1,172951],1],[[-1,173016],1],[[-1,181980],1],[[-1,182293],3],[[-1,231784],4],[[-1,231507],15],[[-1,231780],18],[[-1,231762],"$}"],[[-1,231078],15],[[-1,230565],2],[[-1,231063],1],[[-1,230747],1],[[-1,224631],1],[[-1,230746],1],[[-1,231062],35],[[-1,230563],2],[[-1,231027],3],[[-1,231760],"\n"],[[-1,231759],4],[[-1,231755],"\\LeftLabel{"],[[-1,231744],1],[[-1,231743],"\\textsc{"],[[-1,182313],2],[[-1,182309],2],[[-1,182311],1],[[-1,231735],6],[[-1,231729],"Del"],[[-1,173068],"ete"],[[-1,231726],"}"],[[-1,231722],"}\n"],[[-1,231720],4],[[-1,231716],"\\"],[[-1,181994],"U"],[[-1,231080],2],[[-1,231715],1],[[-1,231714],"naryInfC{$"],[[-1,182155],"\\mathit{ctx}"],[[-1,231704],1],[[-1,230561],2],[[-1,231703],","],[[-1,230745],"\\"],[[-1,224633],","],[[-1,230744],1],[[-1,231702]," \\"],[[-1,231696],"mathsf{"],[[-1,182135],"op"],[[-1,231689],6],[[-1,225738],2],[[-1,231683],"}(\\mathi"],[[-1,231673],"t{id}, "],[[-1,182133],"\\mathit{deps},\n    \\mathsf{cursor}(\\langle"],[[-1,173178],2],[[-1,182091],"\\rangle,\\, "],[[-1,173159],"k"],[[-1,231666],15],[[-1,231651],")"],[[-1,182080],", \\mathsf{"],[[-1,173151],"delete"],[[-1,182070],7],[[-1,182063],"})"],[[-1,231650]," \\evalto"],[[-1,173074]," "],[[-1,231640],9],[[-1,182057],"\\mathit{ctx}"],[[-1,173080],"'"],[[-1,231631],1],[[-1,230559],2],[[-1,231024],1],[[-1,231630],3],[[-1,182045],17],[[-1,231627],15],[[-1,182028],1],[[-1,231612],1],[[-1,226457],2],[[-1,231611],7],[[-1,226455],2],[[-1,231604],1],[[-1,231492],8],[[-1,182021],4],[[-1,231484],7],[[-1,231603],24],[[-1,231579],"$}"],[[-1,231642],1],[[-1,231675],1],[[-1,231700],2],[[-1,231725],1],[[-1,231831],"\n\\end{prooftree}"],[[-1,172933],"\n\n"],[[-1,172636],1],[[-1,172931],"\\begin{prooftree}"],[[-1,172898],"\n"],[[-1,172635],1],[[-1,172897],"\\AxiomC{$\\mathit{ctx},\\, \\mathsf{clearAny}(\\mathit{deps}, k) \\evalto \\mathit{ctx}', \\mathit{pres}"],[[-1,171666],"_"],[[-1,171368],"1"],[[-1,171665],14],[[-1,171668],1],[[-1,172800],"$}"],[[-1,171711],"\n\\AxiomC{$\\mathit{ctx}',\\, \\mathsf{pres}(k)"],[[-1,171651]," "],[[-1,171648],"\\evalto \\mathit{pres}_"],[[-1,171340],"2"],[[-1,171626],13],[[-1,171613],"$}"],[[-1,171650],1],[[-1,172798],"\n"],[[-1,172634],1],[[-1,172797],"\\AxiomC{$\\mathit{pres}"],[[-1,171307],"_3"],[[-1,171309],1],[[-1,172775],1],[[-1,172774]," = \\mathit{pres}"],[[-1,171611],"_"],[[-1,171311],"1"],[[-1,171610],14],[[-1,172758]," \\,\\cup\\, "],[[-1,171596],"\\mathit{pres}_"],[[-1,171326],"2"],[[-1,158861]," \\setminus \\mathit{deps}"],[[-1,171582],13],[[-1,172748],"$}"],[[-1,171569],"\n\\LeftLabel{\\textsc{Clear"],[[-1,171542],"-Elem}}\n\\TrinaryInfC{$\\mathit{ctx},\\, \\mathsf{clearElem}(\\mathit{deps}, k"],[[-1,171467],") \\evalto"],[[-1,171444],"\n   "],[[-1,171458]," \\mathit{ctx}'"],[[-1,171440]," [\\, \\mathsf{pres}(k) \\,\\mapsto\\, \\mathit{pres}"],[[-1,171304],"_3"],[[-1,171393],1],[[-1,171392]," \\,],\\, \\mathit{pres}"],[[-1,171301],"_3"],[[-1,171371],1],[[-1,171370],"$}"],[[-1,171469],1],[[-1,171544],1],[[-1,172914],"\n"],[[-1,172633],1],[[-1,172913],"\\end{prooftree}"],[[-1,171299],"\n\n\\begin{prooftree}"],[[-1,171264],"\n\\AxiomC{$\\begin{matrix}\n    \\mathit{ctx},\\, \\mathsf{clear}(\\mathit{deps}, \\mathsf{mapT}(k)) \\\\\n    \\evalto \\mathit{ctx"],[[-1,171143],"}_1,\\, \\mathit{pres}_1 \\end{matrix}$}\n\\AxiomC{$\\begin{matrix}\n    \\mathit{ctx}_1,\\, \\mathsf{clear}(\\mathit{deps}, \\mathsf{listT}(k)) \\\\\n    \\evalto \\mathit{ctx"],[[-1,170982],"}_2,\\, \\mathit{pres}_2 \\end{matrix}$}\n\\AxiomC{$\\begin{matrix}\n    \\mathit{ctx}_2,\\, \\mathsf{clear}(\\mathit{deps}, \\mathsf{regT}(k)) \\\\\n    \\evalto \\mathit{ctx}_3,\\, \\mathit{pres}_3"],[[-1,170798]," \\end{matrix}$}\n\\LeftLabel{\\textsc{Clear-Any}}\n\\TrinaryInfC{$\\mathit{ctx},\\, \\mathsf{clear"],[[-1,170700],"Any}(\\mathit{deps}, k) \\evalto\n    \\mathit{ctx}"],[[-1,170651],"_3,\\, \\math"],[[-1,170638],"it{pres}_1 \\,\\cup\\, \\mathit{pres}_2 \\"],[[-1,170597],",\\cup\\, \\mathit{pres}_3"],[[-1,170572],"$}"],[[-1,170574],1],[[-1,170601],2],[[-1,170640],1],[[-1,170653],1],[[-1,170708],4],[[-1,170802],2],[[-1,170984],1],[[-1,171145],1],[[-1,171280],"\n\\end{prooftree}"],[[-1,170570],"\n\n\\begin{prooftree}"],[[-1,170535],"\n\\AxiomC{$k \\notin \\mathrm{dom}(\\mathit{ctx})$}\n\\LeftLabel{\\textsc{Clear-None}}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{clear}(\\mathit{deps}, k) \\evalto \\mathi"],[[-1,170376],"t{ctx},\\, \\{\\}$}"],[[-1,170380],2],[[-1,170551],"\n\\end{prooftree}"],[[-1,181360],"\n\n\\begin{prooftree}\n\\AxiomC{$\\mathsf"],[[-1,181322],"{regT}(k) \\in \\mathrm"],[[-1,181299],"{dom}(\\mathit{ctx})$}"],[[-1,181262],"\n\\AxiomC{$\\mathit{concurrent} = \\{ \\mathit{id}"],[[-1,180808],1],[[-1,181216],1],[[-1,181215]," \\maps"],[[-1,181205],"to v"],[[-1,181201],2],[[-1,181199]," \\mid\n    (\\mathit{id}"],[[-1,181177],2],[[-1,181175]," \\mapsto v"],[[-1,181165],2],[[-1,181163],") \\in \\mathit{ctx}(\\mathsf{regT}(k))"],[[-1,181123],"\n    \\,\\wedge\\, \\mathit{id}"],[[-1,181096],2],[[-1,181094]," \\notin \\mathit{deps} \\}$}\n\\LeftLabel{\\textsc{Clear-Reg}}\n\\BinaryInfC{$"],[[-1,181021],"\\mathit{ctx},\\, \\mathsf{"],[[-1,170358],"clear"],[[-1,180997],2],[[-1,180995],"}("],[[-1,180993],13],[[-1,180980],"\\mathit{deps},"],[[-1,170340]," \\mathsf{regT}(k)) \\evalto"],[[-1,180966],59],[[-1,180905],10],[[-1,180895],"\n    \\math"],[[-1,180881],"it{ctx}["],[[-1,180865],"\\,"],[[-1,180809]," "],[[-1,180863],"\\mathsf{regT}(k) \\,\\mapsto"],[[-1,180835],"\\, \\mathit{concurrent} \\,]"],[[-1,170245],",\\, \\math"],[[-1,170230],"rm{dom}(\\mathit{concurrent})"],[[-1,170236],3],[[-1,180837],1],[[-1,180885],2],[[-1,180907],1],[[-1,181023],"$}"],[[-1,181127],2],[[-1,181209],2],[[-1,181278],"\n\\end{prooftree}"],[[-1,170192],"\n\n\\begin{prooftree}"],[[-1,170157],"\n\\AxiomC{$\\mathsf{mapT}(k) \\in \\mathrm{dom}(\\mathit{ctx})$}"],[[-1,170059],"\n\\AxiomC{$\\mathit{ctx}"],[[-1,170033],"(\\mathsf{mapT}(k))"],[[-1,170013],",\\, \\mathsf{clearMap}(\\mathit{deps}, \\{\\}) \\evalto"],[[-1,169957],"\n   "],[[-1,169963]," \\math"],[[-1,169953],"it{cleared},\\, \\mathit{pres}$}"],[[-1,169923],6],[[-1,170015],1],[[-1,170037],2],[[-1,170098],"\n\\LeftLabel{"],[[-1,170065],"$"],[[-1,170086],"\\textsc{Clear-Map}"],[[-1,170064],"_1$"],[[-1,170068],"}"],[[-1,169911],"\n\\BinaryInfC{$\\mathit{ctx},\\, \\mathsf{clear"],[[-1,169866],"}(\\mathit{deps}, \\mathsf{mapT}(k)) \\evalto\n    \\mathit{ctx} [\\, \\mathsf{mapT}(k) \\,\\mapsto\\, \\mathit{cleared} \\,],\\, \\mathit{pres}$}"],[[-1,169868],1],[[-1,170067],2],[[-1,170173],"\n\\end{prooftree}"],[[-1,169734],"\n\n\\begin{prooftree}"],[[-1,169695],"\n\\AxiomC{$"],[[-1,169172],"\\begin{matrix}"],[[-1,169157],"\n   "],[[-1,169158]," "],[[-1,169685],"k \\in \\mathrm{keys}(\\mathit{ctx}) \\"],[[-1,169152],"\\\n    "],[[-1,169650],1],[[-1,169649],"\\wedge\\, k \\notin \\mathit{done}"],[[-1,169146]," \\end{matrix}"],[[-1,169618],"$}\n\\AxiomC{$"],[[-1,169133],"\\begin{matrix}\n    "],[[-1,169606],"\\mathit{ctx},\\, \\mathsf{clearElem}(\\mathit{deps}, k)"],[[-1,169112]," \\\\\n   "],[[-1,169114],1],[[-1,169554]," \\evalto \\mathit{ctx}', \\mathit{pres}_1"],[[-1,169105]," \\end{matrix}"],[[-1,169515],"$}\n\\AxiomC{$"],[[-1,169092],"\\begin{matrix}\n    "],[[-1,169073],1],[[-1,169503],"\\mathit{ctx}'"],[[-1,169484],",\\, \\mathsf{clearMap}"],[[-1,169461],"(\\mathit{deps}, \\mathit{done} \\cup \\{k\\})"],[[-1,169071]," \\\\"],[[-1,169420],"\n    \\evalto \\mathit{ctx}'',\\, \\mathit{pres}_2"],[[-1,169068]," \\end{matrix}"],[[-1,169374],"$}\n\\LeftLabel{$\\textsc{Clear-Map}_2$}\n\\TrinaryInfC{$\\mathit{ctx},\\, \\mathsf{clearMap}(\\mathit{deps}, \\mathit{done})"],[[-1,169259],8],[[-1,169251],"\n    "],[[-1,169241],"\\evalto "],[[-1,169246],"\\math"],[[-1,169225],"it{ctx}'',\\, \\mathit{pres}_1 "],[[-1,168337],"\\,"],[[-1,169196],"\\cup"],[[-1,168335],"\\,"],[[-1,169192]," \\mathit{pres"],[[-1,169177],"}_2$}"],[[-1,169179],1],[[-1,169463],1],[[-1,169490],3],[[-1,169715],"\n\\"],[[-1,169709],"end{prooftree}"],[[-1,169055],"\n\n\\begin{prooftree}"],[[-1,169020],"\n\\AxiomC{$\\mathit{done} = \\mathrm{keys}(\\mathit{ctx})$}\n\\LeftLabel{$\\textsc{Clear-Map}_3$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{clearMap}(\\mathit{deps}, \\mathit{done})"],[[-1,168814]," "],[[-1,168854],5],[[-1,168849],"\\evalto \\mathit{ctx},"],[[-1,168821],"\\,"],[[-1,168828]," \\{\\}$}"],[[-1,169036],"\n\\end{prooftree}"],[[-1,169713],2],[[-1,180807],"\n\n\\begin{prooftree}\n\\AxiomC{$\\mathsf{listT}(k) \\in \\mathrm{dom}(\\mathit{ctx})$}\n\\AxiomC{$\\mathit{ctx}(\\mathsf{listT}(k)),\\, \\mathsf{"],[[-1,168694],"clearList"],[[-1,180675],2],[[-1,180673],"}("],[[-1,180671],13],[[-1,180658],"\\math"],[[-1,180651],"it{deps},"],[[-1,168672]," \\mathsf{head})"],[[-1,180642],"\n    "],[[-1,180637],67],[[-1,180568],4],[[-1,180564],"\\evalto \\mathit{cleared}"],[[-1,168586],",\\, \\mathit{pres}"],[[-1,180540],"$}\n\\LeftLabel{"],[[-1,168566],"$"],[[-1,180526],"\\textsc{Clear-List}"],[[-1,168569],"_1$"],[[-1,180507],"}\n\\BinaryInfC{$\\mathit{ctx},\\, \\mathsf{"],[[-1,168811],"clear"],[[-1,180468],2],[[-1,180466],"}("],[[-1,180464],13],[[-1,180451],"\\mathit{deps},"],[[-1,168793]," \\mathsf{listT}(k)) \\evalto"],[[-1,180437],70],[[-1,180367],"\n    \\mathit{ctx}[\\, \\mathsf{listT}(k) \\,\\mapsto\\, \\mathit{cleared} \\,]"],[[-1,168565],",\\, \\mathit{pres}"],[[-1,180296],"$}\n\\end{prooftree}\n\n\\begin{prooftree"],[[-1,180258],"}\n\\AxiomC{$"],[[-1,168333],"\\begin{matrix}\n    "],[[-1,180237],"k \\not= \\mathsf{tail}"],[[-1,168314]," \\"],[[-1,168299],","],[[-1,168312],5],[[-1,179638],3],[[-1,179635],"\\wedge\\"],[[-1,168297],"\\"],[[-1,179628],2],[[-1,180216],2],[[-1,180146],31],[[-1,180214],"\n"],[[-1,168265],"    "],[[-1,180213],9],[[-1,180204],"\\mathit{ctx}(\\mathsf{next}(k)) = \\mathit{next}"],[[-1,168237]," "],[[-1,168261],5],[[-1,168256],"\\end{matrix}"],[[-1,168244],1],[[-1,180158],"$}\n\\AxiomC{$"],[[-1,168236],"\\begin{matrix}\n    "],[[-1,180115],"\\mathit{ctx},\\, \\mathsf{"],[[-1,168215],"clear"],[[-1,168208],"Elem"],[[-1,168210],1],[[-1,180091],2],[[-1,180089],"}("],[[-1,180087],13],[[-1,180074],"\\mathit{deps},"],[[-1,168191]," k) \\\\"],[[-1,180060],"\n    "],[[-1,180055],34],[[-1,179793],13],[[-1,180021],21],[[-1,179998],4],[[-1,179994],"\\evalto \\mathit{ctx}'"],[[-1,168114],", \\mathit{pres}_1 "],[[-1,168094],"\\end{matrix}"],[[-1,168096],1],[[-1,179973],"$}"],[[-1,168082],"\n\\AxiomC{$\\begin{matrix}\n    \\"],[[-1,168048],"mathit{ctx}',\\, \\mathsf{clearList}(\\mathit{deps}, \\mathit{next}) \\\\\n    \\evalto \\mathit{ctx}'', \\mathit{pres}_2 \\end{matrix}$}"],[[-1,168052],2],[[-1,179971],"\n\\LeftLabel{"],[[-1,179946],"$"],[[-1,179959],"\\textsc{C"],[[-1,179945],"lear-"],[[-1,168541],"List"],[[-1,179940],5],[[-1,179935],"}_"],[[-1,168547],"2"],[[-1,179933],1],[[-1,179932],"$}\n\\"],[[-1,179653],"Tri"],[[-1,179928],6],[[-1,179922],"naryInfC{$\\mathit{ctx},\\, \\mathsf{"],[[-1,168535],"clearList"],[[-1,179888],2],[[-1,179886],"}("],[[-1,179884],13],[[-1,179871],"\\mathit{deps},"],[[-1,168513]," k) \\evalto"],[[-1,179857],28],[[-1,179827],33],[[-1,179780],10],[[-1,179768],"\n    \\mathit{ctx}'"],[[-1,168380],"',"],[[-1,167922],"\\,"],[[-1,168378]," \\mathit{pres}_1 \\,\\cup\\, \\mathit{pres}_2"],[[-1,179750],9],[[-1,179740],12],[[-1,179708],31],[[-1,179677],"$}\n\\end{prooftree}"],[[-1,179626],"\n\n"],[[-1,179624],119],[[-1,179503],31],[[-1,179470],323],[[-1,179143],11],[[-1,179130],22],[[-1,179106],12],[[-1,179094],"\\begin{prooftree}"],[[-1,179061],"\n\\AxiomC{$k = \\math"],[[-1,179038],"sf{tail}$}\n\\LeftLabel{$\\textsc{Clear-"],[[-1,167397],"List"],[[-1,179001],5],[[-1,178996],"}_3$}\n\\UnaryInfC{$\\mathit{ctx},\\, \\mathsf{"],[[-1,167391],"clearList"],[[-1,178954],2],[[-1,178952],"}("],[[-1,178950],13],[[-1,178937],"\\mathit{deps},"],[[-1,167369]," k) \\evalto \\mathit{ctx},\\, \\{\\}$}"],[[-1,178923],86],[[-1,178837],"\n\\end{prooftree}"],[[-1,179042],2],[[-1,179077],16],[[-1,179108],1],[[-1,179132],1],[[-1,179147],2],[[-1,179472],1],[[-1,179505],1],[[-1,179728],7],[[-1,179717],1],[[-1,179721],2],[[-1,179770],1],[[-1,179829],1],[[-1,179950],2],[[-1,180000],1],[[-1,180247],5],[[-1,180260],1],[[-1,180570],1],[[-1,180653],1],[[-1,181301],1],[[-1,181324],1],[[-1,224569],2],[[-1,232771],1],[[-1,232918],15],[[-1,232974],1],[[-1,233021],1],[[-1,233213],6],[[-1,233390],"\n\\capt"],[[-1,233382],"ion{Rules for "],[[-1,104877],"applying "],[[-1,167249],"delet"],[[-1,104868],"ion operations to "],[[-1,104829],"update the"],[[-1,104819],1],[[-1,104850],7],[[-1,104843]," state"],[[-1,104817]," of a replica"],[[-1,104837],"."],[[-1,167244],8],[[-1,174864],8],[[-1,167236],6],[[-1,174856],"}\\l"],[[-1,184742],50],[[-1,233368],25],[[-1,184692],2],[[-1,184690],"abel{fig:"],[[-1,174844],"clear"],[[-1,184681],9],[[-1,184672],"-rules}"],[[-1,233343],22],[[-1,233384],1],[[-1,233404],"\n\\end{"],[[-1,175071],8],[[-1,233398],"figure"],[[-1,174694],"*"],[[-1,174918],1],[[-1,233392],1],[[-1,233391],"}"],[[-1,256555],"\n"],[[-1,197208],"\n"],[[-1,160014],"Assignment and deletion operations require that prior state (the value being overwritten or deleted) is cleared"],[[-1,159901],", while also ensuring that concurre"],[[-1,159864],"nt modifications are not lost"],[[-1,104422],", as illustrated in Figure~\\ref{fig:map-remove}"],[[-1,159835],". The rules to handle this clearing process are given in Figure~\\ref{fig:clear-rules}. Intuitively, the effect of clearing something is to reset it to its empty state by undoing any operations that causally pre"],[[-1,159623],"cede the current operation, while leaving "],[[-1,159556],"the effect of "],[[-1,159581],"any concurrent operations"],[[-1,159542]," untouched.\n\n"],[[-1,159381],"A "],[[-1,159529],39],[[-1,159490],"\\textsf{delete}"],[[-1,159471]," operation"],[[-1,159461],1],[[-1,159460]," "],[[-1,159459],7],[[-1,159452],"can be used to delete either "],[[-1,159378],"an element from an ordered list or a key from a map, depending on what the cursor refers to. The \\textsc{Delete} rule shows how this operation is evaluated"],[[-1,159223],1],[[-1,159222]," by delegating to \\text"],[[-1,158835],"sc"],[[-1,159199],2],[[-1,159197],"{"],[[-1,158831],"C"],[[-1,159196],1],[[-1,159195],"lear"],[[-1,158830],"-"],[[-1,159191],"Elem}."],[[-1,158829]," In turn,"],[[-1,159185]," \\textsc{Clear-Elem} uses \\textsc{Clear-Any} to "],[[-1,159109],"clear out any data with a given key"],[[-1,159072],", regardless of whether it is of type \\textsf{mapT}, \\textsf{listT} or \\textsf{regT}, and also updates the presence set to include any nested operation IDs, but exclude any operations in $\\"],[[-1,158865],"math"],[[-1,158883],4],[[-1,158879],"it{deps}$."],[[-1,159074],1],[[-1,159137],14],[[-1,159625],1],[[-1,159866],1],[[-1,159903],1],[[-1,181979],39],[[-1,181804],8],[[-1,181692],55],[[-1,181796],24],[[-1,181924],83],[[-1,181717],1],[[-1,181841],27],[[-1,181722],5],[[-1,181813],9],[[-1,181814],1],[[-1,181637],42],[[-1,181591],11],[[-1,178805],7],[[-1,178796],91],[[-1,178798],1],[[-1,181595],2],[[-1,181772],49],[[-1,181580],7],[[-1,181561],10],[[-1,181573],10],[[-1,181550],72],[[-1,181476],9],[[-1,181478],1],[[-1,181563],1],[[-1,181940],16],[[-1,197207],"\n"],[[-1,158820],"\n"],[[-1,158818],"The premises of \\textsc{Clear-Any} are satisfied by $\\textsc{Clear-Map}_1$, $\\textsc{Clear-List}_1$ and \\textsc{Clear-Reg} if the respective key appears in $\\mathit{ctx}$, or by \\textsc{Clear-None} (which does nothing) if the key is absent.\n\n"],[[-1,158548],"As defined by the \\textsc{Assign} rule, a register maintains a mapping from operation IDs to values."],[[-1,158549]," "],[[-1,158576],"\\textsc{Clear-Reg} "],[[-1,158448],"updates a register by "],[[-1,158557],"remov"],[[-1,158423],"ing all operation IDs that appear in $\\"],[[-1,158225],"math"],[[-1,158384],4],[[-1,158380],"it{deps}$"],[[-1,158371],1],[[-1,158370]," "],[[-1,158276],"("],[[-1,158369],"i.e."],[[-1,1275],","],[[-1,158365]," which "],[[-1,158358],4],[[-1,158354],"causally p"],[[-1,158340],"recede the clearing operation"],[[-1,158275],")"],[[-1,158311],", but retaining all operation IDs "],[[-1,158274],"that do not appear in $\\"],[[-1,158242],"mathit{deps}$"],[[-1,158221]," (from assignment operations that are concurrent with the clearing operation).\n\nClearing maps and lists takes a similar approach: each element of the map or list is recursively cleared using "],[[-1,158028],"\\textsf{clearElem}, and presence sets are updated to exclude $\\mathit{deps}$. Thus, any list elements or map entries whose modifications causally precede the clearing operation will end up with empty presence sets, and thus be considered deleted. Any map or list elements containing operations that are concurrent with the clearing operation "],[[-1,157647],"are"],[[-1,157686],4],[[-1,157682]," preserve"],[[-1,157653],"d."],[[-1,117545],"\n"],[[-1,104359],"\n\\subsection{Convergence}\\label{sec:convergence}\n\n"],[[-1,104274],"As outlined in Section~\\ref{sec:intro-replication}, we require that all replicas automatically converge towards the same state"],[[-1,104140]," -- a key requirement of a CRDT"],[[-1,104148],". "],[[-1,104109],"We now formalize this notion, and show that the rules in Figures~\\ref{fig:expr-rules} to"],[[-1,104019],"~\\ref{fig:clear-rules} satisfy this requirement."],[[-1,103817],"\n\n\\begin{definition}"],[[-1,91716],"[valid execution]"],[[-1,87355],"\\label{def:valid-exec}"],[[-1,103780],"\nA \\emph{valid execution} is a "],[[-1,103745],"set of operations generated by a set of replicas $\\{p_1, \\dots, p_k\\}"],[[-1,34360],"$"],[[-1,103676],22],[[-1,103654],", ea"],[[-1,103648],"ch reducing a sequence of commands $\\langle \\mathit{cmd}_1 \\mathbin{;} \\dots \\mathbin{;"],[[-1,103559],"} \\mathit{cmd}_n \\rangle$"],[[-1,103533]," without getting stuck"],[[-1,103534],"."],[[-1,103561],1],[[-1,103650],1],[[-1,103749],2],[[-1,103797],"\n\\end{definition}"],[[-1,103511],"\n\n"],[[-1,103469],"A reduction gets stuck if "],[[-1,101419],"there is no application of rules in which "],[[-1,103401],"a"],[[-1,101377],"ll"],[[-1,103400]," premise"],[[-1,101375],"s"],[[-1,103392]," "],[[-1,101332],"are "],[[-1,103391],42],[[-1,103349],"satisfied. For example, the "],[[-1,103314],"$"],[[-1,103321],"\\textsc"],[[-1,103313],"{"],[[-1,1800],"Idx"],[[-1,103312],4],[[-1,103308],"}_{"],[[-1,103305],2],[[-1,103303],"3"],[[-1,1759],",4"],[[-1,103302],"}$ rules in Figure~\\ref{fig:expr-rules} get stuck if "],[[-1,1790],"$"],[[-1,1780],"\\"],[[-1,1765],"math"],[[-1,1771],3],[[-1,1779],4],[[-1,103249],5],[[-1,103244],"sf{"],[[-1,1793],"idx"],[[-1,103241],4],[[-1,103237],"}"],[[-1,1789],"(n)$"],[[-1,103236]," tries to iterate past the end of a list"],[[-1,1667],", which would happen if"],[[-1,1750],8],[[-1,1742]," $n$ is greater than the number of non-deleted elements in the list"],[[-1,103056],"; i"],[[-1,103196],1],[[-1,103117],3],[[-1,103114],"n a real implementation this would be a runtime error."],[[-1,103053],1],[[-1,103195]," By constraining "],[[-1,103172],"valid executions to those that do not get stuck, we ens"],[[-1,103051],"ure that operations only refer to list elements that actually exist."],[[-1,102561],"\n\nNote that it is valid for an execution to never perform any network communication, either because it never "],[[-1,102440],"invokes the \\textsf{yield} command, or because the nondeterministic execution of \\textsf{yield} never applies the \\textsc{Recv} rule. "],[[-1,102242],"W"],[[-1,102306],7],[[-1,102285],"e "],[[-1,102232],"need only a replica's local state to determine"],[[-1,102283],9],[[-1,102274]," whether reducti"],[[-1,102252],"on "],[[-1,102186],"gets stuck."],[[-1,102258],3],[[-1,102299],7],[[-1,102452],6],[[-1,102563],1],[[-1,102983],"\n\n\\begin{definition}"],[[-1,91725],"[history]"],[[-1,87374],"\\label{def:history}"],[[-1,102963],"\nA \\emph{history} "],[[-1,102928],"is "],[[-1,102905],"a"],[[-1,102925],3],[[-1,102922]," sequence of o"],[[-1,102904],"perations in the order it was applied at one particular replica $p$"],[[-1,102836],1],[[-1,102835]," by application of the rules \\textsc{Apply-Local} and \\textsc{Apply-Remote}"],[[-1,102837],"."],[[-1,102945],"\n\\end{definition}"],[[-1,102760],"\n\n"],[[-1,101769],"Since the evaluation rules sequenti"],[[-1,101732],"ally apply one operation at a time"],[[-1,99528]," at a given replica"],[[-1,101698],", the order is well-defined. "],[[-1,101734],1],[[-1,102756],"Even if two replicas"],[[-1,102701]," $p$ and $q$"],[[-1,102736]," applied the same set of operations"],[[-1,102689],", i.e."],[[-1,102566]," if"],[[-1,102683]," $A_p(\\mathsf{ops}) = A_q(\\mathsf{ops})$, they may have applied "],[[-1,102580],"any concurrent"],[[-1,102619],3],[[-1,102616]," operations in a different order."],[[-1,102009]," "],[[-1,102008],4],[[-1,101996],93],[[-1,102004],4],[[-1,102104],1],[[-1,102103],"Due to the premise $\\mathit{op."],[[-1,102068],"deps} \\subseteq A_p(\\mathsf{ops})$ in \\textsc{Apply-Remote}"],[[-1,101832],", "],[[-1,101781],4],[[-1,101777],"histor"],[[-1,99503],"ies"],[[-1,101771],1],[[-1,101830],9],[[-1,101821]," "],[[-1,99507],"are"],[[-1,101820],2],[[-1,101818]," consistent with causality"],[[-1,101327],":"],[[-1,101792]," "],[[-1,101791],1],[[-1,101517],"if an"],[[-1,101571],5],[[-1,101566]," operatio"],[[-1,101512],"n has causal dependencies, it appears at some point after those dependencies in the history"],[[-1,101421],1],[[-1,101420],"."],[[-1,100300],"\n\n\\begin{definition}"],[[-1,91741],"[document state]"],[[-1,87395],"\\label{def:doc-state}"],[[-1,100263],"\nThe \\"],[[-1,100255],"emph{document state} of a replica $p$ is the subtree of $A_p$ containing the document"],[[-1,100168],": that is, $A_p(\\mathsf{mapT}(\\mathsf{doc})"],[[-1,99531],")"],[[-1,100125],"$ or $A_p(\\mathsf{listT}(\\mathsf{doc}"],[[-1,99530],")"],[[-1,100088],")$ or $A_p(\\mathsf{regT}(\\mathsf{doc}"],[[-1,99529],")"],[[-1,100051],")$, wh"],[[-1,100043],"ichever is defined."],[[-1,100045],1],[[-1,100170],1],[[-1,100257],1],[[-1,100280],"\n\\end{definition}"],[[-1,100024],"\n\n"],[[-1,99797],32],[[-1,99802],"$A_p$"],[[-1,99765]," contains"],[[-1,100022],31],[[-1,99991]," variables defined with \\"],[[-1,99958],"textsf{let}, "],[[-1,99746],"which"],[[-1,99945],10],[[-1,99935]," are local to one replica, and not part of the"],[[-1,99863]," replicated"],[[-1,99889]," state"],[[-1,99883],19],[[-1,99864],"."],[[-1,99741]," T"],[[-1,99707],"he definition of document state excludes these variables."],[[-1,99966],4],[[-1,101325],"\n\n\\begin{"],[[-1,101316],2],[[-1,99628],2],[[-1,99626],"convergence"],[[-1,99574],"-thm"],[[-1,101314],5],[[-1,99637],2],[[-1,101309],1],[[-1,101308],"}"],[[-1,101292],"\nFor any two replicas $p$ and $q$ that participated in a valid execution, if $A_p(\\mathsf{ops}) = "],[[-1,101192],"A_q(\\mathsf{ops})$, then $p$ and $q$ have the same document state."],[[-1,101194],1],[[-1,101307],"\n\\end{"],[[-1,101301],2],[[-1,99599],2],[[-1,99597],"convergence-thm"],[[-1,101299],5],[[-1,99648],11],[[-1,101294],1],[[-1,101293],"}"],[[-1,101126],"\n\nThis theorem is proved in the appendix. It formalizes the safety property of convergence: if two replicas have processed the same set of operations, possibly in a different order, then they are in the same state. I"],[[-1,100829],"n combination"],[[-1,100910],21],[[-1,100889]," with a liveness property, namely that "],[[-1,100816],"every replica eventually processes all operations, we obtain the desired notion of convergence: all replicas eventually end up in the same state.\n\nThe liveness property depends on assumptions of replicas invoking \\"],[[-1,100598],"textsf{yield} sufficiently often, and all nondeterministic rules for "],[[-1,100523],"\\textsf{yield} being chosen fairly. We will not formalize the liveness property in this paper, but assert that it "],[[-1,100324],8],[[-1,100409],"can"],[[-1,100308]," usually"],[[-1,100406]," be provided in practice, as network interruptions are usually of finite duration."],[[-1,100529],3],[[-1,100602],2],[[-1,101557],9],[[-1,102072],2],[[-1,102175],71],[[-1,102758],1],[[-1,103178],3],[[-1,103443],4],[[-1,103433],14],[[-1,103439],3],[[-1,103509],20],[[-1,104021],1],[[-1,104146],3],[[-1,117544],"\n\n\\section{Conclusion"],[[-1,97604],"s"],[[-1,101548]," and "],[[-1,7417],"F"],[[-1,101543],1],[[-1,101542],"urther "],[[-1,7415],"W"],[[-1,101535],1],[[-1,101534],"ork"],[[-1,117523],"}\n"],[[-1,21383],11],[[-1,117521],"\n"],[[-1,99480],"In this paper we demonstrated how to compose "],[[-1,99433],"CRDTs for ordered lists, maps and registers into a compound CRDT with a JSON data model. It supports arbitrarily nested lists and maps, and it "],[[-1,99288],"allows replicas to make arbitrary changes to the data without"],[[-1,99191]," "],[[-1,97172],"waiting for"],[[-1,99190],3],[[-1,99169],2],[[-1,99187],1],[[-1,99172],1],[[-1,99173],1],[[-1,99176],3],[[-1,99186],5],[[-1,99227],1],[[-1,99207],3],[[-1,99204]," network "],[[-1,99226],"communicati"],[[-1,99193],"on"],[[-1,99161],". Replicas asynchronously "],[[-1,99075],"send"],[[-1,99135],11],[[-1,99124]," "],[[-1,99095],"mutations"],[[-1,99071]," to other replicas"],[[-1,99117],5],[[-1,99112]," in the form"],[[-1,99053]," of operations. Concurrent operations are commutative, which ensures that replicas converge towards the same state without requiring"],[[-1,98921],4],[[-1,98917]," application-specific con"],[[-1,98888],"flict resolution logic.\n\nThis work focused on the formal semantics of the JSON CRDT, represented as a mathematical model. We "],[[-1,1272],"are also working on a practical implementation of the algorithm, and will report on its performance characteristics in follow-on work."],[[-1,1274],"\n\n"],[[-1,98763],99],[[-1,98627],14],[[-1,98664],21],[[-1,98613],102],[[-1,98279],16],[[-1,98511],38],[[-1,98263],1],[[-1,34986],8],[[-1,34918],60],[[-1,34856],37],[[-1,34858],1],[[-1,34978],1],[[-1,34975],28],[[-1,34977],1],[[-1,98262],156],[[-1,98095],10],[[-1,98101],3],[[-1,98106],5],[[-1,98085],37],[[-1,34819],1],[[-1,98473],2],[[-1,97987],"Our principle of not losing input due to "],[[-1,97944],"concurrent modifications appears "],[[-1,585],"at first glance to be "],[[-1,97911],"reasonable, but as illustrated in "],[[-1,78816],2],[[-1,97877],"Figure~\\ref{fig:todo-item}, "],[[-1,97847],"it leads to "],[[-1,97813],"merged document states that may be surprising to application programmers who are more familiar with sequential programs."],[[-1,97823],5],[[-1,97946],1],[[-1,98002],14],[[-1,97988]," "],[[-1,98471],"Further work will be needed to"],[[-1,79079]," understand the expectations of application programmers"],[[-1,563],","],[[-1,79024]," and to design data structures that are minimal"],[[-1,78973],"ly surprising under concurrent modification"],[[-1,78977],2],[[-1,98441],114],[[-1,98327],"."],[[-1,34818]," It "],[[-1,34626],"may t"],[[-1,34619],"urn out"],[[-1,34621],1],[[-1,34814],11],[[-1,34803]," that a schema language "],[[-1,34757],"will "],[[-1,34608],"be "],[[-1,34524],"required "],[[-1,34481],"to support more"],[[-1,34515],8],[[-1,34507]," "],[[-1,34605],6],[[-1,34597],13],[[-1,34599],1],[[-1,34668],11],[[-1,34584],5],[[-1,34565],5],[[-1,34579],7],[[-1,34657],1],[[-1,34656],"comple"],[[-1,34642],"x"],[[-1,34502]," applications"],[[-1,34641],3],[[-1,34638],"."],[[-1,34037]," A schema language could also support semantic annotations, such as indicating that a number should be treated as a counter rather than a register."],[[-1,34650],4],[[-1,34752],12],[[-1,34730],3],[[-1,34719],18],[[-1,34727],4],[[-1,34740],2],[[-1,34736],2],[[-1,34738],1],[[-1,34779],11],[[-1,97605],"\n"],[[-1,98285],1],[[-1,98048],46],[[-1,98326],41],[[-1,99123],3],[[-1,99215],8],[[-1,99290],1],[[-1,99435],1],[[-1,117520],16],[[-1,117504],"\n"],[[-1,97603],"T"],[[-1,97552],"he CRDT defined in this paper supports insertion, deletion and assignment operations. In addition to these, it would be useful to support a \\emph{move} operation (to change the order of elements in an ordered list, or to move a subtree from one position in a document to another) and an \\emph{undo} operation."],[[-1,81520]," Moreover, garbage collection (tombstone removal) is required in order to prevent unbounded growth of the data"],[[-1,46]," "],[[-1,81410],"structure."],[[-1,97243]," We plan to address these missing features in future work."],[[-1,97602],15],[[-1,97579],6],[[-1,97587],4],[[-1,117503],"\n\n\\section*{Acknowledgements}\n\nThis research was supported by a grant from The Boeing Company."],[[-1,79420]," Thank you to "],[[-1,79355],"Dominic Orchard"],[[-1,28519],","],[[-1,79340],4],[[-1,79336]," "],[[-1,79406],"Diana Vasile"],[[-1,28518],", and the anonymous reviewers"],[[-1,79394]," for comments "],[[-1,28476],"that improved"],[[-1,79380],13],[[-1,79367]," this paper."],[[-1,117409],"\n"],[[-1,117365],"\n\\bibliographystyle{IEEEtran}\n\\bibliography{references}{}"],[[-1,30688],1],[[-1,562],"\n\\vfill"],[[-1,554],"\n"],[[-1,30687],"\n\\begin{IEEEbiography}"],[[-1,30547],"[{\\includegraphics["],[[-1,30514],"width=1in"],[[-1,30528],"]{mk428.jpg}}]"],[[-1,30665],"{Martin Kleppmann}\n"],[[-1,30230],"is a Research Associate "],[[-1,30202],"in the Computer Laboratory at the University of Cambridge. "],[[-1,30087],"H"],[[-1,30117],5],[[-1,30112],"is current research "],[[-1,30086],"project, TRVE Data,"],[[-1,20387]," is"],[[-1,30067],3],[[-1,30064]," work"],[[-1,20383],"ing"],[[-1,29978],1],[[-1,30059],3],[[-1,30056]," towards better security and privacy in "],[[-1,29998],14],[[-1,30016],"cloud applications"],[[-1,29977]," by"],[[-1,29900],13],[[-1,29974]," applying end-to-end encryption "],[[-1,29928],"to collaboratively editable "],[[-1,29874],"application data. H"],[[-1,29829],"is book \\emph{Designing Data-Intensive Applications} was published by O'Reilly Media in 20"],[[-1,29733],"1"],[[-1,29739],1],[[-1,29738],"7"],[[-1,29735],"."],[[-1,29732]," Previously"],[[-1,29719],", "],[[-1,29715],"he work"],[[-1,29706],"ed as a software engineer and entrepreneur at several internet companies"],[[-1,20380],", including Rapportive and LinkedIn"],[[-1,29634],"."],[[-1,29708],1],[[-1,29717],1],[[-1,29721],1],[[-1,29737],1],[[-1,29855],13],[[-1,30119],1],[[-1,30143],12],[[-1,30206],2],[[-1,30646],4],[[-1,30642],"\n\\end{IEEEbiography}\n\n\\begin{IEEEbiography}"],[[-1,30505],"["],[[-1,30503],"{"],[[-1,30501],"\\includegraphics[width=1in]{arb33.jpg"],[[-1,30462],"}"],[[-1,30464],1],[[-1,30502],"}"],[[-1,30504],"]"],[[-1,30599],"{Alastair R."],[[-1,30585],1],[[-1,30584]," Beresford}"],[[-1,30572],"\n"],[[-1,30457],"is a "],[[-1,30448],"Senior Lecturer in the Computer Laboratory at the University of Cambridge."],[[-1,30374],55],[[-1,20839],3],[[-1,20832],3],[[-1,20836],2],[[-1,20957],60],[[-1,20895],15],[[-1,20874],35],[[-1,20880],3],[[-1,20897],1],[[-1,30319],70],[[-1,30249]," "],[[-1,21307],"His"],[[-1,21304],8],[[-1,21296]," research "],[[-1,21226],"work exp"],[[-1,21212],"lores the security and privacy of large-scale distributed systems, with "],[[-1,21138],"a particular focus on "],[[-1,21108],"net"],[[-1,21097],"worked mo"],[[-1,21084],"bile devices such as smartphones"],[[-1,21050],", tablets and la"],[[-1,21032],"ptops."],[[-1,20649]," He looks at th"],[[-1,20578],"e security and privacy of the devices themselves, as well as the se"],[[-1,20505],"curity and pr"],[[-1,20488],"ivacy problems induced by the interaction between mobile devices and clou"],[[-1,20413],"d-based Internet services."],[[-1,20415],1],[[-1,20492],2],[[-1,20511],3],[[-1,20634],28],[[-1,21034],1],[[-1,21052],1],[[-1,21088],2],[[-1,21105],4],[[-1,21116],4],[[-1,21140],1],[[-1,21218],3],[[-1,21280],8],[[-1,21270],1],[[-1,21255],2],[[-1,21241],2],[[-1,21253],6],[[-1,21269],7],[[-1,21272],1],[[-1,21286],3],[[-1,21343],18],[[-1,21361],2],[[-1,30248],14],[[-1,30452],2],[[-1,30551],4],[[-1,30552],"\n"],[[-1,30571],"\\end{IEEEbiography}"],[[-1,30587],1],[[-1,157673],10],[[-1,158030],1],[[-1,158250],4],[[-1,158552],3],[[-1,158819],"\n"],[[-1,29633],"\n"],[[-1,29632],7],[[-1,197223],1],[[-1,197222],"\\if"],[[-1,50404],"includeappendix"],[[-1,197219],10],[[-1,97152],"\n\\clearpage"],[[-1,197209],1],[[-1,117408],11],[[-1,117397],"\n\\"],[[-1,115098],"appendix["],[[-1,117395],8],[[-1,117387],"Proof of "],[[-1,7413],"C"],[[-1,117378],1],[[-1,117377],"onvergence"],[[-1,115107],"]"],[[-1,115077],"\\label{sec:proof}"],[[-1,117367],1],[[-1,117366],"\n"],[[-1,97141],"\n"],[[-1,87750],"\\begin{theorem}\\label{thm:convergence}\nFor any two replicas $p$ and $q$ that participated in a valid execution, if $A_p(\\mathsf{ops}) = A_q(\\mathsf{ops})$, then $p"],[[-1,87585],"$ and $q$ have the same document state.\n\\"],[[-1,87542],"end{theorem}\n\n\\begin{proof}"],[[-1,87503],"\nConsider the histor"],[[-1,87479],"ies $H_p$ and $H_q$ at $p$ and $q$ respectively"],[[-1,87430]," (see Definition~\\ref{def:history})"],[[-1,87432],"."],[[-1,87287]," The "],[[-1,87282],5],[[-1,87277],"rules "],[[-1,87271],78],[[-1,87191],7],[[-1,87193],1],[[-1,87431],1],[[-1,87333],"\\textsc{Apply-Local} and \\textsc{Apply-Remote}"],[[-1,87184],10],[[-1,87174]," maintain the "],[[-1,87081],"in"],[[-1,87160],"variant that "],[[-1,87072],"an"],[[-1,87141],7],[[-1,87134]," operation "],[[-1,87038],"is added to $A_p(\\mathsf{ops})"],[[-1,87006],"$ or $A_q(\\mathsf{ops})$ if"],[[-1,86977]," and only if it was applied to the document state"],[[-1,85923]," at $p$ or $q$"],[[-1,86928],"."],[[-1,86836]," Thus, "],[[-1,86829],3],[[-1,86826],"$A_p"],[[-1,86818],"(\\mathsf{ops}) = A_q(\\mathsf{ops})$ "],[[-1,86681],"if"],[[-1,86659],"f"],[[-1,86679],10],[[-1,86782],4],[[-1,86778]," $H_p$ and $H_q$ contain the same set of operations"],[[-1,86727],5],[[-1,86722]," "],[[-1,86653],"("],[[-1,86721],"potentially "],[[-1,85903],"ordered"],[[-1,85907],2],[[-1,86709],2],[[-1,86707]," "],[[-1,86706],2],[[-1,86704],"different"],[[-1,85889],"ly"],[[-1,86695],6],[[-1,86649],1],[[-1,86652],")"],[[-1,86689],"."],[[-1,86648],"\n"],[[-1,86482],"\nThe history"],[[-1,78495]," $H_p$"],[[-1,86470]," "],[[-1,86459],"at replica $p$ is a sequence of"],[[-1,78499]," $n$"],[[-1,86428]," operations"],[[-1,78489],":"],[[-1,86417]," $H_p = "],[[-1,85887],"\\langle "],[[-1,86409],"o_1"],[[-1,85871],","],[[-1,86406]," \\dots"],[[-1,85870],","],[[-1,86400]," o_n"],[[-1,85879]," \\rangle"],[[-1,86396],"$, and the document state at $p$ is derived from $H_p$ by starting in the emp"],[[-1,86317],"ty state and apply"],[[-1,86297],"ing the operations in order. Like"],[[-1,86262],"wise, the document state at $q$ is derived from $H_q$, which is a permutation of $H_p$."],[[-1,86106]," Both histories must be consistent with causality, i.e. for all "],[[-1,86040],"$i$ with $1 \\"],[[-1,86025],"le i \\le n$, "],[[-1,85847],"we require "],[[-1,86012],"$"],[[-1,85997],"o_i.\\mathit{deps} \\subseteq "],[[-1,85931],"\\"],[[-1,85969],"{"],[[-1,85968],1],[[-1,85967],"o_j.\\mathit{id} \\mid 1 \\"],[[-1,85939],"le j < i"],[[-1,85930],1],[[-1,85929],"\\}"],[[-1,85925],"$."],[[-1,81739]," The causality invariant is maintained by the \\textsc{Apply-*} rules."],[[-1,85836],"\n\nWe can prove the theorem by induction over "],[[-1,85773],"the length of history $n$.\n\n\\emph{Base case:} A"],[[-1,85712],"n empty history with $n=0$ describes the empty document state. The empty document is always the same, and so any two replicas that have not executed any operations"],[[-1,85543]," are by definition in the same state.\n\n\\emph{Induction step:} Given histories $H_p$ and $H_q$ of length $n$, such that $H_p = \\langle o_1, \\dots, o_n \\rangle$ and $H_q"],[[-1,85374],"$ is a permutation of $H_"],[[-1,85347],"p$, and such that applying $H_p$ results in the same document state as applying $H"],[[-1,85261],"_q$, we can construct new histories"],[[-1,85096]," $H_p'$ and $H_q'$"],[[-1,85226]," of length $n+1$ by inserting a new operation $o_{n+1}$ "],[[-1,85156],"at any causally ready position in"],[[-1,85097]," "],[[-1,85123],8],[[-1,85115],"$H_p$ or $"],[[-1,85078],"H_q$ respectively. We must then show that for all the histories $H_p'$ and $H_q'$ constructed this way, applying the "],[[-1,84894],"sequence of "],[[-1,84961],"operations in order results in the same "],[[-1,84909],"document state."],[[-1,84882],"\n\nIn order to prove the induction step, we examine the insertion of $o_{n+1}$ into $H_p$ and $H_q$. Each history can be split into a prefix, which is the minimal subsequence $\\langle o_1, \\dots, o_j \\rangle$ such that $o_{n+1}.\\mathit{deps} \\subseteq \\{o_1.\\mathit{id}, \\dots, o_j.\\mathit{id}\\}$, and a "],[[-1,84284],"suf"],[[-1,84579],3],[[-1,84576],"fix, which is the remaining "],[[-1,84281],"sub"],[[-1,84548],"sequence $\\langle o_{j+1}, \\dots, o_n \\rangle$."],[[-1,78488]," The prefix contains all "],[[-1,78454],"operations that "],[[-1,78463],"causally "],[[-1,78438],"precede $o_{n+1}$, and possib"],[[-1,78407],"ly some operations "],[[-1,78386],"that are concurrent with $o_{n+1}$; the suffix contains only operations that are concurrent with $o_{n+1}$."],[[-1,78388],1],[[-1,78409],1],[[-1,84501]," The earliest position where $o_{n+1}$ can be inserted into the history is between the prefix and the suffix; the latest position is at the end of the suffix; or it could be inserted at any point within the suffix."],[[-1,84278],"\n\nWe"],[[-1,78279]," need to"],[[-1,84274]," show that the effect on the document state is the same, regardless of the position at which $o_{n+1}$ is inserted, and regardless of whether it is inserted in"],[[-1,84113],"to $H_p"],[[-1,84102],"$ or $H"],[[-1,84093],"_q$. We do this"],[[-1,47229]," in Lemma~\\ref{lem:op-commute}"],[[-1,84078]," by showing that $o_{n+1}$ is commutative with respect to all operations in the suffix, i.e. with respect to a"],[[-1,78267],"ny"],[[-1,83968],2],[[-1,78271],1],[[-1,83966]," operations that are concurrent to $"],[[-1,83926],"o_{n+1}$"],[[-1,46948],"."],[[-1,47245],16],[[-1,83918],55],[[-1,83859],78],[[-1,55390],7],[[-1,83781],53],[[-1,83726],51],[[-1,83863],2],[[-1,83930],2],[[-1,84095],1],[[-1,84106],2],[[-1,84115],1],[[-1,84921],6],[[-1,85170],7],[[-1,85265],2],[[-1,85349],1],[[-1,85376],1],[[-1,85549],3],[[-1,85726],7],[[-1,85791],9],[[-1,85943],2],[[-1,86011],7],[[-1,86027],1],[[-1,86042],1],[[-1,86264],1],[[-1,86299],1],[[-1,86319],1],[[-1,86469],5],[[-1,86647],1],[[-1,86610],8],[[-1,86598],17],[[-1,86575],15],[[-1,86552],5],[[-1,86511],29],[[-1,86547],18],[[-1,86560],4],[[-1,86602],2],[[-1,86646],18],[[-1,86822],2],[[-1,86979],1],[[-1,87008],1],[[-1,87123],32],[[-1,87147],3],[[-1,87483],2],[[-1,87515],"\n\\end{proof}"],[[-1,81670],"\n\nBefore we can prove the commutativity of "],[[-1,46913],"operations"],[[-1,81627],34],[[-1,81593],", we must first"],[[-1,81547]," define some more terms and"],[[-1,81578]," prove some preliminary lemmas."],[[-1,87544],1],[[-1,87587],1],[[-1,97139],61],[[-1,97074],30],[[-1,96699],89],[[-1,96608],12],[[-1,96586],5],[[-1,96596],10],[[-1,96610],1],[[-1,96737],"\n\n\\begin{definition}"],[[-1,91766],"["],[[-1,77786],"appearing"],[[-1,77847],9],[[-1,77838]," after"],[[-1,91765],12],[[-1,78248],11],[[-1,91753],11],[[-1,91742],"]"],[[-1,96700],"\n"],[[-1,78001],"In the ordered list $\\mathit{ctx}$, "],[[-1,77964],"l"],[[-1,96581],1],[[-1,96580],"i"],[[-1,96577],"st elemen"],[[-1,96562],"t $k_"],[[-1,78236],"j"],[[-1,96557],1],[[-1,96556],"$"],[[-1,96507]," \\emph{"],[[-1,77802],"appears"],[[-1,77824],6],[[-1,77818]," after"],[[-1,78232],3],[[-1,96500],5],[[-1,78128],1],[[-1,96495],3],[[-1,96492],"} list element $k_"],[[-1,78228],"1"],[[-1,78264],1],[[-1,96447],1],[[-1,96474],1],[[-1,96473],"$"],[[-1,96472],3],[[-1,96221],17],[[-1,96469],1],[[-1,96466],14],[[-1,96452]," if "],[[-1,96446],"there exist"],[[-1,77916],"s a (possibly empty) sequence of list elements"],[[-1,77928],6],[[-1,96435]," $k_2, \\dots, k_{"],[[-1,78262],"j"],[[-1,96418],1],[[-1,96417],"-1}$ such that"],[[-1,96313]," for all $i$ with $1 \\le i "],[[-1,77547],"<"],[[-1,77557],3],[[-1,96286],1],[[-1,96285]," "],[[-1,78260],"j"],[[-1,77554],2],[[-1,96284],1],[[-1,96283],"$,"],[[-1,85869],11],[[-1,96403]," $"],[[-1,96321],8],[[-1,96401],"\\mathit{ctx}(\\mathsf{next}(k_"],[[-1,96272],"i"],[[-1,96372],1],[[-1,96371],")) = k_"],[[-1,96270],"{i+1}$."],[[-1,76383]," Moreover,"],[[-1,76233]," we say"],[[-1,76373]," $"],[[-1,76369],"k_j$ appears \\emph{"],[[-1,76332],6],[[-1,76350],"immediately after}"],[[-1,76320]," $k_1$ if that sequence is empty, i.e."],[[-1,76236]," if"],[[-1,76282]," $\\mathit{ctx}(\\mathsf{next}"],[[-1,76252],"(k_1))"],[[-1,76244]," = k_j$."],[[-1,76246],1],[[-1,76254],1],[[-1,76371],1],[[-1,96364],43],[[-1,96468],1],[[-1,96568],3],[[-1,96579],1],[[-1,96717],"\n\\end{definition}"],[[-1,96204],"\n\nThe "],[[-1,95700],"defini"],[[-1,95690],"tion"],[[-1,95694],2],[[-1,96198],6],[[-1,96192]," of \\emph{"],[[-1,77771],"appearing after"],[[-1,78224],4],[[-1,96182],5],[[-1,78127],1],[[-1,96177],4],[[-1,96173],"} corresponds to the order in which the \\textsc{"],[[-1,1753],"Idx"],[[-1,96125],4],[[-1,96121],"} rules iterate over the list."],[[-1,97078],2],[[-1,97140],"\n"],[[-1,97044],"\n"],[[-1,97042],"\\begin{lemma}"],[[-1,95430],"\\label{lem:list-"],[[-1,77727],"after"],[[-1,78118],8],[[-1,95397],8],[[-1,95408],5],[[-1,95403],"}"],[[-1,95414],3],[[-1,97017],"\n"],[[-1,96994],"If $"],[[-1,96544],"k"],[[-1,96990],11],[[-1,96979],"_"],[[-1,78218],"2"],[[-1,96978],1],[[-1,96977],"$ "],[[-1,77748],"appears after"],[[-1,78214],3],[[-1,96849],5],[[-1,78109],1],[[-1,96844],3],[[-1,96975],14],[[-1,96961]," $"],[[-1,96532],"k"],[[-1,96959],11],[[-1,96948],"_"],[[-1,78210],"1"],[[-1,96947],1],[[-1,96946],"$ in an ordered list, and the list is mutated according to the "],[[-1,96881],"evaluation rules, "],[[-1,96841],"$"],[[-1,96508],"k"],[[-1,96840],11],[[-1,96829],"_"],[[-1,78208],"2"],[[-1,96828],1],[[-1,96827],"$ also "],[[-1,77701],"appears after"],[[-1,78204],3],[[-1,96820],4],[[-1,78108],1],[[-1,96816],4],[[-1,96812]," $"],[[-1,96520],"k"],[[-1,96810],11],[[-1,96799],"_"],[[-1,78200],"1"],[[-1,96798],1],[[-1,96797],"$ in all "],[[-1,78096],"later"],[[-1,96768],10],[[-1,96758]," "],[[-1,96753],"document states."],[[-1,96757],2],[[-1,96788],10],[[-1,96883],1],[[-1,97016],11],[[-1,97029],"\n\\end{lemma}"],[[-1,94916],"\n"],[[-1,96091],"\n\\begin{proof}"],[[-1,96065],"\nThe only rule that modifies the \\textsf{next} "],[[-1,95492],"pointers"],[[-1,96018],7],[[-1,96011]," in the context is $\\"],[[-1,95976],"textsc{Insert}_1$, and it "],[[-1,95932],"inserts a "],[[-1,95920],"new list element between "],[[-1,95893],"two ex"],[[-1,95885],"isting list elements (possibly \\"],[[-1,95828],"text"],[[-1,95853],4],[[-1,95849],"sf{head} and/or \\"],[[-1,95824],"textsf{tail}). This modification preserves the "],[[-1,77678],"appears-after"],[[-1,78189],10],[[-1,95777],10],[[-1,95767]," relat"],[[-1,95753],"ionship between any two existing list elements."],[[-1,95686]," Since no other rule affects the list order, "],[[-1,77655],"appears-after"],[[-1,78169],10],[[-1,95641],10],[[-1,95631]," is always preserved."],[[-1,95761],4],[[-1,95887],1],[[-1,95895],1],[[-1,95922],1],[[-1,95950],9],[[-1,95990],7],[[-1,96077],"\n\\end{proof}"],[[-1,95610],"\n\nNote that deletion of a"],[[-1,95583],"n element from a list does not remove it from the sequence of \\textsf{next} pointers"],[[-1,95484],", but only clears its presence set $\\mathsf{pres}(k)$."],[[-1,94602],88],[[-1,94512],16],[[-1,94514],1],[[-1,95389],"\n\n\\begin{"],[[-1,95378],"lemma}"],[[-1,93620],"\\label{lem:insert-between}"],[[-1,95360],"\nIf one replica inserts a list element $k"],[[-1,95317],"_\\mathit{new}$ between $k_1$ "],[[-1,95280],"and $k_2$, i.e. if "],[[-1,90969],2],[[-1,90965],13],[[-1,90952],"$k_\\mathit{new}"],[[-1,90159],"$"],[[-1,78159]," "],[[-1,77634],"appears after"],[[-1,78158],8],[[-1,78150]," $k_1$"],[[-1,90937]," in the list and"],[[-1,78091]," $k_2$ "],[[-1,77613],"appears after"],[[-1,78084],8],[[-1,90921]," $k_\\mathit{new}$ "],[[-1,90903],15],[[-1,90888],"in the list "],[[-1,90967],1],[[-1,95261],14],[[-1,95243],22],[[-1,95189],72],[[-1,95117],"on the source replica after applying \\textsc{Apply-Local}, then "],[[-1,95053],15],[[-1,95038],"$k_\\mathit{new}$"],[[-1,78046]," "],[[-1,77592],"appears after"],[[-1,78045],8],[[-1,78037]," $k_1$"],[[-1,95022]," and"],[[-1,78031]," $k_2$ "],[[-1,77571],"appears after"],[[-1,78024],8],[[-1,95018]," $k_\\mathit{new}$ "],[[-1,95000],15],[[-1,94985],"on every other replica where that operation is applied."],[[-1,95221],16],[[-1,95247],2],[[-1,95288],4],[[-1,95319],1],[[-1,95372],"\n\\end{lemma}"],[[-1,94608],3],[[-1,94930],"\n"],[[-1,94915],"\n"],[[-1,94929],"\\begin{proof}"],[[-1,94200],"\nThe rules for generating list operations ensure that $k_1$ is either \\textsf{head} or an operation identifier, and $k_2$ is either \\texts"],[[-1,94060],"f{tail} or an operation identifier."],[[-1,94024],"\n\n"],[[-1,94062],1],[[-1,94898],1],[[-1,94897],"When the insertion operation is generated using the \\textsc{Make-Op} rule, its operation identifier "],[[-1,94775],"is given a counter value "],[[-1,94748],"$\\mathit{ctr}$ that is greater than the counter of any existing operation ID in $"],[[-1,94665],"A"],[[-1,94662],"_p(\\mathsf{ops})$. If $k_2$ is an operation identifier"],[[-1,94496],", we must have $k_2 \\"],[[-1,94471],"in A_p(\\mathsf{ops})$, since both \\textsc{Apply"],[[-1,94422],"-Local} and \\textsc{Apply"],[[-1,94395],"-Remote} add operation IDs to $A"],[[-1,94361],"_p(\\mathsf{ops})$ when applying an insertion"],[[-1,94315],"."],[[-1,94268]," "],[[-1,93955],"Thus"],[[-1,93949],", either $k_2 < k_\\mathit{new}$ under the ordering relation $<$ for Lamport timestamps, or $k_2 = \\mathsf{tail}$.\n\nWhen the insertion operation is applied on "],[[-1,93680],"an"],[[-1,93791],"other replica"],[[-1,93778],1],[[-1,93775]," using \\textsc{Apply-Remote} and $\\textsc{Insert}_{1,2}$, "],[[-1,93709],"$k_"],[[-1,77441],"2"],[[-1,93706],1],[[-1,93705],"$ "],[[-1,77432],"appears after"],[[-1,93703],8],[[-1,93695]," $k_"],[[-1,77418],"1"],[[-1,93691],1],[[-1,93690],"$ on that "],[[-1,93677],"replica (by Lemma~\\ref{lem:list-"],[[-1,77714],"after"],[[-1,93645],8],[[-1,93637],"} and causality)."],[[-1,93594]," "],[[-1,93589],"The cursor of the operation is $\\mathsf{cursor}(\\langle\\dots\\rangle, k_1)$"],[[-1,93177],", so the rules start iterating the list at $k_1$"],[[-1,77380],","],[[-1,93129]," and "],[[-1,77379],"therefore"],[[-1,93124],12],[[-1,93112]," $k_\\mathit{new}$ "],[[-1,77370],"is inserted "],[[-1,93094],"at "],[[-1,77410],"s"],[[-1,77407],"ome"],[[-1,77409],1],[[-1,93091],1],[[-1,93090]," position "],[[-1,77391],"after"],[[-1,93080],13],[[-1,93067]," $k_1$"],[[-1,93515],"."],[[-1,93061],"\n\n"],[[-1,93514],1],[[-1,93513],"If other concurrent insertions occurred between $k_1$ and $k_2$, their operation ID may be greater than or less than $k_\\mathit{new}$, and thus either $\\"],[[-1,93352],"textsc{Insert}_1$ or "],[[-1,93329],"$\\"],[[-1,92870],"text"],[[-1,92878],4],[[-1,93327],4],[[-1,93323],"sc{Insert}_2$ may apply. In particular, $\\textsc{Insert}_2$ skips over any list elements whose Lamport timestamp is greater than $k_\\mathit{new}$."],[[-1,93058]," However, we know that $k_2 < k_\\mathit{new} \\vee k_2 = \\mathsf{tail}$, and so $\\"],[[-1,92862],"text"],[[-1,92886],4],[[-1,92977],4],[[-1,92973],"sc{Insert}_1$ will apply with $\\mathit{next}=k_2$ at the latest. The $\\"],[[-1,92854],"textsc{Insert}_{1,2}$ rules thus never iterate past $k_2$, and thus"],[[-1,92787],14],[[-1,92773]," $k_\\mathit{new}$ "],[[-1,77344],"is never inserted "],[[-1,92755],"at a "],[[-1,92748],"list position t"],[[-1,77314],"hat appears after"],[[-1,92733],12],[[-1,92721]," $k_2$."],[[-1,92750],1],[[-1,92894],4],[[-1,92902],4],[[-1,93331],1],[[-1,93360],4],[[-1,93591],1],[[-1,93593],1],[[-1,93717],4],[[-1,93777],1],[[-1,93951],1],[[-1,94267],67],[[-1,94314],1],[[-1,94303],17],[[-1,94313],5],[[-1,94317],1],[[-1,94363],1],[[-1,94397],1],[[-1,94424],1],[[-1,94475],2],[[-1,94664],1],[[-1,94667],1],[[-1,94750],1],[[-1,94797],11],[[-1,94914],"\n\\end"],[[-1,94905],"{"],[[-1,94903],"proof"],[[-1,94904],"}"],[[-1,76226],"\n\n\\"],[[-1,76221],"begin{definition}[comm"],[[-1,76195],"on ancestor]\\label{def:common-ancestor}"],[[-1,76139],"\nIn a history $H$, the \\emph{common ancestor} of two"],[[-1,75041]," concurrent"],[[-1,76087]," operations $o_"],[[-1,75740],"r"],[[-1,75746],1],[[-1,75758],1],[[-1,76072],1],[[-1,76071],"$ and $o_"],[[-1,75742],"s"],[[-1,75744],1],[[-1,75756],1],[[-1,76062],1],[[-1,76061],"$"],[[-1,76058]," is the "],[[-1,76026],"latest "],[[-1,76028],1],[[-1,76048],"document state that "],[[-1,76019],"causally precedes both $o_"],[[-1,75754],"r"],[[-1,75993],1],[[-1,75992],"$ and $o_"],[[-1,75752],"s"],[[-1,75983],1],[[-1,75982],"$."],[[-1,76050],1],[[-1,76060],1],[[-1,76156],"\n\\end{definition}"],[[-1,76199],2],[[-1,76223],1],[[-1,77224],"\n"],[[-1,75980],"\n"],[[-1,75978],"The common ancestor"],[[-1,75780]," of $"],[[-1,75773],"o_"],[[-1,75748],"r"],[[-1,75771],1],[[-1,75770],"$ and $o_"],[[-1,75750],"s"],[[-1,75761],1],[[-1,75760],"$"],[[-1,75775],1],[[-1,75959]," can be defined more formally as the document state resulting from applying a "],[[-1,75845],"sequence of"],[[-1,75881],9],[[-1,75872]," operations"],[[-1,75739]," $\\"],[[-1,75734],"langle o_1, \\dots, o_j \\rangle$"],[[-1,75736],1],[[-1,75827],1],[[-1,75826]," "],[[-1,75696],"that is"],[[-1,75825],6],[[-1,75819]," the shortest prefix of"],[[-1,75861],1],[[-1,75832],2],[[-1,75860],2],[[-1,75858]," $H$"],[[-1,75796]," that satisfies "],[[-1,75689],"$(o_r.\\mathit{deps} \\"],[[-1,75044],"cap"],[[-1,75668],3],[[-1,75665]," o_s"],[[-1,75051],"."],[[-1,75661],"\\"],[[-1,75660],1],[[-1,75659],"mathit{deps}) \\subseteq \\{o_1.\\mathit{id}, \\dots, o_j.\\mathit{id}\\}$."],[[-1,75979],"\n"],[[-1,75030],"\n"],[[-1,75028],"\\begin{definition}[insertion interval"],[[-1,74989],"]\\label{def:insert-interval}\n"],[[-1,74941],"Given two"],[[-1,74743]," concurrent"],[[-1,74932]," "],[[-1,74919],"operations $o_r$ and $o_s$ that insert into the same list, the \\emph{insertion interval} of "],[[-1,74823],"$o_r$ is the pair of keys $(k_r^\\math"],[[-1,74746],"rm"],[[-1,74786],2],[[-1,74784],"{before}, k_r"],[[-1,74769],"^\\math"],[[-1,74750],"rm"],[[-1,74763],2],[[-1,74761],"{after})$"],[[-1,74744]," "],[[-1,74732],"such that"],[[-1,74697]," $o_r.\\mathit{id}$ appears after"],[[-1,74723]," $k_r"],[[-1,74716],"^\\math"],[[-1,74708],"rm{before}$"],[[-1,74665]," when $o_r$ has been applied, $k_r"],[[-1,74629],"^\\mathrm{after}$ appears after $"],[[-1,74593],"o_r.\\mathit{id}$ "],[[-1,74574],"when $o_r$ has been applied, and $k_r^\\mathrm{after}"],[[-1,74472],"$"],[[-1,74522]," appears immediately after $k_r"],[[-1,74489],"^\\mathrm{before}$"],[[-1,74471]," in the common ancestor of $o_r$ and $o_s$. The insertion interval of $o_s$ is the pair of keys $(k_s^\\mathrm{before}, k_s^\\mathrm{after})$ defined "],[[-1,74319],"similarly."],[[-1,74323],2],[[-1,74491],1],[[-1,74576],1],[[-1,74597],2],[[-1,74631],1],[[-1,74710],1],[[-1,74718],1],[[-1,74771],1],[[-1,74827],2],[[-1,74931],6],[[-1,74943],1],[[-1,74944],"\n"],[[-1,74960],"\\end{definition}"],[[-1,74991],1],[[-1,75029],"\n"],[[-1,74309],"\n"],[[-1,74307],"I"],[[-1,74302],"t may be the case that $"],[[-1,74276],"k_r^\\mathrm{before}$ or $k_s^\\"],[[-1,74242],"mathrm{before}$ is "],[[-1,74217],"\\textsf{head}"],[[-1,74202],", and that $k_r^\\mathrm{after}$ or $"],[[-1,74162],"k_s^\\mathrm{after}$ is "],[[-1,74137],"\\textsf{tail}."],[[-1,70193],"\n\n\\begin{lemma}\\label{lem:insert-conflict}\n"],[[-1,70107],"For any two concurrent insertion operations $o_r, o_s$ "],[[-1,70051],"i"],[[-1,70138],1],[[-1,70137],"n a"],[[-1,70134],1],[[-1,70133]," "],[[-1,70038],"h"],[[-1,70132],11],[[-1,70121],"istory $H$, "],[[-1,70037],"if "],[[-1,70034],37],[[-1,69997],"$o_r.\\mathit{cur} = o_s.\\mathit{cur}$"],[[-1,69960],1],[[-1,69959],", then the order "],[[-1,69755],"at"],[[-1,69942],2],[[-1,69940]," which the insert"],[[-1,69749],"ed elements"],[[-1,69923],4],[[-1,69919]," "],[[-1,69910],"appear in the list"],[[-1,69309]," after applyin"],[[-1,69291],"g $H$"],[[-1,69295],2],[[-1,69892]," is"],[[-1,69738]," deterministic and"],[[-1,69889]," independent of the order "],[[-1,69251],"of $o_r$ and $o_s$ in $H$"],[[-1,69863],35],[[-1,69828],"."],[[-1,69918],4],[[-1,70109],1],[[-1,70139],"\n"],[[-1,70150],"\\end{lemma}"],[[-1,69827],"\n\n\\begin{proof}"],[[-1,69720],"\nWithout loss of generality, assume that $o_r.\\mathit{id} < o_s.\\mathit{id}$ according to the ordering relation on Lamport timestamps. (If the operation ID of $o_r$ is great"],[[-1,69545],"er than that of $o_s$, the two operations can be swapped in this proof.) We now distinguish "],[[-1,69451],"the two possible order"],[[-1,69419],"s of applying the operations:\n\n\\begin{enumerate}"],[[-1,69352],"\n\\item $o_r$ is applied before $o_s$ in $H$"],[[-1,69226],". Thus, at the time when $o_s$ is applied, $o_r$ has already been applied. When applying $o_s$, since $o_r$ has a lesser operation ID, the "],[[-1,69085],"rule $\\textsc{Insert}_1$ applies with $\\mathit{next} = o_r.\\mathit{id}$ at the latest, so the insertion position of $o_s$ must appear before $o_r$. It is not possible for "],[[-1,68908],"$\\"],[[-1,68898],"textsc{"],[[-1,68906],4],[[-1,68914],"Insert"],[[-1,68891],"}_2$ to skip past "],[[-1,68871],"$o_r$.\n\n\\item $o_s$ is applied before $o_r$ in $H$. Thus, at the time when $o_r$ is applied, $o_s$ has already been applied. "],[[-1,68738],"When applying $o_r$, the rule $\\textsc{Insert"],[[-1,68691],"}_2$ applies with $\\mathit{next} = o_s.\\mathit{id}$"],[[-1,68638],", so the rule skips "],[[-1,68599],"past"],[[-1,68618],4],[[-1,68614]," $o_s$ and "],[[-1,68595],"inserts $o_r$ at a position after $o_s$. Moreover, any list elements"],[[-1,68493]," that appear"],[[-1,68527]," between $o_s.\\mathit{cur}$ and $o"],[[-1,68481],"_s$ at the time of inserting $o_r$ must have a Lamport timestamp greater tha"],[[-1,68401],"n $o_s.\\mathit{id}$, "],[[-1,68364],"so $"],[[-1,68358],"\\textsc{Insert}_2$ also skips over those list elements when inserting $o_r$. Thus, the insertion position of $o_r$ must be after $o_s$."],[[-1,68360],1],[[-1,68380],8],[[-1,68405],2],[[-1,68640],1],[[-1,68693],1],[[-1,68746],4],[[-1,68873],1],[[-1,69087],1],[[-1,69429],5],[[-1,69453],1],[[-1,69547],1],[[-1,69812],"\n"],[[-1,69367],"\\end{enumerate}"],[[-1,69811],4],[[-1,69807],"\n"],[[-1,68222],"\n"],[[-1,68111],"Thus,"],[[-1,68221],14],[[-1,68207]," the insertion position of $o_r$ appears after the insertion position of $o_s$"],[[-1,68106],", regardless of the order in which the two operations are applied. "],[[-1,68037],"The ordering depends only on the operation IDs, and since these IDs are fixed at the t"],[[-1,67947],"ime the operations are generated, the list order is determined by the IDs."],[[-1,67951],2],[[-1,68039],1],[[-1,68129],2],[[-1,68223],"\n"],[[-1,69806],"\\end{proof}"],[[-1,74123],1],[[-1,73916],11],[[-1,74120],94],[[-1,74024],95],[[-1,74026],1],[[-1,74122],1],[[-1,74139],1],[[-1,74166],2],[[-1,74204],1],[[-1,74221],2],[[-1,74223],1],[[-1,74246],2],[[-1,74278],1],[[-1,74306],2],[[-1,74308],"\n"],[[-1,77223],"\n\\begin{lemma}\\label{lem:insert"],[[-1,75048],"-"],[[-1,77192],1],[[-1,77191],"reorder}\n"],[[-1,77138],"In an operation history"],[[-1,73717]," $H$"],[[-1,77115],", "],[[-1,77112],"a"],[[-1,77170],1],[[-1,77169],"n insertion operation "],[[-1,77004],"is commutative"],[[-1,77147],9],[[-1,77111],7],[[-1,77104]," with respect to concurrent insertion operations to the same list"],[[-1,76971],"."],[[-1,77039],19],[[-1,77171],"\n"],[[-1,77182],"\\end{lemma}"],[[-1,76970],"\n\n\\begin{proof}"],[[-1,73713],"\nGiven any two concurrent insertion operations"],[[-1,73630]," $o_r, "],[[-1,73623],1],[[-1,73622],"o_s$"],[[-1,73667]," in $H$, we must show that the docume"],[[-1,73618],"nt state does not depend on the order in which $o_r$ and $o_s$ are applied."],[[-1,73542],"\n\nEither $o_r$ and $o_s$ "],[[-1,73507],"have the same insertion interval as "],[[-1,73469],"defined in Definition~\\ref{def:insert-interval}, or they have different insertion intervals. If the insertion intervals are different, then by Lemma~\\ref{lem:insert-between} the operations cannot affect each other, and so they have the same effect regardless of their order. "],[[-1,73168],"So we need "],[[-1,73157],3],[[-1,73154],"only analyze the case in which they have the same insertion interval $(k^\\mathrm{before}, k"],[[-1,73059],"^\\mathrm{after})$."],[[-1,73063],2],[[-1,73170],1],[[-1,73194],12],[[-1,73471],1],[[-1,73517],5],[[-1,73543],"\n"],[[-1,72072],"\n"],[[-1,66883],"If $o_r.\\mathit{cur} = o_s.\\mathit{cur}$, then by Lemma~\\ref{lem:insert-conflict}, "],[[-1,66800],30],[[-1,66704],6],[[-1,66698],"the operation with the greater operation ID appears first in the list"],[[-1,66593],", regardless of the order in which the operation"],[[-1,66543],"s are applied"],[[-1,66545],1],[[-1,66770],". If $o_r.\\mathit{cur} \\not= o_s.\\mathit{cur}$, "],[[-1,66530],"then one or both of the cursors must refer to a list element that appears between $k^\\mathrm{before}$ and $k^\\mathrm{after}$, and that "],[[-1,66369],"did not yet exist in the common ancestor (Definition~\\ref{def:common-ancestor}).\n\n"],[[-1,66281],"Take "],[[-1,66268],"a cursor that differs from $k^\\mathrm{before}$"],[[-1,66214],": the list element it refers to was "],[[-1,66178],7],[[-1,66171],"inserted by a"],[[-1,66018]," prior"],[[-1,66158],1],[[-1,66157]," operation"],[[-1,66075],", whose cursor in turn refers to another prior operation"],[[-1,66005],", and so on"],[[-1,66147],35],[[-1,66112],". "],[[-1,65994],"Following this chain"],[[-1,65879]," of cursors"],[[-1,65919]," for a finite number of steps"],[[-1,65974]," "],[[-1,65973],11],[[-1,65962],"leads to an operation"],[[-1,65755]," $o_\\mathrm{first}$"],[[-1,65941]," whose cursor refers t"],[[-1,65868],"o $k"],[[-1,65862],"^\\mathrm{before}$"],[[-1,65831],1],[[-1,65830]," "],[[-1,65735],"("],[[-1,65829],"since an insertion operation always inserts at a position after the cursor"],[[-1,65734],")"],[[-1,65833],1],[[-1,65845],"."],[[-1,65670],"\n\n"],[[-1,65844],1],[[-1,65843],"Note that "],[[-1,65733],"all of the operations in this chain are causally dependent on "],[[-1,65668],"$o_\\mathrm{first}$, and so they must have a"],[[-1,65613]," Lamport timestamp greater than $o_\\mathrm{first}$. Thus, we can apply the same argument as in Lemma~\\ref{lem:insert-conflict}"],[[-1,65485],": if $\\textsc{Insert}_2$ skips over the list element inserted by $o_\\mathrm{first}$, it will also skip over all of the list elements that are causally dependent on "],[[-1,65303],"it; if $\\textsc{Insert}_1$ inserts a new element before $o_\\mathrm{first}$, it is also inserted before the chain of operations that is based on it."],[[-1,65317],7],[[-1,65321],2],[[-1,65487],1],[[-1,65625],6],[[-1,65864],1],[[-1,66218],2],[[-1,66222],2],[[-1,66276],4],[[-1,66395],13],[[-1,66722],9],[[-1,66897],7],[[-1,72070],28],[[-1,72033],1],[[-1,72042],9],[[-1,72031],50],[[-1,71975],51],[[-1,71916],26],[[-1,71354],2],[[-1,71890],4],[[-1,71360],1],[[-1,71886],8],[[-1,71343],4],[[-1,71331],7],[[-1,71339],4],[[-1,71878],19],[[-1,71348],2],[[-1,71859],25],[[-1,71830],36],[[-1,71834],2],[[-1,71924],4],[[-1,71981],3],[[-1,72071],1],[[-1,76942],1],[[-1,72508],45],[[-1,72459],46],[[-1,72403],34],[[-1,72355],52],[[-1,72299],104],[[-1,72191],88],[[-1,72081],7],[[-1,71793],37],[[-1,71324],7],[[-1,70927],12],[[-1,71317],37],[[-1,71234],11],[[-1,71280],5],[[-1,71269],1],[[-1,71223],51],[[-1,71002],1],[[-1,71172],24],[[-1,70903],1],[[-1,70659],21],[[-1,70637],1],[[-1,70902],50],[[-1,70850],78],[[-1,70720],61],[[-1,70635],1],[[-1,70772],2],[[-1,70633],1],[[-1,70770],25],[[-1,70743],17],[[-1,70724],4],[[-1,70632],14],[[-1,70616],2],[[-1,70618],1],[[-1,70726],1],[[-1,70745],1],[[-1,70852],1],[[-1,71268],17],[[-1,71275],3],[[-1,71756],44],[[-1,71148],7],[[-1,70915],12],[[-1,71141],1],[[-1,71136],5],[[-1,71129],105],[[-1,71022],18],[[-1,71024],1],[[-1,71131],1],[[-1,71140],2],[[-1,72074],1],[[-1,72103],13],[[-1,72084],3],[[-1,70614],"\n\n"],[[-1,65155],"Therefore, the order of $o_r"],[[-1,65125],"$ and $o_s$ in the final list "],[[-1,64996],"is determined by"],[[-1,65095],10],[[-1,65085]," the Lamport timestamp"],[[-1,65009],"s"],[[-1,65063]," of the first "],[[-1,65019],"insertion"],[[-1,65008],"s "],[[-1,64980],"into the insertion interval after the"],[[-1,64927],"ir"],[[-1,64943]," common ancestor"],[[-1,64924],", in the chain"],[[-1,64883],"s"],[[-1,64910]," of cursor re"],[[-1,64895],"ferences of "],[[-1,64882],"the two operations."],[[-1,64897],1],[[-1,65010],1],[[-1,65049],15],[[-1,65127],1],[[-1,65156]," "],[[-1,70612],92],[[-1,70462],2],[[-1,70460],"Since the argument"],[[-1,66287]," above"],[[-1,70442]," applies to all pairs of concurrent operations $o_r,"],[[-1,70382]," o_s$ in $H$, we deduce that the final order of elements in the list depends only on the operation IDs but not the order of application,"],[[-1,70390],4],[[-1,70514],1],[[-1,70513]," which shows that "],[[-1,70231],"concurrent insertions to the same list"],[[-1,70495],15],[[-1,70480]," are commutative."],[[-1,70520],3],[[-1,72090],3],[[-1,72195],2],[[-1,72303],2],[[-1,72369],7],[[-1,72413],5],[[-1,72461],1],[[-1,72463],1],[[-1,76940],34],[[-1,76894],153],[[-1,76516],2],[[-1,76741],29],[[-1,76710],78],[[-1,76387],4],[[-1,76632],116],[[-1,76513],29],[[-1,76476],3],[[-1,76484],8],[[-1,76473],33],[[-1,76432],45],[[-1,76440],4],[[-1,76712],1],[[-1,76906],6],[[-1,76941],"\n"],[[-1,76955],1],[[-1,76954],"\\end{proof}"],[[-1,77297],3],[[-1,77257],11],[[-1,77294],10],[[-1,77274],17],[[-1,77246],22],[[-1,77284],5],[[-1,92193],"\n\n"],[[-1,92191],18],[[-1,91787],14],[[-1,91769],3],[[-1,91773],2],[[-1,92173],15],[[-1,92156],12],[[-1,92127],102],[[-1,91620],7],[[-1,92025],119],[[-1,91580],20],[[-1,91555],38],[[-1,91906],23],[[-1,91605],7],[[-1,91883],70],[[-1,91499],9],[[-1,91582],1],[[-1,91813],26],[[-1,91490],92],[[-1,92144],17],[[-1,92158],1],[[-1,92440],42],[[-1,92381],45],[[-1,92398],17],[[-1,92714],42],[[-1,92660],57],[[-1,92661],1],[[-1,92672],11],[[-1,92603],15],[[-1,92576],50],[[-1,92487],8],[[-1,92526],30],[[-1,91643],15],[[-1,91398],9],[[-1,91385],2],[[-1,91381],14],[[-1,91383],1],[[-1,91389],2],[[-1,92195],2],[[-1,91699],8],[[-1,91367],9],[[-1,91356],7],[[-1,91358],1],[[-1,91691],1],[[-1,91349],10],[[-1,91337],16],[[-1,91339],1],[[-1,91690],20],[[-1,91321],21],[[-1,91670],26],[[-1,91299],16],[[-1,91277],43],[[-1,91230],30],[[-1,91198],145],[[-1,91051],82],[[-1,90768],44],[[-1,90722],41],[[-1,90673],44],[[-1,90625],66],[[-1,90529],1],[[-1,90559],1],[[-1,90554],24],[[-1,90528],369],[[-1,88165],123],[[-1,88037],7],[[-1,88042],5],[[-1,88030],67],[[-1,90556],1],[[-1,90558],1],[[-1,90629],2],[[-1,90681],4],[[-1,90724],1],[[-1,91053],1],[[-1,91200],1],[[-1,91234],2],[[-1,91283],3],[[-1,91644],1],[[-1,92479],18],[[-1,92459],19],[[-1,92461],1],[[-1,92588],12],[[-1,94909],2],[[-1,95380],1],[[-1,95585],1],[[-1,97043],1],[[-1,83675],1],[[-1,83674],"\\begin{"],[[-1,83663],"lemma}\\label{lem:delete-commute}\n"],[[-1,55328],"In a"],[[-1,55324],11],[[-1,55313]," history $H$, "],[[-1,55297],"a "],[[-1,55298],"d"],[[-1,83614],1],[[-1,83613],"eletion"],[[-1,55295]," operation"],[[-1,83606]," is commutative with respect to"],[[-1,83575],6],[[-1,83569]," concurrent operations.\n\\end{lemma}"],[[-1,56414],"\n\n\\begin{proof}"],[[-1,55375],"\nGiven a deletion operation $o_"],[[-1,55340],5],[[-1,55231],2],[[-1,55335],3],[[-1,55332],"d"],[[-1,55331],3],[[-1,55344],1],[[-1,55343],"$ "],[[-1,55274],"and any other concurrent operation $o_c$"],[[-1,55181],", we must show that the document state after applying both operations does not depend on the order in which $o_d$ and $o_c$ were applied."],[[-1,55234],"\n"],[[-1,56387],"\nThe rules in Figure~\\ref{fig:clear"],[[-1,56350],"-ru"],[[-1,56341],"les} define how a deletion operation"],[[-1,56172]," $o_"],[[-1,56168],8],[[-1,56160],"d"],[[-1,56159],3],[[-1,56156],"$"],[[-1,56305]," is applied: starting at the cursor "],[[-1,56223],"in the operation, they recursively descend the "],[[-1,56108],"sub"],[[-1,56176],"tree"],[[-1,56155],", removing $o_"],[[-1,56141],8],[[-1,56133],"d"],[[-1,56132],3],[[-1,56129],".\\mathit{deps}$ from"],[[-1,56097]," the presence set $\\mathsf{pres}(k)$ at"],[[-1,56109]," "],[[-1,56105],"all bran"],[[-1,56058],"ch nodes in the subtree"],[[-1,55972],", and updating all registers to remove any values written by operations in $o_"],[[-1,55894],5],[[-1,55227],2],[[-1,55889],3],[[-1,55886],"d"],[[-1,55885],3],[[-1,55882],".\\mathit{deps}$."],[[-1,55042],"\n\n"],[[-1,55040],95],[[-1,54945],"If $o_c$ is an assignment or insertion operation, the \\textsc{Assign}"],[[-1,54842]," rule adds $o_c.\\mathit{id}$ to "],[[-1,54804],"the "],[[-1,54786],"mapping from operation ID to value for a register, and the \\textsc{Descend}, \\textsc{Assign},"],[[-1,54800],7],[[-1,54810],3],[[-1,54876],1],[[-1,54875]," \\textsc{Empty-Map} and \\textsc{"],[[-1,54693],"Empty-List} rules add $o_c.\\mathit{id}$ to the presence sets $\\mathsf{pres}(k)$ along the path through the document tree described b"],[[-1,54557],"y the cursor."],[[-1,54297],"\n\nIf"],[[-1,54250]," $o_d.\\mathit{cur}$ is not a prefix of"],[[-1,54252],1],[[-1,54293]," $o_c"],[[-1,54285],".\\mathit{cur}"],[[-1,54288],"$"],[[-1,54190],", the "],[[-1,54182],"operations affect disjoint subtrees of the document, and so they are trivially commutative."],[[-1,53612]," Any state changes by \\textsc{Descend} and $\\textsc{Add-ID}_1$ along the "],[[-1,53535],"shared part of the cursor path are applied using the set union operator $\\cup$, which is commutative.\n\n"],[[-1,53392],"Now consider"],[[-1,53539],2],[[-1,54091],27],[[-1,54062],13],[[-1,54049]," the case where $o_d.\\mathit{cur}"],[[-1,54008],"$ is a prefix of $o_c.\\mathit{cur}$."],[[-1,53378]," "],[[-1,54016],4],[[-1,54064],1],[[-1,54184],1],[[-1,54287],2],[[-1,54272],20],[[-1,54544],2],[[-1,54542],"Since $o_c$ is concurrent with $o_d$, we know that $o_c.\\mathit{id} \\notin o_d.\\mathit{deps}$."],[[-1,54353]," Th"],[[-1,53688],"erefore"],[[-1,54350],2],[[-1,54348],", if $o_c$ is applied before $o_d$ in "],[[-1,54308],"the history"],[[-1,53972],", the \\textsc{Clear-*} rules "],[[-1,53923],"evaluating $o_d$ wi"],[[-1,53786],"ll"],[[-1,53904],2],[[-1,53902]," leave any occurrences of $o_c.\\mathit{id}$ "],[[-1,53852],"in the document state "],[[-1,53858],"undist"],[[-1,53830],"urbed"],[[-1,53681],", while removing any occurrences of operations in $o_d.\\mathit{deps}$"],[[-1,53825],"."],[[-1,53374],"\n\nIf $o_"],[[-1,53338],"d"],[[-1,53366],1],[[-1,53365],"$ is applied "],[[-1,53332],"before"],[[-1,53352],5],[[-1,53347]," $o_"],[[-1,53325],"c"],[[-1,53343],1],[[-1,53342],"$, "],[[-1,53324],"the effect on presence sets and registers is the same as if they had been "],[[-1,53236],"applied in the reverse orde"],[[-1,53181],"r. Moreover"],[[-1,53168],", $o_c$ "],[[-1,53112],"applies in the same wa"],[[-1,53088],"y as if $o_d$ had not been applied previously, because "],[[-1,53005],"applying a deletion only modifies presence sets and registers, "],[[-1,52737],"without"],[[-1,52942],12],[[-1,52930]," actually remov"],[[-1,52729],"ing"],[[-1,52915],5],[[-1,52910]," map keys or list "],[[-1,52882],"elements"],[[-1,52873],", and because the rules for applying an operation are not conditional on the previous content of presence sets and registers"],[[-1,52874],"."],[[-1,52892],5],[[-1,53017],6],[[-1,53021],2],[[-1,53033],6],[[-1,53090],1],[[-1,53160],24],[[-1,53170],1],[[-1,53209],14],[[-1,53250],7],[[-1,53376],"\n\n"],[[-1,52722],"Thus, "],[[-1,52715],"t"],[[-1,53824],2],[[-1,53822],"he effect of "],[[-1,53797],"applying "],[[-1,53784],"$o_c$ before $o_d$ is"],[[-1,53763],5],[[-1,53758]," the same as applying $o_d$ before $o_c$, so the operations commute."],[[-1,53809],6],[[-1,53943],10],[[-1,54310],1],[[-1,54561],2],[[-1,55044],1],[[-1,56269],23],[[-1,56347],3],[[-1,56352],1],[[-1,56399],"\n\\end{proof}"],[[-1,83534],"\n\n\\begin{lemma}\\label{lem:assign-commute}\n"],[[-1,50389],"In a history $H$, an "],[[-1,50367],"a"],[[-1,83492],1],[[-1,83491],"ssignment"],[[-1,50366]," operation"],[[-1,83482]," is commutative with respect to "],[[-1,83450],6],[[-1,83444],"concurrent operations."],[[-1,83630],8],[[-1,83667],2],[[-1,256554],"\n"],[[-1,83410],"\\end{lemma}"],[[-1,50356],"\n\n\\begin{proof}"],[[-1,50329],"\nGiven an assignment $o_a$ and any other concurrent operation $o_c$, we must show that the document state after applying both operations does not depend on the order in which "],[[-1,50152],"$o_a$ and $o_c$ were applied.\n\nThe rules \\textsc{Assign}, \\textsc{Empty-Map} and \\textsc{Empty-List} define how an assignment operation $o_a$ is applied, depending on the value being assigned. All three rules first clear any causally prior state from the cursor at which the assignment is occurring; by Lemma~\\ref{lem:delete-commute}, this clearing operation is commutative with concurrent operations, and leaves updates by concurrent operations untouched."],[[-1,50154],1],[[-1,50341],"\n"],[[-1,49695],"\n"],[[-1,49656],"The rules also add $o_a.\\mathit{id}$ to the presence set identified by the cursor, and \\textsc{Descend} adds $o_a.\\mathit{id}$ to the presence sets "],[[-1,49504],"on the path from the root of the document tree described by the cursor. These state changes are applied using the set union operator $\\cup$, which is commutative.\n\nFinally"],[[-1,49331],", in the case where"],[[-1,49241]," value assigned by $o_a$"],[[-1,49312]," "],[[-1,49311],19],[[-1,49292],"is a primitive and the \\textsc{Assign} rule applies"],[[-1,49198],", the mapping from operation ID to value is added to the register"],[[-1,49059]," by the expression"],[[-1,49119],1],[[-1,49118]," "],[[-1,49115],"$\\mathit{child}[\\,\\mathit{id} \\mapsto \\mathit{val}\\,]$."],[[-1,48840],1],[[-1,49041]," "],[[-1,49040],102],[[-1,48147],1],[[-1,48938],11],[[-1,48146],1],[[-1,48927],42],[[-1,48779],4],[[-1,48885],29],[[-1,48854],13],[[-1,48838],53],[[-1,48775],6],[[-1,48841],1],[[-1,48769],2],[[-1,48767],"If"],[[-1,48675]," $o_c$ is not an assignment operation or if"],[[-1,48765]," $o_a.\\mathit{cursor} \\not= o_c.\\mathit{cursor}$, the "],[[-1,48695],"operations "],[[-1,48623],"are independent and thus trivially commutative."],[[-1,47456],"\n\n"],[[-1,48576],1],[[-1,48575],"If $o_a$ and $o_c$ are assignments to the same cursor, we use the "],[[-1,48136],"commutativity of "],[[-1,48119],5],[[-1,48112],7],[[-1,48105],"updates to a partial function:"],[[-1,48114],1],[[-1,48509],9],[[-1,48500]," "],[[-1,48415],"$\\mathit{child}[\\,\\mathit{id}_1 \\mapsto \\mathit{val"],[[-1,48362],"}_1\\,]"],[[-1,48252],"\\,"],[[-1,48356],"["],[[-1,48353],"\\,\\mathit{id}_2 \\mapsto \\mathit{val}_2\\,] = \\mathit{child}[\\,\\mathit{id}_2 \\mapsto \\mathit{val}_2\\,]"],[[-1,48250],"\\,"],[[-1,48253],"["],[[-1,48248],"\\,\\mathit{id}_1 \\mapsto \\mathit{val}_1"],[[-1,48208],"\\,]$ provided that $\\mathit{id}_1 \\not= \\mathit{"],[[-1,48154],"id}_2$."],[[-1,47866]," Since operation IDs (Lamport timestamps) are unique, two concurrent assignments add two different keys to the mapping"],[[-1,47747],", and their order is immaterial"],[[-1,47748],"."],[[-1,48075],"\n\nThus, "],[[-1,48051],"all parts of the process of applying $o_"],[[-1,48009],"a$ have the same effect"],[[-1,47922]," on the document state"],[[-1,47986],", regardless of whether $o_c$ "],[[-1,47897],"is"],[[-1,47956],3],[[-1,47953]," applied before or after $o_a$"],[[-1,47895],", so the op"],[[-1,47882],"erations commute"],[[-1,47884],1],[[-1,47923],"."],[[-1,48011],1],[[-1,48067],8],[[-1,48160],3],[[-1,48210],1],[[-1,48355],1],[[-1,48364],1],[[-1,48499],42],[[-1,48684],9],[[-1,48711],8],[[-1,48856],1],[[-1,49117],1],[[-1,49133],7],[[-1,49333],1],[[-1,49508],2],[[-1,49696],"\n"],[[-1,50340],"\\end{proof}"],[[-1,47442],"\n\n\\begin{lemma}\\label{lem:op-commute}"],[[-1,46903],"\n"],[[-1,46865],"Given an operation histor"],[[-1,46834],"y $H=\\langle o_1, \\dots, o_n \\rangle$"],[[-1,46779]," from a valid execution"],[[-1,46797],", a new operation "],[[-1,46756],"$o_{n+1}$ from that execution can be inserted at any point in $H$"],[[-1,46629]," after $o"],[[-1,46618],"_{n+1}.\\mathit{deps}$ have been applied. "],[[-1,46534],"For "],[[-1,46529],"a"],[[-1,46575],1],[[-1,46574],"ll"],[[-1,46550]," histories "],[[-1,46465],"$H'$ "],[[-1,46539],"that "],[[-1,46528],"can be constructed this way, the document state resulting from "],[[-1,46460],"applying the operations in $H'$ in order is the same, and independent of the ordering of any concurrent operations in $H$."],[[-1,46572],11],[[-1,46577],1],[[-1,46620],1],[[-1,46691],31],[[-1,46840],3],[[-1,46866],"\n"],[[-1,46902],"\\end{lemma}\n\n\\begin{proof}"],[[-1,46245],"\n$H$ can be split into a prefix and a suffix, as described in the proof of Theorem~\\ref{thm:convergence}."],[[-1,46074]," The suffix contains only operations that are concurrent with $o_{n+1}$"],[[-1,45999],", and w"],[[-1,46003],1],[[-1,46140],2],[[-1,46138],"e allow $o_{n+1}$ to be inserted at any point after the prefix"],[[-1,45990],". "],[[-1,46076],2],[[-1,46338],1],[[-1,46336],"We"],[[-1,45987]," then"],[[-1,46334]," prove the lemma case-by-case, depending on the t"],[[-1,46275],"ype of mutation in $o_{n+1}$. "],[[-1,46285],5],[[-1,46337],"\n"],[[-1,45982],"\n"],[[-1,45980],"If $o_"],[[-1,45970],"{n+1}$ is a deletion, by Lemma~\\ref{lem:delete-commute} it is co"],[[-1,45864],"mmutative with all operations in the suffix, and so $"],[[-1,45809],"o_{n+1}$ can be inserted at any point within, before, or after the suffix without changing its"],[[-1,45713]," effect on the final document state. Similarly, if $o_{n+1}$ is an assignment, by Lemma~\\ref{lem:assign-commute} it is commutative with all operations in the suffix.\n\nIf $o_"],[[-1,45538],"{n+1}$ is an insertion, let $o_c$ be any operation in the suffix, and consider the cases "],[[-1,45439],"of $o_{n+1}$ being inserted before and after $o_c$ in the history. If $o_c$ is a deletion or assignment, it is commutative with $o_{n+1}$ by Lemma~\\ref{lem:"],[[-1,45277],"delete-commute} or Lemma~\\ref{lem:assign-commute} respectively."],[[-1,45013]," If $o_c$ is an insertion into the same list as $o_{n+"],[[-1,44957],"1}$, then by Lemma~\\ref{lem:insert-reorder} the operations are commutative."],[[-1,44959],1],[[-1,45214]," If $o_c$ is an insertion into a different list in the document"],[[-1,45015],1],[[-1,45023],4],[[-1,45151],", its effect is independent from $o_{n+1}$ and so the two operations can be applied in any order."],[[-1,45054],31],[[-1,45283],3],[[-1,45449],5],[[-1,45540],1],[[-1,45715],1],[[-1,45811],1],[[-1,45906],21],[[-1,45974],2],[[-1,45981],"\n"],[[-1,47393],"\n"],[[-1,44706],"Thus,"],[[-1,44691]," $o_{n+"],[[-1,44680],"1}$ is commutative with respect to any concurrent operation in $H$"],[[-1,44464],". "],[[-1,44461],"T"],[[-1,44614],7],[[-1,44607],"herefore"],[[-1,44460],","],[[-1,44599]," "],[[-1,44471],"$"],[[-1,44459],"o_{n+1}$ can be inserted"],[[-1,44380]," into $H$"],[[-1,44435]," at any point after "],[[-1,44413],"its causal dependencies, and the "],[[-1,44371],"effect on the final document state is independent of the position at which the operation is inserted."],[[-1,44415],1],[[-1,44684],2],[[-1,44701],5],[[-1,47392],81],[[-1,47309],64],[[-1,47311],1],[[-1,47405],"\n\\end{"],[[-1,46871],"proof"],[[-1,47399],5],[[-1,47394],"}"],[[-1,44598],"\n\nThis completes the induction step in the proof of Theorem~\\ref{thm:convergence}, and thus proves convergence of our datatype."],[[-1,50494],"\n"],[[-1,83399],1],[[-1,256545],33],[[-1,256508],56],[[-1,256310],1],[[-1,256452],21],[[-1,256119],7],[[-1,255952],5],[[-1,256112],11],[[-1,256141],2],[[-1,256124],1],[[-1,256431],12],[[-1,256415],2],[[-1,256398],2],[[-1,256302],1],[[-1,256396],8],[[-1,255816],1],[[-1,256388],47],[[-1,256339],22],[[-1,256301],1],[[-1,255818],1],[[-1,256300],2],[[-1,255811],1],[[-1,255815],1],[[-1,255812],1],[[-1,256298],14],[[-1,256272],1],[[-1,255825],6],[[-1,256245],53],[[-1,256271],2],[[-1,255975],2],[[-1,255972],5],[[-1,256269],3],[[-1,255819],1],[[-1,256266],4],[[-1,252239],5],[[-1,256262],8],[[-1,255925],1],[[-1,256254],5],[[-1,255934],1],[[-1,255931],1],[[-1,255933],1],[[-1,256192],37],[[-1,255924],1],[[-1,255842],2],[[-1,255923],6],[[-1,255840],2],[[-1,255917],1],[[-1,255908],15],[[-1,255916],4],[[-1,256079],4],[[-1,255831],6],[[-1,256075],2],[[-1,255982],2],[[-1,256073],12],[[-1,256059],29],[[-1,255814],2],[[-1,256030],27],[[-1,255984],2],[[-1,255985],1],[[-1,256003],1],[[-1,255966],6],[[-1,256002],3],[[-1,255832],1],[[-1,255999],4],[[-1,252244],5],[[-1,255995],8],[[-1,255926],1],[[-1,255987],2],[[-1,255928],2],[[-1,255893],29],[[-1,255838],2],[[-1,255864],6],[[-1,255836],1],[[-1,255833],1],[[-1,255835],1],[[-1,255858],16],[[-1,256061],1],[[-1,256284],12],[[-1,256096],6],[[-1,255939],5],[[-1,256090],10],[[-1,252402],70],[[-1,251591],14],[[-1,252332],32],[[-1,252296],14],[[-1,243284],29],[[-1,252282],27],[[-1,252253],9],[[-1,252255],1],[[-1,252300],2],[[-1,255810],2],[[-1,255579],1],[[-1,255808],34],[[-1,255772],77],[[-1,255679],56],[[-1,255613],11],[[-1,255578],57],[[-1,255515],164],[[-1,255349],16],[[-1,255303],13],[[-1,255333],30],[[-1,255290],49],[[-1,255204],1],[[-1,255241],19],[[-1,255191],30],[[-1,255153],35],[[-1,249096],3],[[-1,255118],14],[[-1,255102],1],[[-1,255088],1],[[-1,255101],12],[[-1,255087],3],[[-1,254962],4],[[-1,255084],1],[[-1,254957],1],[[-1,255083],1],[[-1,255065],36],[[-1,255000],1],[[-1,255029],2],[[-1,254976],4],[[-1,255027],9],[[-1,254980],1],[[-1,255018],1],[[-1,254979],2],[[-1,255017],16],[[-1,254999],19],[[-1,255104],1],[[-1,255161],4],[[-1,255222],12],[[-1,255351],1],[[-1,255521],3],[[-1,255623],5],[[-1,255695],8],[[-1,255774],1],[[-1,256080],1],[[-1,255082],1],[[-1,254967],3],[[-1,255081],11],[[-1,255068],2],[[-1,251561],65],[[-1,251494],94],[[-1,251387],8],[[-1,251377],10],[[-1,251327],1],[[-1,251367],3],[[-1,251360],9],[[-1,250918],1],[[-1,251351],24],[[-1,251326],11],[[-1,250917],1],[[-1,251315],15],[[-1,251298],21],[[-1,251263],8],[[-1,251247],24],[[-1,250916],1],[[-1,251223],10],[[-1,250944],1],[[-1,250935],1],[[-1,251213],16],[[-1,251195],29],[[-1,251164],28],[[-1,251105],30],[[-1,251136],10],[[-1,250915],1],[[-1,251126],10],[[-1,250937],2],[[-1,251116],11],[[-1,251062],59],[[-1,251001],1],[[-1,250928],2],[[-1,251000],2],[[-1,250929],1],[[-1,250998],16],[[-1,250980],30],[[-1,250982],1],[[-1,251003],1],[[-1,251166],1],[[-1,251197],1],[[-1,251255],4],[[-1,251277],5],[[-1,251270],7],[[-1,251272],1],[[-1,251300],1],[[-1,251364],2],[[-1,251379],1],[[-1,251400],13],[[-1,250914],157],[[-1,250274],4],[[-1,250757],34],[[-1,250721],2],[[-1,250715],53],[[-1,249164],3],[[-1,250662],9],[[-1,249181],4],[[-1,250653],26],[[-1,249160],37],[[-1,250627],3],[[-1,250591],4],[[-1,250583],1],[[-1,250587],2],[[-1,250624],17],[[-1,250582],1],[[-1,250576],32],[[-1,250607],1],[[-1,250579],3],[[-1,250606],15],[[-1,248734],14],[[-1,248718],2],[[-1,248720],1],[[-1,248992],1],[[-1,250480],117],[[-1,248988],14],[[-1,250363],11],[[-1,250338],3],[[-1,248973],1],[[-1,250335],21],[[-1,248944],4],[[-1,250314],1],[[-1,248958],4],[[-1,250313],39],[[-1,250270],8],[[-1,248947],1],[[-1,248940],27],[[-1,250262],4],[[-1,248909],4],[[-1,250258],9],[[-1,248877],1],[[-1,250249],29],[[-1,248876],10],[[-1,250220],27],[[-1,249122],7],[[-1,249100],1],[[-1,248737],3],[[-1,249115],15],[[-1,249099],3],[[-1,249093],91],[[-1,248866],1],[[-1,249002],3],[[-1,250193],3],[[-1,250149],35],[[-1,250108],79],[[-1,250114],3],[[-1,250186],37],[[-1,250029],30],[[-1,249993],8],[[-1,249975],6],[[-1,249985],10],[[-1,249969],230],[[-1,249559],2],[[-1,249553],3],[[-1,249557],2],[[-1,249739],18],[[-1,249719],15],[[-1,249394],14],[[-1,249704],64],[[-1,249638],5],[[-1,249631],72],[[-1,249545],9],[[-1,249492],98],[[-1,249380],19],[[-1,249343],39],[[-1,249244],4],[[-1,249262],9],[[-1,249304],41],[[-1,249239],58],[[-1,248716],79],[[-1,248635],30],[[-1,248571],1],[[-1,247502],16],[[-1,247476],17],[[-1,247458],1],[[-1,247486],10],[[-1,248570],1],[[-1,248605],33],[[-1,248569],37],[[-1,248500],89],[[-1,247297],5],[[-1,248411],4],[[-1,248393],118],[[-1,248251],4],[[-1,248275],24],[[-1,248246],3],[[-1,248241],7],[[-1,248230],115],[[-1,248105],88],[[-1,247930],11],[[-1,247911],40],[[-1,247919],4],[[-1,248017],16],[[-1,247999],24],[[-1,247835],8],[[-1,247975],18],[[-1,247949],14],[[-1,247933],2],[[-1,247814],1],[[-1,247931],1],[[-1,247811],20],[[-1,247827],13],[[-1,247791],13],[[-1,247617],113],[[-1,247778],1],[[-1,247504],2],[[-1,247292],37],[[-1,247253],247],[[-1,247004],70],[[-1,246757],148],[[-1,246758],1],[[-1,246608],1],[[-1,246934],85],[[-1,246847],16],[[-1,246800],41],[[-1,246831],11],[[-1,246607],93],[[-1,246759],1],[[-1,246514],11],[[-1,246479],22],[[-1,246447],37],[[-1,246340],3],[[-1,246410],25],[[-1,246330],6],[[-1,246385],12],[[-1,246359],1],[[-1,246373],14],[[-1,246358],17],[[-1,246324],21],[[-1,246301],92],[[-1,246207],10],[[-1,246195],94],[[-1,246093],49],[[-1,246022],8],[[-1,245915],2],[[-1,246014],49],[[-1,245913],12],[[-1,245965],40],[[-1,245900],220],[[-1,245678],57],[[-1,245434],118],[[-1,245436],2],[[-1,245530],21],[[-1,245621],56],[[-1,245482],45],[[-1,245315],3],[[-1,244554],27],[[-1,244525],27],[[-1,244527],1],[[-1,245312],4],[[-1,244951],1],[[-1,245308],19],[[-1,244457],3],[[-1,245289],55],[[-1,244944],6],[[-1,245234],7],[[-1,245225],28],[[-1,244930],33],[[-1,244441],3],[[-1,244897],34],[[-1,244861],19],[[-1,244863],1],[[-1,245197],1],[[-1,244841],2],[[-1,245076],88],[[-1,244786],1],[[-1,244988],1],[[-1,244839],1],[[-1,244987],1],[[-1,244838],51],[[-1,244986],13],[[-1,244693],3],[[-1,244973],3],[[-1,244690],13],[[-1,244695],1],[[-1,244970],2],[[-1,244677],1],[[-1,244674],6],[[-1,244676],1],[[-1,244968],14],[[-1,244668],53],[[-1,244424],1],[[-1,244615],1],[[-1,244426],1],[[-1,244614],5],[[-1,244603],49],[[-1,244438],1],[[-1,244423],19],[[-1,244088],15],[[-1,244404],9],[[-1,244009],1],[[-1,244395],1],[[-1,243983],2],[[-1,244002],1],[[-1,244394],1],[[-1,243986],2],[[-1,244393],1],[[-1,244368],2],[[-1,244392],24],[[-1,244366],4],[[-1,244195],5],[[-1,244166],2],[[-1,244190],8],[[-1,244362],16],[[-1,244340],2],[[-1,244346],6],[[-1,244338],19],[[-1,244181],13],[[-1,244319],5],[[-1,244253],1],[[-1,244068],2],[[-1,244252],2],[[-1,244314],1],[[-1,244066],6],[[-1,244313],17],[[-1,244060],1],[[-1,243992],5],[[-1,244059],5],[[-1,244233],1],[[-1,244005],1],[[-1,244001],1],[[-1,244004],1],[[-1,244232],1],[[-1,244296],3],[[-1,244257],4],[[-1,244293],3],[[-1,244228],2],[[-1,244290],16],[[-1,244008],1],[[-1,244274],5],[[-1,244212],5],[[-1,244162],2],[[-1,244202],2],[[-1,244207],3],[[-1,244269],1],[[-1,244200],4],[[-1,244268],2],[[-1,244225],13],[[-1,244266],2],[[-1,244047],4],[[-1,243995],1],[[-1,244007],2],[[-1,244264],3],[[-1,244159],35],[[-1,244042],11],[[-1,244124],3],[[-1,244031],6],[[-1,244121],26],[[-1,244093],5],[[-1,244023],13],[[-1,244095],1],[[-1,244261],1],[[-1,244609],3],[[-1,244954],2],[[-1,244785],44],[[-1,245227],1],[[-1,245437],1],[[-1,245565],17],[[-1,245680],1],[[-1,245925],1],[[-1,246044],11],[[-1,246101],4],[[-1,246197],1],[[-1,246209],1],[[-1,246303],1],[[-1,246457],5],[[-1,246503],12],[[-1,246820],10],[[-1,246849],1],[[-1,247006],1],[[-1,247255],1],[[-1,247777],107],[[-1,247651],5],[[-1,247670],18],[[-1,247646],29],[[-1,247935],1],[[-1,247957],4],[[-1,248001],1],[[-1,248115],5],[[-1,248234],2],[[-1,248243],1],[[-1,248407],7],[[-1,248532],16],[[-1,248637],1],[[-1,249263],1],[[-1,249361],9],[[-1,249536],22],[[-1,249633],1],[[-1,249640],1],[[-1,249721],1],[[-1,249999],3],[[-1,250188],1],[[-1,250190],1],[[-1,250352],7],[[-1,250496],8],[[-1,250512],8],[[-1,250719],2],[[-1,250723],1],[[-1,251496],1],[[-1,255066],1],[[-1,243981],1],[[-1,243979],25],[[-1,243952],47],[[-1,243890],189],[[-1,243686],4],[[-1,243701],13],[[-1,243682],1],[[-1,243688],2],[[-1,243681],59],[[-1,242237],5],[[-1,242228],1],[[-1,242232],4],[[-1,242227],26],[[-1,243622],5],[[-1,243615],1],[[-1,243533],1],[[-1,243614],20],[[-1,243592],20],[[-1,243525],9],[[-1,243514],60],[[-1,243452],44],[[-1,243406],32],[[-1,243372],35],[[-1,243185],16],[[-1,243087],3],[[-1,243169],37],[[-1,243106],8],[[-1,243084],40],[[-1,242240],1],[[-1,243044],55],[[-1,243132],13],[[-1,243201],4],[[-1,242989],48],[[-1,243197],11],[[-1,242941],33],[[-1,242906],28],[[-1,242908],1],[[-1,243202],1],[[-1,243337],53],[[-1,243374],1],[[-1,243408],1],[[-1,243454],1],[[-1,243516],1],[[-1,243594],1],[[-1,243617],1],[[-1,243954],1],[[-1,243980],1],[[-1,242876],1],[[-1,242874],121],[[-1,242751],44],[[-1,242686],14],[[-1,242707],21],[[-1,242672],22],[[-1,242241],1],[[-1,242650],29],[[-1,242611],7],[[-1,242602],3],[[-1,242591],12],[[-1,242569],5],[[-1,242393],36],[[-1,242339],56],[[-1,242357],9],[[-1,242564],12],[[-1,242496],15],[[-1,242552],56],[[-1,242481],88],[[-1,242239],2],[[-1,242201],27],[[-1,242172],2],[[-1,242136],6],[[-1,242126],8],[[-1,242114],1],[[-1,242111],11],[[-1,242098],1],[[-1,242095],3],[[-1,242082],37],[[-1,242039],96],[[-1,241933],50],[[-1,241848],14],[[-1,241883],35],[[-1,241834],1],[[-1,241284],12],[[-1,241833],13],[[-1,241818],13],[[-1,241272],15],[[-1,241805],267],[[-1,241288],1],[[-1,241538],16],[[-1,241516],1],[[-1,241522],5],[[-1,241515],5],[[-1,241484],68],[[-1,241404],115],[[-1,241242],4],[[-1,241218],7],[[-1,241209],61],[[-1,241146],85],[[-1,239583],146],[[-1,239435],26],[[-1,239407],73],[[-1,239001],29],[[-1,239334],1],[[-1,238955],26],[[-1,239333],24],[[-1,238920],12],[[-1,239309],13],[[-1,238905],5],[[-1,239296],25],[[-1,239263],1],[[-1,239258],24],[[-1,238895],25],[[-1,239234],50],[[-1,239174],35],[[-1,238766],40],[[-1,238496],52],[[-1,238420],22],[[-1,238444],1],[[-1,238390],3],[[-1,238443],23],[[-1,238363],252],[[-1,238053],14],[[-1,238028],1],[[-1,238039],10],[[-1,237787],15],[[-1,238029],1],[[-1,238027],12],[[-1,237772],19],[[-1,238015],23],[[-1,237286],59],[[-1,237992],1],[[-1,237989],8],[[-1,237977],6],[[-1,237965],58],[[-1,237903],35],[[-1,237599],10],[[-1,237868],47],[[-1,237819],7],[[-1,237804],17],[[-1,237753],28],[[-1,237711],1],[[-1,237712],1],[[-1,237725],13],[[-1,237710],52],[[-1,237656],22],[[-1,237220],11],[[-1,237634],8],[[-1,237181],19],[[-1,237626],13],[[-1,237162],6],[[-1,237613],4],[[-1,237658],1],[[-1,237812],4],[[-1,237821],1],[[-1,237907],2],[[-1,237971],3],[[-1,237981],2],[[-1,237991],1],[[-1,238111],29],[[-1,238375],6],[[-1,238387],6],[[-1,239139],31],[[-1,239067],23],[[-1,239108],24],[[-1,239044],43],[[-1,239184],5],[[-1,239262],2],[[-1,239271],4],[[-1,239409],1],[[-1,239437],1],[[-1,239585],1],[[-1,87963],3],[[-1,239584],1],[[-1,241061],36],[[-1,241019],92],[[-1,240849],19],[[-1,240927],14],[[-1,240905],43],[[-1,240830],81],[[-1,237583],113],[[-1,237468],39],[[-1,236800],5],[[-1,236526],8],[[-1,236795],2],[[-1,236772],1],[[-1,236793],2],[[-1,236789],16],[[-1,236771],43],[[-1,236724],47],[[-1,236584],4],[[-1,236576],2],[[-1,236567],2],[[-1,236574],7],[[-1,236565],6],[[-1,236580],2],[[-1,236677],2],[[-1,236516],7],[[-1,236675],37],[[-1,236559],6],[[-1,236638],54],[[-1,236509],16],[[-1,236457],7],[[-1,236493],8],[[-1,236469],4],[[-1,236450],3],[[-1,236465],1],[[-1,236485],16],[[-1,236445],101],[[-1,236221],28],[[-1,236192],25],[[-1,236193],1],[[-1,236344],87],[[-1,236253],5],[[-1,236150],62],[[-1,236248],2],[[-1,236162],3],[[-1,236246],14],[[-1,235769],6],[[-1,236232],1],[[-1,236167],1],[[-1,236159],9],[[-1,236078],8],[[-1,235763],1],[[-1,236070],46],[[-1,236022],4],[[-1,235756],4],[[-1,236018],32],[[-1,235752],1],[[-1,235986],1],[[-1,235983],23],[[-1,235746],3],[[-1,235960],55],[[-1,235741],1],[[-1,235905],36],[[-1,235735],3],[[-1,235869],24],[[-1,235048],1],[[-1,235041],128],[[-1,234905],33],[[-1,234871],2],[[-1,234913],4],[[-1,235047],3],[[-1,235845],70],[[-1,235379],51],[[-1,235289],2],[[-1,235297],4],[[-1,235328],29],[[-1,235287],1],[[-1,235775],4],[[-1,235286],21],[[-1,235771],1],[[-1,235722],5],[[-1,235264],23],[[-1,235237],26],[[-1,235239],1],[[-1,235241],1],[[-1,235717],9],[[-1,235195],11],[[-1,235708],53],[[-1,235645],4],[[-1,235639],101],[[-1,235524],118],[[-1,235404],15],[[-1,235387],8],[[-1,234869],45],[[-1,234814],21],[[-1,234824],10],[[-1,234793],2],[[-1,234783],6],[[-1,234791],8],[[-1,234777],32],[[-1,234729],35],[[-1,234684],43],[[-1,234639],75],[[-1,234562],23],[[-1,234564],1],[[-1,234641],1],[[-1,234694],5],[[-1,234745],8],[[-1,235389],1],[[-1,235406],1],[[-1,235538],7],[[-1,235641],1],[[-1,235655],5],[[-1,235732],5],[[-1,235985],1],[[-1,236024],1],[[-1,236231],10],[[-1,236257],2],[[-1,236447],1],[[-1,236728],2],[[-1,236791],1],[[-1,237470],1],[[-1,237585],2],[[-1,233602],179],[[-1,237150],5],[[-1,237140],11],[[-1,237145],3],[[-1,237129],5],[[-1,237086],1],[[-1,237124],11],[[-1,237109],1],[[-1,237113],4],[[-1,237108],20],[[-1,237087],1],[[-1,237088],1],[[-1,237142],1],[[-1,237085],96],[[-1,236987],3],[[-1,236980],31],[[-1,236893],10],[[-1,236949],50],[[-1,236883],52],[[-1,236814],14],[[-1,236831],13],[[-1,236816],2],[[-1,236818],1],[[-1,236984],2],[[-1,236989],1],[[-1,240749],14],[[-1,240733],39],[[-1,240692],25],[[-1,240665],103],[[-1,240560],10],[[-1,240548],30],[[-1,240427],9],[[-1,240518],17],[[-1,240492],9],[[-1,240501],6],[[-1,240483],2],[[-1,240495],3],[[-1,240481],43],[[-1,240418],76],[[-1,240178],6],[[-1,240170],11],[[-1,240150],9],[[-1,240172],1],[[-1,240342],115],[[-1,240225],47],[[-1,240103],1],[[-1,240060],48],[[-1,240011],57],[[-1,240012],1],[[-1,239954],7],[[-1,239945],3],[[-1,239926],8],[[-1,239942],16],[[-1,239918],155],[[-1,239761],65],[[-1,239692],107],[[-1,239696],2],[[-1,239763],1],[[-1,239947],1],[[-1,240102],16],[[-1,240084],4],[[-1,240086],1],[[-1,240227],1],[[-1,240550],1],[[-1,240562],1],[[-1,240667],1],[[-1,240694],1],[[-1,240735],1],[[-1,240913],4],[[-1,241025],3],[[-1,241148],1],[[-1,241211],1],[[-1,241224],3],[[-1,241238],7],[[-1,241416],6],[[-1,241510],13],[[-1,241820],1],[[-1,241943],5],[[-1,242045],3],[[-1,242097],1],[[-1,242100],1],[[-1,242113],1],[[-1,242118],2],[[-1,242130],2],[[-1,242170],7],[[-1,242159],8],[[-1,242163],2],[[-1,242174],1],[[-1,242579],5],[[-1,242599],4],[[-1,242604],1],[[-1,242621],5],[[-1,242753],1],[[-1,242875],1],[[-1,197206],"\n\\fi %"],[[-1,50482]," include"],[[-1,50472],"appendix"],[[-1,50474],1],[[-1,197200],11],[[-1,143308],"\n"],[[-1,143307],18],[[-1,143287],6],[[-1,140913],40],[[-1,138453],22],[[-1,140873],1],[[-1,143281],21],[[-1,143258],193],[[-1,142938],1],[[-1,142943],5],[[-1,142937],14],[[-1,143065],108],[[-1,142923],109],[[-1,142811],12],[[-1,142813],1],[[-1,142814],1],[[-1,142812],1],[[-1,142799],135],[[-1,142468],14],[[-1,142664],20],[[-1,142642],174],[[-1,142454],57],[[-1,140533],22],[[-1,142234],75],[[-1,142397],7],[[-1,142138],9],[[-1,142390],20],[[-1,142326],7],[[-1,142370],32],[[-1,142319],64],[[-1,142129],33],[[-1,142094],26],[[-1,142045],13],[[-1,142068],23],[[-1,142032],2],[[-1,142018],24],[[-1,141610],2],[[-1,141105],68],[[-1,141035],72],[[-1,140955],42],[[-1,140963],4],[[-1,141037],1],[[-1,141106],1],[[-1,141994],1],[[-1,141980],12],[[-1,141966],16],[[-1,141968],1],[[-1,141993],5],[[-1,141947],1],[[-1,141988],7],[[-1,141946],90],[[-1,141652],41],[[-1,141856],84],[[-1,141759],7],[[-1,141772],13],[[-1,141752],96],[[-1,141604],121],[[-1,141429],1],[[-1,141372],155],[[-1,141114],6],[[-1,141107],1],[[-1,141217],3],[[-1,141179],4],[[-1,141174],1],[[-1,141214],34],[[-1,141172],55],[[-1,140754],149],[[-1,140565],21],[[-1,140500],119],[[-1,140377],6],[[-1,140381],2],[[-1,140544],11],[[-1,140605],12],[[-1,140587],5],[[-1,140593],3],[[-1,140872],20],[[-1,138478],25],[[-1,140371],23],[[-1,140346],40],[[-1,140264],7],[[-1,139681],15],[[-1,140257],83],[[-1,139666],19],[[-1,137736],13],[[-1,139647],1],[[-1,140174],81],[[-1,140091],38],[[-1,140041],133],[[-1,139898],17],[[-1,139908],10],[[-1,139881],34],[[-1,139840],11],[[-1,139847],7],[[-1,139817],18],[[-1,139818],1],[[-1,139799],63],[[-1,137723],22],[[-1,139736],55],[[-1,137560],13],[[-1,137509],185],[[-1,137320],51],[[-1,137267],49],[[-1,136198],2],[[-1,137218],1],[[-1,136194],64],[[-1,136128],22],[[-1,136130],1],[[-1,137269],1],[[-1,137324],2],[[-1,137547],19],[[-1,137701],37],[[-1,137217],5],[[-1,137664],1],[[-1,137645],21],[[-1,137207],9],[[-1,137624],10],[[-1,137612],52],[[-1,136101],1],[[-1,136046],104],[[-1,135881],5],[[-1,135942],3],[[-1,135931],25],[[-1,135876],10],[[-1,135906],6],[[-1,135896],3],[[-1,135889],6],[[-1,135893],2],[[-1,135900],2],[[-1,135939],4],[[-1,136100],9],[[-1,137614],1],[[-1,137647],1],[[-1,137663],8],[[-1,140053],6],[[-1,140093],1],[[-1,140306],21],[[-1,140348],1],[[-1,141180],1],[[-1,141428],28],[[-1,141483],27],[[-1,141656],4],[[-1,142030],6],[[-1,142096],1],[[-1,142255],21],[[-1,142644],1],[[-1,143260],1],[[-1,143289],1],[[-1,197189],1],[[-1,137198],1],[[-1,137196],95],[[-1,137091],22],[[-1,137007],1],[[-1,136288],4],[[-1,136538],18],[[-1,136548],2],[[-1,137006],57],[[-1,136520],1],[[-1,136515],1],[[-1,136399],20],[[-1,136514],7],[[-1,136379],7],[[-1,136949],19],[[-1,136372],2],[[-1,136930],20],[[-1,136263],65],[[-1,136302],1],[[-1,136507],17],[[-1,136488],52],[[-1,136490],1],[[-1,136910],2],[[-1,136299],1],[[-1,136434],1],[[-1,136908],22],[[-1,136424],25],[[-1,136886],10],[[-1,137069],62],[[-1,136876],2],[[-1,136828],9],[[-1,136815],56],[[-1,136623],9],[[-1,136610],1],[[-1,136614],2],[[-1,136759],23],[[-1,136819],2],[[-1,136874],36],[[-1,136736],27],[[-1,136599],4],[[-1,136709],22],[[-1,136636],13],[[-1,136595],7],[[-1,136687],42],[[-1,137101],5],[[-1,137197],1],[[-1,139646],1],[[-1,139644],29],[[-1,138503],25],[[-1,139615],102],[[-1,139512],36],[[-1,139466],2],[[-1,139362],13],[[-1,139348],1],[[-1,139464],14],[[-1,139444],23],[[-1,139397],8],[[-1,139417],8],[[-1,139377],2],[[-1,139303],83],[[-1,139192],7],[[-1,139220],2],[[-1,139193],1],[[-1,139218],10],[[-1,139126],1],[[-1,139208],4],[[-1,139125],30],[[-1,139204],1],[[-1,139176],50],[[-1,139062],1],[[-1,139053],113],[[-1,137934],47],[[-1,137877],48],[[-1,137781],14],[[-1,137829],42],[[-1,137885],4],[[-1,137887],1],[[-1,138940],84],[[-1,138740],6],[[-1,138856],102],[[-1,138622],55],[[-1,138565],45],[[-1,138516],13],[[-1,138520],2],[[-1,138567],1],[[-1,138754],1],[[-1,138729],107],[[-1,138431],24],[[-1,138402],134],[[-1,138127],26],[[-1,137751],2],[[-1,138101],15],[[-1,137760],1],[[-1,138086],10],[[-1,137766],3],[[-1,138076],18],[[-1,137748],8],[[-1,138058],2],[[-1,138040],6],[[-1,138056],11],[[-1,138017],11],[[-1,137739],3],[[-1,138006],59],[[-1,137945],11],[[-1,137947],1],[[-1,138268],1],[[-1,138265],51],[[-1,138023],6],[[-1,138214],11],[[-1,138130],3],[[-1,138203],35],[[-1,138034],3],[[-1,138168],38],[[-1,138267],1],[[-1,138751],2],[[-1,138743],3],[[-1,138749],3],[[-1,138753],1],[[-1,139061],4],[[-1,139203],9],[[-1,139313],5],[[-1,139375],13],[[-1,139409],12],[[-1,139419],1],[[-1,139421],1],[[-1,139450],3],[[-1,139476],5],[[-1,139645],1],[[-1,133054],30],[[-1,133022],66],[[-1,133024],1],[[-1,133058],3],[[-1,245490],4],[[-1,255070],1],[[-1,256122],1],[[-1,256341],1],[[-1,256413],1],[[-1,256127],2],[[-1,256412],11],[[-1,256399],1],[[-1,256401],1],[[-1,256419],2],[[-1,256512],2],[[-1,256553],4],[[-1,256637],1],[[-1,256719],2],[[-1,256854],1],[[-1,256912],1],[[-1,259285],35],[[-1,135842],8],[[-1,259250],38],[[-1,259301],1],[[-1,259300],"\\end{document}\n"],[[-1,259335],3],[[-1,259403],5],[[-1,259526],1],[[-1,259531],2],[[-1,259551],1],[[-1,259718],1]]]]